"use strict";var _excluded=["region"],_excluded2=["chars","padding","resolution","textureWidth","textureHeight"];function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function _regeneratorRuntime(){return e;};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value;},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e];}try{define({},"");}catch(t){define=function define(t,e,r){return t[e]=r;};}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a;}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)};}catch(t){return{type:"throw",arg:t};}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this;});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t);});});}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a);},function(t){invoke("throw",t,i,a);}):e.resolve(h).then(function(t){u.value=t,i(u);},function(t){return invoke("throw",t,i,a);});}a(c.arg);}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r);});}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();}});}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0};}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u;}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg);}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done};}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg);}};}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y);}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e);}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e;}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0);}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next;};return i.next=i;}}throw new TypeError(_typeof(e)+" is not iterable");}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name));},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t;},e.awrap=function(t){return{__await:t};},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this;}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next();});},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this;}),define(g,"toString",function(){return"[object Generator]";}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next;}return next.done=!0,next;};},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t);},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval;},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o;}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc);}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc);}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break;}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a);},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y;},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y;}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r);}return o;}}throw Error("illegal catch attempt");},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y;}},e;}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value;}catch(n){return void e(n);}i.done?t(u):Promise.resolve(u).then(r,o);}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n);}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n);}_next(void 0);});};}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]};},e:function e(r){throw r;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var o,a=!0,u=!1;return{s:function s(){t=t.call(r);},n:function n(){var r=t.next();return a=r.done,r;},e:function e(r){u=!0,o=r;},f:function f(){try{a||null==t.return||t.return();}finally{if(u)throw o;}}};}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r);}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r);}function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o]);}return i;}function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n];}return t;}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var p=_superPropBase(e,t);if(p){var n=Object.getOwnPropertyDescriptor(p,t);return n.get?n.get.call(arguments.length<3?e:r):n.value;}},_get.apply(null,arguments);}function _superPropBase(t,o){for(;!{}.hasOwnProperty.call(t,o)&&null!==(t=_getPrototypeOf(t)););return t;}function _callSuper(t,o,e){return o=_getPrototypeOf(o),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(o,e||[],_getPrototypeOf(t).constructor):o.apply(t,e));}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t);}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e;}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t;})();}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t);},_getPrototypeOf(t);}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e);}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t;},_setPrototypeOf(t,e);}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e;}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function");}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o);}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+"";}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.");}return("string"===r?String:Number)(t);}function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0;}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n;}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1;}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r;}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return;}finally{if(o)throw n;}}return a;}}function _arrayWithHoles(r){if(Array.isArray(r))return r;}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}(function(global,factory){(typeof exports==="undefined"?"undefined":_typeof(exports))==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):(global=typeof globalThis!=='undefined'?globalThis:global||self,global.PIXI=factory());})(void 0,function(){'use strict';var _INTERNAL_FORMAT_TO_B;var ENV=/* @__PURE__ */function(ENV2){ENV2[ENV2["WEBGL_LEGACY"]=0]="WEBGL_LEGACY";ENV2[ENV2["WEBGL"]=1]="WEBGL";ENV2[ENV2["WEBGL2"]=2]="WEBGL2";return ENV2;}(ENV||{});var RENDERER_TYPE=/* @__PURE__ */function(RENDERER_TYPE2){RENDERER_TYPE2[RENDERER_TYPE2["UNKNOWN"]=0]="UNKNOWN";RENDERER_TYPE2[RENDERER_TYPE2["WEBGL"]=1]="WEBGL";RENDERER_TYPE2[RENDERER_TYPE2["CANVAS"]=2]="CANVAS";return RENDERER_TYPE2;}(RENDERER_TYPE||{});var BUFFER_BITS=/* @__PURE__ */function(BUFFER_BITS2){BUFFER_BITS2[BUFFER_BITS2["COLOR"]=16384]="COLOR";BUFFER_BITS2[BUFFER_BITS2["DEPTH"]=256]="DEPTH";BUFFER_BITS2[BUFFER_BITS2["STENCIL"]=1024]="STENCIL";return BUFFER_BITS2;}(BUFFER_BITS||{});var BLEND_MODES=/* @__PURE__ */function(BLEND_MODES2){BLEND_MODES2[BLEND_MODES2["NORMAL"]=0]="NORMAL";BLEND_MODES2[BLEND_MODES2["ADD"]=1]="ADD";BLEND_MODES2[BLEND_MODES2["MULTIPLY"]=2]="MULTIPLY";BLEND_MODES2[BLEND_MODES2["SCREEN"]=3]="SCREEN";BLEND_MODES2[BLEND_MODES2["OVERLAY"]=4]="OVERLAY";BLEND_MODES2[BLEND_MODES2["DARKEN"]=5]="DARKEN";BLEND_MODES2[BLEND_MODES2["LIGHTEN"]=6]="LIGHTEN";BLEND_MODES2[BLEND_MODES2["COLOR_DODGE"]=7]="COLOR_DODGE";BLEND_MODES2[BLEND_MODES2["COLOR_BURN"]=8]="COLOR_BURN";BLEND_MODES2[BLEND_MODES2["HARD_LIGHT"]=9]="HARD_LIGHT";BLEND_MODES2[BLEND_MODES2["SOFT_LIGHT"]=10]="SOFT_LIGHT";BLEND_MODES2[BLEND_MODES2["DIFFERENCE"]=11]="DIFFERENCE";BLEND_MODES2[BLEND_MODES2["EXCLUSION"]=12]="EXCLUSION";BLEND_MODES2[BLEND_MODES2["HUE"]=13]="HUE";BLEND_MODES2[BLEND_MODES2["SATURATION"]=14]="SATURATION";BLEND_MODES2[BLEND_MODES2["COLOR"]=15]="COLOR";BLEND_MODES2[BLEND_MODES2["LUMINOSITY"]=16]="LUMINOSITY";BLEND_MODES2[BLEND_MODES2["NORMAL_NPM"]=17]="NORMAL_NPM";BLEND_MODES2[BLEND_MODES2["ADD_NPM"]=18]="ADD_NPM";BLEND_MODES2[BLEND_MODES2["SCREEN_NPM"]=19]="SCREEN_NPM";BLEND_MODES2[BLEND_MODES2["NONE"]=20]="NONE";BLEND_MODES2[BLEND_MODES2["SRC_OVER"]=0]="SRC_OVER";BLEND_MODES2[BLEND_MODES2["SRC_IN"]=21]="SRC_IN";BLEND_MODES2[BLEND_MODES2["SRC_OUT"]=22]="SRC_OUT";BLEND_MODES2[BLEND_MODES2["SRC_ATOP"]=23]="SRC_ATOP";BLEND_MODES2[BLEND_MODES2["DST_OVER"]=24]="DST_OVER";BLEND_MODES2[BLEND_MODES2["DST_IN"]=25]="DST_IN";BLEND_MODES2[BLEND_MODES2["DST_OUT"]=26]="DST_OUT";BLEND_MODES2[BLEND_MODES2["DST_ATOP"]=27]="DST_ATOP";BLEND_MODES2[BLEND_MODES2["ERASE"]=26]="ERASE";BLEND_MODES2[BLEND_MODES2["SUBTRACT"]=28]="SUBTRACT";BLEND_MODES2[BLEND_MODES2["XOR"]=29]="XOR";return BLEND_MODES2;}(BLEND_MODES||{});var DRAW_MODES=/* @__PURE__ */function(DRAW_MODES2){DRAW_MODES2[DRAW_MODES2["POINTS"]=0]="POINTS";DRAW_MODES2[DRAW_MODES2["LINES"]=1]="LINES";DRAW_MODES2[DRAW_MODES2["LINE_LOOP"]=2]="LINE_LOOP";DRAW_MODES2[DRAW_MODES2["LINE_STRIP"]=3]="LINE_STRIP";DRAW_MODES2[DRAW_MODES2["TRIANGLES"]=4]="TRIANGLES";DRAW_MODES2[DRAW_MODES2["TRIANGLE_STRIP"]=5]="TRIANGLE_STRIP";DRAW_MODES2[DRAW_MODES2["TRIANGLE_FAN"]=6]="TRIANGLE_FAN";return DRAW_MODES2;}(DRAW_MODES||{});var FORMATS=/* @__PURE__ */function(FORMATS2){FORMATS2[FORMATS2["RGBA"]=6408]="RGBA";FORMATS2[FORMATS2["RGB"]=6407]="RGB";FORMATS2[FORMATS2["RG"]=33319]="RG";FORMATS2[FORMATS2["RED"]=6403]="RED";FORMATS2[FORMATS2["RGBA_INTEGER"]=36249]="RGBA_INTEGER";FORMATS2[FORMATS2["RGB_INTEGER"]=36248]="RGB_INTEGER";FORMATS2[FORMATS2["RG_INTEGER"]=33320]="RG_INTEGER";FORMATS2[FORMATS2["RED_INTEGER"]=36244]="RED_INTEGER";FORMATS2[FORMATS2["ALPHA"]=6406]="ALPHA";FORMATS2[FORMATS2["LUMINANCE"]=6409]="LUMINANCE";FORMATS2[FORMATS2["LUMINANCE_ALPHA"]=6410]="LUMINANCE_ALPHA";FORMATS2[FORMATS2["DEPTH_COMPONENT"]=6402]="DEPTH_COMPONENT";FORMATS2[FORMATS2["DEPTH_STENCIL"]=34041]="DEPTH_STENCIL";return FORMATS2;}(FORMATS||{});var TARGETS=/* @__PURE__ */function(TARGETS2){TARGETS2[TARGETS2["TEXTURE_2D"]=3553]="TEXTURE_2D";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP"]=34067]="TEXTURE_CUBE_MAP";TARGETS2[TARGETS2["TEXTURE_2D_ARRAY"]=35866]="TEXTURE_2D_ARRAY";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_POSITIVE_X"]=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_NEGATIVE_X"]=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_POSITIVE_Y"]=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_NEGATIVE_Y"]=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_POSITIVE_Z"]=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_NEGATIVE_Z"]=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";return TARGETS2;}(TARGETS||{});var TYPES=/* @__PURE__ */function(TYPES2){TYPES2[TYPES2["UNSIGNED_BYTE"]=5121]="UNSIGNED_BYTE";TYPES2[TYPES2["UNSIGNED_SHORT"]=5123]="UNSIGNED_SHORT";TYPES2[TYPES2["UNSIGNED_SHORT_5_6_5"]=33635]="UNSIGNED_SHORT_5_6_5";TYPES2[TYPES2["UNSIGNED_SHORT_4_4_4_4"]=32819]="UNSIGNED_SHORT_4_4_4_4";TYPES2[TYPES2["UNSIGNED_SHORT_5_5_5_1"]=32820]="UNSIGNED_SHORT_5_5_5_1";TYPES2[TYPES2["UNSIGNED_INT"]=5125]="UNSIGNED_INT";TYPES2[TYPES2["UNSIGNED_INT_10F_11F_11F_REV"]=35899]="UNSIGNED_INT_10F_11F_11F_REV";TYPES2[TYPES2["UNSIGNED_INT_2_10_10_10_REV"]=33640]="UNSIGNED_INT_2_10_10_10_REV";TYPES2[TYPES2["UNSIGNED_INT_24_8"]=34042]="UNSIGNED_INT_24_8";TYPES2[TYPES2["UNSIGNED_INT_5_9_9_9_REV"]=35902]="UNSIGNED_INT_5_9_9_9_REV";TYPES2[TYPES2["BYTE"]=5120]="BYTE";TYPES2[TYPES2["SHORT"]=5122]="SHORT";TYPES2[TYPES2["INT"]=5124]="INT";TYPES2[TYPES2["FLOAT"]=5126]="FLOAT";TYPES2[TYPES2["FLOAT_32_UNSIGNED_INT_24_8_REV"]=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV";TYPES2[TYPES2["HALF_FLOAT"]=36193]="HALF_FLOAT";return TYPES2;}(TYPES||{});var SAMPLER_TYPES=/* @__PURE__ */function(SAMPLER_TYPES2){SAMPLER_TYPES2[SAMPLER_TYPES2["FLOAT"]=0]="FLOAT";SAMPLER_TYPES2[SAMPLER_TYPES2["INT"]=1]="INT";SAMPLER_TYPES2[SAMPLER_TYPES2["UINT"]=2]="UINT";return SAMPLER_TYPES2;}(SAMPLER_TYPES||{});var SCALE_MODES=/* @__PURE__ */function(SCALE_MODES2){SCALE_MODES2[SCALE_MODES2["NEAREST"]=0]="NEAREST";SCALE_MODES2[SCALE_MODES2["LINEAR"]=1]="LINEAR";return SCALE_MODES2;}(SCALE_MODES||{});var WRAP_MODES=/* @__PURE__ */function(WRAP_MODES2){WRAP_MODES2[WRAP_MODES2["CLAMP"]=33071]="CLAMP";WRAP_MODES2[WRAP_MODES2["REPEAT"]=10497]="REPEAT";WRAP_MODES2[WRAP_MODES2["MIRRORED_REPEAT"]=33648]="MIRRORED_REPEAT";return WRAP_MODES2;}(WRAP_MODES||{});var MIPMAP_MODES=/* @__PURE__ */function(MIPMAP_MODES2){MIPMAP_MODES2[MIPMAP_MODES2["OFF"]=0]="OFF";MIPMAP_MODES2[MIPMAP_MODES2["POW2"]=1]="POW2";MIPMAP_MODES2[MIPMAP_MODES2["ON"]=2]="ON";MIPMAP_MODES2[MIPMAP_MODES2["ON_MANUAL"]=3]="ON_MANUAL";return MIPMAP_MODES2;}(MIPMAP_MODES||{});var ALPHA_MODES=/* @__PURE__ */function(ALPHA_MODES2){ALPHA_MODES2[ALPHA_MODES2["NPM"]=0]="NPM";ALPHA_MODES2[ALPHA_MODES2["UNPACK"]=1]="UNPACK";ALPHA_MODES2[ALPHA_MODES2["PMA"]=2]="PMA";ALPHA_MODES2[ALPHA_MODES2["NO_PREMULTIPLIED_ALPHA"]=0]="NO_PREMULTIPLIED_ALPHA";ALPHA_MODES2[ALPHA_MODES2["PREMULTIPLY_ON_UPLOAD"]=1]="PREMULTIPLY_ON_UPLOAD";ALPHA_MODES2[ALPHA_MODES2["PREMULTIPLIED_ALPHA"]=2]="PREMULTIPLIED_ALPHA";return ALPHA_MODES2;}(ALPHA_MODES||{});var CLEAR_MODES=/* @__PURE__ */function(CLEAR_MODES2){CLEAR_MODES2[CLEAR_MODES2["NO"]=0]="NO";CLEAR_MODES2[CLEAR_MODES2["YES"]=1]="YES";CLEAR_MODES2[CLEAR_MODES2["AUTO"]=2]="AUTO";CLEAR_MODES2[CLEAR_MODES2["BLEND"]=0]="BLEND";CLEAR_MODES2[CLEAR_MODES2["CLEAR"]=1]="CLEAR";CLEAR_MODES2[CLEAR_MODES2["BLIT"]=2]="BLIT";return CLEAR_MODES2;}(CLEAR_MODES||{});var GC_MODES=/* @__PURE__ */function(GC_MODES2){GC_MODES2[GC_MODES2["AUTO"]=0]="AUTO";GC_MODES2[GC_MODES2["MANUAL"]=1]="MANUAL";return GC_MODES2;}(GC_MODES||{});var PRECISION=/* @__PURE__ */function(PRECISION2){PRECISION2["LOW"]="lowp";PRECISION2["MEDIUM"]="mediump";PRECISION2["HIGH"]="highp";return PRECISION2;}(PRECISION||{});var MASK_TYPES=/* @__PURE__ */function(MASK_TYPES2){MASK_TYPES2[MASK_TYPES2["NONE"]=0]="NONE";MASK_TYPES2[MASK_TYPES2["SCISSOR"]=1]="SCISSOR";MASK_TYPES2[MASK_TYPES2["STENCIL"]=2]="STENCIL";MASK_TYPES2[MASK_TYPES2["SPRITE"]=3]="SPRITE";MASK_TYPES2[MASK_TYPES2["COLOR"]=4]="COLOR";return MASK_TYPES2;}(MASK_TYPES||{});var COLOR_MASK_BITS=/* @__PURE__ */function(COLOR_MASK_BITS2){COLOR_MASK_BITS2[COLOR_MASK_BITS2["RED"]=1]="RED";COLOR_MASK_BITS2[COLOR_MASK_BITS2["GREEN"]=2]="GREEN";COLOR_MASK_BITS2[COLOR_MASK_BITS2["BLUE"]=4]="BLUE";COLOR_MASK_BITS2[COLOR_MASK_BITS2["ALPHA"]=8]="ALPHA";return COLOR_MASK_BITS2;}(COLOR_MASK_BITS||{});var MSAA_QUALITY=/* @__PURE__ */function(MSAA_QUALITY2){MSAA_QUALITY2[MSAA_QUALITY2["NONE"]=0]="NONE";MSAA_QUALITY2[MSAA_QUALITY2["LOW"]=2]="LOW";MSAA_QUALITY2[MSAA_QUALITY2["MEDIUM"]=4]="MEDIUM";MSAA_QUALITY2[MSAA_QUALITY2["HIGH"]=8]="HIGH";return MSAA_QUALITY2;}(MSAA_QUALITY||{});var BUFFER_TYPE=/* @__PURE__ */function(BUFFER_TYPE2){BUFFER_TYPE2[BUFFER_TYPE2["ELEMENT_ARRAY_BUFFER"]=34963]="ELEMENT_ARRAY_BUFFER";BUFFER_TYPE2[BUFFER_TYPE2["ARRAY_BUFFER"]=34962]="ARRAY_BUFFER";BUFFER_TYPE2[BUFFER_TYPE2["UNIFORM_BUFFER"]=35345]="UNIFORM_BUFFER";return BUFFER_TYPE2;}(BUFFER_TYPE||{});var BrowserAdapter={createCanvas:function createCanvas(width,height){var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;return canvas;},getCanvasRenderingContext2D:function getCanvasRenderingContext2D(){return CanvasRenderingContext2D;},getWebGLRenderingContext:function getWebGLRenderingContext(){return WebGLRenderingContext;},getNavigator:function getNavigator(){return navigator;},getBaseUrl:function getBaseUrl(){var _document$baseURI;return(_document$baseURI=document.baseURI)!==null&&_document$baseURI!==void 0?_document$baseURI:window.location.href;},getFontFaceSet:function getFontFaceSet(){return document.fonts;},fetch:function(_fetch){function fetch(_x,_x2){return _fetch.apply(this,arguments);}fetch.toString=function(){return _fetch.toString();};return fetch;}(function(url,options){return fetch(url,options);}),parseXML:function parseXML(xml){var parser=new DOMParser();return parser.parseFromString(xml,"text/xml");}};var settings={ADAPTER:BrowserAdapter,RESOLUTION:1,RENDER_OPTIONS:{view:null,width:800,height:600,autoDensity:false,backgroundColor:0,backgroundAlpha:1,clearBeforeRender:true,antialias:false,premultipliedAlpha:true,preserveDrawingBuffer:false,hello:false},CREATE_IMAGE_BITMAP:false,ROUND_PIXELS:false};var appleIphone=/iPhone/i;var appleIpod=/iPod/i;var appleTablet=/iPad/i;var appleUniversal=/\biOS-universal(?:.+)Mac\b/i;var androidPhone=/\bAndroid(?:.+)Mobile\b/i;var androidTablet=/Android/i;var amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i;var amazonTablet=/Silk/i;var windowsPhone=/Windows Phone/i;var windowsTablet=/\bWindows(?:.+)ARM\b/i;var otherBlackBerry=/BlackBerry/i;var otherBlackBerry10=/BB10/i;var otherOpera=/Opera Mini/i;var otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i;var otherFirefox=/Mobile(?:.+)Firefox\b/i;var isAppleTabletOnIos13=function isAppleTabletOnIos13(navigator){return typeof navigator!=='undefined'&&navigator.platform==='MacIntel'&&typeof navigator.maxTouchPoints==='number'&&navigator.maxTouchPoints>1&&typeof MSStream==='undefined';};function createMatch(userAgent){return function(regex){return regex.test(userAgent);};}function isMobile$1(param){var nav={userAgent:'',platform:'',maxTouchPoints:0};if(!param&&typeof navigator!=='undefined'){nav={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};}else if(typeof param==='string'){nav.userAgent=param;}else if(param&&param.userAgent){nav={userAgent:param.userAgent,platform:param.platform,maxTouchPoints:param.maxTouchPoints||0};}var userAgent=nav.userAgent;var tmp=userAgent.split('[FBAN');if(typeof tmp[1]!=='undefined'){userAgent=tmp[0];}tmp=userAgent.split('Twitter');if(typeof tmp[1]!=='undefined'){userAgent=tmp[0];}var match=createMatch(userAgent);var result={apple:{phone:match(appleIphone)&&!match(windowsPhone),ipod:match(appleIpod),tablet:!match(appleIphone)&&(match(appleTablet)||isAppleTabletOnIos13(nav))&&!match(windowsPhone),universal:match(appleUniversal),device:(match(appleIphone)||match(appleIpod)||match(appleTablet)||match(appleUniversal)||isAppleTabletOnIos13(nav))&&!match(windowsPhone)},amazon:{phone:match(amazonPhone),tablet:!match(amazonPhone)&&match(amazonTablet),device:match(amazonPhone)||match(amazonTablet)},android:{phone:!match(windowsPhone)&&match(amazonPhone)||!match(windowsPhone)&&match(androidPhone),tablet:!match(windowsPhone)&&!match(amazonPhone)&&!match(androidPhone)&&(match(amazonTablet)||match(androidTablet)),device:!match(windowsPhone)&&(match(amazonPhone)||match(amazonTablet)||match(androidPhone)||match(androidTablet))||match(/\bokhttp\b/i)},windows:{phone:match(windowsPhone),tablet:match(windowsTablet),device:match(windowsPhone)||match(windowsTablet)},other:{blackberry:match(otherBlackBerry),blackberry10:match(otherBlackBerry10),opera:match(otherOpera),firefox:match(otherFirefox),chrome:match(otherChrome),device:match(otherBlackBerry)||match(otherBlackBerry10)||match(otherOpera)||match(otherFirefox)||match(otherChrome)},any:false,phone:false,tablet:false};result.any=result.apple.device||result.android.device||result.windows.device||result.other.device;result.phone=result.apple.phone||result.android.phone||result.windows.phone;result.tablet=result.apple.tablet||result.android.tablet||result.windows.tablet;return result;}var isMobile=isMobile$1(globalThis.navigator);settings.RETINA_PREFIX=/@([0-9\.]+)x/;settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=false;var commonjsGlobal=typeof globalThis!=='undefined'?globalThis:typeof window!=='undefined'?window:typeof global!=='undefined'?global:typeof self!=='undefined'?self:{};function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,'default')?x['default']:x;}function getAugmentedNamespace(n){if(n.__esModule)return n;var f=n.default;if(typeof f=="function"){var a=function a(){if(this instanceof a){return Reflect.construct(f,arguments,this.constructor);}return f.apply(this,arguments);};a.prototype=f.prototype;}else a={};Object.defineProperty(a,'__esModule',{value:true});Object.keys(n).forEach(function(k){var d=Object.getOwnPropertyDescriptor(n,k);Object.defineProperty(a,k,d.get?d:{enumerable:true,get:function get(){return n[k];}});});return a;}var eventemitter3={exports:{}};(function(module){var has=Object.prototype.hasOwnProperty,prefix='~';/**
  	 * Constructor to create a storage for our `EE` objects.
  	 * An `Events` instance is a plain object whose properties are event names.
  	 *
  	 * @constructor
  	 * @private
  	 */function Events(){}//
// We try to not inherit from `Object.prototype`. In some engines creating an
// instance in this way is faster than calling `Object.create(null)` directly.
// If `Object.create(null)` is not supported we prefix the event names with a
// character to make sure that the built-in object properties are not
// overridden or used as an attack vector.
//
if(Object.create){Events.prototype=Object.create(null);//
// This hack is needed because the `__proto__` property is still inherited in
// some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.
//
if(!new Events().__proto__)prefix=false;}/**
  	 * Representation of a single event listener.
  	 *
  	 * @param {Function} fn The listener function.
  	 * @param {*} context The context to invoke the listener with.
  	 * @param {Boolean} [once=false] Specify if the listener is a one-time listener.
  	 * @constructor
  	 * @private
  	 */function EE(fn,context,once){this.fn=fn;this.context=context;this.once=once||false;}/**
  	 * Add a listener for a given event.
  	 *
  	 * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.
  	 * @param {(String|Symbol)} event The event name.
  	 * @param {Function} fn The listener function.
  	 * @param {*} context The context to invoke the listener with.
  	 * @param {Boolean} once Specify if the listener is a one-time listener.
  	 * @returns {EventEmitter}
  	 * @private
  	 */function addListener(emitter,event,fn,context,once){if(typeof fn!=='function'){throw new TypeError('The listener must be a function');}var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;if(!emitter._events[evt])emitter._events[evt]=listener,emitter._eventsCount++;else if(!emitter._events[evt].fn)emitter._events[evt].push(listener);else emitter._events[evt]=[emitter._events[evt],listener];return emitter;}/**
  	 * Clear event by name.
  	 *
  	 * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.
  	 * @param {(String|Symbol)} evt The Event name.
  	 * @private
  	 */function clearEvent(emitter,evt){if(--emitter._eventsCount===0)emitter._events=new Events();else delete emitter._events[evt];}/**
  	 * Minimal `EventEmitter` interface that is molded against the Node.js
  	 * `EventEmitter` interface.
  	 *
  	 * @constructor
  	 * @public
  	 */function EventEmitter(){this._events=new Events();this._eventsCount=0;}/**
  	 * Return an array listing the events for which the emitter has registered
  	 * listeners.
  	 *
  	 * @returns {Array}
  	 * @public
  	 */EventEmitter.prototype.eventNames=function eventNames(){var names=[],events,name;if(this._eventsCount===0)return names;for(name in events=this._events){if(has.call(events,name))names.push(prefix?name.slice(1):name);}if(Object.getOwnPropertySymbols){return names.concat(Object.getOwnPropertySymbols(events));}return names;};/**
  	 * Return the listeners registered for a given event.
  	 *
  	 * @param {(String|Symbol)} event The event name.
  	 * @returns {Array} The registered listeners.
  	 * @public
  	 */EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++){ee[i]=handlers[i].fn;}return ee;};/**
  	 * Return the number of listeners listening to a given event.
  	 *
  	 * @param {(String|Symbol)} event The event name.
  	 * @returns {Number} The number of listeners.
  	 * @public
  	 */EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];if(!listeners)return 0;if(listeners.fn)return 1;return listeners.length;};/**
  	 * Calls each of the listeners registered for a given event.
  	 *
  	 * @param {(String|Symbol)} event The event name.
  	 * @returns {Boolean} `true` if the event had listeners, else `false`.
  	 * @public
  	 */EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return false;var listeners=this._events[evt],len=arguments.length,args,i;if(listeners.fn){if(listeners.once)this.removeListener(event,listeners.fn,undefined,true);switch(len){case 1:return listeners.fn.call(listeners.context),true;case 2:return listeners.fn.call(listeners.context,a1),true;case 3:return listeners.fn.call(listeners.context,a1,a2),true;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),true;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),true;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),true;}for(i=1,args=new Array(len-1);i<len;i++){args[i-1]=arguments[i];}listeners.fn.apply(listeners.context,args);}else{var length=listeners.length,j;for(i=0;i<length;i++){if(listeners[i].once)this.removeListener(event,listeners[i].fn,undefined,true);switch(len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++){args[j-1]=arguments[j];}listeners[i].fn.apply(listeners[i].context,args);}}}return true;};/**
  	 * Add a listener for a given event.
  	 *
  	 * @param {(String|Symbol)} event The event name.
  	 * @param {Function} fn The listener function.
  	 * @param {*} [context=this] The context to invoke the listener with.
  	 * @returns {EventEmitter} `this`.
  	 * @public
  	 */EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,false);};/**
  	 * Add a one-time listener for a given event.
  	 *
  	 * @param {(String|Symbol)} event The event name.
  	 * @param {Function} fn The listener function.
  	 * @param {*} [context=this] The context to invoke the listener with.
  	 * @returns {EventEmitter} `this`.
  	 * @public
  	 */EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,true);};/**
  	 * Remove the listeners of a given event.
  	 *
  	 * @param {(String|Symbol)} event The event name.
  	 * @param {Function} fn Only remove the listeners that match this function.
  	 * @param {*} context Only remove the listeners that have this context.
  	 * @param {Boolean} once Only remove one-time listeners.
  	 * @returns {EventEmitter} `this`.
  	 * @public
  	 */EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn){clearEvent(this,evt);return this;}var listeners=this._events[evt];if(listeners.fn){if(listeners.fn===fn&&(!once||listeners.once)&&(!context||listeners.context===context)){clearEvent(this,evt);}}else{for(var i=0,events=[],length=listeners.length;i<length;i++){if(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context){events.push(listeners[i]);}}//
// Reset the array, or remove it completely if we have no more listeners.
//
if(events.length)this._events[evt]=events.length===1?events[0]:events;else clearEvent(this,evt);}return this;};/**
  	 * Remove all listeners, or those of the specified event.
  	 *
  	 * @param {(String|Symbol)} [event] The event name.
  	 * @returns {EventEmitter} `this`.
  	 * @public
  	 */EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;if(event){evt=prefix?prefix+event:event;if(this._events[evt])clearEvent(this,evt);}else{this._events=new Events();this._eventsCount=0;}return this;};//
// Alias methods names because people roll like that.
//
EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.addListener=EventEmitter.prototype.on;//
// Expose the prefix.
//
EventEmitter.prefixed=prefix;//
// Allow `EventEmitter` to be imported as module namespace.
//
EventEmitter.EventEmitter=EventEmitter;//
// Expose the module.
//
{module.exports=EventEmitter;}})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;var EventEmitter=/*@__PURE__*/getDefaultExportFromCjs(eventemitter3Exports);var earcut$2={exports:{}};earcut$2.exports=earcut;earcut$2.exports.default=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;var minX,minY,maxX,maxY,x,y,invSize;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);// if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox
if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y;}// minX, minY and invSize are later used to transform coords into integers for z-order calculation
invSize=Math.max(maxX-minX,maxY-minY);invSize=invSize!==0?32767/invSize:0;}earcutLinked(outerNode,triangles,dim,minX,minY,invSize,0);return triangles;}// create a circular doubly linked list from polygon points in the specified winding order
function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0){for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);}if(last&&equals(last,last.next)){removeNode(last);last=last.next;}return last;}// eliminate colinear or duplicate points
function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)break;again=true;}else{p=p.next;}}while(again||p!==end);return end;}// main ear slicing loop which triangulates a polygon (given as a linked list)
function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(!ear)return;// interlink polygon nodes in z-order
if(!pass&&invSize)indexCurve(ear,minX,minY,invSize);var stop=ear,prev,next;// iterate through ears, slicing them one by one
while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){// cut off the triangle
triangles.push(prev.i/dim|0);triangles.push(ear.i/dim|0);triangles.push(next.i/dim|0);removeNode(ear);// skipping the next vertex leads to less sliver triangles
ear=next.next;stop=next.next;continue;}ear=next;// if we looped through the whole remaining polygon and can't find any more ears
if(ear===stop){// try filtering points and slicing again
if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);// if this didn't work, try curing all small self-intersections locally
}else if(pass===1){ear=cureLocalIntersections(filterPoints(ear),triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,invSize,2);// as a last resort, try splitting the remaining polygon into two
}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,invSize);}break;}}}// check whether a polygon node forms a valid ear with adjacent nodes
function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;// reflex, can't be an ear
// now make sure we don't have other points inside the potential ear
var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y;// triangle bbox; min & max are calculated like this for speed
var x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy;var p=c.next;while(p!==a){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next;}return true;}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;// reflex, can't be an ear
var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y;// triangle bbox; min & max are calculated like this for speed
var x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy;// z-order range for the current triangle bbox;
var minZ=zOrder(x0,y0,minX,minY,invSize),maxZ=zOrder(x1,y1,minX,minY,invSize);var p=ear.prevZ,n=ear.nextZ;// look for points inside the triangle in both directions
while(p&&p.z>=minZ&&n&&n.z<=maxZ){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ;if(n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.nextZ;}// look for remaining points in decreasing z-order
while(p&&p.z>=minZ){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ;}// look for remaining points in increasing z-order
while(n&&n.z<=maxZ){if(n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.nextZ;}return true;}// go through all polygon nodes and cure small local self-intersections
function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim|0);triangles.push(p.i/dim|0);triangles.push(b.i/dim|0);// remove two nodes involved
removeNode(p);removeNode(p.next);p=start=b;}p=p.next;}while(p!==start);return filterPoints(p);}// try splitting polygon into two and triangulate them independently
function splitEarcut(start,triangles,dim,minX,minY,invSize){// look for a valid diagonal that divides the polygon into two
var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){// split the polygon in two by the diagonal
var c=splitPolygon(a,b);// filter colinear points around the cuts
a=filterPoints(a,a.next);c=filterPoints(c,c.next);// run earcut on each half
earcutLinked(a,triangles,dim,minX,minY,invSize,0);earcutLinked(c,triangles,dim,minX,minY,invSize,0);return;}b=b.next;}a=a.next;}while(a!==start);}// link every hole into the outer loop, producing a single-ring polygon without holes
function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list));}queue.sort(compareX);// process holes from left to right
for(i=0;i<queue.length;i++){outerNode=eliminateHole(queue[i],outerNode);}return outerNode;}function compareX(a,b){return a.x-b.x;}// find a bridge between vertices that connects hole with an outer ring and and link it
function eliminateHole(hole,outerNode){var bridge=findHoleBridge(hole,outerNode);if(!bridge){return outerNode;}var bridgeReverse=splitPolygon(bridge,hole);// filter collinear points around the cuts
filterPoints(bridgeReverse,bridgeReverse.next);return filterPoints(bridge,bridge.next);}// David Eberly's algorithm for finding a bridge between hole and outer polygon
function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;// find a segment intersected by a ray from the hole's leftmost point to the left;
// segment's endpoint with lesser x will be potential connection point
do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;m=p.x<p.next.x?p:p.next;if(x===hx)return m;// hole touches outer segment; pick leftmost endpoint
}}p=p.next;}while(p!==outerNode);if(!m)return null;// look for points inside the triangle of hole point, segment intersection and endpoint;
// if there are no points found, we have a valid connection;
// otherwise choose the point of the minimum angle with the ray as connection point
var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m;do{if(hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);// tangential
if(locallyInside(p,hole)&&(tan<tanMin||tan===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))){m=p;tanMin=tan;}}p=p.next;}while(p!==stop);return m;}// whether sector in vertex m contains sector in vertex p in the same coordinates
function sectorContainsSector(m,p){return area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0;}// interlink polygon nodes in z-order
function indexCurve(start,minX,minY,invSize){var p=start;do{if(p.z===0)p.z=zOrder(p.x,p.y,minX,minY,invSize);p.prevZ=p.prev;p.nextZ=p.next;p=p.next;}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p);}// Simon Tatham's linked list merge sort algorithm
// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html
function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break;}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize!==0&&(qSize===0||!q||p.z<=q.z)){e=p;p=p.nextZ;pSize--;}else{e=q;q=q.nextZ;qSize--;}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e;}p=q;}tail.nextZ=null;inSize*=2;}while(numMerges>1);return list;}// z-order of a point given coords and inverse of the longer side of data bbox
function zOrder(x,y,minX,minY,invSize){// coords are transformed into non-negative 15-bit integer range
x=(x-minX)*invSize|0;y=(y-minY)*invSize|0;x=(x|x<<8)&0x00FF00FF;x=(x|x<<4)&0x0F0F0F0F;x=(x|x<<2)&0x33333333;x=(x|x<<1)&0x55555555;y=(y|y<<8)&0x00FF00FF;y=(y|y<<4)&0x0F0F0F0F;y=(y|y<<2)&0x33333333;y=(y|y<<1)&0x55555555;return x|y<<1;}// find the leftmost node of a polygon ring
function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)leftmost=p;p=p.next;}while(p!==start);return leftmost;}// check if a point lies within a convex triangle
function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)>=(ax-px)*(cy-py)&&(ax-px)*(by-py)>=(bx-px)*(ay-py)&&(bx-px)*(cy-py)>=(cx-px)*(by-py);}// check if a diagonal between two polygon nodes is valid (lies in polygon interior)
function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&(// dones't intersect other edges
locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)&&(// locally visible
area(a.prev,a,b.prev)||area(a,b.prev,b))||// does not create opposite-facing sectors
equals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0);// special zero-length case
}// signed area of a triangle
function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y);}// check if two points are equal
function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y;}// check if two segments intersect
function intersects(p1,q1,p2,q2){var o1=sign$1(area(p1,q1,p2));var o2=sign$1(area(p1,q1,q2));var o3=sign$1(area(p2,q2,p1));var o4=sign$1(area(p2,q2,q1));if(o1!==o2&&o3!==o4)return true;// general case
if(o1===0&&onSegment(p1,p2,q1))return true;// p1, q1 and p2 are collinear and p2 lies on p1q1
if(o2===0&&onSegment(p1,q2,q1))return true;// p1, q1 and q2 are collinear and q2 lies on p1q1
if(o3===0&&onSegment(p2,p1,q2))return true;// p2, q2 and p1 are collinear and p1 lies on p2q2
if(o4===0&&onSegment(p2,q1,q2))return true;// p2, q2 and q1 are collinear and q1 lies on p2q2
return false;}// for collinear points p, q, r, check if point q lies on segment pr
function onSegment(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y);}function sign$1(num){return num>0?1:num<0?-1:0;}// check if a polygon diagonal intersects any polygon segments
function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next;}while(p!==a);return false;}// check if a polygon diagonal is locally inside the polygon
function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0;}// check if the middle point of a polygon diagonal is inside the polygon
function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next;}while(p!==a);return inside;}// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;
// if one belongs to the outer ring and another to a hole, it merges it into a single ring
function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2;}// create a node and optionally link it with previous one (in a circular doubly linked list)
function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p;}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p;}return p;}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ;}function Node(i,x,y){// vertex index in coordinates array
this.i=i;// vertex coordinates
this.x=x;this.y=y;// previous and next vertex nodes in a polygon ring
this.prev=null;this.next=null;// z-order curve value
this.z=0;// previous and next nodes in z-order
this.prevZ=null;this.nextZ=null;// indicates whether this is a steiner point
this.steiner=false;}// return a percentage difference between the polygon area and its triangulation area;
// used to verify correctness of triangulation
earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length;var outerLen=hasHoles?holeIndices[0]*dim:data.length;var polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles){for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim;var end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim));}}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim;var b=triangles[i+1]*dim;var c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]));}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea);};function signedArea(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i;}return sum;}// turn a polygon in a multi-dimensional array form (e.g. as in GeoJSON) into a form Earcut accepts
earcut.flatten=function(data){var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);}if(i>0){holeIndex+=data[i-1].length;result.holes.push(holeIndex);}}return result;};var earcutExports=earcut$2.exports;var earcut$1=/*@__PURE__*/getDefaultExportFromCjs(earcutExports);var punycode$1={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */punycode$1.exports;(function(module,exports){(function(root){/** Detect free variables */var freeExports=exports&&!exports.nodeType&&exports;var freeModule=module&&!module.nodeType&&module;var freeGlobal=_typeof(commonjsGlobal)=='object'&&commonjsGlobal;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal;}/**
  		 * The `punycode` object.
  		 * @name punycode
  		 * @type Object
  		 */var punycode,/** Highest positive signed 32-bit float value */maxInt=2147483647,// aka. 0x7FFFFFFF or 2^31-1
/** Bootstring parameters */base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,// 0x80
delimiter='-',// '\x2D'
/** Regular expressions */regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,// unprintable ASCII chars + non-ASCII chars
regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,// RFC 3490 separators
/** Error messages */errors={'overflow':'Overflow: input needs wider integers to process','not-basic':'Illegal input >= 0x80 (not a basic code point)','invalid-input':'Invalid input'},/** Convenience shortcuts */baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,/** Temporary variable */key;/*--------------------------------------------------------------------------*/ /**
  		 * A generic error utility function.
  		 * @private
  		 * @param {String} type The error type.
  		 * @returns {Error} Throws a `RangeError` with the applicable error message.
  		 */function error(type){throw new RangeError(errors[type]);}/**
  		 * A generic `Array#map` utility function.
  		 * @private
  		 * @param {Array} array The array to iterate over.
  		 * @param {Function} callback The function that gets called for every array
  		 * item.
  		 * @returns {Array} A new array of values returned by the callback function.
  		 */function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length]);}return result;}/**
  		 * A simple `Array#map`-like wrapper to work with domain name strings or email
  		 * addresses.
  		 * @private
  		 * @param {String} domain The domain name or email address.
  		 * @param {Function} callback The function that gets called for every
  		 * character.
  		 * @returns {Array} A new string of characters returned by the callback
  		 * function.
  		 */function mapDomain(string,fn){var parts=string.split('@');var result='';if(parts.length>1){// In email addresses, only the domain name should be punycoded. Leave
// the local part (i.e. everything up to `@`) intact.
result=parts[0]+'@';string=parts[1];}// Avoid `split(regex)` for IE8 compatibility. See #17.
string=string.replace(regexSeparators,'\x2E');var labels=string.split('.');var encoded=map(labels,fn).join('.');return result+encoded;}/**
  		 * Creates an array containing the numeric code points of each Unicode
  		 * character in the string. While JavaScript uses UCS-2 internally,
  		 * this function will convert a pair of surrogate halves (each of which
  		 * UCS-2 exposes as separate characters) into a single code point,
  		 * matching UTF-16.
  		 * @see `punycode.ucs2.encode`
  		 * @see <https://mathiasbynens.be/notes/javascript-encoding>
  		 * @memberOf punycode.ucs2
  		 * @name decode
  		 * @param {String} string The Unicode input string (UCS-2).
  		 * @returns {Array} The new array of code points.
  		 */function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=0xD800&&value<=0xDBFF&&counter<length){// high surrogate, and there is a next character
extra=string.charCodeAt(counter++);if((extra&0xFC00)==0xDC00){// low surrogate
output.push(((value&0x3FF)<<10)+(extra&0x3FF)+0x10000);}else{// unmatched surrogate; only append this code unit, in case the next
// code unit is the high surrogate of a surrogate pair
output.push(value);counter--;}}else{output.push(value);}}return output;}/**
  		 * Creates a string based on an array of numeric code points.
  		 * @see `punycode.ucs2.decode`
  		 * @memberOf punycode.ucs2
  		 * @name encode
  		 * @param {Array} codePoints The array of numeric code points.
  		 * @returns {String} The new Unicode string (UCS-2).
  		 */function ucs2encode(array){return map(array,function(value){var output='';if(value>0xFFFF){value-=0x10000;output+=stringFromCharCode(value>>>10&0x3FF|0xD800);value=0xDC00|value&0x3FF;}output+=stringFromCharCode(value);return output;}).join('');}/**
  		 * Converts a basic code point into a digit/integer.
  		 * @see `digitToBasic()`
  		 * @private
  		 * @param {Number} codePoint The basic numeric code point value.
  		 * @returns {Number} The numeric value of a basic code point (for use in
  		 * representing integers) in the range `0` to `base - 1`, or `base` if
  		 * the code point does not represent a value.
  		 */function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22;}if(codePoint-65<26){return codePoint-65;}if(codePoint-97<26){return codePoint-97;}return base;}/**
  		 * Converts a digit/integer into a basic code point.
  		 * @see `basicToDigit()`
  		 * @private
  		 * @param {Number} digit The numeric value of a basic code point.
  		 * @returns {Number} The basic code point whose value (when used for
  		 * representing integers) is `digit`, which needs to be in the range
  		 * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is
  		 * used; else, the lowercase form is used. The behavior is undefined
  		 * if `flag` is non-zero and `digit` has no uppercase form.
  		 */function digitToBasic(digit,flag){//  0..25 map to ASCII a..z or A..Z
// 26..35 map to ASCII 0..9
return digit+22+75*(digit<26)-((flag!=0)<<5);}/**
  		 * Bias adaptation function as per section 3.4 of RFC 3492.
  		 * https://tools.ietf.org/html/rfc3492#section-3.4
  		 * @private
  		 */function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for/* no initialization */(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin);}return floor(k+(baseMinusTMin+1)*delta/(delta+skew));}/**
  		 * Converts a Punycode string of ASCII-only symbols to a string of Unicode
  		 * symbols.
  		 * @memberOf punycode
  		 * @param {String} input The Punycode string of ASCII-only symbols.
  		 * @returns {String} The resulting string of Unicode symbols.
  		 */function decode(input){// Don't use UCS-2
var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,/** Cached calculation results */baseMinusT;// Handle the basic code points: let `basic` be the number of input code
// points before the last delimiter, or `0` if there is none, then copy
// the first basic code points to the output.
basic=input.lastIndexOf(delimiter);if(basic<0){basic=0;}for(j=0;j<basic;++j){// if it's not a basic code point
if(input.charCodeAt(j)>=0x80){error('not-basic');}output.push(input.charCodeAt(j));}// Main decoding loop: start just after the last delimiter if any basic code
// points were copied; start at the beginning otherwise.
for/* no final expression */(index=basic>0?basic+1:0;index<inputLength;){// `index` is the index of the next character to be consumed.
// Decode a generalized variable-length integer into `delta`,
// which gets added to `i`. The overflow checking is easier
// if we increase `i` as we go, then subtract off its starting
// value at the end to obtain `delta`.
for/* no condition */(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error('invalid-input');}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error('overflow');}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break;}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error('overflow');}w*=baseMinusT;}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);// `i` was supposed to wrap around from `out` to `0`,
// incrementing `n` each time, so we'll fix that now:
if(floor(i/out)>maxInt-n){error('overflow');}n+=floor(i/out);i%=out;// Insert `n` at position `i` of the output
output.splice(i++,0,n);}return ucs2encode(output);}/**
  		 * Converts a string of Unicode symbols (e.g. a domain name label) to a
  		 * Punycode string of ASCII-only symbols.
  		 * @memberOf punycode
  		 * @param {String} input The string of Unicode symbols.
  		 * @returns {String} The resulting Punycode string of ASCII-only symbols.
  		 */function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],/** `inputLength` will hold the number of code points in `input`. */inputLength,/** Cached calculation results */handledCPCountPlusOne,baseMinusT,qMinusT;// Convert the input in UCS-2 to Unicode
input=ucs2decode(input);// Cache the length
inputLength=input.length;// Initialize the state
n=initialN;delta=0;bias=initialBias;// Handle the basic code points
for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<0x80){output.push(stringFromCharCode(currentValue));}}handledCPCount=basicLength=output.length;// `handledCPCount` is the number of code points that have been handled;
// `basicLength` is the number of basic code points.
// Finish the basic string - if it is not empty - with a delimiter
if(basicLength){output.push(delimiter);}// Main encoding loop:
while(handledCPCount<inputLength){// All non-basic code points < n have been handled already. Find the next
// larger one:
for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue;}}// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,
// but guard against overflow
handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error('overflow');}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error('overflow');}if(currentValue==n){// Represent delta as a generalized variable-length integer
for/* no condition */(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break;}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT);}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount;}}++delta;++n;}return output.join('');}/**
  		 * Converts a Punycode string representing a domain name or an email address
  		 * to Unicode. Only the Punycoded parts of the input will be converted, i.e.
  		 * it doesn't matter if you call it on a string that has already been
  		 * converted to Unicode.
  		 * @memberOf punycode
  		 * @param {String} input The Punycoded domain name or email address to
  		 * convert to Unicode.
  		 * @returns {String} The Unicode representation of the given Punycode
  		 * string.
  		 */function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string;});}/**
  		 * Converts a Unicode string representing a domain name or an email address to
  		 * Punycode. Only the non-ASCII parts of the domain name will be converted,
  		 * i.e. it doesn't matter if you call it with a domain that's already in
  		 * ASCII.
  		 * @memberOf punycode
  		 * @param {String} input The domain name or email address to convert, as a
  		 * Unicode string.
  		 * @returns {String} The Punycode representation of the given domain name or
  		 * email address.
  		 */function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?'xn--'+encode(string):string;});}/*--------------------------------------------------------------------------*/ /** Define the public API */punycode={/**
  			 * A string representing the current Punycode.js version number.
  			 * @memberOf punycode
  			 * @type String
  			 */'version':'1.4.1',/**
  			 * An object of methods to convert from JavaScript's internal character
  			 * representation (UCS-2) to Unicode code points, and back.
  			 * @see <https://mathiasbynens.be/notes/javascript-encoding>
  			 * @memberOf punycode
  			 * @type Object
  			 */'ucs2':{'decode':ucs2decode,'encode':ucs2encode},'decode':decode,'encode':encode,'toASCII':toASCII,'toUnicode':toUnicode};/** Expose `punycode` */ // Some AMD build optimizers, like r.js, check for specific condition patterns
// like the following:
if(freeExports&&freeModule){if(module.exports==freeExports){// in Node.js, io.js, or RingoJS v0.8.0+
freeModule.exports=punycode;}else{// in Narwhal or RingoJS v0.7.0-
for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);}}}else{// in Rhino or a web browser
root.punycode=punycode;}})(commonjsGlobal);})(punycode$1,punycode$1.exports);var punycodeExports=punycode$1.exports;/** @type {import('.')} */var esErrors=Error;/** @type {import('./eval')} */var _eval=EvalError;/** @type {import('./range')} */var range=RangeError;/** @type {import('./ref')} */var ref=ReferenceError;/** @type {import('./syntax')} */var syntax=SyntaxError;/** @type {import('./type')} */var type=TypeError;/** @type {import('./uri')} */var uri=URIError;/* eslint complexity: [2, 18], max-statements: [2, 33] */var shams=function hasSymbols(){if(typeof Symbol!=='function'||typeof Object.getOwnPropertySymbols!=='function'){return false;}if(_typeof(Symbol.iterator)==='symbol'){return true;}var obj={};var sym=Symbol('test');var symObj=Object(sym);if(typeof sym==='string'){return false;}if(Object.prototype.toString.call(sym)!=='[object Symbol]'){return false;}if(Object.prototype.toString.call(symObj)!=='[object Symbol]'){return false;}// temp disabled per https://github.com/ljharb/object.assign/issues/17
// if (sym instanceof Symbol) { return false; }
// temp disabled per https://github.com/WebReflection/get-own-property-symbols/issues/4
// if (!(symObj instanceof Symbol)) { return false; }
// if (typeof Symbol.prototype.toString !== 'function') { return false; }
// if (String(sym) !== Symbol.prototype.toString.call(sym)) { return false; }
var symVal=42;obj[sym]=symVal;for(sym in obj){return false;}// eslint-disable-line no-restricted-syntax, no-unreachable-loop
if(typeof Object.keys==='function'&&Object.keys(obj).length!==0){return false;}if(typeof Object.getOwnPropertyNames==='function'&&Object.getOwnPropertyNames(obj).length!==0){return false;}var syms=Object.getOwnPropertySymbols(obj);if(syms.length!==1||syms[0]!==sym){return false;}if(!Object.prototype.propertyIsEnumerable.call(obj,sym)){return false;}if(typeof Object.getOwnPropertyDescriptor==='function'){var descriptor=Object.getOwnPropertyDescriptor(obj,sym);if(descriptor.value!==symVal||descriptor.enumerable!==true){return false;}}return true;};var origSymbol=typeof Symbol!=='undefined'&&Symbol;var hasSymbolSham=shams;var hasSymbols$1=function hasNativeSymbols(){if(typeof origSymbol!=='function'){return false;}if(typeof Symbol!=='function'){return false;}if(_typeof(origSymbol('foo'))!=='symbol'){return false;}if(_typeof(Symbol('bar'))!=='symbol'){return false;}return hasSymbolSham();};var test={__proto__:null,foo:{}};var $Object=Object;/** @type {import('.')} */var hasProto$1=function hasProto(){// @ts-expect-error: TS errors on an inherited property for some reason
return{__proto__:test}.foo===test.foo&&!(test instanceof $Object);};/* eslint no-invalid-this: 1 */var ERROR_MESSAGE='Function.prototype.bind called on incompatible ';var toStr$1=Object.prototype.toString;var max=Math.max;var funcType='[object Function]';var concatty=function concatty(a,b){var arr=[];for(var i=0;i<a.length;i+=1){arr[i]=a[i];}for(var j=0;j<b.length;j+=1){arr[j+a.length]=b[j];}return arr;};var slicy=function slicy(arrLike,offset){var arr=[];for(var i=offset||0,j=0;i<arrLike.length;i+=1,j+=1){arr[j]=arrLike[i];}return arr;};var joiny=function joiny(arr,joiner){var str='';for(var i=0;i<arr.length;i+=1){str+=arr[i];if(i+1<arr.length){str+=joiner;}}return str;};var implementation$1=function bind(that){var target=this;if(typeof target!=='function'||toStr$1.apply(target)!==funcType){throw new TypeError(ERROR_MESSAGE+target);}var args=slicy(arguments,1);var bound;var binder=function binder(){if(this instanceof bound){var result=target.apply(this,concatty(args,arguments));if(Object(result)===result){return result;}return this;}return target.apply(that,concatty(args,arguments));};var boundLength=max(0,target.length-args.length);var boundArgs=[];for(var i=0;i<boundLength;i++){boundArgs[i]='$'+i;}bound=Function('binder','return function ('+joiny(boundArgs,',')+'){ return binder.apply(this,arguments); }')(binder);if(target.prototype){var Empty=function Empty(){};Empty.prototype=target.prototype;bound.prototype=new Empty();Empty.prototype=null;}return bound;};var implementation=implementation$1;var functionBind=Function.prototype.bind||implementation;var call=Function.prototype.call;var $hasOwn=Object.prototype.hasOwnProperty;var bind$1=functionBind;/** @type {import('.')} */var hasown=bind$1.call(call,$hasOwn);var undefined$1;var $Error=esErrors;var $EvalError=_eval;var $RangeError=range;var $ReferenceError=ref;var $SyntaxError$1=syntax;var $TypeError$3=type;var $URIError=uri;var $Function=Function;// eslint-disable-next-line consistent-return
var getEvalledConstructor=function getEvalledConstructor(expressionSyntax){try{return $Function('"use strict"; return ('+expressionSyntax+').constructor;')();}catch(e){}};var $gOPD$1=Object.getOwnPropertyDescriptor;if($gOPD$1){try{$gOPD$1({},'');}catch(e){$gOPD$1=null;// this is IE 8, which has a broken gOPD
}}var throwTypeError=function throwTypeError(){throw new $TypeError$3();};var ThrowTypeError=$gOPD$1?function(){try{// eslint-disable-next-line no-unused-expressions, no-caller, no-restricted-properties
arguments.callee;// IE 8 does not throw here
return throwTypeError;}catch(calleeThrows){try{// IE 8 throws on Object.getOwnPropertyDescriptor(arguments, '')
return $gOPD$1(arguments,'callee').get;}catch(gOPDthrows){return throwTypeError;}}}():throwTypeError;var hasSymbols=hasSymbols$1();var hasProto=hasProto$1();var getProto=Object.getPrototypeOf||(hasProto?function(x){return x.__proto__;}// eslint-disable-line no-proto
:null);var needsEval={};var TypedArray=typeof Uint8Array==='undefined'||!getProto?undefined$1:getProto(Uint8Array);var INTRINSICS={__proto__:null,'%AggregateError%':typeof AggregateError==='undefined'?undefined$1:AggregateError,'%Array%':Array,'%ArrayBuffer%':typeof ArrayBuffer==='undefined'?undefined$1:ArrayBuffer,'%ArrayIteratorPrototype%':hasSymbols&&getProto?getProto([][Symbol.iterator]()):undefined$1,'%AsyncFromSyncIteratorPrototype%':undefined$1,'%AsyncFunction%':needsEval,'%AsyncGenerator%':needsEval,'%AsyncGeneratorFunction%':needsEval,'%AsyncIteratorPrototype%':needsEval,'%Atomics%':typeof Atomics==='undefined'?undefined$1:Atomics,'%BigInt%':typeof BigInt==='undefined'?undefined$1:BigInt,'%BigInt64Array%':typeof BigInt64Array==='undefined'?undefined$1:BigInt64Array,'%BigUint64Array%':typeof BigUint64Array==='undefined'?undefined$1:BigUint64Array,'%Boolean%':Boolean,'%DataView%':typeof DataView==='undefined'?undefined$1:DataView,'%Date%':Date,'%decodeURI%':decodeURI,'%decodeURIComponent%':decodeURIComponent,'%encodeURI%':encodeURI,'%encodeURIComponent%':encodeURIComponent,'%Error%':$Error,'%eval%':eval,// eslint-disable-line no-eval
'%EvalError%':$EvalError,'%Float32Array%':typeof Float32Array==='undefined'?undefined$1:Float32Array,'%Float64Array%':typeof Float64Array==='undefined'?undefined$1:Float64Array,'%FinalizationRegistry%':typeof FinalizationRegistry==='undefined'?undefined$1:FinalizationRegistry,'%Function%':$Function,'%GeneratorFunction%':needsEval,'%Int8Array%':typeof Int8Array==='undefined'?undefined$1:Int8Array,'%Int16Array%':typeof Int16Array==='undefined'?undefined$1:Int16Array,'%Int32Array%':typeof Int32Array==='undefined'?undefined$1:Int32Array,'%isFinite%':isFinite,'%isNaN%':isNaN,'%IteratorPrototype%':hasSymbols&&getProto?getProto(getProto([][Symbol.iterator]())):undefined$1,'%JSON%':(typeof JSON==="undefined"?"undefined":_typeof(JSON))==='object'?JSON:undefined$1,'%Map%':typeof Map==='undefined'?undefined$1:Map,'%MapIteratorPrototype%':typeof Map==='undefined'||!hasSymbols||!getProto?undefined$1:getProto(new Map()[Symbol.iterator]()),'%Math%':Math,'%Number%':Number,'%Object%':Object,'%parseFloat%':parseFloat,'%parseInt%':parseInt,'%Promise%':typeof Promise==='undefined'?undefined$1:Promise,'%Proxy%':typeof Proxy==='undefined'?undefined$1:Proxy,'%RangeError%':$RangeError,'%ReferenceError%':$ReferenceError,'%Reflect%':typeof Reflect==='undefined'?undefined$1:Reflect,'%RegExp%':RegExp,'%Set%':typeof Set==='undefined'?undefined$1:Set,'%SetIteratorPrototype%':typeof Set==='undefined'||!hasSymbols||!getProto?undefined$1:getProto(new Set()[Symbol.iterator]()),'%SharedArrayBuffer%':typeof SharedArrayBuffer==='undefined'?undefined$1:SharedArrayBuffer,'%String%':String,'%StringIteratorPrototype%':hasSymbols&&getProto?getProto(''[Symbol.iterator]()):undefined$1,'%Symbol%':hasSymbols?Symbol:undefined$1,'%SyntaxError%':$SyntaxError$1,'%ThrowTypeError%':ThrowTypeError,'%TypedArray%':TypedArray,'%TypeError%':$TypeError$3,'%Uint8Array%':typeof Uint8Array==='undefined'?undefined$1:Uint8Array,'%Uint8ClampedArray%':typeof Uint8ClampedArray==='undefined'?undefined$1:Uint8ClampedArray,'%Uint16Array%':typeof Uint16Array==='undefined'?undefined$1:Uint16Array,'%Uint32Array%':typeof Uint32Array==='undefined'?undefined$1:Uint32Array,'%URIError%':$URIError,'%WeakMap%':typeof WeakMap==='undefined'?undefined$1:WeakMap,'%WeakRef%':typeof WeakRef==='undefined'?undefined$1:WeakRef,'%WeakSet%':typeof WeakSet==='undefined'?undefined$1:WeakSet};if(getProto){try{null.error;// eslint-disable-line no-unused-expressions
}catch(e){// https://github.com/tc39/proposal-shadowrealm/pull/384#issuecomment-1364264229
var errorProto=getProto(getProto(e));INTRINSICS['%Error.prototype%']=errorProto;}}var doEval=function doEval(name){var value;if(name==='%AsyncFunction%'){value=getEvalledConstructor('async function () {}');}else if(name==='%GeneratorFunction%'){value=getEvalledConstructor('function* () {}');}else if(name==='%AsyncGeneratorFunction%'){value=getEvalledConstructor('async function* () {}');}else if(name==='%AsyncGenerator%'){var fn=doEval('%AsyncGeneratorFunction%');if(fn){value=fn.prototype;}}else if(name==='%AsyncIteratorPrototype%'){var gen=doEval('%AsyncGenerator%');if(gen&&getProto){value=getProto(gen.prototype);}}INTRINSICS[name]=value;return value;};var LEGACY_ALIASES={__proto__:null,'%ArrayBufferPrototype%':['ArrayBuffer','prototype'],'%ArrayPrototype%':['Array','prototype'],'%ArrayProto_entries%':['Array','prototype','entries'],'%ArrayProto_forEach%':['Array','prototype','forEach'],'%ArrayProto_keys%':['Array','prototype','keys'],'%ArrayProto_values%':['Array','prototype','values'],'%AsyncFunctionPrototype%':['AsyncFunction','prototype'],'%AsyncGenerator%':['AsyncGeneratorFunction','prototype'],'%AsyncGeneratorPrototype%':['AsyncGeneratorFunction','prototype','prototype'],'%BooleanPrototype%':['Boolean','prototype'],'%DataViewPrototype%':['DataView','prototype'],'%DatePrototype%':['Date','prototype'],'%ErrorPrototype%':['Error','prototype'],'%EvalErrorPrototype%':['EvalError','prototype'],'%Float32ArrayPrototype%':['Float32Array','prototype'],'%Float64ArrayPrototype%':['Float64Array','prototype'],'%FunctionPrototype%':['Function','prototype'],'%Generator%':['GeneratorFunction','prototype'],'%GeneratorPrototype%':['GeneratorFunction','prototype','prototype'],'%Int8ArrayPrototype%':['Int8Array','prototype'],'%Int16ArrayPrototype%':['Int16Array','prototype'],'%Int32ArrayPrototype%':['Int32Array','prototype'],'%JSONParse%':['JSON','parse'],'%JSONStringify%':['JSON','stringify'],'%MapPrototype%':['Map','prototype'],'%NumberPrototype%':['Number','prototype'],'%ObjectPrototype%':['Object','prototype'],'%ObjProto_toString%':['Object','prototype','toString'],'%ObjProto_valueOf%':['Object','prototype','valueOf'],'%PromisePrototype%':['Promise','prototype'],'%PromiseProto_then%':['Promise','prototype','then'],'%Promise_all%':['Promise','all'],'%Promise_reject%':['Promise','reject'],'%Promise_resolve%':['Promise','resolve'],'%RangeErrorPrototype%':['RangeError','prototype'],'%ReferenceErrorPrototype%':['ReferenceError','prototype'],'%RegExpPrototype%':['RegExp','prototype'],'%SetPrototype%':['Set','prototype'],'%SharedArrayBufferPrototype%':['SharedArrayBuffer','prototype'],'%StringPrototype%':['String','prototype'],'%SymbolPrototype%':['Symbol','prototype'],'%SyntaxErrorPrototype%':['SyntaxError','prototype'],'%TypedArrayPrototype%':['TypedArray','prototype'],'%TypeErrorPrototype%':['TypeError','prototype'],'%Uint8ArrayPrototype%':['Uint8Array','prototype'],'%Uint8ClampedArrayPrototype%':['Uint8ClampedArray','prototype'],'%Uint16ArrayPrototype%':['Uint16Array','prototype'],'%Uint32ArrayPrototype%':['Uint32Array','prototype'],'%URIErrorPrototype%':['URIError','prototype'],'%WeakMapPrototype%':['WeakMap','prototype'],'%WeakSetPrototype%':['WeakSet','prototype']};var bind=functionBind;var hasOwn$1=hasown;var $concat$1=bind.call(Function.call,Array.prototype.concat);var $spliceApply=bind.call(Function.apply,Array.prototype.splice);var $replace$1=bind.call(Function.call,String.prototype.replace);var $strSlice=bind.call(Function.call,String.prototype.slice);var $exec=bind.call(Function.call,RegExp.prototype.exec);/* adapted from https://github.com/lodash/lodash/blob/4.17.15/dist/lodash.js#L6735-L6744 */var rePropName=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g;var reEscapeChar=/\\(\\)?/g;/** Used to match backslashes in property paths. */var stringToPath=function stringToPath(string){var first=$strSlice(string,0,1);var last=$strSlice(string,-1);if(first==='%'&&last!=='%'){throw new $SyntaxError$1('invalid intrinsic syntax, expected closing `%`');}else if(last==='%'&&first!=='%'){throw new $SyntaxError$1('invalid intrinsic syntax, expected opening `%`');}var result=[];$replace$1(string,rePropName,function(match,number,quote,subString){result[result.length]=quote?$replace$1(subString,reEscapeChar,'$1'):number||match;});return result;};/* end adaptation */var getBaseIntrinsic=function getBaseIntrinsic(name,allowMissing){var intrinsicName=name;var alias;if(hasOwn$1(LEGACY_ALIASES,intrinsicName)){alias=LEGACY_ALIASES[intrinsicName];intrinsicName='%'+alias[0]+'%';}if(hasOwn$1(INTRINSICS,intrinsicName)){var value=INTRINSICS[intrinsicName];if(value===needsEval){value=doEval(intrinsicName);}if(typeof value==='undefined'&&!allowMissing){throw new $TypeError$3('intrinsic '+name+' exists, but is not available. Please file an issue!');}return{alias:alias,name:intrinsicName,value:value};}throw new $SyntaxError$1('intrinsic '+name+' does not exist!');};var getIntrinsic=function GetIntrinsic(name,allowMissing){if(typeof name!=='string'||name.length===0){throw new $TypeError$3('intrinsic name must be a non-empty string');}if(arguments.length>1&&typeof allowMissing!=='boolean'){throw new $TypeError$3('"allowMissing" argument must be a boolean');}if($exec(/^%?[^%]*%?$/,name)===null){throw new $SyntaxError$1('`%` may not be present anywhere but at the beginning and end of the intrinsic name');}var parts=stringToPath(name);var intrinsicBaseName=parts.length>0?parts[0]:'';var intrinsic=getBaseIntrinsic('%'+intrinsicBaseName+'%',allowMissing);var intrinsicRealName=intrinsic.name;var value=intrinsic.value;var skipFurtherCaching=false;var alias=intrinsic.alias;if(alias){intrinsicBaseName=alias[0];$spliceApply(parts,$concat$1([0,1],alias));}for(var i=1,isOwn=true;i<parts.length;i+=1){var part=parts[i];var first=$strSlice(part,0,1);var last=$strSlice(part,-1);if((first==='"'||first==="'"||first==='`'||last==='"'||last==="'"||last==='`')&&first!==last){throw new $SyntaxError$1('property names with quotes must have matching quotes');}if(part==='constructor'||!isOwn){skipFurtherCaching=true;}intrinsicBaseName+='.'+part;intrinsicRealName='%'+intrinsicBaseName+'%';if(hasOwn$1(INTRINSICS,intrinsicRealName)){value=INTRINSICS[intrinsicRealName];}else if(value!=null){if(!(part in value)){if(!allowMissing){throw new $TypeError$3('base intrinsic for '+name+' exists, but the property is not available.');}return void undefined$1;}if($gOPD$1&&i+1>=parts.length){var desc=$gOPD$1(value,part);isOwn=!!desc;// By convention, when a data property is converted to an accessor
// property to emulate a data property that does not suffer from
// the override mistake, that accessor's getter is marked with
// an `originalValue` property. Here, when we detect this, we
// uphold the illusion by pretending to see that original data
// property, i.e., returning the value rather than the getter
// itself.
if(isOwn&&'get'in desc&&!('originalValue'in desc.get)){value=desc.get;}else{value=value[part];}}else{isOwn=hasOwn$1(value,part);value=value[part];}if(isOwn&&!skipFurtherCaching){INTRINSICS[intrinsicRealName]=value;}}}return value;};var callBind$1={exports:{}};var esDefineProperty;var hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var GetIntrinsic=getIntrinsic;/** @type {import('.')} */var $defineProperty=GetIntrinsic('%Object.defineProperty%',true)||false;if($defineProperty){try{$defineProperty({},'a',{value:1});}catch(e){// IE 8 has a broken defineProperty
$defineProperty=false;}}esDefineProperty=$defineProperty;return esDefineProperty;}var GetIntrinsic$3=getIntrinsic;var $gOPD=GetIntrinsic$3('%Object.getOwnPropertyDescriptor%',true);if($gOPD){try{$gOPD([],'length');}catch(e){// IE 8 has a broken gOPD
$gOPD=null;}}var gopd$1=$gOPD;var $defineProperty$1=requireEsDefineProperty();var $SyntaxError=syntax;var $TypeError$2=type;var gopd=gopd$1;/** @type {import('.')} */var defineDataProperty=function defineDataProperty(obj,property,value){if(!obj||_typeof(obj)!=='object'&&typeof obj!=='function'){throw new $TypeError$2('`obj` must be an object or a function`');}if(typeof property!=='string'&&_typeof(property)!=='symbol'){throw new $TypeError$2('`property` must be a string or a symbol`');}if(arguments.length>3&&typeof arguments[3]!=='boolean'&&arguments[3]!==null){throw new $TypeError$2('`nonEnumerable`, if provided, must be a boolean or null');}if(arguments.length>4&&typeof arguments[4]!=='boolean'&&arguments[4]!==null){throw new $TypeError$2('`nonWritable`, if provided, must be a boolean or null');}if(arguments.length>5&&typeof arguments[5]!=='boolean'&&arguments[5]!==null){throw new $TypeError$2('`nonConfigurable`, if provided, must be a boolean or null');}if(arguments.length>6&&typeof arguments[6]!=='boolean'){throw new $TypeError$2('`loose`, if provided, must be a boolean');}var nonEnumerable=arguments.length>3?arguments[3]:null;var nonWritable=arguments.length>4?arguments[4]:null;var nonConfigurable=arguments.length>5?arguments[5]:null;var loose=arguments.length>6?arguments[6]:false;/* @type {false | TypedPropertyDescriptor<unknown>} */var desc=!!gopd&&gopd(obj,property);if($defineProperty$1){$defineProperty$1(obj,property,{configurable:nonConfigurable===null&&desc?desc.configurable:!nonConfigurable,enumerable:nonEnumerable===null&&desc?desc.enumerable:!nonEnumerable,value:value,writable:nonWritable===null&&desc?desc.writable:!nonWritable});}else if(loose||!nonEnumerable&&!nonWritable&&!nonConfigurable){// must fall back to [[Set]], and was not explicitly asked to make non-enumerable, non-writable, or non-configurable
obj[property]=value;// eslint-disable-line no-param-reassign
}else{throw new $SyntaxError('This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.');}};var $defineProperty=requireEsDefineProperty();var hasPropertyDescriptors=function hasPropertyDescriptors(){return!!$defineProperty;};hasPropertyDescriptors.hasArrayLengthDefineBug=function hasArrayLengthDefineBug(){// node v0.6 has a bug where array lengths can be Set but not Defined
if(!$defineProperty){return null;}try{return $defineProperty([],'length',{value:1}).length!==1;}catch(e){// In Firefox 4-22, defining length on an array throws an exception.
return true;}};var hasPropertyDescriptors_1=hasPropertyDescriptors;var GetIntrinsic$2=getIntrinsic;var define=defineDataProperty;var hasDescriptors=hasPropertyDescriptors_1();var gOPD=gopd$1;var $TypeError$1=type;var $floor$1=GetIntrinsic$2('%Math.floor%');/** @type {import('.')} */var setFunctionLength=function setFunctionLength(fn,length){if(typeof fn!=='function'){throw new $TypeError$1('`fn` is not a function');}if(typeof length!=='number'||length<0||length>0xFFFFFFFF||$floor$1(length)!==length){throw new $TypeError$1('`length` must be a positive 32-bit integer');}var loose=arguments.length>2&&!!arguments[2];var functionLengthIsConfigurable=true;var functionLengthIsWritable=true;if('length'in fn&&gOPD){var desc=gOPD(fn,'length');if(desc&&!desc.configurable){functionLengthIsConfigurable=false;}if(desc&&!desc.writable){functionLengthIsWritable=false;}}if(functionLengthIsConfigurable||functionLengthIsWritable||!loose){if(hasDescriptors){define(/** @type {Parameters<define>[0]} */fn,'length',length,true,true);}else{define(/** @type {Parameters<define>[0]} */fn,'length',length);}}return fn;};(function(module){var bind=functionBind;var GetIntrinsic=getIntrinsic;var setFunctionLength$1=setFunctionLength;var $TypeError=type;var $apply=GetIntrinsic('%Function.prototype.apply%');var $call=GetIntrinsic('%Function.prototype.call%');var $reflectApply=GetIntrinsic('%Reflect.apply%',true)||bind.call($call,$apply);var $defineProperty=requireEsDefineProperty();var $max=GetIntrinsic('%Math.max%');module.exports=function callBind(originalFunction){if(typeof originalFunction!=='function'){throw new $TypeError('a function is required');}var func=$reflectApply(bind,$call,arguments);return setFunctionLength$1(func,1+$max(0,originalFunction.length-(arguments.length-1)),true);};var applyBind=function applyBind(){return $reflectApply(bind,$apply,arguments);};if($defineProperty){$defineProperty(module.exports,'apply',{value:applyBind});}else{module.exports.apply=applyBind;}})(callBind$1);var callBindExports=callBind$1.exports;var GetIntrinsic$1=getIntrinsic;var callBind=callBindExports;var $indexOf=callBind(GetIntrinsic$1('String.prototype.indexOf'));var callBound$1=function callBoundIntrinsic(name,allowMissing){var intrinsic=GetIntrinsic$1(name,!!allowMissing);if(typeof intrinsic==='function'&&$indexOf(name,'.prototype.')>-1){return callBind(intrinsic);}return intrinsic;};var _nodeResolve_empty={};var _nodeResolve_empty$1=/*#__PURE__*/Object.freeze({__proto__:null,default:_nodeResolve_empty});var require$$0=/*@__PURE__*/getAugmentedNamespace(_nodeResolve_empty$1);var hasMap=typeof Map==='function'&&Map.prototype;var mapSizeDescriptor=Object.getOwnPropertyDescriptor&&hasMap?Object.getOwnPropertyDescriptor(Map.prototype,'size'):null;var mapSize$1=hasMap&&mapSizeDescriptor&&typeof mapSizeDescriptor.get==='function'?mapSizeDescriptor.get:null;var mapForEach=hasMap&&Map.prototype.forEach;var hasSet=typeof Set==='function'&&Set.prototype;var setSizeDescriptor=Object.getOwnPropertyDescriptor&&hasSet?Object.getOwnPropertyDescriptor(Set.prototype,'size'):null;var setSize=hasSet&&setSizeDescriptor&&typeof setSizeDescriptor.get==='function'?setSizeDescriptor.get:null;var setForEach=hasSet&&Set.prototype.forEach;var hasWeakMap=typeof WeakMap==='function'&&WeakMap.prototype;var weakMapHas=hasWeakMap?WeakMap.prototype.has:null;var hasWeakSet=typeof WeakSet==='function'&&WeakSet.prototype;var weakSetHas=hasWeakSet?WeakSet.prototype.has:null;var hasWeakRef=typeof WeakRef==='function'&&WeakRef.prototype;var weakRefDeref=hasWeakRef?WeakRef.prototype.deref:null;var booleanValueOf=Boolean.prototype.valueOf;var objectToString=Object.prototype.toString;var functionToString=Function.prototype.toString;var $match=String.prototype.match;var $slice=String.prototype.slice;var $replace=String.prototype.replace;var $toUpperCase=String.prototype.toUpperCase;var $toLowerCase=String.prototype.toLowerCase;var $test=RegExp.prototype.test;var $concat=Array.prototype.concat;var $join=Array.prototype.join;var $arrSlice=Array.prototype.slice;var $floor=Math.floor;var bigIntValueOf=typeof BigInt==='function'?BigInt.prototype.valueOf:null;var gOPS=Object.getOwnPropertySymbols;var symToString=typeof Symbol==='function'&&_typeof(Symbol.iterator)==='symbol'?Symbol.prototype.toString:null;var hasShammedSymbols=typeof Symbol==='function'&&_typeof(Symbol.iterator)==='object';// ie, `has-tostringtag/shams
var toStringTag=typeof Symbol==='function'&&Symbol.toStringTag&&(_typeof(Symbol.toStringTag)===hasShammedSymbols?'object':'symbol')?Symbol.toStringTag:null;var isEnumerable=Object.prototype.propertyIsEnumerable;var gPO=(typeof Reflect==='function'?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype// eslint-disable-line no-proto
?function(O){return O.__proto__;// eslint-disable-line no-proto
}:null);function addNumericSeparator(num,str){if(num===Infinity||num===-Infinity||num!==num||num&&num>-1000&&num<1000||$test.call(/e/,str)){return str;}var sepRegex=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof num==='number'){var int=num<0?-$floor(-num):$floor(num);// trunc(num)
if(int!==num){var intStr=String(int);var dec=$slice.call(str,intStr.length+1);return $replace.call(intStr,sepRegex,'$&_')+'.'+$replace.call($replace.call(dec,/([0-9]{3})/g,'$&_'),/_$/,'');}}return $replace.call(str,sepRegex,'$&_');}var utilInspect=require$$0;var inspectCustom=utilInspect.custom;var inspectSymbol=isSymbol(inspectCustom)?inspectCustom:null;var objectInspect=function inspect_(obj,options,depth,seen){var opts=options||{};if(has$3(opts,'quoteStyle')&&opts.quoteStyle!=='single'&&opts.quoteStyle!=='double'){throw new TypeError('option "quoteStyle" must be "single" or "double"');}if(has$3(opts,'maxStringLength')&&(typeof opts.maxStringLength==='number'?opts.maxStringLength<0&&opts.maxStringLength!==Infinity:opts.maxStringLength!==null)){throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');}var customInspect=has$3(opts,'customInspect')?opts.customInspect:true;if(typeof customInspect!=='boolean'&&customInspect!=='symbol'){throw new TypeError('option "customInspect", if provided, must be `true`, `false`, or `\'symbol\'`');}if(has$3(opts,'indent')&&opts.indent!==null&&opts.indent!=='\t'&&!(parseInt(opts.indent,10)===opts.indent&&opts.indent>0)){throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');}if(has$3(opts,'numericSeparator')&&typeof opts.numericSeparator!=='boolean'){throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');}var numericSeparator=opts.numericSeparator;if(typeof obj==='undefined'){return'undefined';}if(obj===null){return'null';}if(typeof obj==='boolean'){return obj?'true':'false';}if(typeof obj==='string'){return inspectString(obj,opts);}if(typeof obj==='number'){if(obj===0){return Infinity/obj>0?'0':'-0';}var str=String(obj);return numericSeparator?addNumericSeparator(obj,str):str;}if(typeof obj==='bigint'){var bigIntStr=String(obj)+'n';return numericSeparator?addNumericSeparator(obj,bigIntStr):bigIntStr;}var maxDepth=typeof opts.depth==='undefined'?5:opts.depth;if(typeof depth==='undefined'){depth=0;}if(depth>=maxDepth&&maxDepth>0&&_typeof(obj)==='object'){return isArray$3(obj)?'[Array]':'[Object]';}var indent=getIndent(opts,depth);if(typeof seen==='undefined'){seen=[];}else if(indexOf(seen,obj)>=0){return'[Circular]';}function inspect(value,from,noIndent){if(from){seen=$arrSlice.call(seen);seen.push(from);}if(noIndent){var newOpts={depth:opts.depth};if(has$3(opts,'quoteStyle')){newOpts.quoteStyle=opts.quoteStyle;}return inspect_(value,newOpts,depth+1,seen);}return inspect_(value,opts,depth+1,seen);}if(typeof obj==='function'&&!isRegExp$1(obj)){// in older engines, regexes are callable
var name=nameOf(obj);var keys=arrObjKeys(obj,inspect);return'[Function'+(name?': '+name:' (anonymous)')+']'+(keys.length>0?' { '+$join.call(keys,', ')+' }':'');}if(isSymbol(obj)){var symString=hasShammedSymbols?$replace.call(String(obj),/^(Symbol\(.*\))_[^)]*$/,'$1'):symToString.call(obj);return _typeof(obj)==='object'&&!hasShammedSymbols?markBoxed(symString):symString;}if(isElement(obj)){var s='<'+$toLowerCase.call(String(obj.nodeName));var attrs=obj.attributes||[];for(var i=0;i<attrs.length;i++){s+=' '+attrs[i].name+'='+wrapQuotes(quote(attrs[i].value),'double',opts);}s+='>';if(obj.childNodes&&obj.childNodes.length){s+='...';}s+='</'+$toLowerCase.call(String(obj.nodeName))+'>';return s;}if(isArray$3(obj)){if(obj.length===0){return'[]';}var xs=arrObjKeys(obj,inspect);if(indent&&!singleLineValues(xs)){return'['+indentedJoin(xs,indent)+']';}return'[ '+$join.call(xs,', ')+' ]';}if(isError(obj)){var parts=arrObjKeys(obj,inspect);if(!('cause'in Error.prototype)&&'cause'in obj&&!isEnumerable.call(obj,'cause')){return'{ ['+String(obj)+'] '+$join.call($concat.call('[cause]: '+inspect(obj.cause),parts),', ')+' }';}if(parts.length===0){return'['+String(obj)+']';}return'{ ['+String(obj)+'] '+$join.call(parts,', ')+' }';}if(_typeof(obj)==='object'&&customInspect){if(inspectSymbol&&typeof obj[inspectSymbol]==='function'&&utilInspect){return utilInspect(obj,{depth:maxDepth-depth});}else if(customInspect!=='symbol'&&typeof obj.inspect==='function'){return obj.inspect();}}if(isMap(obj)){var mapParts=[];if(mapForEach){mapForEach.call(obj,function(value,key){mapParts.push(inspect(key,obj,true)+' => '+inspect(value,obj));});}return collectionOf('Map',mapSize$1.call(obj),mapParts,indent);}if(isSet(obj)){var setParts=[];if(setForEach){setForEach.call(obj,function(value){setParts.push(inspect(value,obj));});}return collectionOf('Set',setSize.call(obj),setParts,indent);}if(isWeakMap(obj)){return weakCollectionOf('WeakMap');}if(isWeakSet(obj)){return weakCollectionOf('WeakSet');}if(isWeakRef(obj)){return weakCollectionOf('WeakRef');}if(isNumber(obj)){return markBoxed(inspect(Number(obj)));}if(isBigInt(obj)){return markBoxed(inspect(bigIntValueOf.call(obj)));}if(isBoolean(obj)){return markBoxed(booleanValueOf.call(obj));}if(isString(obj)){return markBoxed(inspect(String(obj)));}// note: in IE 8, sometimes `global !== window` but both are the prototypes of each other
/* eslint-env browser */if(typeof window!=='undefined'&&obj===window){return'{ [object Window] }';}if(obj===commonjsGlobal){return'{ [object globalThis] }';}if(!isDate(obj)&&!isRegExp$1(obj)){var ys=arrObjKeys(obj,inspect);var isPlainObject=gPO?gPO(obj)===Object.prototype:obj instanceof Object||obj.constructor===Object;var protoTag=obj instanceof Object?'':'null prototype';var stringTag=!isPlainObject&&toStringTag&&Object(obj)===obj&&toStringTag in obj?$slice.call(toStr(obj),8,-1):protoTag?'Object':'';var constructorTag=isPlainObject||typeof obj.constructor!=='function'?'':obj.constructor.name?obj.constructor.name+' ':'';var tag=constructorTag+(stringTag||protoTag?'['+$join.call($concat.call([],stringTag||[],protoTag||[]),': ')+'] ':'');if(ys.length===0){return tag+'{}';}if(indent){return tag+'{'+indentedJoin(ys,indent)+'}';}return tag+'{ '+$join.call(ys,', ')+' }';}return String(obj);};function wrapQuotes(s,defaultStyle,opts){var quoteChar=(opts.quoteStyle||defaultStyle)==='double'?'"':"'";return quoteChar+s+quoteChar;}function quote(s){return $replace.call(String(s),/"/g,'&quot;');}function isArray$3(obj){return toStr(obj)==='[object Array]'&&(!toStringTag||!(_typeof(obj)==='object'&&toStringTag in obj));}function isDate(obj){return toStr(obj)==='[object Date]'&&(!toStringTag||!(_typeof(obj)==='object'&&toStringTag in obj));}function isRegExp$1(obj){return toStr(obj)==='[object RegExp]'&&(!toStringTag||!(_typeof(obj)==='object'&&toStringTag in obj));}function isError(obj){return toStr(obj)==='[object Error]'&&(!toStringTag||!(_typeof(obj)==='object'&&toStringTag in obj));}function isString(obj){return toStr(obj)==='[object String]'&&(!toStringTag||!(_typeof(obj)==='object'&&toStringTag in obj));}function isNumber(obj){return toStr(obj)==='[object Number]'&&(!toStringTag||!(_typeof(obj)==='object'&&toStringTag in obj));}function isBoolean(obj){return toStr(obj)==='[object Boolean]'&&(!toStringTag||!(_typeof(obj)==='object'&&toStringTag in obj));}// Symbol and BigInt do have Symbol.toStringTag by spec, so that can't be used to eliminate false positives
function isSymbol(obj){if(hasShammedSymbols){return obj&&_typeof(obj)==='object'&&obj instanceof Symbol;}if(_typeof(obj)==='symbol'){return true;}if(!obj||_typeof(obj)!=='object'||!symToString){return false;}try{symToString.call(obj);return true;}catch(e){}return false;}function isBigInt(obj){if(!obj||_typeof(obj)!=='object'||!bigIntValueOf){return false;}try{bigIntValueOf.call(obj);return true;}catch(e){}return false;}var hasOwn=Object.prototype.hasOwnProperty||function(key){return key in this;};function has$3(obj,key){return hasOwn.call(obj,key);}function toStr(obj){return objectToString.call(obj);}function nameOf(f){if(f.name){return f.name;}var m=$match.call(functionToString.call(f),/^function\s*([\w$]+)/);if(m){return m[1];}return null;}function indexOf(xs,x){if(xs.indexOf){return xs.indexOf(x);}for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x){return i;}}return-1;}function isMap(x){if(!mapSize$1||!x||_typeof(x)!=='object'){return false;}try{mapSize$1.call(x);try{setSize.call(x);}catch(s){return true;}return x instanceof Map;// core-js workaround, pre-v2.5.0
}catch(e){}return false;}function isWeakMap(x){if(!weakMapHas||!x||_typeof(x)!=='object'){return false;}try{weakMapHas.call(x,weakMapHas);try{weakSetHas.call(x,weakSetHas);}catch(s){return true;}return x instanceof WeakMap;// core-js workaround, pre-v2.5.0
}catch(e){}return false;}function isWeakRef(x){if(!weakRefDeref||!x||_typeof(x)!=='object'){return false;}try{weakRefDeref.call(x);return true;}catch(e){}return false;}function isSet(x){if(!setSize||!x||_typeof(x)!=='object'){return false;}try{setSize.call(x);try{mapSize$1.call(x);}catch(m){return true;}return x instanceof Set;// core-js workaround, pre-v2.5.0
}catch(e){}return false;}function isWeakSet(x){if(!weakSetHas||!x||_typeof(x)!=='object'){return false;}try{weakSetHas.call(x,weakSetHas);try{weakMapHas.call(x,weakMapHas);}catch(s){return true;}return x instanceof WeakSet;// core-js workaround, pre-v2.5.0
}catch(e){}return false;}function isElement(x){if(!x||_typeof(x)!=='object'){return false;}if(typeof HTMLElement!=='undefined'&&x instanceof HTMLElement){return true;}return typeof x.nodeName==='string'&&typeof x.getAttribute==='function';}function inspectString(str,opts){if(str.length>opts.maxStringLength){var remaining=str.length-opts.maxStringLength;var trailer='... '+remaining+' more character'+(remaining>1?'s':'');return inspectString($slice.call(str,0,opts.maxStringLength),opts)+trailer;}// eslint-disable-next-line no-control-regex
var s=$replace.call($replace.call(str,/(['\\])/g,'\\$1'),/[\x00-\x1f]/g,lowbyte);return wrapQuotes(s,'single',opts);}function lowbyte(c){var n=c.charCodeAt(0);var x={8:'b',9:'t',10:'n',12:'f',13:'r'}[n];if(x){return'\\'+x;}return'\\x'+(n<0x10?'0':'')+$toUpperCase.call(n.toString(16));}function markBoxed(str){return'Object('+str+')';}function weakCollectionOf(type){return type+' { ? }';}function collectionOf(type,size,entries,indent){var joinedEntries=indent?indentedJoin(entries,indent):$join.call(entries,', ');return type+' ('+size+') {'+joinedEntries+'}';}function singleLineValues(xs){for(var i=0;i<xs.length;i++){if(indexOf(xs[i],'\n')>=0){return false;}}return true;}function getIndent(opts,depth){var baseIndent;if(opts.indent==='\t'){baseIndent='\t';}else if(typeof opts.indent==='number'&&opts.indent>0){baseIndent=$join.call(Array(opts.indent+1),' ');}else{return null;}return{base:baseIndent,prev:$join.call(Array(depth+1),baseIndent)};}function indentedJoin(xs,indent){if(xs.length===0){return'';}var lineJoiner='\n'+indent.prev+indent.base;return lineJoiner+$join.call(xs,','+lineJoiner)+'\n'+indent.prev;}function arrObjKeys(obj,inspect){var isArr=isArray$3(obj);var xs=[];if(isArr){xs.length=obj.length;for(var i=0;i<obj.length;i++){xs[i]=has$3(obj,i)?inspect(obj[i],obj):'';}}var syms=typeof gOPS==='function'?gOPS(obj):[];var symMap;if(hasShammedSymbols){symMap={};for(var k=0;k<syms.length;k++){symMap['$'+syms[k]]=syms[k];}}for(var key in obj){// eslint-disable-line no-restricted-syntax
if(!has$3(obj,key)){continue;}// eslint-disable-line no-restricted-syntax, no-continue
if(isArr&&String(Number(key))===key&&key<obj.length){continue;}// eslint-disable-line no-restricted-syntax, no-continue
if(hasShammedSymbols&&symMap['$'+key]instanceof Symbol){// this is to prevent shammed Symbols, which are stored as strings, from being included in the string key section
continue;// eslint-disable-line no-restricted-syntax, no-continue
}else if($test.call(/[^\w$]/,key)){xs.push(inspect(key,obj)+': '+inspect(obj[key],obj));}else{xs.push(key+': '+inspect(obj[key],obj));}}if(typeof gOPS==='function'){for(var j=0;j<syms.length;j++){if(isEnumerable.call(obj,syms[j])){xs.push('['+inspect(syms[j])+']: '+inspect(obj[syms[j]],obj));}}}return xs;}var GetIntrinsic=getIntrinsic;var callBound=callBound$1;var inspect=objectInspect;var $TypeError=type;var $WeakMap=GetIntrinsic('%WeakMap%',true);var $Map=GetIntrinsic('%Map%',true);var $weakMapGet=callBound('WeakMap.prototype.get',true);var $weakMapSet=callBound('WeakMap.prototype.set',true);var $weakMapHas=callBound('WeakMap.prototype.has',true);var $mapGet=callBound('Map.prototype.get',true);var $mapSet=callBound('Map.prototype.set',true);var $mapHas=callBound('Map.prototype.has',true);/*
  * This function traverses the list returning the node corresponding to the given key.
  *
  * That node is also moved to the head of the list, so that if it's accessed again we don't need to traverse the whole list. By doing so, all the recently used nodes can be accessed relatively quickly.
  */ /** @type {import('.').listGetNode} */var listGetNode=function listGetNode(list,key){// eslint-disable-line consistent-return
/** @type {typeof list | NonNullable<(typeof list)['next']>} */var prev=list;/** @type {(typeof list)['next']} */var curr;for(;(curr=prev.next)!==null;prev=curr){if(curr.key===key){prev.next=curr.next;// eslint-disable-next-line no-extra-parens
curr.next=/** @type {NonNullable<typeof list.next>} */list.next;list.next=curr;// eslint-disable-line no-param-reassign
return curr;}}};/** @type {import('.').listGet} */var listGet=function listGet(objects,key){var node=listGetNode(objects,key);return node&&node.value;};/** @type {import('.').listSet} */var listSet=function listSet(objects,key,value){var node=listGetNode(objects,key);if(node){node.value=value;}else{// Prepend the new node to the beginning of the list
objects.next=/** @type {import('.').ListNode<typeof value>} */{// eslint-disable-line no-param-reassign, no-extra-parens
key:key,next:objects.next,value:value};}};/** @type {import('.').listHas} */var listHas=function listHas(objects,key){return!!listGetNode(objects,key);};/** @type {import('.')} */var sideChannel=function getSideChannel(){/** @type {WeakMap<object, unknown>} */var $wm;/** @type {Map<object, unknown>} */var $m;/** @type {import('.').RootNode<unknown>} */var $o;/** @type {import('.').Channel} */var channel={assert:function assert(key){if(!channel.has(key)){throw new $TypeError('Side channel does not contain '+inspect(key));}},get:function get(key){// eslint-disable-line consistent-return
if($WeakMap&&key&&(_typeof(key)==='object'||typeof key==='function')){if($wm){return $weakMapGet($wm,key);}}else if($Map){if($m){return $mapGet($m,key);}}else{if($o){// eslint-disable-line no-lonely-if
return listGet($o,key);}}},has:function has(key){if($WeakMap&&key&&(_typeof(key)==='object'||typeof key==='function')){if($wm){return $weakMapHas($wm,key);}}else if($Map){if($m){return $mapHas($m,key);}}else{if($o){// eslint-disable-line no-lonely-if
return listHas($o,key);}}return false;},set:function set(key,value){if($WeakMap&&key&&(_typeof(key)==='object'||typeof key==='function')){if(!$wm){$wm=new $WeakMap();}$weakMapSet($wm,key,value);}else if($Map){if(!$m){$m=new $Map();}$mapSet($m,key,value);}else{if(!$o){// Initialize the linked list as an empty node, so that we don't have to special-case handling of the first node: we can always refer to it as (previous node).next, instead of something like (list).head
$o={key:{},next:null};}listSet($o,key,value);}}};return channel;};var replace=String.prototype.replace;var percentTwenties=/%20/g;var Format={RFC1738:'RFC1738',RFC3986:'RFC3986'};var formats$4={'default':Format.RFC3986,formatters:{RFC1738:function RFC1738(value){return replace.call(value,percentTwenties,'+');},RFC3986:function RFC3986(value){return String(value);}},RFC1738:Format.RFC1738,RFC3986:Format.RFC3986};var formats$3=formats$4;var has$2=Object.prototype.hasOwnProperty;var isArray$2=Array.isArray;var hexTable=function(){var array=[];for(var i=0;i<256;++i){array.push('%'+((i<16?'0':'')+i.toString(16)).toUpperCase());}return array;}();var compactQueue=function compactQueue(queue){while(queue.length>1){var item=queue.pop();var obj=item.obj[item.prop];if(isArray$2(obj)){var compacted=[];for(var j=0;j<obj.length;++j){if(typeof obj[j]!=='undefined'){compacted.push(obj[j]);}}item.obj[item.prop]=compacted;}}};var arrayToObject=function arrayToObject(source,options){var obj=options&&options.plainObjects?Object.create(null):{};for(var i=0;i<source.length;++i){if(typeof source[i]!=='undefined'){obj[i]=source[i];}}return obj;};var merge=function merge(target,source,options){/* eslint no-param-reassign: 0 */if(!source){return target;}if(_typeof(source)!=='object'){if(isArray$2(target)){target.push(source);}else if(target&&_typeof(target)==='object'){if(options&&(options.plainObjects||options.allowPrototypes)||!has$2.call(Object.prototype,source)){target[source]=true;}}else{return[target,source];}return target;}if(!target||_typeof(target)!=='object'){return[target].concat(source);}var mergeTarget=target;if(isArray$2(target)&&!isArray$2(source)){mergeTarget=arrayToObject(target,options);}if(isArray$2(target)&&isArray$2(source)){source.forEach(function(item,i){if(has$2.call(target,i)){var targetItem=target[i];if(targetItem&&_typeof(targetItem)==='object'&&item&&_typeof(item)==='object'){target[i]=merge(targetItem,item,options);}else{target.push(item);}}else{target[i]=item;}});return target;}return Object.keys(source).reduce(function(acc,key){var value=source[key];if(has$2.call(acc,key)){acc[key]=merge(acc[key],value,options);}else{acc[key]=value;}return acc;},mergeTarget);};var assign=function assignSingleSource(target,source){return Object.keys(source).reduce(function(acc,key){acc[key]=source[key];return acc;},target);};var decode=function decode(str,decoder,charset){var strWithoutPlus=str.replace(/\+/g,' ');if(charset==='iso-8859-1'){// unescape never throws, no try...catch needed:
return strWithoutPlus.replace(/%[0-9a-f]{2}/gi,unescape);}// utf-8
try{return decodeURIComponent(strWithoutPlus);}catch(e){return strWithoutPlus;}};var limit=1024;/* eslint operator-linebreak: [2, "before"] */var encode=function encode(str,defaultEncoder,charset,kind,format){// This code was originally written by Brian White (mscdex) for the io.js core querystring library.
// It has been adapted here for stricter adherence to RFC 3986
if(str.length===0){return str;}var string=str;if(_typeof(str)==='symbol'){string=Symbol.prototype.toString.call(str);}else if(typeof str!=='string'){string=String(str);}if(charset==='iso-8859-1'){return escape(string).replace(/%u[0-9a-f]{4}/gi,function($0){return'%26%23'+parseInt($0.slice(2),16)+'%3B';});}var out='';for(var j=0;j<string.length;j+=limit){var segment=string.length>=limit?string.slice(j,j+limit):string;var arr=[];for(var i=0;i<segment.length;++i){var c=segment.charCodeAt(i);if(c===0x2D// -
||c===0x2E// .
||c===0x5F// _
||c===0x7E// ~
||c>=0x30&&c<=0x39// 0-9
||c>=0x41&&c<=0x5A// a-z
||c>=0x61&&c<=0x7A// A-Z
||format===formats$3.RFC1738&&(c===0x28||c===0x29)// ( )
){arr[arr.length]=segment.charAt(i);continue;}if(c<0x80){arr[arr.length]=hexTable[c];continue;}if(c<0x800){arr[arr.length]=hexTable[0xC0|c>>6]+hexTable[0x80|c&0x3F];continue;}if(c<0xD800||c>=0xE000){arr[arr.length]=hexTable[0xE0|c>>12]+hexTable[0x80|c>>6&0x3F]+hexTable[0x80|c&0x3F];continue;}i+=1;c=0x10000+((c&0x3FF)<<10|segment.charCodeAt(i)&0x3FF);arr[arr.length]=hexTable[0xF0|c>>18]+hexTable[0x80|c>>12&0x3F]+hexTable[0x80|c>>6&0x3F]+hexTable[0x80|c&0x3F];}out+=arr.join('');}return out;};var compact=function compact(value){var queue=[{obj:{o:value},prop:'o'}];var refs=[];for(var i=0;i<queue.length;++i){var item=queue[i];var obj=item.obj[item.prop];var keys=Object.keys(obj);for(var j=0;j<keys.length;++j){var key=keys[j];var val=obj[key];if(_typeof(val)==='object'&&val!==null&&refs.indexOf(val)===-1){queue.push({obj:obj,prop:key});refs.push(val);}}}compactQueue(queue);return value;};var isRegExp=function isRegExp(obj){return Object.prototype.toString.call(obj)==='[object RegExp]';};var isBuffer=function isBuffer(obj){if(!obj||_typeof(obj)!=='object'){return false;}return!!(obj.constructor&&obj.constructor.isBuffer&&obj.constructor.isBuffer(obj));};var combine=function combine(a,b){return[].concat(a,b);};var maybeMap=function maybeMap(val,fn){if(isArray$2(val)){var mapped=[];for(var i=0;i<val.length;i+=1){mapped.push(fn(val[i]));}return mapped;}return fn(val);};var utils$2={arrayToObject:arrayToObject,assign:assign,combine:combine,compact:compact,decode:decode,encode:encode,isBuffer:isBuffer,isRegExp:isRegExp,maybeMap:maybeMap,merge:merge};var getSideChannel=sideChannel;var utils$1=utils$2;var formats$2=formats$4;var has$1=Object.prototype.hasOwnProperty;var arrayPrefixGenerators={brackets:function brackets(prefix){return prefix+'[]';},comma:'comma',indices:function indices(prefix,key){return prefix+'['+key+']';},repeat:function repeat(prefix){return prefix;}};var isArray$1=Array.isArray;var push=Array.prototype.push;var pushToArray=function pushToArray(arr,valueOrArray){push.apply(arr,isArray$1(valueOrArray)?valueOrArray:[valueOrArray]);};var toISO=Date.prototype.toISOString;var defaultFormat=formats$2['default'];var defaults$1={addQueryPrefix:false,allowDots:false,allowEmptyArrays:false,arrayFormat:'indices',charset:'utf-8',charsetSentinel:false,delimiter:'&',encode:true,encodeDotInKeys:false,encoder:utils$1.encode,encodeValuesOnly:false,format:defaultFormat,formatter:formats$2.formatters[defaultFormat],// deprecated
indices:false,serializeDate:function serializeDate(date){return toISO.call(date);},skipNulls:false,strictNullHandling:false};var isNonNullishPrimitive=function isNonNullishPrimitive(v){return typeof v==='string'||typeof v==='number'||typeof v==='boolean'||_typeof(v)==='symbol'||typeof v==='bigint';};var sentinel={};var stringify$1=function stringify(object,prefix,generateArrayPrefix,commaRoundTrip,allowEmptyArrays,strictNullHandling,skipNulls,encodeDotInKeys,encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,sideChannel){var obj=object;var tmpSc=sideChannel;var step=0;var findFlag=false;while((tmpSc=tmpSc.get(sentinel))!==void undefined&&!findFlag){// Where object last appeared in the ref tree
var pos=tmpSc.get(object);step+=1;if(typeof pos!=='undefined'){if(pos===step){throw new RangeError('Cyclic object value');}else{findFlag=true;// Break while
}}if(typeof tmpSc.get(sentinel)==='undefined'){step=0;}}if(typeof filter==='function'){obj=filter(prefix,obj);}else if(obj instanceof Date){obj=serializeDate(obj);}else if(generateArrayPrefix==='comma'&&isArray$1(obj)){obj=utils$1.maybeMap(obj,function(value){if(value instanceof Date){return serializeDate(value);}return value;});}if(obj===null){if(strictNullHandling){return encoder&&!encodeValuesOnly?encoder(prefix,defaults$1.encoder,charset,'key',format):prefix;}obj='';}if(isNonNullishPrimitive(obj)||utils$1.isBuffer(obj)){if(encoder){var keyValue=encodeValuesOnly?prefix:encoder(prefix,defaults$1.encoder,charset,'key',format);return[formatter(keyValue)+'='+formatter(encoder(obj,defaults$1.encoder,charset,'value',format))];}return[formatter(prefix)+'='+formatter(String(obj))];}var values=[];if(typeof obj==='undefined'){return values;}var objKeys;if(generateArrayPrefix==='comma'&&isArray$1(obj)){// we need to join elements in
if(encodeValuesOnly&&encoder){obj=utils$1.maybeMap(obj,encoder);}objKeys=[{value:obj.length>0?obj.join(',')||null:void undefined}];}else if(isArray$1(filter)){objKeys=filter;}else{var keys=Object.keys(obj);objKeys=sort?keys.sort(sort):keys;}var encodedPrefix=encodeDotInKeys?prefix.replace(/\./g,'%2E'):prefix;var adjustedPrefix=commaRoundTrip&&isArray$1(obj)&&obj.length===1?encodedPrefix+'[]':encodedPrefix;if(allowEmptyArrays&&isArray$1(obj)&&obj.length===0){return adjustedPrefix+'[]';}for(var j=0;j<objKeys.length;++j){var key=objKeys[j];var value=_typeof(key)==='object'&&typeof key.value!=='undefined'?key.value:obj[key];if(skipNulls&&value===null){continue;}var encodedKey=allowDots&&encodeDotInKeys?key.replace(/\./g,'%2E'):key;var keyPrefix=isArray$1(obj)?typeof generateArrayPrefix==='function'?generateArrayPrefix(adjustedPrefix,encodedKey):adjustedPrefix:adjustedPrefix+(allowDots?'.'+encodedKey:'['+encodedKey+']');sideChannel.set(object,step);var valueSideChannel=getSideChannel();valueSideChannel.set(sentinel,sideChannel);pushToArray(values,stringify(value,keyPrefix,generateArrayPrefix,commaRoundTrip,allowEmptyArrays,strictNullHandling,skipNulls,encodeDotInKeys,generateArrayPrefix==='comma'&&encodeValuesOnly&&isArray$1(obj)?null:encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,valueSideChannel));}return values;};var normalizeStringifyOptions=function normalizeStringifyOptions(opts){if(!opts){return defaults$1;}if(typeof opts.allowEmptyArrays!=='undefined'&&typeof opts.allowEmptyArrays!=='boolean'){throw new TypeError('`allowEmptyArrays` option can only be `true` or `false`, when provided');}if(typeof opts.encodeDotInKeys!=='undefined'&&typeof opts.encodeDotInKeys!=='boolean'){throw new TypeError('`encodeDotInKeys` option can only be `true` or `false`, when provided');}if(opts.encoder!==null&&typeof opts.encoder!=='undefined'&&typeof opts.encoder!=='function'){throw new TypeError('Encoder has to be a function.');}var charset=opts.charset||defaults$1.charset;if(typeof opts.charset!=='undefined'&&opts.charset!=='utf-8'&&opts.charset!=='iso-8859-1'){throw new TypeError('The charset option must be either utf-8, iso-8859-1, or undefined');}var format=formats$2['default'];if(typeof opts.format!=='undefined'){if(!has$1.call(formats$2.formatters,opts.format)){throw new TypeError('Unknown format option provided.');}format=opts.format;}var formatter=formats$2.formatters[format];var filter=defaults$1.filter;if(typeof opts.filter==='function'||isArray$1(opts.filter)){filter=opts.filter;}var arrayFormat;if(opts.arrayFormat in arrayPrefixGenerators){arrayFormat=opts.arrayFormat;}else if('indices'in opts){arrayFormat=opts.indices?'indices':'repeat';}else{arrayFormat=defaults$1.arrayFormat;}if('commaRoundTrip'in opts&&typeof opts.commaRoundTrip!=='boolean'){throw new TypeError('`commaRoundTrip` must be a boolean, or absent');}var allowDots=typeof opts.allowDots==='undefined'?opts.encodeDotInKeys===true?true:defaults$1.allowDots:!!opts.allowDots;return{addQueryPrefix:typeof opts.addQueryPrefix==='boolean'?opts.addQueryPrefix:defaults$1.addQueryPrefix,allowDots:allowDots,allowEmptyArrays:typeof opts.allowEmptyArrays==='boolean'?!!opts.allowEmptyArrays:defaults$1.allowEmptyArrays,arrayFormat:arrayFormat,charset:charset,charsetSentinel:typeof opts.charsetSentinel==='boolean'?opts.charsetSentinel:defaults$1.charsetSentinel,commaRoundTrip:opts.commaRoundTrip,delimiter:typeof opts.delimiter==='undefined'?defaults$1.delimiter:opts.delimiter,encode:typeof opts.encode==='boolean'?opts.encode:defaults$1.encode,encodeDotInKeys:typeof opts.encodeDotInKeys==='boolean'?opts.encodeDotInKeys:defaults$1.encodeDotInKeys,encoder:typeof opts.encoder==='function'?opts.encoder:defaults$1.encoder,encodeValuesOnly:typeof opts.encodeValuesOnly==='boolean'?opts.encodeValuesOnly:defaults$1.encodeValuesOnly,filter:filter,format:format,formatter:formatter,serializeDate:typeof opts.serializeDate==='function'?opts.serializeDate:defaults$1.serializeDate,skipNulls:typeof opts.skipNulls==='boolean'?opts.skipNulls:defaults$1.skipNulls,sort:typeof opts.sort==='function'?opts.sort:null,strictNullHandling:typeof opts.strictNullHandling==='boolean'?opts.strictNullHandling:defaults$1.strictNullHandling};};var stringify_1=function stringify_1(object,opts){var obj=object;var options=normalizeStringifyOptions(opts);var objKeys;var filter;if(typeof options.filter==='function'){filter=options.filter;obj=filter('',obj);}else if(isArray$1(options.filter)){filter=options.filter;objKeys=filter;}var keys=[];if(_typeof(obj)!=='object'||obj===null){return'';}var generateArrayPrefix=arrayPrefixGenerators[options.arrayFormat];var commaRoundTrip=generateArrayPrefix==='comma'&&options.commaRoundTrip;if(!objKeys){objKeys=Object.keys(obj);}if(options.sort){objKeys.sort(options.sort);}var sideChannel=getSideChannel();for(var i=0;i<objKeys.length;++i){var key=objKeys[i];if(options.skipNulls&&obj[key]===null){continue;}pushToArray(keys,stringify$1(obj[key],key,generateArrayPrefix,commaRoundTrip,options.allowEmptyArrays,options.strictNullHandling,options.skipNulls,options.encodeDotInKeys,options.encode?options.encoder:null,options.filter,options.sort,options.allowDots,options.serializeDate,options.format,options.formatter,options.encodeValuesOnly,options.charset,sideChannel));}var joined=keys.join(options.delimiter);var prefix=options.addQueryPrefix===true?'?':'';if(options.charsetSentinel){if(options.charset==='iso-8859-1'){// encodeURIComponent('&#10003;'), the "numeric entity" representation of a checkmark
prefix+='utf8=%26%2310003%3B&';}else{// encodeURIComponent('')
prefix+='utf8=%E2%9C%93&';}}return joined.length>0?prefix+joined:'';};var utils=utils$2;var has=Object.prototype.hasOwnProperty;var isArray=Array.isArray;var defaults={allowDots:false,allowEmptyArrays:false,allowPrototypes:false,allowSparse:false,arrayLimit:20,charset:'utf-8',charsetSentinel:false,comma:false,decodeDotInKeys:false,decoder:utils.decode,delimiter:'&',depth:5,duplicates:'combine',ignoreQueryPrefix:false,interpretNumericEntities:false,parameterLimit:1000,parseArrays:true,plainObjects:false,strictNullHandling:false};var interpretNumericEntities=function interpretNumericEntities(str){return str.replace(/&#(\d+);/g,function($0,numberStr){return String.fromCharCode(parseInt(numberStr,10));});};var parseArrayValue=function parseArrayValue(val,options){if(val&&typeof val==='string'&&options.comma&&val.indexOf(',')>-1){return val.split(',');}return val;};// This is what browsers will submit when the  character occurs in an
// application/x-www-form-urlencoded body and the encoding of the page containing
// the form is iso-8859-1, or when the submitted form has an accept-charset
// attribute of iso-8859-1. Presumably also with other charsets that do not contain
// the  character, such as us-ascii.
var isoSentinel='utf8=%26%2310003%3B';// encodeURIComponent('&#10003;')
// These are the percent-encoded utf-8 octets representing a checkmark, indicating that the request actually is utf-8 encoded.
var charsetSentinel='utf8=%E2%9C%93';// encodeURIComponent('')
var parseValues=function parseQueryStringValues(str,options){var obj={__proto__:null};var cleanStr=options.ignoreQueryPrefix?str.replace(/^\?/,''):str;var limit=options.parameterLimit===Infinity?undefined:options.parameterLimit;var parts=cleanStr.split(options.delimiter,limit);var skipIndex=-1;// Keep track of where the utf8 sentinel was found
var i;var charset=options.charset;if(options.charsetSentinel){for(i=0;i<parts.length;++i){if(parts[i].indexOf('utf8=')===0){if(parts[i]===charsetSentinel){charset='utf-8';}else if(parts[i]===isoSentinel){charset='iso-8859-1';}skipIndex=i;i=parts.length;// The eslint settings do not allow break;
}}}for(i=0;i<parts.length;++i){if(i===skipIndex){continue;}var part=parts[i];var bracketEqualsPos=part.indexOf(']=');var pos=bracketEqualsPos===-1?part.indexOf('='):bracketEqualsPos+1;var key,val;if(pos===-1){key=options.decoder(part,defaults.decoder,charset,'key');val=options.strictNullHandling?null:'';}else{key=options.decoder(part.slice(0,pos),defaults.decoder,charset,'key');val=utils.maybeMap(parseArrayValue(part.slice(pos+1),options),function(encodedVal){return options.decoder(encodedVal,defaults.decoder,charset,'value');});}if(val&&options.interpretNumericEntities&&charset==='iso-8859-1'){val=interpretNumericEntities(val);}if(part.indexOf('[]=')>-1){val=isArray(val)?[val]:val;}var existing=has.call(obj,key);if(existing&&options.duplicates==='combine'){obj[key]=utils.combine(obj[key],val);}else if(!existing||options.duplicates==='last'){obj[key]=val;}}return obj;};var parseObject=function parseObject(chain,val,options,valuesParsed){var leaf=valuesParsed?val:parseArrayValue(val,options);for(var i=chain.length-1;i>=0;--i){var obj;var root=chain[i];if(root==='[]'&&options.parseArrays){obj=options.allowEmptyArrays&&leaf===''?[]:[].concat(leaf);}else{obj=options.plainObjects?Object.create(null):{};var cleanRoot=root.charAt(0)==='['&&root.charAt(root.length-1)===']'?root.slice(1,-1):root;var decodedRoot=options.decodeDotInKeys?cleanRoot.replace(/%2E/g,'.'):cleanRoot;var index=parseInt(decodedRoot,10);if(!options.parseArrays&&decodedRoot===''){obj={0:leaf};}else if(!isNaN(index)&&root!==decodedRoot&&String(index)===decodedRoot&&index>=0&&options.parseArrays&&index<=options.arrayLimit){obj=[];obj[index]=leaf;}else if(decodedRoot!=='__proto__'){obj[decodedRoot]=leaf;}}leaf=obj;}return leaf;};var parseKeys=function parseQueryStringKeys(givenKey,val,options,valuesParsed){if(!givenKey){return;}// Transform dot notation to bracket notation
var key=options.allowDots?givenKey.replace(/\.([^.[]+)/g,'[$1]'):givenKey;// The regex chunks
var brackets=/(\[[^[\]]*])/;var child=/(\[[^[\]]*])/g;// Get the parent
var segment=options.depth>0&&brackets.exec(key);var parent=segment?key.slice(0,segment.index):key;// Stash the parent if it exists
var keys=[];if(parent){// If we aren't using plain objects, optionally prefix keys that would overwrite object prototype properties
if(!options.plainObjects&&has.call(Object.prototype,parent)){if(!options.allowPrototypes){return;}}keys.push(parent);}// Loop through children appending to the array until we hit depth
var i=0;while(options.depth>0&&(segment=child.exec(key))!==null&&i<options.depth){i+=1;if(!options.plainObjects&&has.call(Object.prototype,segment[1].slice(1,-1))){if(!options.allowPrototypes){return;}}keys.push(segment[1]);}// If there's a remainder, just add whatever is left
if(segment){keys.push('['+key.slice(segment.index)+']');}return parseObject(keys,val,options,valuesParsed);};var normalizeParseOptions=function normalizeParseOptions(opts){if(!opts){return defaults;}if(typeof opts.allowEmptyArrays!=='undefined'&&typeof opts.allowEmptyArrays!=='boolean'){throw new TypeError('`allowEmptyArrays` option can only be `true` or `false`, when provided');}if(typeof opts.decodeDotInKeys!=='undefined'&&typeof opts.decodeDotInKeys!=='boolean'){throw new TypeError('`decodeDotInKeys` option can only be `true` or `false`, when provided');}if(opts.decoder!==null&&typeof opts.decoder!=='undefined'&&typeof opts.decoder!=='function'){throw new TypeError('Decoder has to be a function.');}if(typeof opts.charset!=='undefined'&&opts.charset!=='utf-8'&&opts.charset!=='iso-8859-1'){throw new TypeError('The charset option must be either utf-8, iso-8859-1, or undefined');}var charset=typeof opts.charset==='undefined'?defaults.charset:opts.charset;var duplicates=typeof opts.duplicates==='undefined'?defaults.duplicates:opts.duplicates;if(duplicates!=='combine'&&duplicates!=='first'&&duplicates!=='last'){throw new TypeError('The duplicates option must be either combine, first, or last');}var allowDots=typeof opts.allowDots==='undefined'?opts.decodeDotInKeys===true?true:defaults.allowDots:!!opts.allowDots;return{allowDots:allowDots,allowEmptyArrays:typeof opts.allowEmptyArrays==='boolean'?!!opts.allowEmptyArrays:defaults.allowEmptyArrays,allowPrototypes:typeof opts.allowPrototypes==='boolean'?opts.allowPrototypes:defaults.allowPrototypes,allowSparse:typeof opts.allowSparse==='boolean'?opts.allowSparse:defaults.allowSparse,arrayLimit:typeof opts.arrayLimit==='number'?opts.arrayLimit:defaults.arrayLimit,charset:charset,charsetSentinel:typeof opts.charsetSentinel==='boolean'?opts.charsetSentinel:defaults.charsetSentinel,comma:typeof opts.comma==='boolean'?opts.comma:defaults.comma,decodeDotInKeys:typeof opts.decodeDotInKeys==='boolean'?opts.decodeDotInKeys:defaults.decodeDotInKeys,decoder:typeof opts.decoder==='function'?opts.decoder:defaults.decoder,delimiter:typeof opts.delimiter==='string'||utils.isRegExp(opts.delimiter)?opts.delimiter:defaults.delimiter,// eslint-disable-next-line no-implicit-coercion, no-extra-parens
depth:typeof opts.depth==='number'||opts.depth===false?+opts.depth:defaults.depth,duplicates:duplicates,ignoreQueryPrefix:opts.ignoreQueryPrefix===true,interpretNumericEntities:typeof opts.interpretNumericEntities==='boolean'?opts.interpretNumericEntities:defaults.interpretNumericEntities,parameterLimit:typeof opts.parameterLimit==='number'?opts.parameterLimit:defaults.parameterLimit,parseArrays:opts.parseArrays!==false,plainObjects:typeof opts.plainObjects==='boolean'?opts.plainObjects:defaults.plainObjects,strictNullHandling:typeof opts.strictNullHandling==='boolean'?opts.strictNullHandling:defaults.strictNullHandling};};var parse$2=function parse$2(str,opts){var options=normalizeParseOptions(opts);if(str===''||str===null||typeof str==='undefined'){return options.plainObjects?Object.create(null):{};}var tempObj=typeof str==='string'?parseValues(str,options):str;var obj=options.plainObjects?Object.create(null):{};// Iterate over the keys and setup the new object
var keys=Object.keys(tempObj);for(var i=0;i<keys.length;++i){var key=keys[i];var newObj=parseKeys(key,tempObj[key],options,typeof str==='string');obj=utils.merge(obj,newObj,options);}if(options.allowSparse===true){return obj;}return utils.compact(obj);};var stringify=stringify_1;var parse$1=parse$2;var formats$1=formats$4;var lib={formats:formats$1,parse:parse$1,stringify:stringify};/*
   * Copyright Joyent, Inc. and other Node contributors.
   *
   * Permission is hereby granted, free of charge, to any person obtaining a
   * copy of this software and associated documentation files (the
   * "Software"), to deal in the Software without restriction, including
   * without limitation the rights to use, copy, modify, merge, publish,
   * distribute, sublicense, and/or sell copies of the Software, and to permit
   * persons to whom the Software is furnished to do so, subject to the
   * following conditions:
   *
   * The above copyright notice and this permission notice shall be included
   * in all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
   * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
   * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
   * NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
   * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
   * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
   * USE OR OTHER DEALINGS IN THE SOFTWARE.
   */var punycode=punycodeExports;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null;}// Reference: RFC 3986, RFC 1808, RFC 2396
/*
   * define these here so at least they only have to be
   * compiled once on the first module load.
   */var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,// Special case for a simple path URL
simplePathPattern=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,/*
     * RFC 2396: characters reserved for delimiting URLs.
     * We actually just auto-escape these.
     */delims=['<','>','"','`',' ','\r','\n','\t'],// RFC 2396: characters not allowed for various reasons.
unwise=['{','}','|','\\','^','`'].concat(delims),// Allowed by RFCs, but cause of XSS attacks.  Always escape these.
autoEscape=['\''].concat(unwise),/*
     * Characters that are never ever allowed in a hostname.
     * Note that any invalid chars are also handled, but these
     * are the ones that are *expected* to be seen, so we fast-path
     * them.
     */nonHostChars=['%','/','?',';','#'].concat(autoEscape),hostEndingChars=['/','?','#'],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,// protocols that can allow "unsafe" and "unwise" chars.
unsafeProtocol={javascript:true,'javascript:':true},// protocols that never have a hostname.
hostlessProtocol={javascript:true,'javascript:':true},// protocols that always contain a // bit.
slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,'http:':true,'https:':true,'ftp:':true,'gopher:':true,'file:':true},querystring=lib;function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&_typeof(url)==='object'&&url instanceof Url){return url;}var u=new Url();u.parse(url,parseQueryString,slashesDenoteHost);return u;}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(typeof url!=='string'){throw new TypeError("Parameter 'url' must be a string, not "+_typeof(url));}/*
     * Copy chrome, IE, opera backslash-handling behavior.
     * Back slashes before the query string get converted to forward slashes
     * See: https://code.google.com/p/chromium/issues/detail?id=25916
     */var queryIndex=url.indexOf('?'),splitter=queryIndex!==-1&&queryIndex<url.indexOf('#')?'?':'#',uSplit=url.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,'/');url=uSplit.join(splitter);var rest=url;/*
     * trim before proceeding.
     * This is to support parse stuff like "  http://foo.com  \n"
     */rest=rest.trim();if(!slashesDenoteHost&&url.split('#').length===1){// Try fast path regexp
var simplePath=simplePathPattern.exec(rest);if(simplePath){this.path=rest;this.href=rest;this.pathname=simplePath[1];if(simplePath[2]){this.search=simplePath[2];if(parseQueryString){this.query=querystring.parse(this.search.substr(1));}else{this.query=this.search.substr(1);}}else if(parseQueryString){this.search='';this.query={};}return this;}}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length);}/*
     * figure out if it's got a host
     * user@server is *always* interpreted as a hostname, and url
     * resolution will treat //foo/bar as host=foo,path=bar because that's
     * how the browser resolves relative URLs.
     */if(slashesDenoteHost||proto||rest.match(/^\/\/[^@/]+@[^@/]+/)){var slashes=rest.substr(0,2)==='//';if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true;}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){/*
       * there's a hostname.
       * the first instance of /, ?, ;, or # ends the host.
       *
       * If there is an @ in the hostname, then non-host chars *are* allowed
       * to the left of the last @ sign, unless some host-ending character
       * comes *before* the @-sign.
       * URLs are obnoxious.
       *
       * ex:
       * http://a@b@c/ => user:a@b host:c
       * http://a@b?@c => user:a host:c path:/?@c
       */ /*
       * v0.12 TODO(isaacs): This is not quite how Chrome does things.
       * Review our test case against browsers more comprehensively.
       */ // find the first instance of any hostEndingChars
var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd)){hostEnd=hec;}}/*
       * at this point, either we have an explicit point where the
       * auth portion cannot go past, or the last @ char is the decider.
       */var auth,atSign;if(hostEnd===-1){// atSign can be anywhere.
atSign=rest.lastIndexOf('@');}else{/*
         * atSign must be in auth portion.
         * http://a@b/c@d => host:b auth:a path:/c@d
         */atSign=rest.lastIndexOf('@',hostEnd);}/*
       * Now we have a portion which is definitely the auth.
       * Pull that off.
       */if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth);}// the host is the remaining to the left of the first non-host char
hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd)){hostEnd=hec;}}// if we still have not hit it, then the entire thing is a host.
if(hostEnd===-1){hostEnd=rest.length;}this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);// pull out port.
this.parseHost();/*
       * we've indicated that there is a hostname,
       * so even if it's empty, it has to be present.
       */this.hostname=this.hostname||'';/*
       * if hostname begins with [ and ends with ]
       * assume that it's an IPv6 address.
       */var ipv6Hostname=this.hostname[0]==='['&&this.hostname[this.hostname.length-1]===']';// validate a little.
if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part){continue;}if(!part.match(hostnamePartPattern)){var newpart='';for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){/*
                 * we replace non-ASCII char with a temporary placeholder
                 * we need this to make sure size of hostname is not
                 * broken by replacing non-ASCII by nothing
                 */newpart+='x';}else{newpart+=part[j];}}// we test again with ASCII char only
if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2]);}if(notHost.length){rest='/'+notHost.join('.')+rest;}this.hostname=validParts.join('.');break;}}}}if(this.hostname.length>hostnameMaxLen){this.hostname='';}else{// hostnames are always lower case.
this.hostname=this.hostname.toLowerCase();}if(!ipv6Hostname){/*
         * IDNA Support: Returns a punycoded representation of "domain".
         * It only converts parts of the domain name that
         * have non-ASCII characters, i.e. it doesn't matter if
         * you call it with a domain that already is ASCII-only.
         */this.hostname=punycode.toASCII(this.hostname);}var p=this.port?':'+this.port:'';var h=this.hostname||'';this.host=h+p;this.href+=this.host;/*
       * strip [ and ] from the hostname
       * the host field still retains them, though
       */if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=='/'){rest='/'+rest;}}}/*
     * now rest is set to the post-host stuff.
     * chop off any delim chars.
     */if(!unsafeProtocol[lowerProto]){/*
       * First, make 100% sure that any "autoEscape" chars get
       * escaped, even if encodeURIComponent doesn't think they
       * need to be.
       */for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)===-1){continue;}var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae);}rest=rest.split(ae).join(esc);}}// chop off from the tail first.
var hash=rest.indexOf('#');if(hash!==-1){// got a fragment string.
this.hash=rest.substr(hash);rest=rest.slice(0,hash);}var qm=rest.indexOf('?');if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query);}rest=rest.slice(0,qm);}else if(parseQueryString){// no query string, but parseQueryString still requested
this.search='';this.query={};}if(rest){this.pathname=rest;}if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname='/';}// to support http.request
if(this.pathname||this.search){var p=this.pathname||'';var s=this.search||'';this.path=p+s;}// finally, reconstruct the href based on what has been validated.
this.href=this.format();return this;};// format a parsed object into a url string
function urlFormat(obj){/*
     * ensure it's an object, and not a string url.
     * If it's an obj, this is a no-op.
     * this way, you can call url_format() on strings
     * to clean up potentially wonky urls.
     */if(typeof obj==='string'){obj=urlParse(obj);}if(!(obj instanceof Url)){return Url.prototype.format.call(obj);}return obj.format();}Url.prototype.format=function(){var auth=this.auth||'';if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,':');auth+='@';}var protocol=this.protocol||'',pathname=this.pathname||'',hash=this.hash||'',host=false,query='';if(this.host){host=auth+this.host;}else if(this.hostname){host=auth+(this.hostname.indexOf(':')===-1?this.hostname:'['+this.hostname+']');if(this.port){host+=':'+this.port;}}if(this.query&&_typeof(this.query)==='object'&&Object.keys(this.query).length){query=querystring.stringify(this.query,{arrayFormat:'repeat',addQueryPrefix:false});}var search=this.search||query&&'?'+query||'';if(protocol&&protocol.substr(-1)!==':'){protocol+=':';}/*
     * only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.
     * unless they had them to begin with.
     */if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host='//'+(host||'');if(pathname&&pathname.charAt(0)!=='/'){pathname='/'+pathname;}}else if(!host){host='';}if(hash&&hash.charAt(0)!=='#'){hash='#'+hash;}if(search&&search.charAt(0)!=='?'){search='?'+search;}pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match);});search=search.replace('#','%23');return protocol+host+pathname+search+hash;};function urlResolve(source,relative){return urlParse(source,false,true).resolve(relative);}Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,false,true)).format();};Url.prototype.resolveObject=function(relative){if(typeof relative==='string'){var rel=new Url();rel.parse(relative,false,true);relative=rel;}var result=new Url();var tkeys=Object.keys(this);for(var tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey];}/*
     * hash is always overridden, no matter what.
     * even href="" will remove it.
     */result.hash=relative.hash;// if the relative url is empty, then there's nothing left to do here.
if(relative.href===''){result.href=result.format();return result;}// hrefs like //foo/bar always cut to the protocol.
if(relative.slashes&&!relative.protocol){// take everything except the protocol from relative
var rkeys=Object.keys(relative);for(var rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];if(rkey!=='protocol'){result[rkey]=relative[rkey];}}// urlParse appends trailing / to urls like http://www.example.com
if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.pathname='/';result.path=result.pathname;}result.href=result.format();return result;}if(relative.protocol&&relative.protocol!==result.protocol){/*
       * if it's a known url protocol, then changing
       * the protocol does weird things
       * first, if it's not file:, then we MUST have a host,
       * and if there was a path
       * to begin with, then we MUST have a path.
       * if it is file:, then the host is dropped,
       * because that's known to be hostless.
       * anything else is assumed to be absolute.
       */if(!slashedProtocol[relative.protocol]){var keys=Object.keys(relative);for(var v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k];}result.href=result.format();return result;}result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||'').split('/');while(relPath.length&&!(relative.host=relPath.shift())){}if(!relative.host){relative.host='';}if(!relative.hostname){relative.hostname='';}if(relPath[0]!==''){relPath.unshift('');}if(relPath.length<2){relPath.unshift('');}result.pathname=relPath.join('/');}else{result.pathname=relative.pathname;}result.search=relative.search;result.query=relative.query;result.host=relative.host||'';result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;// to support http.request
if(result.pathname||result.search){var p=result.pathname||'';var s=result.search||'';result.path=p+s;}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result;}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==='/',isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==='/',mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split('/')||[],relPath=relative.pathname&&relative.pathname.split('/')||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];/*
     * if the url is a non-slashed url, then relative
     * links like ../.. should be able
     * to crawl up to the hostname, as well.  This is strange.
     * result.protocol has already been set by now.
     * Later on, put the first path part into the host field.
     */if(psychotic){result.hostname='';result.port=null;if(result.host){if(srcPath[0]===''){srcPath[0]=result.host;}else{srcPath.unshift(result.host);}}result.host='';if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]===''){relPath[0]=relative.host;}else{relPath.unshift(relative.host);}}relative.host=null;}mustEndAbs=mustEndAbs&&(relPath[0]===''||srcPath[0]==='');}if(isRelAbs){// it's absolute.
result.host=relative.host||relative.host===''?relative.host:result.host;result.hostname=relative.hostname||relative.hostname===''?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath;// fall through to the dot-handling below.
}else if(relPath.length){/*
       * it's relative
       * throw away the existing file, and take the new path instead.
       */if(!srcPath){srcPath=[];}srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query;}else if(relative.search!=null){/*
       * just pull out the search.
       * like href='?foo'.
       * Put this after the other two cases because it simplifies the booleans
       */if(psychotic){result.host=srcPath.shift();result.hostname=result.host;/*
         * occationaly the auth can get stuck only in host
         * this especially happens in cases like
         * url.resolveObject('mailto:local1@domain1', 'local2@domain2')
         */var authInHost=result.host&&result.host.indexOf('@')>0?result.host.split('@'):false;if(authInHost){result.auth=authInHost.shift();result.hostname=authInHost.shift();result.host=result.hostname;}}result.search=relative.search;result.query=relative.query;// to support http.request
if(result.pathname!==null||result.search!==null){result.path=(result.pathname?result.pathname:'')+(result.search?result.search:'');}result.href=result.format();return result;}if(!srcPath.length){/*
       * no path at all.  easy.
       * we've already handled the other stuff above.
       */result.pathname=null;// to support http.request
if(result.search){result.path='/'+result.search;}else{result.path=null;}result.href=result.format();return result;}/*
     * if a url ENDs in . or .., then it must get a trailing slash.
     * however, if it ends in anything else non-slashy,
     * then it must NOT get a trailing slash.
     */var last=srcPath.slice(-1)[0];var hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&(last==='.'||last==='..')||last==='';/*
     * strip single dots, resolve double dots to parent dir
     * if the path tries to go above the root, `up` ends up > 0
     */var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last==='.'){srcPath.splice(i,1);}else if(last==='..'){srcPath.splice(i,1);up++;}else if(up){srcPath.splice(i,1);up--;}}// if the path is allowed to go above the root, restore leading ..s
if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift('..');}}if(mustEndAbs&&srcPath[0]!==''&&(!srcPath[0]||srcPath[0].charAt(0)!=='/')){srcPath.unshift('');}if(hasTrailingSlash&&srcPath.join('/').substr(-1)!=='/'){srcPath.push('');}var isAbsolute=srcPath[0]===''||srcPath[0]&&srcPath[0].charAt(0)==='/';// put the host back
if(psychotic){result.hostname=isAbsolute?'':srcPath.length?srcPath.shift():'';result.host=result.hostname;/*
       * occationaly the auth can get stuck only in host
       * this especially happens in cases like
       * url.resolveObject('mailto:local1@domain1', 'local2@domain2')
       */var authInHost=result.host&&result.host.indexOf('@')>0?result.host.split('@'):false;if(authInHost){result.auth=authInHost.shift();result.hostname=authInHost.shift();result.host=result.hostname;}}mustEndAbs=mustEndAbs||result.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift('');}if(srcPath.length>0){result.pathname=srcPath.join('/');}else{result.pathname=null;result.path=null;}// to support request.http
if(result.pathname!==null||result.search!==null){result.path=(result.pathname?result.pathname:'')+(result.search?result.search:'');}result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result;};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==':'){this.port=port.substr(1);}host=host.substr(0,host.length-port.length);}if(host){this.hostname=host;}};var parse=urlParse;var resolve=urlResolve;var format=urlFormat;var url={parse:parse,format:format,resolve:resolve};function assertPath(path2){if(typeof path2!=="string"){throw new TypeError("Path must be a string. Received ".concat(JSON.stringify(path2)));}}function removeUrlParams(url){var re=url.split("?")[0];return re.split("#")[0];}function escapeRegExp(string){return string.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");}function replaceAll(str,find,replace){return str.replace(new RegExp(escapeRegExp(find),"g"),replace);}function normalizeStringPosix(path2,allowAboveRoot){var res="";var lastSegmentLength=0;var lastSlash=-1;var dots=0;var code=-1;for(var i=0;i<=path2.length;++i){if(i<path2.length){code=path2.charCodeAt(i);}else if(code===47){break;}else{code=47;}if(code===47){if(lastSlash===i-1||dots===1);else if(lastSlash!==i-1&&dots===2){if(res.length<2||lastSegmentLength!==2||res.charCodeAt(res.length-1)!==46||res.charCodeAt(res.length-2)!==46){if(res.length>2){var lastSlashIndex=res.lastIndexOf("/");if(lastSlashIndex!==res.length-1){if(lastSlashIndex===-1){res="";lastSegmentLength=0;}else{res=res.slice(0,lastSlashIndex);lastSegmentLength=res.length-1-res.lastIndexOf("/");}lastSlash=i;dots=0;continue;}}else if(res.length===2||res.length===1){res="";lastSegmentLength=0;lastSlash=i;dots=0;continue;}}if(allowAboveRoot){if(res.length>0){res+="/..";}else{res="..";}lastSegmentLength=2;}}else{if(res.length>0){res+="/".concat(path2.slice(lastSlash+1,i));}else{res=path2.slice(lastSlash+1,i);}lastSegmentLength=i-lastSlash-1;}lastSlash=i;dots=0;}else if(code===46&&dots!==-1){++dots;}else{dots=-1;}}return res;}var path={toPosix:function toPosix(path2){return replaceAll(path2,"\\","/");},isUrl:function isUrl(path2){return /^https?:/.test(this.toPosix(path2));},isDataUrl:function isDataUrl(path2){return /^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(path2);},hasProtocol:function hasProtocol(path2){return /^[^/:]+:\//.test(this.toPosix(path2));},getProtocol:function getProtocol(path2){assertPath(path2);path2=this.toPosix(path2);var protocol="";var isFile=/^file:\/\/\//.exec(path2);var isHttp=/^[^/:]+:\/\//.exec(path2);var isWindows=/^[^/:]+:\//.exec(path2);if(isFile||isHttp||isWindows){var arr=(isFile===null||isFile===void 0?void 0:isFile[0])||(isHttp===null||isHttp===void 0?void 0:isHttp[0])||(isWindows===null||isWindows===void 0?void 0:isWindows[0]);protocol=arr;path2=path2.slice(arr.length);}return protocol;},toAbsolute:function toAbsolute(url,customBaseUrl,customRootUrl){if(this.isDataUrl(url))return url;var baseUrl=removeUrlParams(this.toPosix(customBaseUrl!==null&&customBaseUrl!==void 0?customBaseUrl:settings.ADAPTER.getBaseUrl()));var rootUrl=removeUrlParams(this.toPosix(customRootUrl!==null&&customRootUrl!==void 0?customRootUrl:this.rootname(baseUrl)));assertPath(url);url=this.toPosix(url);if(url.startsWith("/")){return path.join(rootUrl,url.slice(1));}var absolutePath=this.isAbsolute(url)?url:this.join(baseUrl,url);return absolutePath;},normalize:function normalize(path2){path2=this.toPosix(path2);assertPath(path2);if(path2.length===0)return".";var protocol="";var isAbsolute=path2.startsWith("/");if(this.hasProtocol(path2)){protocol=this.rootname(path2);path2=path2.slice(protocol.length);}var trailingSeparator=path2.endsWith("/");path2=normalizeStringPosix(path2,false);if(path2.length>0&&trailingSeparator)path2+="/";if(isAbsolute)return"/".concat(path2);return protocol+path2;},isAbsolute:function isAbsolute(path2){assertPath(path2);path2=this.toPosix(path2);if(this.hasProtocol(path2))return true;return path2.startsWith("/");},join:function join(){if(arguments.length===0){return".";}var joined;for(var i=0;i<arguments.length;++i){var arg=i<0||arguments.length<=i?undefined:arguments[i];assertPath(arg);if(arg.length>0){if(joined===void 0)joined=arg;else{var _ref;var prevArg=(_ref=i-1<0||arguments.length<=i-1?undefined:arguments[i-1])!==null&&_ref!==void 0?_ref:"";if(this.extname(prevArg)){joined+="/../".concat(arg);}else{joined+="/".concat(arg);}}}}if(joined===void 0){return".";}return this.normalize(joined);},dirname:function dirname(path2){assertPath(path2);if(path2.length===0)return".";path2=this.toPosix(path2);var code=path2.charCodeAt(0);var hasRoot=code===47;var end=-1;var matchedSlash=true;var proto=this.getProtocol(path2);var origpath=path2;path2=path2.slice(proto.length);for(var i=path2.length-1;i>=1;--i){code=path2.charCodeAt(i);if(code===47){if(!matchedSlash){end=i;break;}}else{matchedSlash=false;}}if(end===-1)return hasRoot?"/":this.isUrl(origpath)?proto+path2:proto;if(hasRoot&&end===1)return"//";return proto+path2.slice(0,end);},rootname:function rootname(path2){assertPath(path2);path2=this.toPosix(path2);var root="";if(path2.startsWith("/"))root="/";else{root=this.getProtocol(path2);}if(this.isUrl(path2)){var _index2=path2.indexOf("/",root.length);if(_index2!==-1){root=path2.slice(0,_index2);}else root=path2;if(!root.endsWith("/"))root+="/";}return root;},basename:function basename(path2,ext){assertPath(path2);if(ext)assertPath(ext);path2=removeUrlParams(this.toPosix(path2));var start=0;var end=-1;var matchedSlash=true;var i;if(ext!==void 0&&ext.length>0&&ext.length<=path2.length){if(ext.length===path2.length&&ext===path2)return"";var extIdx=ext.length-1;var firstNonSlashEnd=-1;for(i=path2.length-1;i>=0;--i){var code=path2.charCodeAt(i);if(code===47){if(!matchedSlash){start=i+1;break;}}else{if(firstNonSlashEnd===-1){matchedSlash=false;firstNonSlashEnd=i+1;}if(extIdx>=0){if(code===ext.charCodeAt(extIdx)){if(--extIdx===-1){end=i;}}else{extIdx=-1;end=firstNonSlashEnd;}}}}if(start===end)end=firstNonSlashEnd;else if(end===-1)end=path2.length;return path2.slice(start,end);}for(i=path2.length-1;i>=0;--i){if(path2.charCodeAt(i)===47){if(!matchedSlash){start=i+1;break;}}else if(end===-1){matchedSlash=false;end=i+1;}}if(end===-1)return"";return path2.slice(start,end);},extname:function extname(path2){assertPath(path2);path2=removeUrlParams(this.toPosix(path2));var startDot=-1;var startPart=0;var end=-1;var matchedSlash=true;var preDotState=0;for(var i=path2.length-1;i>=0;--i){var code=path2.charCodeAt(i);if(code===47){if(!matchedSlash){startPart=i+1;break;}continue;}if(end===-1){matchedSlash=false;end=i+1;}if(code===46){if(startDot===-1)startDot=i;else if(preDotState!==1)preDotState=1;}else if(startDot!==-1){preDotState=-1;}}if(startDot===-1||end===-1||preDotState===0||preDotState===1&&startDot===end-1&&startDot===startPart+1){return"";}return path2.slice(startDot,end);},parse:function parse(path2){assertPath(path2);var ret={root:"",dir:"",base:"",ext:"",name:""};if(path2.length===0)return ret;path2=removeUrlParams(this.toPosix(path2));var code=path2.charCodeAt(0);var isAbsolute=this.isAbsolute(path2);var start;ret.root=this.rootname(path2);if(isAbsolute||this.hasProtocol(path2)){start=1;}else{start=0;}var startDot=-1;var startPart=0;var end=-1;var matchedSlash=true;var i=path2.length-1;var preDotState=0;for(;i>=start;--i){code=path2.charCodeAt(i);if(code===47){if(!matchedSlash){startPart=i+1;break;}continue;}if(end===-1){matchedSlash=false;end=i+1;}if(code===46){if(startDot===-1)startDot=i;else if(preDotState!==1)preDotState=1;}else if(startDot!==-1){preDotState=-1;}}if(startDot===-1||end===-1||preDotState===0||preDotState===1&&startDot===end-1&&startDot===startPart+1){if(end!==-1){if(startPart===0&&isAbsolute)ret.base=ret.name=path2.slice(1,end);else ret.base=ret.name=path2.slice(startPart,end);}}else{if(startPart===0&&isAbsolute){ret.name=path2.slice(1,startDot);ret.base=path2.slice(1,end);}else{ret.name=path2.slice(startPart,startDot);ret.base=path2.slice(startPart,end);}ret.ext=path2.slice(startDot,end);}ret.dir=this.dirname(path2);return ret;},sep:"/",delimiter:":"};var warnings={};function deprecation(version,message){var ignoreDepth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:3;if(warnings[message]){return;}var stack=new Error().stack;if(typeof stack==="undefined"){console.warn("PixiJS Deprecation Warning: ","".concat(message,"\nDeprecated since v").concat(version));}else{stack=stack.split("\n").splice(ignoreDepth).join("\n");if(console.groupCollapsed){console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6","".concat(message,"\nDeprecated since v").concat(version));console.warn(stack);console.groupEnd();}else{console.warn("PixiJS Deprecation Warning: ","".concat(message,"\nDeprecated since v").concat(version));console.warn(stack);}}warnings[message]=true;}function skipHello(){deprecation("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello");}function sayHello(){deprecation("7.0.0","sayHello is deprecated, please use Renderer's \"hello\" option");}var supported;function isWebGLSupported(){if(typeof supported==="undefined"){supported=function supported2(){var contextOptions={stencil:true,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{var _gl;if(!settings.ADAPTER.getWebGLRenderingContext()){return false;}var canvas=settings.ADAPTER.createCanvas();var gl=canvas.getContext("webgl",contextOptions)||canvas.getContext("experimental-webgl",contextOptions);var success=!!((_gl=gl)!==null&&_gl!==void 0&&(_gl=_gl.getContextAttributes())!==null&&_gl!==void 0&&_gl.stencil);if(gl){var loseContext=gl.getExtension("WEBGL_lose_context");if(loseContext){loseContext.loseContext();}}gl=null;return success;}catch(e){return false;}}();}return supported;}var aliceblue="#f0f8ff";var antiquewhite="#faebd7";var aqua="#00ffff";var aquamarine="#7fffd4";var azure="#f0ffff";var beige="#f5f5dc";var bisque="#ffe4c4";var black="#000000";var blanchedalmond="#ffebcd";var blue="#0000ff";var blueviolet="#8a2be2";var brown="#a52a2a";var burlywood="#deb887";var cadetblue="#5f9ea0";var chartreuse="#7fff00";var chocolate="#d2691e";var coral="#ff7f50";var cornflowerblue="#6495ed";var cornsilk="#fff8dc";var crimson="#dc143c";var cyan="#00ffff";var darkblue="#00008b";var darkcyan="#008b8b";var darkgoldenrod="#b8860b";var darkgray="#a9a9a9";var darkgreen="#006400";var darkgrey="#a9a9a9";var darkkhaki="#bdb76b";var darkmagenta="#8b008b";var darkolivegreen="#556b2f";var darkorange="#ff8c00";var darkorchid="#9932cc";var darkred="#8b0000";var darksalmon="#e9967a";var darkseagreen="#8fbc8f";var darkslateblue="#483d8b";var darkslategray="#2f4f4f";var darkslategrey="#2f4f4f";var darkturquoise="#00ced1";var darkviolet="#9400d3";var deeppink="#ff1493";var deepskyblue="#00bfff";var dimgray="#696969";var dimgrey="#696969";var dodgerblue="#1e90ff";var firebrick="#b22222";var floralwhite="#fffaf0";var forestgreen="#228b22";var fuchsia="#ff00ff";var gainsboro="#dcdcdc";var ghostwhite="#f8f8ff";var goldenrod="#daa520";var gold="#ffd700";var gray="#808080";var green="#008000";var greenyellow="#adff2f";var grey="#808080";var honeydew="#f0fff0";var hotpink="#ff69b4";var indianred="#cd5c5c";var indigo="#4b0082";var ivory="#fffff0";var khaki="#f0e68c";var lavenderblush="#fff0f5";var lavender="#e6e6fa";var lawngreen="#7cfc00";var lemonchiffon="#fffacd";var lightblue="#add8e6";var lightcoral="#f08080";var lightcyan="#e0ffff";var lightgoldenrodyellow="#fafad2";var lightgray="#d3d3d3";var lightgreen="#90ee90";var lightgrey="#d3d3d3";var lightpink="#ffb6c1";var lightsalmon="#ffa07a";var lightseagreen="#20b2aa";var lightskyblue="#87cefa";var lightslategray="#778899";var lightslategrey="#778899";var lightsteelblue="#b0c4de";var lightyellow="#ffffe0";var lime="#00ff00";var limegreen="#32cd32";var linen="#faf0e6";var magenta="#ff00ff";var maroon="#800000";var mediumaquamarine="#66cdaa";var mediumblue="#0000cd";var mediumorchid="#ba55d3";var mediumpurple="#9370db";var mediumseagreen="#3cb371";var mediumslateblue="#7b68ee";var mediumspringgreen="#00fa9a";var mediumturquoise="#48d1cc";var mediumvioletred="#c71585";var midnightblue="#191970";var mintcream="#f5fffa";var mistyrose="#ffe4e1";var moccasin="#ffe4b5";var navajowhite="#ffdead";var navy="#000080";var oldlace="#fdf5e6";var olive="#808000";var olivedrab="#6b8e23";var orange="#ffa500";var orangered="#ff4500";var orchid="#da70d6";var palegoldenrod="#eee8aa";var palegreen="#98fb98";var paleturquoise="#afeeee";var palevioletred="#db7093";var papayawhip="#ffefd5";var peachpuff="#ffdab9";var peru="#cd853f";var pink="#ffc0cb";var plum="#dda0dd";var powderblue="#b0e0e6";var purple="#800080";var rebeccapurple="#663399";var red="#ff0000";var rosybrown="#bc8f8f";var royalblue="#4169e1";var saddlebrown="#8b4513";var salmon="#fa8072";var sandybrown="#f4a460";var seagreen="#2e8b57";var seashell="#fff5ee";var sienna="#a0522d";var silver="#c0c0c0";var skyblue="#87ceeb";var slateblue="#6a5acd";var slategray="#708090";var slategrey="#708090";var snow="#fffafa";var springgreen="#00ff7f";var steelblue="#4682b4";var tan="#d2b48c";var teal="#008080";var thistle="#d8bfd8";var tomato="#ff6347";var turquoise="#40e0d0";var violet="#ee82ee";var wheat="#f5deb3";var white="#ffffff";var whitesmoke="#f5f5f5";var yellow="#ffff00";var yellowgreen="#9acd32";var cssColorNames={aliceblue:aliceblue,antiquewhite:antiquewhite,aqua:aqua,aquamarine:aquamarine,azure:azure,beige:beige,bisque:bisque,black:black,blanchedalmond:blanchedalmond,blue:blue,blueviolet:blueviolet,brown:brown,burlywood:burlywood,cadetblue:cadetblue,chartreuse:chartreuse,chocolate:chocolate,coral:coral,cornflowerblue:cornflowerblue,cornsilk:cornsilk,crimson:crimson,cyan:cyan,darkblue:darkblue,darkcyan:darkcyan,darkgoldenrod:darkgoldenrod,darkgray:darkgray,darkgreen:darkgreen,darkgrey:darkgrey,darkkhaki:darkkhaki,darkmagenta:darkmagenta,darkolivegreen:darkolivegreen,darkorange:darkorange,darkorchid:darkorchid,darkred:darkred,darksalmon:darksalmon,darkseagreen:darkseagreen,darkslateblue:darkslateblue,darkslategray:darkslategray,darkslategrey:darkslategrey,darkturquoise:darkturquoise,darkviolet:darkviolet,deeppink:deeppink,deepskyblue:deepskyblue,dimgray:dimgray,dimgrey:dimgrey,dodgerblue:dodgerblue,firebrick:firebrick,floralwhite:floralwhite,forestgreen:forestgreen,fuchsia:fuchsia,gainsboro:gainsboro,ghostwhite:ghostwhite,goldenrod:goldenrod,gold:gold,gray:gray,green:green,greenyellow:greenyellow,grey:grey,honeydew:honeydew,hotpink:hotpink,indianred:indianred,indigo:indigo,ivory:ivory,khaki:khaki,lavenderblush:lavenderblush,lavender:lavender,lawngreen:lawngreen,lemonchiffon:lemonchiffon,lightblue:lightblue,lightcoral:lightcoral,lightcyan:lightcyan,lightgoldenrodyellow:lightgoldenrodyellow,lightgray:lightgray,lightgreen:lightgreen,lightgrey:lightgrey,lightpink:lightpink,lightsalmon:lightsalmon,lightseagreen:lightseagreen,lightskyblue:lightskyblue,lightslategray:lightslategray,lightslategrey:lightslategrey,lightsteelblue:lightsteelblue,lightyellow:lightyellow,lime:lime,limegreen:limegreen,linen:linen,magenta:magenta,maroon:maroon,mediumaquamarine:mediumaquamarine,mediumblue:mediumblue,mediumorchid:mediumorchid,mediumpurple:mediumpurple,mediumseagreen:mediumseagreen,mediumslateblue:mediumslateblue,mediumspringgreen:mediumspringgreen,mediumturquoise:mediumturquoise,mediumvioletred:mediumvioletred,midnightblue:midnightblue,mintcream:mintcream,mistyrose:mistyrose,moccasin:moccasin,navajowhite:navajowhite,navy:navy,oldlace:oldlace,olive:olive,olivedrab:olivedrab,orange:orange,orangered:orangered,orchid:orchid,palegoldenrod:palegoldenrod,palegreen:palegreen,paleturquoise:paleturquoise,palevioletred:palevioletred,papayawhip:papayawhip,peachpuff:peachpuff,peru:peru,pink:pink,plum:plum,powderblue:powderblue,purple:purple,rebeccapurple:rebeccapurple,red:red,rosybrown:rosybrown,royalblue:royalblue,saddlebrown:saddlebrown,salmon:salmon,sandybrown:sandybrown,seagreen:seagreen,seashell:seashell,sienna:sienna,silver:silver,skyblue:skyblue,slateblue:slateblue,slategray:slategray,slategrey:slategrey,snow:snow,springgreen:springgreen,steelblue:steelblue,tan:tan,teal:teal,thistle:thistle,tomato:tomato,turquoise:turquoise,violet:violet,wheat:wheat,white:white,whitesmoke:whitesmoke,yellow:yellow,yellowgreen:yellowgreen};function hex2rgb(hex){var out=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];out[0]=(hex>>16&255)/255;out[1]=(hex>>8&255)/255;out[2]=(hex&255)/255;return out;}function hex2string(hex){var hexString=hex.toString(16);hexString="000000".substring(0,6-hexString.length)+hexString;return"#".concat(hexString);}function string2hex(string){if(typeof string==="string"){string=cssColorNames[string.toLowerCase()]||string;if(string[0]==="#"){string=string.slice(1);}if(string.length===3){var _string=string,_string2=_slicedToArray(_string,3),r=_string2[0],g=_string2[1],b=_string2[2];string=r+r+g+g+b+b;}}return parseInt(string,16);}function rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+(rgb[2]*255|0);}function mapPremultipliedBlendModes(){var pm=[];var npm=[];for(var i=0;i<32;i++){pm[i]=i;npm[i]=i;}pm[BLEND_MODES.NORMAL_NPM]=BLEND_MODES.NORMAL;pm[BLEND_MODES.ADD_NPM]=BLEND_MODES.ADD;pm[BLEND_MODES.SCREEN_NPM]=BLEND_MODES.SCREEN;npm[BLEND_MODES.NORMAL]=BLEND_MODES.NORMAL_NPM;npm[BLEND_MODES.ADD]=BLEND_MODES.ADD_NPM;npm[BLEND_MODES.SCREEN]=BLEND_MODES.SCREEN_NPM;var array=[];array.push(npm);array.push(pm);return array;}var premultiplyBlendMode=mapPremultipliedBlendModes();function correctBlendMode(blendMode,premultiplied){return premultiplyBlendMode[premultiplied?1:0][blendMode];}function premultiplyRgba(rgb,alpha,out,premultiply){out=out||new Float32Array(4);if(premultiply||premultiply===void 0){out[0]=rgb[0]*alpha;out[1]=rgb[1]*alpha;out[2]=rgb[2]*alpha;}else{out[0]=rgb[0];out[1]=rgb[1];out[2]=rgb[2];}out[3]=alpha;return out;}function premultiplyTint(tint,alpha){if(alpha===1){return(alpha*255<<24)+tint;}if(alpha===0){return 0;}var R=tint>>16&255;var G=tint>>8&255;var B=tint&255;R=R*alpha+0.5|0;G=G*alpha+0.5|0;B=B*alpha+0.5|0;return(alpha*255<<24)+(R<<16)+(G<<8)+B;}function premultiplyTintToRgba(tint,alpha,out,premultiply){out=out||new Float32Array(4);out[0]=(tint>>16&255)/255;out[1]=(tint>>8&255)/255;out[2]=(tint&255)/255;if(premultiply||premultiply===void 0){out[0]*=alpha;out[1]*=alpha;out[2]*=alpha;}out[3]=alpha;return out;}var DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function createIndicesForQuads(size){var outBuffer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var totalIndices=size*6;outBuffer=outBuffer||new Uint16Array(totalIndices);if(outBuffer.length!==totalIndices){throw new Error("Out buffer length is incorrect, got ".concat(outBuffer.length," and expected ").concat(totalIndices));}for(var i=0,j=0;i<totalIndices;i+=6,j+=4){outBuffer[i+0]=j+0;outBuffer[i+1]=j+1;outBuffer[i+2]=j+2;outBuffer[i+3]=j+0;outBuffer[i+4]=j+2;outBuffer[i+5]=j+3;}return outBuffer;}function getBufferType(array){if(array.BYTES_PER_ELEMENT===4){if(array instanceof Float32Array){return"Float32Array";}else if(array instanceof Uint32Array){return"Uint32Array";}return"Int32Array";}else if(array.BYTES_PER_ELEMENT===2){if(array instanceof Uint16Array){return"Uint16Array";}}else if(array.BYTES_PER_ELEMENT===1){if(array instanceof Uint8Array){return"Uint8Array";}}return null;}var map$2={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function interleaveTypedArrays$1(arrays,sizes){var outSize=0;var stride=0;var views={};for(var i=0;i<arrays.length;i++){stride+=sizes[i];outSize+=arrays[i].length;}var buffer=new ArrayBuffer(outSize*4);var out=null;var littleOffset=0;for(var _i=0;_i<arrays.length;_i++){var size=sizes[_i];var array=arrays[_i];var _type2=getBufferType(array);if(!views[_type2]){views[_type2]=new map$2[_type2](buffer);}out=views[_type2];for(var j=0;j<array.length;j++){var indexStart=(j/size|0)*stride+littleOffset;var _index3=j%size;out[indexStart+_index3]=array[j];}littleOffset+=size;}return new Float32Array(buffer);}function nextPow2(v){v+=v===0?1:0;--v;v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return v+1;}function isPow2(v){return!(v&v-1)&&!!v;}function log2(v){var r=(v>65535?1:0)<<4;v>>>=r;var shift=(v>255?1:0)<<3;v>>>=shift;r|=shift;shift=(v>15?1:0)<<2;v>>>=shift;r|=shift;shift=(v>3?1:0)<<1;v>>>=shift;r|=shift;return r|v>>1;}function removeItems(arr,startIdx,removeCount){var length=arr.length;var i;if(startIdx>=length||removeCount===0){return;}removeCount=startIdx+removeCount>length?length-startIdx:removeCount;var len=length-removeCount;for(i=startIdx;i<len;++i){arr[i]=arr[i+removeCount];}arr.length=len;}function sign(n){if(n===0)return 0;return n<0?-1:1;}var nextUid=0;function uid(){return++nextUid;}var _BoundingBox=/*#__PURE__*/function(){function _BoundingBox(left,top,right,bottom){_classCallCheck(this,_BoundingBox);this.left=left;this.top=top;this.right=right;this.bottom=bottom;}return _createClass(_BoundingBox,[{key:"width",get:function get(){return this.right-this.left;}},{key:"height",get:function get(){return this.bottom-this.top;}},{key:"isEmpty",value:function isEmpty(){return this.left===this.right||this.top===this.bottom;}}]);}();var BoundingBox=_BoundingBox;BoundingBox.EMPTY=new _BoundingBox(0,0,0,0);var ProgramCache={};var TextureCache=/* @__PURE__ */Object.create(null);var BaseTextureCache=/* @__PURE__ */Object.create(null);function destroyTextureCache(){var key;for(key in TextureCache){TextureCache[key].destroy();}for(key in BaseTextureCache){BaseTextureCache[key].destroy();}}function clearTextureCache(){var key;for(key in TextureCache){delete TextureCache[key];}for(key in BaseTextureCache){delete BaseTextureCache[key];}}var CanvasRenderTarget=/*#__PURE__*/function(){function CanvasRenderTarget(width,height,resolution){_classCallCheck(this,CanvasRenderTarget);this._canvas=settings.ADAPTER.createCanvas();this._context=this._canvas.getContext("2d");this.resolution=resolution||settings.RESOLUTION;this.resize(width,height);}return _createClass(CanvasRenderTarget,[{key:"clear",value:function clear(){this._checkDestroyed();this._context.setTransform(1,0,0,1,0,0);this._context.clearRect(0,0,this._canvas.width,this._canvas.height);}},{key:"resize",value:function resize(desiredWidth,desiredHeight){this._checkDestroyed();this._canvas.width=Math.round(desiredWidth*this.resolution);this._canvas.height=Math.round(desiredHeight*this.resolution);}},{key:"destroy",value:function destroy(){this._context=null;this._canvas=null;}},{key:"width",get:function get(){this._checkDestroyed();return this._canvas.width;},set:function set(val){this._checkDestroyed();this._canvas.width=Math.round(val);}},{key:"height",get:function get(){this._checkDestroyed();return this._canvas.height;},set:function set(val){this._checkDestroyed();this._canvas.height=Math.round(val);}},{key:"canvas",get:function get(){this._checkDestroyed();return this._canvas;}},{key:"context",get:function get(){this._checkDestroyed();return this._context;}},{key:"_checkDestroyed",value:function _checkDestroyed(){if(this._canvas===null){throw new TypeError("The CanvasRenderTarget has already been destroyed");}}}]);}();function checkRow(data,width,y){for(var x=0,_index4=4*y*width;x<width;++x,_index4+=4){if(data[_index4+3]!==0)return false;}return true;}function checkColumn(data,width,x,top,bottom){var stride=4*width;for(var y=top,_index5=top*stride+4*x;y<=bottom;++y,_index5+=stride){if(data[_index5+3]!==0)return false;}return true;}function getCanvasBoundingBox(canvas){var width=canvas.width,height=canvas.height;var context=canvas.getContext("2d",{willReadFrequently:true});if(context===null){throw new TypeError("Failed to get canvas 2D context");}var imageData=context.getImageData(0,0,width,height);var data=imageData.data;var left=0;var top=0;var right=width-1;var bottom=height-1;while(top<height&&checkRow(data,width,top))++top;if(top===height)return BoundingBox.EMPTY;while(checkRow(data,width,bottom))--bottom;while(checkColumn(data,width,left,top,bottom))++left;while(checkColumn(data,width,right,top,bottom))--right;++right;++bottom;return new BoundingBox(left,top,right,bottom);}function trimCanvas(canvas){var boundingBox=getCanvasBoundingBox(canvas);var width=boundingBox.width,height=boundingBox.height;var data=null;if(!boundingBox.isEmpty()){var _context=canvas.getContext("2d");if(_context===null){throw new TypeError("Failed to get canvas 2D context");}data=_context.getImageData(boundingBox.left,boundingBox.top,width,height);}return{width:width,height:height,data:data};}function decomposeDataUri(dataUri){var dataUriMatch=DATA_URI.exec(dataUri);if(dataUriMatch){return{mediaType:dataUriMatch[1]?dataUriMatch[1].toLowerCase():void 0,subType:dataUriMatch[2]?dataUriMatch[2].toLowerCase():void 0,charset:dataUriMatch[3]?dataUriMatch[3].toLowerCase():void 0,encoding:dataUriMatch[4]?dataUriMatch[4].toLowerCase():void 0,data:dataUriMatch[5]};}return void 0;}var tempAnchor;function determineCrossOrigin(url$1){var loc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:globalThis.location;if(url$1.startsWith("data:")){return"";}loc=loc||globalThis.location;if(!tempAnchor){tempAnchor=document.createElement("a");}tempAnchor.href=url$1;var parsedUrl=url.parse(tempAnchor.href);var samePort=!parsedUrl.port&&loc.port===""||parsedUrl.port===loc.port;if(parsedUrl.hostname!==loc.hostname||!samePort||parsedUrl.protocol!==loc.protocol){return"anonymous";}return"";}function getResolutionOfUrl(url){var _settings$RETINA_PREF;var defaultValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var resolution=(_settings$RETINA_PREF=settings.RETINA_PREFIX)===null||_settings$RETINA_PREF===void 0?void 0:_settings$RETINA_PREF.exec(url);if(resolution){return parseFloat(resolution[1]);}return defaultValue;}var index=/*#__PURE__*/Object.freeze({__proto__:null,BaseTextureCache:BaseTextureCache,BoundingBox:BoundingBox,CanvasRenderTarget:CanvasRenderTarget,DATA_URI:DATA_URI,EventEmitter:EventEmitter,ProgramCache:ProgramCache,TextureCache:TextureCache,clearTextureCache:clearTextureCache,correctBlendMode:correctBlendMode,createIndicesForQuads:createIndicesForQuads,decomposeDataUri:decomposeDataUri,deprecation:deprecation,destroyTextureCache:destroyTextureCache,determineCrossOrigin:determineCrossOrigin,earcut:earcut$1,getBufferType:getBufferType,getCanvasBoundingBox:getCanvasBoundingBox,getResolutionOfUrl:getResolutionOfUrl,hex2rgb:hex2rgb,hex2string:hex2string,interleaveTypedArrays:interleaveTypedArrays$1,isMobile:isMobile,isPow2:isPow2,isWebGLSupported:isWebGLSupported,log2:log2,nextPow2:nextPow2,path:path,premultiplyBlendMode:premultiplyBlendMode,premultiplyRgba:premultiplyRgba,premultiplyTint:premultiplyTint,premultiplyTintToRgba:premultiplyTintToRgba,removeItems:removeItems,rgb2hex:rgb2hex,sayHello:sayHello,sign:sign,skipHello:skipHello,string2hex:string2hex,trimCanvas:trimCanvas,uid:uid,url:url});var ExtensionType=/* @__PURE__ */function(ExtensionType2){ExtensionType2["Renderer"]="renderer";ExtensionType2["Application"]="application";ExtensionType2["RendererSystem"]="renderer-webgl-system";ExtensionType2["RendererPlugin"]="renderer-webgl-plugin";ExtensionType2["CanvasRendererSystem"]="renderer-canvas-system";ExtensionType2["CanvasRendererPlugin"]="renderer-canvas-plugin";ExtensionType2["Asset"]="asset";ExtensionType2["LoadParser"]="load-parser";ExtensionType2["ResolveParser"]="resolve-parser";ExtensionType2["CacheParser"]="cache-parser";ExtensionType2["DetectionParser"]="detection-parser";return ExtensionType2;}(ExtensionType||{});var normalizeExtension=function normalizeExtension(ext){if(typeof ext==="function"||_typeof(ext)==="object"&&ext.extension){if(!ext.extension){throw new Error("Extension class must have an extension object");}var metadata=_typeof(ext.extension)!=="object"?{type:ext.extension}:ext.extension;ext=_objectSpread(_objectSpread({},metadata),{},{ref:ext});}if(_typeof(ext)==="object"){ext=_objectSpread({},ext);}else{throw new Error("Invalid extension type");}if(typeof ext.type==="string"){ext.type=[ext.type];}return ext;};var normalizePriority=function normalizePriority(ext,defaultPriority){var _normalizeExtension$p;return(_normalizeExtension$p=normalizeExtension(ext).priority)!==null&&_normalizeExtension$p!==void 0?_normalizeExtension$p:defaultPriority;};var extensions$1={_addHandlers:{},_removeHandlers:{},_queue:{},remove:function remove(){var _this=this;for(var _len=arguments.length,extensions2=new Array(_len),_key=0;_key<_len;_key++){extensions2[_key]=arguments[_key];}extensions2.map(normalizeExtension).forEach(function(ext){ext.type.forEach(function(type){var _this$_removeHandlers,_this$_removeHandlers2;return(_this$_removeHandlers=(_this$_removeHandlers2=_this._removeHandlers)[type])===null||_this$_removeHandlers===void 0?void 0:_this$_removeHandlers.call(_this$_removeHandlers2,ext);});});return this;},add:function add(){var _this2=this;for(var _len2=arguments.length,extensions2=new Array(_len2),_key2=0;_key2<_len2;_key2++){extensions2[_key2]=arguments[_key2];}extensions2.map(normalizeExtension).forEach(function(ext){ext.type.forEach(function(type){var handlers=_this2._addHandlers;var queue=_this2._queue;if(!handlers[type]){queue[type]=queue[type]||[];queue[type].push(ext);}else{handlers[type](ext);}});});return this;},handle:function handle(type,onAdd,onRemove){var addHandlers=this._addHandlers;var removeHandlers=this._removeHandlers;if(addHandlers[type]||removeHandlers[type]){throw new Error("Extension type ".concat(type," already has a handler"));}addHandlers[type]=onAdd;removeHandlers[type]=onRemove;var queue=this._queue;if(queue[type]){queue[type].forEach(function(ext){return onAdd(ext);});delete queue[type];}return this;},handleByMap:function handleByMap(type,map){return this.handle(type,function(extension){map[extension.name]=extension.ref;},function(extension){delete map[extension.name];});},handleByList:function handleByList(type,list){var defaultPriority=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;return this.handle(type,function(extension){if(list.includes(extension.ref)){return;}list.push(extension.ref);list.sort(function(a,b){return normalizePriority(b,defaultPriority)-normalizePriority(a,defaultPriority);});},function(extension){var index=list.indexOf(extension.ref);if(index!==-1){list.splice(index,1);}});}};var ViewableBuffer=/*#__PURE__*/function(){function ViewableBuffer(sizeOrBuffer){_classCallCheck(this,ViewableBuffer);if(typeof sizeOrBuffer==="number"){this.rawBinaryData=new ArrayBuffer(sizeOrBuffer);}else if(sizeOrBuffer instanceof Uint8Array){this.rawBinaryData=sizeOrBuffer.buffer;}else{this.rawBinaryData=sizeOrBuffer;}this.uint32View=new Uint32Array(this.rawBinaryData);this.float32View=new Float32Array(this.rawBinaryData);}return _createClass(ViewableBuffer,[{key:"int8View",get:function get(){if(!this._int8View){this._int8View=new Int8Array(this.rawBinaryData);}return this._int8View;}},{key:"uint8View",get:function get(){if(!this._uint8View){this._uint8View=new Uint8Array(this.rawBinaryData);}return this._uint8View;}},{key:"int16View",get:function get(){if(!this._int16View){this._int16View=new Int16Array(this.rawBinaryData);}return this._int16View;}},{key:"uint16View",get:function get(){if(!this._uint16View){this._uint16View=new Uint16Array(this.rawBinaryData);}return this._uint16View;}},{key:"int32View",get:function get(){if(!this._int32View){this._int32View=new Int32Array(this.rawBinaryData);}return this._int32View;}},{key:"view",value:function view(type){return this["".concat(type,"View")];}},{key:"destroy",value:function destroy(){this.rawBinaryData=null;this._int8View=null;this._uint8View=null;this._int16View=null;this._uint16View=null;this._int32View=null;this.uint32View=null;this.float32View=null;}}],[{key:"sizeOf",value:function sizeOf(type){switch(type){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error("".concat(type," isn't a valid view type"));}}}]);}();var fragTemplate$1=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function generateIfTestSrc(maxIfs){var src="";for(var i=0;i<maxIfs;++i){if(i>0){src+="\nelse ";}if(i<maxIfs-1){src+="if(test == ".concat(i,".0){}");}}return src;}function checkMaxIfStatementsInShader(maxIfs,gl){if(maxIfs===0){throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");}var shader=gl.createShader(gl.FRAGMENT_SHADER);while(true){var _fragmentSrc=fragTemplate$1.replace(/%forloop%/gi,generateIfTestSrc(maxIfs));gl.shaderSource(shader,_fragmentSrc);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){maxIfs=maxIfs/2|0;}else{break;}}return maxIfs;}var BLEND$1=0;var OFFSET$1=1;var CULLING$1=2;var DEPTH_TEST$1=3;var WINDING$1=4;var DEPTH_MASK$1=5;var State=/*#__PURE__*/function(){function State(){_classCallCheck(this,State);this.data=0;this.blendMode=BLEND_MODES.NORMAL;this.polygonOffset=0;this.blend=true;this.depthMask=true;}return _createClass(State,[{key:"blend",get:function get(){return!!(this.data&1<<BLEND$1);},set:function set(value){if(!!(this.data&1<<BLEND$1)!==value){this.data^=1<<BLEND$1;}}},{key:"offsets",get:function get(){return!!(this.data&1<<OFFSET$1);},set:function set(value){if(!!(this.data&1<<OFFSET$1)!==value){this.data^=1<<OFFSET$1;}}},{key:"culling",get:function get(){return!!(this.data&1<<CULLING$1);},set:function set(value){if(!!(this.data&1<<CULLING$1)!==value){this.data^=1<<CULLING$1;}}},{key:"depthTest",get:function get(){return!!(this.data&1<<DEPTH_TEST$1);},set:function set(value){if(!!(this.data&1<<DEPTH_TEST$1)!==value){this.data^=1<<DEPTH_TEST$1;}}},{key:"depthMask",get:function get(){return!!(this.data&1<<DEPTH_MASK$1);},set:function set(value){if(!!(this.data&1<<DEPTH_MASK$1)!==value){this.data^=1<<DEPTH_MASK$1;}}},{key:"clockwiseFrontFace",get:function get(){return!!(this.data&1<<WINDING$1);},set:function set(value){if(!!(this.data&1<<WINDING$1)!==value){this.data^=1<<WINDING$1;}}},{key:"blendMode",get:function get(){return this._blendMode;},set:function set(value){this.blend=value!==BLEND_MODES.NONE;this._blendMode=value;}},{key:"polygonOffset",get:function get(){return this._polygonOffset;},set:function set(value){this.offsets=!!value;this._polygonOffset=value;}},{key:"toString",value:function toString(){return"[pixijs/core:State blendMode=".concat(this.blendMode," clockwiseFrontFace=").concat(this.clockwiseFrontFace," culling=").concat(this.culling," depthMask=").concat(this.depthMask," polygonOffset=").concat(this.polygonOffset,"]");}}],[{key:"for2d",value:function for2d(){var state=new State();state.depthTest=false;state.blend=true;return state;}}]);}();var INSTALLED=[];function autoDetectResource(source,options){if(!source){return null;}var extension="";if(typeof source==="string"){var result=/\.(\w{3,4})(?:$|\?|#)/i.exec(source);if(result){extension=result[1].toLowerCase();}}for(var i=INSTALLED.length-1;i>=0;--i){var ResourcePlugin=INSTALLED[i];if(ResourcePlugin.test&&ResourcePlugin.test(source,extension)){return new ResourcePlugin(source,options);}}throw new Error("Unrecognized source type to auto-detect Resource");}var Runner=/*#__PURE__*/function(){function Runner(name){_classCallCheck(this,Runner);this.items=[];this._name=name;this._aliasCount=0;}return _createClass(Runner,[{key:"emit",value:function emit(a0,a1,a2,a3,a4,a5,a6,a7){if(arguments.length>8){throw new Error("max arguments reached");}var name=this.name,items=this.items;this._aliasCount++;for(var i=0,len=items.length;i<len;i++){items[i][name](a0,a1,a2,a3,a4,a5,a6,a7);}if(items===this.items){this._aliasCount--;}return this;}},{key:"ensureNonAliasedItems",value:function ensureNonAliasedItems(){if(this._aliasCount>0&&this.items.length>1){this._aliasCount=0;this.items=this.items.slice(0);}}},{key:"add",value:function add(item){if(item[this._name]){this.ensureNonAliasedItems();this.remove(item);this.items.push(item);}return this;}},{key:"remove",value:function remove(item){var index=this.items.indexOf(item);if(index!==-1){this.ensureNonAliasedItems();this.items.splice(index,1);}return this;}},{key:"contains",value:function contains(item){return this.items.includes(item);}},{key:"removeAll",value:function removeAll(){this.ensureNonAliasedItems();this.items.length=0;return this;}},{key:"destroy",value:function destroy(){this.removeAll();this.items=null;this._name=null;}},{key:"empty",get:function get(){return this.items.length===0;}},{key:"name",get:function get(){return this._name;}}]);}();Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}});var Resource=/*#__PURE__*/function(){function Resource(){var width=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var height=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Resource);this._width=width;this._height=height;this.destroyed=false;this.internal=false;this.onResize=new Runner("setRealSize");this.onUpdate=new Runner("update");this.onError=new Runner("onError");}return _createClass(Resource,[{key:"bind",value:function bind(baseTexture){this.onResize.add(baseTexture);this.onUpdate.add(baseTexture);this.onError.add(baseTexture);if(this._width||this._height){this.onResize.emit(this._width,this._height);}}},{key:"unbind",value:function unbind(baseTexture){this.onResize.remove(baseTexture);this.onUpdate.remove(baseTexture);this.onError.remove(baseTexture);}},{key:"resize",value:function resize(width,height){if(width!==this._width||height!==this._height){this._width=width;this._height=height;this.onResize.emit(width,height);}}},{key:"valid",get:function get(){return!!this._width&&!!this._height;}},{key:"update",value:function update(){if(!this.destroyed){this.onUpdate.emit();}}},{key:"load",value:function load(){return Promise.resolve(this);}},{key:"width",get:function get(){return this._width;}},{key:"height",get:function get(){return this._height;}},{key:"style",value:function style(_renderer,_baseTexture,_glTexture){return false;}},{key:"dispose",value:function dispose(){}},{key:"destroy",value:function destroy(){if(!this.destroyed){this.destroyed=true;this.dispose();this.onError.removeAll();this.onError=null;this.onResize.removeAll();this.onResize=null;this.onUpdate.removeAll();this.onUpdate=null;}}}],[{key:"test",value:function test(_source,_extension){return false;}}]);}();var BufferResource=/*#__PURE__*/function(_Resource){function BufferResource(source,options){var _this3;_classCallCheck(this,BufferResource);var _ref2=options||{},width=_ref2.width,height=_ref2.height;if(!width||!height){throw new Error("BufferResource width or height invalid");}_this3=_callSuper(this,BufferResource,[width,height]);_this3.data=source;return _this3;}_inherits(BufferResource,_Resource);return _createClass(BufferResource,[{key:"upload",value:function upload(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES.UNPACK);var width=baseTexture.realWidth;var height=baseTexture.realHeight;if(glTexture.width===width&&glTexture.height===height){gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,glTexture.type,this.data);}else{glTexture.width=width;glTexture.height=height;gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data);}return true;}},{key:"dispose",value:function dispose(){this.data=null;}}],[{key:"test",value:function test(source){return source instanceof Float32Array||source instanceof Uint8Array||source instanceof Uint32Array;}}]);}(Resource);var defaultBufferOptions={scaleMode:SCALE_MODES.NEAREST,format:FORMATS.RGBA,alphaMode:ALPHA_MODES.NPM};var _BaseTexture=/*#__PURE__*/function(_EventEmitter){function _BaseTexture(){var _this4;var resource=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,_BaseTexture);_this4=_callSuper(this,_BaseTexture);options=Object.assign({},_BaseTexture.defaultOptions,options);var _options2=options,alphaMode=_options2.alphaMode,mipmap=_options2.mipmap,anisotropicLevel=_options2.anisotropicLevel,scaleMode=_options2.scaleMode,width=_options2.width,height=_options2.height,wrapMode=_options2.wrapMode,format=_options2.format,type=_options2.type,target=_options2.target,resolution=_options2.resolution,resourceOptions=_options2.resourceOptions;if(resource&&!(resource instanceof Resource)){resource=autoDetectResource(resource,resourceOptions);resource.internal=true;}_this4.resolution=resolution||settings.RESOLUTION;_this4.width=Math.round((width||0)*_this4.resolution)/_this4.resolution;_this4.height=Math.round((height||0)*_this4.resolution)/_this4.resolution;_this4._mipmap=mipmap;_this4.anisotropicLevel=anisotropicLevel;_this4._wrapMode=wrapMode;_this4._scaleMode=scaleMode;_this4.format=format;_this4.type=type;_this4.target=target;_this4.alphaMode=alphaMode;_this4.uid=uid();_this4.touched=0;_this4.isPowerOfTwo=false;_this4._refreshPOT();_this4._glTextures={};_this4.dirtyId=0;_this4.dirtyStyleId=0;_this4.cacheId=null;_this4.valid=width>0&&height>0;_this4.textureCacheIds=[];_this4.destroyed=false;_this4.resource=null;_this4._batchEnabled=0;_this4._batchLocation=0;_this4.parentTextureArray=null;_this4.setResource(resource);return _this4;}_inherits(_BaseTexture,_EventEmitter);return _createClass(_BaseTexture,[{key:"realWidth",get:function get(){return Math.round(this.width*this.resolution);}},{key:"realHeight",get:function get(){return Math.round(this.height*this.resolution);}},{key:"mipmap",get:function get(){return this._mipmap;},set:function set(value){if(this._mipmap!==value){this._mipmap=value;this.dirtyStyleId++;}}},{key:"scaleMode",get:function get(){return this._scaleMode;},set:function set(value){if(this._scaleMode!==value){this._scaleMode=value;this.dirtyStyleId++;}}},{key:"wrapMode",get:function get(){return this._wrapMode;},set:function set(value){if(this._wrapMode!==value){this._wrapMode=value;this.dirtyStyleId++;}}},{key:"setStyle",value:function setStyle(scaleMode,mipmap){var dirty;if(scaleMode!==void 0&&scaleMode!==this.scaleMode){this.scaleMode=scaleMode;dirty=true;}if(mipmap!==void 0&&mipmap!==this.mipmap){this.mipmap=mipmap;dirty=true;}if(dirty){this.dirtyStyleId++;}return this;}},{key:"setSize",value:function setSize(desiredWidth,desiredHeight,resolution){resolution=resolution||this.resolution;return this.setRealSize(desiredWidth*resolution,desiredHeight*resolution,resolution);}},{key:"setRealSize",value:function setRealSize(realWidth,realHeight,resolution){this.resolution=resolution||this.resolution;this.width=Math.round(realWidth)/this.resolution;this.height=Math.round(realHeight)/this.resolution;this._refreshPOT();this.update();return this;}},{key:"_refreshPOT",value:function _refreshPOT(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight);}},{key:"setResolution",value:function setResolution(resolution){var oldResolution=this.resolution;if(oldResolution===resolution){return this;}this.resolution=resolution;if(this.valid){this.width=Math.round(this.width*oldResolution)/resolution;this.height=Math.round(this.height*oldResolution)/resolution;this.emit("update",this);}this._refreshPOT();return this;}},{key:"setResource",value:function setResource(resource){if(this.resource===resource){return this;}if(this.resource){throw new Error("Resource can be set only once");}resource.bind(this);this.resource=resource;return this;}},{key:"update",value:function update(){if(!this.valid){if(this.width>0&&this.height>0){this.valid=true;this.emit("loaded",this);this.emit("update",this);}}else{this.dirtyId++;this.dirtyStyleId++;this.emit("update",this);}}},{key:"onError",value:function onError(event){this.emit("error",this,event);}},{key:"destroy",value:function destroy(){if(this.resource){this.resource.unbind(this);if(this.resource.internal){this.resource.destroy();}this.resource=null;}if(this.cacheId){delete BaseTextureCache[this.cacheId];delete TextureCache[this.cacheId];this.cacheId=null;}this.dispose();_BaseTexture.removeFromCache(this);this.textureCacheIds=null;this.destroyed=true;}},{key:"dispose",value:function dispose(){this.emit("dispose",this);}},{key:"castToBaseTexture",value:function castToBaseTexture(){return this;}}],[{key:"from",value:function from(source,options){var strict=arguments.length>2&&arguments[2]!==undefined?arguments[2]:settings.STRICT_TEXTURE_CACHE;var isFrame=typeof source==="string";var cacheId=null;if(isFrame){cacheId=source;}else{if(!source._pixiId){var prefix=(options===null||options===void 0?void 0:options.pixiIdPrefix)||"pixiid";source._pixiId="".concat(prefix,"_").concat(uid());}cacheId=source._pixiId;}var baseTexture=BaseTextureCache[cacheId];if(isFrame&&strict&&!baseTexture){throw new Error("The cacheId \"".concat(cacheId,"\" does not exist in BaseTextureCache."));}if(!baseTexture){baseTexture=new _BaseTexture(source,options);baseTexture.cacheId=cacheId;_BaseTexture.addToCache(baseTexture,cacheId);}return baseTexture;}},{key:"fromBuffer",value:function fromBuffer(buffer,width,height,options){buffer=buffer||new Float32Array(width*height*4);var resource=new BufferResource(buffer,{width:width,height:height});var type=buffer instanceof Float32Array?TYPES.FLOAT:TYPES.UNSIGNED_BYTE;return new _BaseTexture(resource,Object.assign({},defaultBufferOptions,options||{width:width,height:height,type:type}));}},{key:"addToCache",value:function addToCache(baseTexture,id){if(id){if(!baseTexture.textureCacheIds.includes(id)){baseTexture.textureCacheIds.push(id);}if(BaseTextureCache[id]&&BaseTextureCache[id]!==baseTexture){console.warn("BaseTexture added to the cache with an id [".concat(id,"] that already had an entry"));}BaseTextureCache[id]=baseTexture;}}},{key:"removeFromCache",value:function removeFromCache(baseTexture){if(typeof baseTexture==="string"){var baseTextureFromCache=BaseTextureCache[baseTexture];if(baseTextureFromCache){var _index6=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);if(_index6>-1){baseTextureFromCache.textureCacheIds.splice(_index6,1);}delete BaseTextureCache[baseTexture];return baseTextureFromCache;}}else if(baseTexture!==null&&baseTexture!==void 0&&baseTexture.textureCacheIds){for(var i=0;i<baseTexture.textureCacheIds.length;++i){delete BaseTextureCache[baseTexture.textureCacheIds[i]];}baseTexture.textureCacheIds.length=0;return baseTexture;}return null;}}]);}(EventEmitter);var BaseTexture=_BaseTexture;BaseTexture.defaultOptions={mipmap:MIPMAP_MODES.POW2,anisotropicLevel:0,scaleMode:SCALE_MODES.LINEAR,wrapMode:WRAP_MODES.CLAMP,alphaMode:ALPHA_MODES.UNPACK,target:TARGETS.TEXTURE_2D,format:FORMATS.RGBA,type:TYPES.UNSIGNED_BYTE};BaseTexture._globalBatch=0;var BatchDrawCall=/*#__PURE__*/_createClass(function BatchDrawCall(){_classCallCheck(this,BatchDrawCall);this.texArray=null;this.blend=0;this.type=DRAW_MODES.TRIANGLES;this.start=0;this.size=0;this.data=null;});var UID$4=0;var Buffer=/*#__PURE__*/function(){function Buffer(data){var _static=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var index=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;_classCallCheck(this,Buffer);this.data=data||new Float32Array(1);this._glBuffers={};this._updateID=0;this.index=index;this.static=_static;this.id=UID$4++;this.disposeRunner=new Runner("disposeBuffer");}return _createClass(Buffer,[{key:"update",value:function update(data){if(data instanceof Array){data=new Float32Array(data);}this.data=data||this.data;this._updateID++;}},{key:"dispose",value:function dispose(){this.disposeRunner.emit(this,false);}},{key:"destroy",value:function destroy(){this.dispose();this.data=null;}},{key:"index",get:function get(){return this.type===BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;},set:function set(value){this.type=value?BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:BUFFER_TYPE.ARRAY_BUFFER;}}],[{key:"from",value:function from(data){if(data instanceof Array){data=new Float32Array(data);}return new Buffer(data);}}]);}();var Attribute=/*#__PURE__*/function(){function Attribute(buffer){var size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var normalized=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var type=arguments.length>3&&arguments[3]!==undefined?arguments[3]:TYPES.FLOAT;var stride=arguments.length>4?arguments[4]:undefined;var start=arguments.length>5?arguments[5]:undefined;var instance=arguments.length>6?arguments[6]:undefined;var divisor=arguments.length>7&&arguments[7]!==undefined?arguments[7]:1;_classCallCheck(this,Attribute);this.buffer=buffer;this.size=size;this.normalized=normalized;this.type=type;this.stride=stride;this.start=start;this.instance=instance;this.divisor=divisor;}return _createClass(Attribute,[{key:"destroy",value:function destroy(){this.buffer=null;}}],[{key:"from",value:function from(buffer,size,normalized,type,stride){return new Attribute(buffer,size,normalized,type,stride);}}]);}();var map$1={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function interleaveTypedArrays(arrays,sizes){var outSize=0;var stride=0;var views={};for(var i=0;i<arrays.length;i++){stride+=sizes[i];outSize+=arrays[i].length;}var buffer=new ArrayBuffer(outSize*4);var out=null;var littleOffset=0;for(var _i2=0;_i2<arrays.length;_i2++){var size=sizes[_i2];var array=arrays[_i2];var _type3=getBufferType(array);if(!views[_type3]){views[_type3]=new map$1[_type3](buffer);}out=views[_type3];for(var j=0;j<array.length;j++){var indexStart=(j/size|0)*stride+littleOffset;var _index7=j%size;out[indexStart+_index7]=array[j];}littleOffset+=size;}return new Float32Array(buffer);}var byteSizeMap$1={5126:4,5123:2,5121:1};var UID$3=0;var map={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};var Geometry=/*#__PURE__*/function(){function Geometry(){var buffers=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var attributes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Geometry);this.buffers=buffers;this.indexBuffer=null;this.attributes=attributes;this.glVertexArrayObjects={};this.id=UID$3++;this.instanced=false;this.instanceCount=1;this.disposeRunner=new Runner("disposeGeometry");this.refCount=0;}return _createClass(Geometry,[{key:"addAttribute",value:function addAttribute(id,buffer){var size=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var normalized=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var type=arguments.length>4?arguments[4]:undefined;var stride=arguments.length>5?arguments[5]:undefined;var start=arguments.length>6?arguments[6]:undefined;var instance=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;if(!buffer){throw new Error("You must pass a buffer when creating an attribute");}if(!(buffer instanceof Buffer)){if(buffer instanceof Array){buffer=new Float32Array(buffer);}buffer=new Buffer(buffer);}var ids=id.split("|");if(ids.length>1){for(var i=0;i<ids.length;i++){this.addAttribute(ids[i],buffer,size,normalized,type);}return this;}var bufferIndex=this.buffers.indexOf(buffer);if(bufferIndex===-1){this.buffers.push(buffer);bufferIndex=this.buffers.length-1;}this.attributes[id]=new Attribute(bufferIndex,size,normalized,type,stride,start,instance);this.instanced=this.instanced||instance;return this;}},{key:"getAttribute",value:function getAttribute(id){return this.attributes[id];}},{key:"getBuffer",value:function getBuffer(id){return this.buffers[this.getAttribute(id).buffer];}},{key:"addIndex",value:function addIndex(buffer){if(!(buffer instanceof Buffer)){if(buffer instanceof Array){buffer=new Uint16Array(buffer);}buffer=new Buffer(buffer);}buffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;this.indexBuffer=buffer;if(!this.buffers.includes(buffer)){this.buffers.push(buffer);}return this;}},{key:"getIndex",value:function getIndex(){return this.indexBuffer;}},{key:"interleave",value:function interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var arrays=[];var sizes=[];var interleavedBuffer=new Buffer();var i;for(i in this.attributes){var attribute=this.attributes[i];var buffer=this.buffers[attribute.buffer];arrays.push(buffer.data);sizes.push(attribute.size*byteSizeMap$1[attribute.type]/4);attribute.buffer=0;}interleavedBuffer.data=interleaveTypedArrays(arrays,sizes);for(i=0;i<this.buffers.length;i++){if(this.buffers[i]!==this.indexBuffer){this.buffers[i].destroy();}}this.buffers=[interleavedBuffer];if(this.indexBuffer){this.buffers.push(this.indexBuffer);}return this;}},{key:"getSize",value:function getSize(){for(var i in this.attributes){var attribute=this.attributes[i];var buffer=this.buffers[attribute.buffer];return buffer.data.length/(attribute.stride/4||attribute.size);}return 0;}},{key:"dispose",value:function dispose(){this.disposeRunner.emit(this,false);}},{key:"destroy",value:function destroy(){this.dispose();this.buffers=null;this.indexBuffer=null;this.attributes=null;}},{key:"clone",value:function clone(){var geometry=new Geometry();for(var i=0;i<this.buffers.length;i++){geometry.buffers[i]=new Buffer(this.buffers[i].data.slice(0));}for(var _i3 in this.attributes){var attrib=this.attributes[_i3];geometry.attributes[_i3]=new Attribute(attrib.buffer,attrib.size,attrib.normalized,attrib.type,attrib.stride,attrib.start,attrib.instance);}if(this.indexBuffer){geometry.indexBuffer=geometry.buffers[this.buffers.indexOf(this.indexBuffer)];geometry.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;}return geometry;}}],[{key:"merge",value:function merge(geometries){var geometryOut=new Geometry();var arrays=[];var sizes=[];var offsets=[];var geometry;for(var i=0;i<geometries.length;i++){geometry=geometries[i];for(var j=0;j<geometry.buffers.length;j++){sizes[j]=sizes[j]||0;sizes[j]+=geometry.buffers[j].data.length;offsets[j]=0;}}for(var _i4=0;_i4<geometry.buffers.length;_i4++){arrays[_i4]=new map[getBufferType(geometry.buffers[_i4].data)](sizes[_i4]);geometryOut.buffers[_i4]=new Buffer(arrays[_i4]);}for(var _i5=0;_i5<geometries.length;_i5++){geometry=geometries[_i5];for(var _j=0;_j<geometry.buffers.length;_j++){arrays[_j].set(geometry.buffers[_j].data,offsets[_j]);offsets[_j]+=geometry.buffers[_j].data.length;}}geometryOut.attributes=geometry.attributes;if(geometry.indexBuffer){geometryOut.indexBuffer=geometryOut.buffers[geometry.buffers.indexOf(geometry.indexBuffer)];geometryOut.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;var offset=0;var stride=0;var offset2=0;var bufferIndexToCount=0;for(var _i6=0;_i6<geometry.buffers.length;_i6++){if(geometry.buffers[_i6]!==geometry.indexBuffer){bufferIndexToCount=_i6;break;}}for(var _i7 in geometry.attributes){var attribute=geometry.attributes[_i7];if((attribute.buffer|0)===bufferIndexToCount){stride+=attribute.size*byteSizeMap$1[attribute.type]/4;}}for(var _i8=0;_i8<geometries.length;_i8++){var indexBufferData=geometries[_i8].indexBuffer.data;for(var _j2=0;_j2<indexBufferData.length;_j2++){geometryOut.indexBuffer.data[_j2+offset2]+=offset;}offset+=geometries[_i8].buffers[bufferIndexToCount].data.length/stride;offset2+=indexBufferData.length;}}return geometryOut;}}]);}();var BatchGeometry=/*#__PURE__*/function(_Geometry){function BatchGeometry(){var _this5;var _static=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classCallCheck(this,BatchGeometry);_this5=_callSuper(this,BatchGeometry);_this5._buffer=new Buffer(null,_static,false);_this5._indexBuffer=new Buffer(null,_static,true);_this5.addAttribute("aVertexPosition",_this5._buffer,2,false,TYPES.FLOAT).addAttribute("aTextureCoord",_this5._buffer,2,false,TYPES.FLOAT).addAttribute("aColor",_this5._buffer,4,true,TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",_this5._buffer,1,true,TYPES.FLOAT).addIndex(_this5._indexBuffer);return _this5;}_inherits(BatchGeometry,_Geometry);return _createClass(BatchGeometry);}(Geometry);var PI_2=Math.PI*2;var RAD_TO_DEG=180/Math.PI;var DEG_TO_RAD=Math.PI/180;var SHAPES=/* @__PURE__ */function(SHAPES2){SHAPES2[SHAPES2["POLY"]=0]="POLY";SHAPES2[SHAPES2["RECT"]=1]="RECT";SHAPES2[SHAPES2["CIRC"]=2]="CIRC";SHAPES2[SHAPES2["ELIP"]=3]="ELIP";SHAPES2[SHAPES2["RREC"]=4]="RREC";return SHAPES2;}(SHAPES||{});var Point=/*#__PURE__*/function(){function Point(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Point);this.x=0;this.y=0;this.x=x;this.y=y;}return _createClass(Point,[{key:"clone",value:function clone(){return new Point(this.x,this.y);}},{key:"copyFrom",value:function copyFrom(p){this.set(p.x,p.y);return this;}},{key:"copyTo",value:function copyTo(p){p.set(this.x,this.y);return p;}},{key:"equals",value:function equals(p){return p.x===this.x&&p.y===this.y;}},{key:"set",value:function set(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:x;this.x=x;this.y=y;return this;}},{key:"toString",value:function toString(){return"[pixijs/math:Point x=".concat(this.x," y=").concat(this.y,"]");}}]);}();var tempPoints$1=[new Point(),new Point(),new Point(),new Point()];var Rectangle=/*#__PURE__*/function(){function Rectangle(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var width=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var height=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Rectangle);this.x=Number(x);this.y=Number(y);this.width=Number(width);this.height=Number(height);this.type=SHAPES.RECT;}return _createClass(Rectangle,[{key:"left",get:function get(){return this.x;}},{key:"right",get:function get(){return this.x+this.width;}},{key:"top",get:function get(){return this.y;}},{key:"bottom",get:function get(){return this.y+this.height;}},{key:"clone",value:function clone(){return new Rectangle(this.x,this.y,this.width,this.height);}},{key:"copyFrom",value:function copyFrom(rectangle){this.x=rectangle.x;this.y=rectangle.y;this.width=rectangle.width;this.height=rectangle.height;return this;}},{key:"copyTo",value:function copyTo(rectangle){rectangle.x=this.x;rectangle.y=this.y;rectangle.width=this.width;rectangle.height=this.height;return rectangle;}},{key:"contains",value:function contains(x,y){if(this.width<=0||this.height<=0){return false;}if(x>=this.x&&x<this.x+this.width){if(y>=this.y&&y<this.y+this.height){return true;}}return false;}},{key:"intersects",value:function intersects(other,transform){if(!transform){var x02=this.x<other.x?other.x:this.x;var x12=this.right>other.right?other.right:this.right;if(x12<=x02){return false;}var y02=this.y<other.y?other.y:this.y;var y12=this.bottom>other.bottom?other.bottom:this.bottom;return y12>y02;}var x0=this.left;var x1=this.right;var y0=this.top;var y1=this.bottom;if(x1<=x0||y1<=y0){return false;}var lt=tempPoints$1[0].set(other.left,other.top);var lb=tempPoints$1[1].set(other.left,other.bottom);var rt=tempPoints$1[2].set(other.right,other.top);var rb=tempPoints$1[3].set(other.right,other.bottom);if(rt.x<=lt.x||lb.y<=lt.y){return false;}var s=Math.sign(transform.a*transform.d-transform.b*transform.c);if(s===0){return false;}transform.apply(lt,lt);transform.apply(lb,lb);transform.apply(rt,rt);transform.apply(rb,rb);if(Math.max(lt.x,lb.x,rt.x,rb.x)<=x0||Math.min(lt.x,lb.x,rt.x,rb.x)>=x1||Math.max(lt.y,lb.y,rt.y,rb.y)<=y0||Math.min(lt.y,lb.y,rt.y,rb.y)>=y1){return false;}var nx=s*(lb.y-lt.y);var ny=s*(lt.x-lb.x);var n00=nx*x0+ny*y0;var n10=nx*x1+ny*y0;var n01=nx*x0+ny*y1;var n11=nx*x1+ny*y1;if(Math.max(n00,n10,n01,n11)<=nx*lt.x+ny*lt.y||Math.min(n00,n10,n01,n11)>=nx*rb.x+ny*rb.y){return false;}var mx=s*(lt.y-rt.y);var my=s*(rt.x-lt.x);var m00=mx*x0+my*y0;var m10=mx*x1+my*y0;var m01=mx*x0+my*y1;var m11=mx*x1+my*y1;if(Math.max(m00,m10,m01,m11)<=mx*lt.x+my*lt.y||Math.min(m00,m10,m01,m11)>=mx*rb.x+my*rb.y){return false;}return true;}},{key:"pad",value:function pad(){var paddingX=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var paddingY=arguments.length>1&&arguments[1]!==undefined?arguments[1]:paddingX;this.x-=paddingX;this.y-=paddingY;this.width+=paddingX*2;this.height+=paddingY*2;return this;}},{key:"fit",value:function fit(rectangle){var x1=Math.max(this.x,rectangle.x);var x2=Math.min(this.x+this.width,rectangle.x+rectangle.width);var y1=Math.max(this.y,rectangle.y);var y2=Math.min(this.y+this.height,rectangle.y+rectangle.height);this.x=x1;this.width=Math.max(x2-x1,0);this.y=y1;this.height=Math.max(y2-y1,0);return this;}},{key:"ceil",value:function ceil(){var resolution=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var eps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1e-3;var x2=Math.ceil((this.x+this.width-eps)*resolution)/resolution;var y2=Math.ceil((this.y+this.height-eps)*resolution)/resolution;this.x=Math.floor((this.x+eps)*resolution)/resolution;this.y=Math.floor((this.y+eps)*resolution)/resolution;this.width=x2-this.x;this.height=y2-this.y;return this;}},{key:"enlarge",value:function enlarge(rectangle){var x1=Math.min(this.x,rectangle.x);var x2=Math.max(this.x+this.width,rectangle.x+rectangle.width);var y1=Math.min(this.y,rectangle.y);var y2=Math.max(this.y+this.height,rectangle.y+rectangle.height);this.x=x1;this.width=x2-x1;this.y=y1;this.height=y2-y1;return this;}},{key:"toString",value:function toString(){return"[pixijs/math:Rectangle x=".concat(this.x," y=").concat(this.y," width=").concat(this.width," height=").concat(this.height,"]");}}],[{key:"EMPTY",get:function get(){return new Rectangle(0,0,0,0);}}]);}();var Circle=/*#__PURE__*/function(){function Circle(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var radius=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Circle);this.x=x;this.y=y;this.radius=radius;this.type=SHAPES.CIRC;}return _createClass(Circle,[{key:"clone",value:function clone(){return new Circle(this.x,this.y,this.radius);}},{key:"contains",value:function contains(x,y){if(this.radius<=0){return false;}var r2=this.radius*this.radius;var dx=this.x-x;var dy=this.y-y;dx*=dx;dy*=dy;return dx+dy<=r2;}},{key:"getBounds",value:function getBounds(){return new Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2);}},{key:"toString",value:function toString(){return"[pixijs/math:Circle x=".concat(this.x," y=").concat(this.y," radius=").concat(this.radius,"]");}}]);}();var Ellipse=/*#__PURE__*/function(){function Ellipse(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var halfWidth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var halfHeight=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Ellipse);this.x=x;this.y=y;this.width=halfWidth;this.height=halfHeight;this.type=SHAPES.ELIP;}return _createClass(Ellipse,[{key:"clone",value:function clone(){return new Ellipse(this.x,this.y,this.width,this.height);}},{key:"contains",value:function contains(x,y){if(this.width<=0||this.height<=0){return false;}var normx=(x-this.x)/this.width;var normy=(y-this.y)/this.height;normx*=normx;normy*=normy;return normx+normy<=1;}},{key:"getBounds",value:function getBounds(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height);}},{key:"toString",value:function toString(){return"[pixijs/math:Ellipse x=".concat(this.x," y=").concat(this.y," width=").concat(this.width," height=").concat(this.height,"]");}}]);}();var Polygon=/*#__PURE__*/function(){function Polygon(){_classCallCheck(this,Polygon);for(var _len3=arguments.length,points=new Array(_len3),_key3=0;_key3<_len3;_key3++){points[_key3]=arguments[_key3];}var flat=Array.isArray(points[0])?points[0]:points;if(typeof flat[0]!=="number"){var p=[];for(var i=0,il=flat.length;i<il;i++){p.push(flat[i].x,flat[i].y);}flat=p;}this.points=flat;this.type=SHAPES.POLY;this.closeStroke=true;}return _createClass(Polygon,[{key:"clone",value:function clone(){var points=this.points.slice();var polygon=new Polygon(points);polygon.closeStroke=this.closeStroke;return polygon;}},{key:"contains",value:function contains(x,y){var inside=false;var length=this.points.length/2;for(var i=0,j=length-1;i<length;j=i++){var xi=this.points[i*2];var yi=this.points[i*2+1];var xj=this.points[j*2];var yj=this.points[j*2+1];var intersect=yi>y!==yj>y&&x<(xj-xi)*((y-yi)/(yj-yi))+xi;if(intersect){inside=!inside;}}return inside;}},{key:"toString",value:function toString(){return"[pixijs/math:PolygoncloseStroke=".concat(this.closeStroke,"points=").concat(this.points.reduce(function(pointsDesc,currentPoint){return"".concat(pointsDesc,", ").concat(currentPoint);},""),"]");}}]);}();var RoundedRectangle=/*#__PURE__*/function(){function RoundedRectangle(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var width=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var height=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var radius=arguments.length>4&&arguments[4]!==undefined?arguments[4]:20;_classCallCheck(this,RoundedRectangle);this.x=x;this.y=y;this.width=width;this.height=height;this.radius=radius;this.type=SHAPES.RREC;}return _createClass(RoundedRectangle,[{key:"clone",value:function clone(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius);}},{key:"contains",value:function contains(x,y){if(this.width<=0||this.height<=0){return false;}if(x>=this.x&&x<=this.x+this.width){if(y>=this.y&&y<=this.y+this.height){var radius=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(y>=this.y+radius&&y<=this.y+this.height-radius||x>=this.x+radius&&x<=this.x+this.width-radius){return true;}var dx=x-(this.x+radius);var dy=y-(this.y+radius);var radius2=radius*radius;if(dx*dx+dy*dy<=radius2){return true;}dx=x-(this.x+this.width-radius);if(dx*dx+dy*dy<=radius2){return true;}dy=y-(this.y+this.height-radius);if(dx*dx+dy*dy<=radius2){return true;}dx=x-(this.x+radius);if(dx*dx+dy*dy<=radius2){return true;}}}return false;}},{key:"toString",value:function toString(){return"[pixijs/math:RoundedRectangle x=".concat(this.x," y=").concat(this.y,"width=").concat(this.width," height=").concat(this.height," radius=").concat(this.radius,"]");}}]);}();var Matrix=/*#__PURE__*/function(){function Matrix(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var tx=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var ty=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;_classCallCheck(this,Matrix);this.array=null;this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;}return _createClass(Matrix,[{key:"fromArray",value:function fromArray(array){this.a=array[0];this.b=array[1];this.c=array[3];this.d=array[4];this.tx=array[2];this.ty=array[5];}},{key:"set",value:function set(a,b,c,d,tx,ty){this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;return this;}},{key:"toArray",value:function toArray(transpose,out){if(!this.array){this.array=new Float32Array(9);}var array=out||this.array;if(transpose){array[0]=this.a;array[1]=this.b;array[2]=0;array[3]=this.c;array[4]=this.d;array[5]=0;array[6]=this.tx;array[7]=this.ty;array[8]=1;}else{array[0]=this.a;array[1]=this.c;array[2]=this.tx;array[3]=this.b;array[4]=this.d;array[5]=this.ty;array[6]=0;array[7]=0;array[8]=1;}return array;}},{key:"apply",value:function apply(pos,newPos){newPos=newPos||new Point();var x=pos.x;var y=pos.y;newPos.x=this.a*x+this.c*y+this.tx;newPos.y=this.b*x+this.d*y+this.ty;return newPos;}},{key:"applyInverse",value:function applyInverse(pos,newPos){newPos=newPos||new Point();var id=1/(this.a*this.d+this.c*-this.b);var x=pos.x;var y=pos.y;newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id;newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id;return newPos;}},{key:"translate",value:function translate(x,y){this.tx+=x;this.ty+=y;return this;}},{key:"scale",value:function scale(x,y){this.a*=x;this.d*=y;this.c*=x;this.b*=y;this.tx*=x;this.ty*=y;return this;}},{key:"rotate",value:function rotate(angle){var cos=Math.cos(angle);var sin=Math.sin(angle);var a1=this.a;var c1=this.c;var tx1=this.tx;this.a=a1*cos-this.b*sin;this.b=a1*sin+this.b*cos;this.c=c1*cos-this.d*sin;this.d=c1*sin+this.d*cos;this.tx=tx1*cos-this.ty*sin;this.ty=tx1*sin+this.ty*cos;return this;}},{key:"append",value:function append(matrix){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;this.a=matrix.a*a1+matrix.b*c1;this.b=matrix.a*b1+matrix.b*d1;this.c=matrix.c*a1+matrix.d*c1;this.d=matrix.c*b1+matrix.d*d1;this.tx=matrix.tx*a1+matrix.ty*c1+this.tx;this.ty=matrix.tx*b1+matrix.ty*d1+this.ty;return this;}},{key:"setTransform",value:function setTransform(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){this.a=Math.cos(rotation+skewY)*scaleX;this.b=Math.sin(rotation+skewY)*scaleX;this.c=-Math.sin(rotation-skewX)*scaleY;this.d=Math.cos(rotation-skewX)*scaleY;this.tx=x-(pivotX*this.a+pivotY*this.c);this.ty=y-(pivotX*this.b+pivotY*this.d);return this;}},{key:"prepend",value:function prepend(matrix){var tx1=this.tx;if(matrix.a!==1||matrix.b!==0||matrix.c!==0||matrix.d!==1){var a1=this.a;var c1=this.c;this.a=a1*matrix.a+this.b*matrix.c;this.b=a1*matrix.b+this.b*matrix.d;this.c=c1*matrix.a+this.d*matrix.c;this.d=c1*matrix.b+this.d*matrix.d;}this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx;this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty;return this;}},{key:"decompose",value:function decompose(transform){var a=this.a;var b=this.b;var c=this.c;var d=this.d;var pivot=transform.pivot;var skewX=-Math.atan2(-c,d);var skewY=Math.atan2(b,a);var delta=Math.abs(skewX+skewY);if(delta<1e-5||Math.abs(PI_2-delta)<1e-5){transform.rotation=skewY;transform.skew.x=transform.skew.y=0;}else{transform.rotation=0;transform.skew.x=skewX;transform.skew.y=skewY;}transform.scale.x=Math.sqrt(a*a+b*b);transform.scale.y=Math.sqrt(c*c+d*d);transform.position.x=this.tx+(pivot.x*a+pivot.y*c);transform.position.y=this.ty+(pivot.x*b+pivot.y*d);return transform;}},{key:"invert",value:function invert(){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;var tx1=this.tx;var n=a1*d1-b1*c1;this.a=d1/n;this.b=-b1/n;this.c=-c1/n;this.d=a1/n;this.tx=(c1*this.ty-d1*tx1)/n;this.ty=-(a1*this.ty-b1*tx1)/n;return this;}},{key:"identity",value:function identity(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this;}},{key:"clone",value:function clone(){var matrix=new Matrix();matrix.a=this.a;matrix.b=this.b;matrix.c=this.c;matrix.d=this.d;matrix.tx=this.tx;matrix.ty=this.ty;return matrix;}},{key:"copyTo",value:function copyTo(matrix){matrix.a=this.a;matrix.b=this.b;matrix.c=this.c;matrix.d=this.d;matrix.tx=this.tx;matrix.ty=this.ty;return matrix;}},{key:"copyFrom",value:function copyFrom(matrix){this.a=matrix.a;this.b=matrix.b;this.c=matrix.c;this.d=matrix.d;this.tx=matrix.tx;this.ty=matrix.ty;return this;}},{key:"toString",value:function toString(){return"[pixijs/math:Matrix a=".concat(this.a," b=").concat(this.b," c=").concat(this.c," d=").concat(this.d," tx=").concat(this.tx," ty=").concat(this.ty,"]");}}],[{key:"IDENTITY",get:function get(){return new Matrix();}},{key:"TEMP_MATRIX",get:function get(){return new Matrix();}}]);}();var ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1];var uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1];var vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1];var vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1];var rotationCayley=[];var rotationMatrices=[];var signum=Math.sign;function init(){for(var i=0;i<16;i++){var row=[];rotationCayley.push(row);for(var j=0;j<16;j++){var _ux=signum(ux[i]*ux[j]+vx[i]*uy[j]);var _uy=signum(uy[i]*ux[j]+vy[i]*uy[j]);var _vx=signum(ux[i]*vx[j]+vx[i]*vy[j]);var _vy=signum(uy[i]*vx[j]+vy[i]*vy[j]);for(var k=0;k<16;k++){if(ux[k]===_ux&&uy[k]===_uy&&vx[k]===_vx&&vy[k]===_vy){row.push(k);break;}}}}for(var _i9=0;_i9<16;_i9++){var mat=new Matrix();mat.set(ux[_i9],uy[_i9],vx[_i9],vy[_i9],0,0);rotationMatrices.push(mat);}}init();var groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function uX(ind){return ux[ind];},uY:function uY(ind){return uy[ind];},vX:function vX(ind){return vx[ind];},vY:function vY(ind){return vy[ind];},inv:function inv(rotation){if(rotation&8){return rotation&15;}return-rotation&7;},add:function add(rotationSecond,rotationFirst){return rotationCayley[rotationSecond][rotationFirst];},sub:function sub(rotationSecond,rotationFirst){return rotationCayley[rotationSecond][groupD8.inv(rotationFirst)];},rotate180:function rotate180(rotation){return rotation^4;},isVertical:function isVertical(rotation){return(rotation&3)===2;},byDirection:function byDirection(dx,dy){if(Math.abs(dx)*2<=Math.abs(dy)){if(dy>=0){return groupD8.S;}return groupD8.N;}else if(Math.abs(dy)*2<=Math.abs(dx)){if(dx>0){return groupD8.E;}return groupD8.W;}else if(dy>0){if(dx>0){return groupD8.SE;}return groupD8.SW;}else if(dx>0){return groupD8.NE;}return groupD8.NW;},matrixAppendRotationInv:function matrixAppendRotationInv(matrix,rotation){var tx=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var ty=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var mat=rotationMatrices[groupD8.inv(rotation)];mat.tx=tx;mat.ty=ty;matrix.append(mat);}};var ObservablePoint=/*#__PURE__*/function(){function ObservablePoint(cb,scope){var x=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var y=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,ObservablePoint);this._x=x;this._y=y;this.cb=cb;this.scope=scope;}return _createClass(ObservablePoint,[{key:"clone",value:function clone(){var cb=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cb;var scope=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scope;return new ObservablePoint(cb,scope,this._x,this._y);}},{key:"set",value:function set(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:x;if(this._x!==x||this._y!==y){this._x=x;this._y=y;this.cb.call(this.scope);}return this;}},{key:"copyFrom",value:function copyFrom(p){if(this._x!==p.x||this._y!==p.y){this._x=p.x;this._y=p.y;this.cb.call(this.scope);}return this;}},{key:"copyTo",value:function copyTo(p){p.set(this._x,this._y);return p;}},{key:"equals",value:function equals(p){return p.x===this._x&&p.y===this._y;}},{key:"toString",value:function toString(){return"[pixijs/math:ObservablePoint x=".concat(0," y=",0," scope=",this.scope,"]");}},{key:"x",get:function get(){return this._x;},set:function set(value){if(this._x!==value){this._x=value;this.cb.call(this.scope);}}},{key:"y",get:function get(){return this._y;},set:function set(value){if(this._y!==value){this._y=value;this.cb.call(this.scope);}}}]);}();var _Transform=/*#__PURE__*/function(){function _Transform(){_classCallCheck(this,_Transform);this.worldTransform=new Matrix();this.localTransform=new Matrix();this.position=new ObservablePoint(this.onChange,this,0,0);this.scale=new ObservablePoint(this.onChange,this,1,1);this.pivot=new ObservablePoint(this.onChange,this,0,0);this.skew=new ObservablePoint(this.updateSkew,this,0,0);this._rotation=0;this._cx=1;this._sx=0;this._cy=0;this._sy=1;this._localID=0;this._currentLocalID=0;this._worldID=0;this._parentID=0;}return _createClass(_Transform,[{key:"onChange",value:function onChange(){this._localID++;}},{key:"updateSkew",value:function updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y);this._sx=Math.sin(this._rotation+this.skew.y);this._cy=-Math.sin(this._rotation-this.skew.x);this._sy=Math.cos(this._rotation-this.skew.x);this._localID++;}},{key:"toString",value:function toString(){return"[pixijs/math:Transform position=(".concat(this.position.x,", ").concat(this.position.y,") rotation=").concat(this.rotation," scale=(").concat(this.scale.x,", ").concat(this.scale.y,") skew=(").concat(this.skew.x,", ").concat(this.skew.y,") ]");}},{key:"updateLocalTransform",value:function updateLocalTransform(){var lt=this.localTransform;if(this._localID!==this._currentLocalID){lt.a=this._cx*this.scale.x;lt.b=this._sx*this.scale.x;lt.c=this._cy*this.scale.y;lt.d=this._sy*this.scale.y;lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c);lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d);this._currentLocalID=this._localID;this._parentID=-1;}}},{key:"updateTransform",value:function updateTransform(parentTransform){var lt=this.localTransform;if(this._localID!==this._currentLocalID){lt.a=this._cx*this.scale.x;lt.b=this._sx*this.scale.x;lt.c=this._cy*this.scale.y;lt.d=this._sy*this.scale.y;lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c);lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d);this._currentLocalID=this._localID;this._parentID=-1;}if(this._parentID!==parentTransform._worldID){var pt=parentTransform.worldTransform;var wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c;wt.b=lt.a*pt.b+lt.b*pt.d;wt.c=lt.c*pt.a+lt.d*pt.c;wt.d=lt.c*pt.b+lt.d*pt.d;wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx;wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty;this._parentID=parentTransform._worldID;this._worldID++;}}},{key:"setFromMatrix",value:function setFromMatrix(matrix){matrix.decompose(this);this._localID++;}},{key:"rotation",get:function get(){return this._rotation;},set:function set(value){if(this._rotation!==value){this._rotation=value;this.updateSkew();}}}]);}();var Transform=_Transform;Transform.IDENTITY=new _Transform();var defaultFragment$2="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}";var defaultVertex$3="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n";function compileShader(gl,type,src){var shader=gl.createShader(type);gl.shaderSource(shader,src);gl.compileShader(shader);return shader;}function booleanArray(size){var array=new Array(size);for(var i=0;i<array.length;i++){array[i]=false;}return array;}function defaultValue(type,size){switch(type){case"float":return 0;case"vec2":return new Float32Array(2*size);case"vec3":return new Float32Array(3*size);case"vec4":return new Float32Array(4*size);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*size);case"ivec3":return new Int32Array(3*size);case"ivec4":return new Int32Array(4*size);case"uvec2":return new Uint32Array(2*size);case"uvec3":return new Uint32Array(3*size);case"uvec4":return new Uint32Array(4*size);case"bool":return false;case"bvec2":return booleanArray(2*size);case"bvec3":return booleanArray(3*size);case"bvec4":return booleanArray(4*size);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);}return null;}var uniformParsers=[{test:function test(data){return data.type==="float"&&data.size===1&&!data.isArray;},code:function code(name){return"\n            if(uv[\"".concat(name,"\"] !== ud[\"").concat(name,"\"].value)\n            {\n                ud[\"").concat(name,"\"].value = uv[\"").concat(name,"\"]\n                gl.uniform1f(ud[\"").concat(name,"\"].location, uv[\"").concat(name,"\"])\n            }\n            ");}},{test:function test(data,uniform){return(data.type==="sampler2D"||data.type==="samplerCube"||data.type==="sampler2DArray")&&data.size===1&&!data.isArray&&(uniform==null||uniform.castToBaseTexture!==void 0);},code:function code(name){return"t = syncData.textureCount++;\n\n            renderer.texture.bind(uv[\"".concat(name,"\"], t);\n\n            if(ud[\"").concat(name,"\"].value !== t)\n            {\n                ud[\"").concat(name,"\"].value = t;\n                gl.uniform1i(ud[\"").concat(name,"\"].location, t);\n; // eslint-disable-line max-len\n            }");}},{test:function test(data,uniform){return data.type==="mat3"&&data.size===1&&!data.isArray&&uniform.a!==void 0;},code:function code(name){return"\n            gl.uniformMatrix3fv(ud[\"".concat(name,"\"].location, false, uv[\"").concat(name,"\"].toArray(true));\n            ");},codeUbo:function codeUbo(name){return"\n                var ".concat(name,"_matrix = uv.").concat(name,".toArray(true);\n\n                data[offset] = ").concat(name,"_matrix[0];\n                data[offset+1] = ").concat(name,"_matrix[1];\n                data[offset+2] = ").concat(name,"_matrix[2];\n        \n                data[offset + 4] = ").concat(name,"_matrix[3];\n                data[offset + 5] = ").concat(name,"_matrix[4];\n                data[offset + 6] = ").concat(name,"_matrix[5];\n        \n                data[offset + 8] = ").concat(name,"_matrix[6];\n                data[offset + 9] = ").concat(name,"_matrix[7];\n                data[offset + 10] = ").concat(name,"_matrix[8];\n            ");}},{test:function test(data,uniform){return data.type==="vec2"&&data.size===1&&!data.isArray&&uniform.x!==void 0;},code:function code(name){return"\n                cv = ud[\"".concat(name,"\"].value;\n                v = uv[\"").concat(name,"\"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud[\"").concat(name,"\"].location, v.x, v.y);\n                }");},codeUbo:function codeUbo(name){return"\n                v = uv.".concat(name,";\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            ");}},{test:function test(data){return data.type==="vec2"&&data.size===1&&!data.isArray;},code:function code(name){return"\n                cv = ud[\"".concat(name,"\"].value;\n                v = uv[\"").concat(name,"\"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud[\"").concat(name,"\"].location, v[0], v[1]);\n                }\n            ");}},{test:function test(data,uniform){return data.type==="vec4"&&data.size===1&&!data.isArray&&uniform.width!==void 0;},code:function code(name){return"\n                cv = ud[\"".concat(name,"\"].value;\n                v = uv[\"").concat(name,"\"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud[\"").concat(name,"\"].location, v.x, v.y, v.width, v.height)\n                }");},codeUbo:function codeUbo(name){return"\n                    v = uv.".concat(name,";\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                ");}},{test:function test(data){return data.type==="vec4"&&data.size===1&&!data.isArray;},code:function code(name){return"\n                cv = ud[\"".concat(name,"\"].value;\n                v = uv[\"").concat(name,"\"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud[\"").concat(name,"\"].location, v[0], v[1], v[2], v[3])\n                }");}}];var GLSL_TO_SINGLE_SETTERS_CACHED={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"};var GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(group,uniformData){var funcFragments=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(var i in group.uniforms){var data=uniformData[i];if(!data){var _group$uniforms$i;if((_group$uniforms$i=group.uniforms[i])!==null&&_group$uniforms$i!==void 0&&_group$uniforms$i.group){if(group.uniforms[i].ubo){funcFragments.push("\n                        renderer.shader.syncUniformBufferGroup(uv.".concat(i,", '").concat(i,"');\n                    "));}else{funcFragments.push("\n                        renderer.shader.syncUniformGroup(uv.".concat(i,", syncData);\n                    "));}}continue;}var uniform=group.uniforms[i];var parsed=false;for(var j=0;j<uniformParsers.length;j++){if(uniformParsers[j].test(data,uniform)){funcFragments.push(uniformParsers[j].code(i,uniform));parsed=true;break;}}if(!parsed){var templateType=data.size===1&&!data.isArray?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS;var template=templateType[data.type].replace("location","ud[\"".concat(i,"\"].location"));funcFragments.push("\n            cu = ud[\"".concat(i,"\"];\n            cv = cu.value;\n            v = uv[\"").concat(i,"\"];\n            ").concat(template,";"));}}return new Function("ud","uv","renderer","syncData",funcFragments.join("\n"));}var unknownContext={};var context=unknownContext;function getTestContext(){var _context2;if(context===unknownContext||(_context2=context)!==null&&_context2!==void 0&&_context2.isContextLost()){var canvas=settings.ADAPTER.createCanvas();var gl;if(settings.PREFER_ENV>=ENV.WEBGL2){gl=canvas.getContext("webgl2",{});}if(!gl){gl=canvas.getContext("webgl",{})||canvas.getContext("experimental-webgl",{});if(!gl){gl=null;}else{gl.getExtension("WEBGL_draw_buffers");}}context=gl;}return context;}var maxFragmentPrecision;function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION.MEDIUM;var gl=getTestContext();if(gl){if(gl.getShaderPrecisionFormat){var shaderFragment=gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT);maxFragmentPrecision=shaderFragment.precision?PRECISION.HIGH:PRECISION.MEDIUM;}}}return maxFragmentPrecision;}function logPrettyShaderError(gl,shader){var _console;var shaderSrc=gl.getShaderSource(shader).split("\n").map(function(line,index){return"".concat(index,": ").concat(line);});var shaderLog=gl.getShaderInfoLog(shader);var splitShader=shaderLog.split("\n");var dedupe={};var lineNumbers=splitShader.map(function(line){return parseFloat(line.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"));}).filter(function(n){if(n&&!dedupe[n]){dedupe[n]=true;return true;}return false;});var logArgs=[""];lineNumbers.forEach(function(number){shaderSrc[number-1]="%c".concat(shaderSrc[number-1],"%c");logArgs.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px");});var fragmentSourceToLog=shaderSrc.join("\n");logArgs[0]=fragmentSourceToLog;console.error(shaderLog);console.groupCollapsed("click to view full shader code");(_console=console).warn.apply(_console,logArgs);console.groupEnd();}function logProgramError(gl,program,vertexShader,fragmentShader){if(!gl.getProgramParameter(program,gl.LINK_STATUS)){if(!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)){logPrettyShaderError(gl,vertexShader);}if(!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)){logPrettyShaderError(gl,fragmentShader);}console.error("PixiJS Error: Could not initialize shader.");if(gl.getProgramInfoLog(program)!==""){console.warn("PixiJS Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program));}}}var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(type){return GLSL_TO_SIZE[type];}var GL_TABLE=null;var GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(gl,type){if(!GL_TABLE){var typeNames=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];GL_TABLE[gl[tn]]=GL_TO_GLSL_TYPES[tn];}}return GL_TABLE[type];}function setPrecision(src,requestedPrecision,maxSupportedPrecision){if(src.substring(0,9)!=="precision"){var precision=requestedPrecision;if(requestedPrecision===PRECISION.HIGH&&maxSupportedPrecision!==PRECISION.HIGH){precision=PRECISION.MEDIUM;}return"precision ".concat(precision," float;\n").concat(src);}else if(maxSupportedPrecision!==PRECISION.HIGH&&src.substring(0,15)==="precision highp"){return src.replace("precision highp","precision mediump");}return src;}var unsafeEval;function unsafeEvalSupported(){if(typeof unsafeEval==="boolean"){return unsafeEval;}try{var func=new Function("param1","param2","param3","return param1[param2] === param3;");unsafeEval=func({a:"b"},"a","b")===true;}catch(e){unsafeEval=false;}return unsafeEval;}var UID$2=0;var nameCache={};var _Program=/*#__PURE__*/function(){function _Program(vertexSrc,fragmentSrc){var name=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"pixi-shader";var extra=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};_classCallCheck(this,_Program);this.extra={};this.id=UID$2++;this.vertexSrc=vertexSrc||_Program.defaultVertexSrc;this.fragmentSrc=fragmentSrc||_Program.defaultFragmentSrc;this.vertexSrc=this.vertexSrc.trim();this.fragmentSrc=this.fragmentSrc.trim();this.extra=extra;if(this.vertexSrc.substring(0,8)!=="#version"){name=name.replace(/\s+/g,"-");if(nameCache[name]){nameCache[name]++;name+="-".concat(nameCache[name]);}else{nameCache[name]=1;}this.vertexSrc="#define SHADER_NAME ".concat(name,"\n").concat(this.vertexSrc);this.fragmentSrc="#define SHADER_NAME ".concat(name,"\n").concat(this.fragmentSrc);this.vertexSrc=setPrecision(this.vertexSrc,_Program.defaultVertexPrecision,PRECISION.HIGH);this.fragmentSrc=setPrecision(this.fragmentSrc,_Program.defaultFragmentPrecision,getMaxFragmentPrecision());}this.glPrograms={};this.syncUniforms=null;}return _createClass(_Program,null,[{key:"defaultVertexSrc",get:function get(){return defaultVertex$3;}},{key:"defaultFragmentSrc",get:function get(){return defaultFragment$2;}},{key:"from",value:function from(vertexSrc,fragmentSrc,name){var key=vertexSrc+fragmentSrc;var program=ProgramCache[key];if(!program){ProgramCache[key]=program=new _Program(vertexSrc,fragmentSrc,name);}return program;}}]);}();var Program=_Program;Program.defaultVertexPrecision=PRECISION.HIGH;Program.defaultFragmentPrecision=isMobile.apple.device?PRECISION.HIGH:PRECISION.MEDIUM;var UID$1=0;var UniformGroup=/*#__PURE__*/function(){function UniformGroup(uniforms,isStatic,isUbo){_classCallCheck(this,UniformGroup);this.group=true;this.syncUniforms={};this.dirtyId=0;this.id=UID$1++;this.static=!!isStatic;this.ubo=!!isUbo;if(uniforms instanceof Buffer){this.buffer=uniforms;this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER;this.autoManage=false;this.ubo=true;}else{this.uniforms=uniforms;if(this.ubo){this.buffer=new Buffer(new Float32Array(1));this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER;this.autoManage=true;}}}return _createClass(UniformGroup,[{key:"update",value:function update(){this.dirtyId++;if(!this.autoManage&&this.buffer){this.buffer.update();}}},{key:"add",value:function add(name,uniforms,_static){if(!this.ubo){this.uniforms[name]=new UniformGroup(uniforms,_static);}else{throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");}}}],[{key:"from",value:function from(uniforms,_static,_ubo){return new UniformGroup(uniforms,_static,_ubo);}},{key:"uboFrom",value:function uboFrom(uniforms,_static){return new UniformGroup(uniforms,_static!==null&&_static!==void 0?_static:true,true);}}]);}();var Shader=/*#__PURE__*/function(){function Shader(program,uniforms){_classCallCheck(this,Shader);this.uniformBindCount=0;this.program=program;if(uniforms){if(uniforms instanceof UniformGroup){this.uniformGroup=uniforms;}else{this.uniformGroup=new UniformGroup(uniforms);}}else{this.uniformGroup=new UniformGroup({});}this.disposeRunner=new Runner("disposeShader");}return _createClass(Shader,[{key:"checkUniformExists",value:function checkUniformExists(name,group){if(group.uniforms[name]){return true;}for(var i in group.uniforms){var uniform=group.uniforms[i];if(uniform.group){if(this.checkUniformExists(name,uniform)){return true;}}}return false;}},{key:"destroy",value:function destroy(){this.uniformGroup=null;this.disposeRunner.emit(this);this.disposeRunner.destroy();}},{key:"uniforms",get:function get(){return this.uniformGroup.uniforms;}}],[{key:"from",value:function from(vertexSrc,fragmentSrc,uniforms){var program=Program.from(vertexSrc,fragmentSrc);return new Shader(program,uniforms);}}]);}();var BatchShaderGenerator=/*#__PURE__*/function(){function BatchShaderGenerator(vertexSrc,fragTemplate){_classCallCheck(this,BatchShaderGenerator);this.vertexSrc=vertexSrc;this.fragTemplate=fragTemplate;this.programCache={};this.defaultGroupCache={};if(!fragTemplate.includes("%count%")){throw new Error('Fragment template must contain "%count%".');}if(!fragTemplate.includes("%forloop%")){throw new Error('Fragment template must contain "%forloop%".');}}return _createClass(BatchShaderGenerator,[{key:"generateShader",value:function generateShader(maxTextures){if(!this.programCache[maxTextures]){var sampleValues=new Int32Array(maxTextures);for(var i=0;i<maxTextures;i++){sampleValues[i]=i;}this.defaultGroupCache[maxTextures]=UniformGroup.from({uSamplers:sampleValues},true);var _fragmentSrc2=this.fragTemplate;_fragmentSrc2=_fragmentSrc2.replace(/%count%/gi,"".concat(maxTextures));_fragmentSrc2=_fragmentSrc2.replace(/%forloop%/gi,this.generateSampleSrc(maxTextures));this.programCache[maxTextures]=new Program(this.vertexSrc,_fragmentSrc2);}var uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix(),default:this.defaultGroupCache[maxTextures]};return new Shader(this.programCache[maxTextures],uniforms);}},{key:"generateSampleSrc",value:function generateSampleSrc(maxTextures){var src="";src+="\n";src+="\n";for(var i=0;i<maxTextures;i++){if(i>0){src+="\nelse ";}if(i<maxTextures-1){src+="if(vTextureId < ".concat(i,".5)");}src+="\n{";src+="\n\tcolor = texture2D(uSamplers[".concat(i,"], vTextureCoord);");src+="\n}";}src+="\n";src+="\n";return src;}}]);}();var BatchTextureArray=/*#__PURE__*/function(){function BatchTextureArray(){_classCallCheck(this,BatchTextureArray);this.elements=[];this.ids=[];this.count=0;}return _createClass(BatchTextureArray,[{key:"clear",value:function clear(){for(var i=0;i<this.count;i++){this.elements[i]=null;}this.count=0;}}]);}();function canUploadSameBuffer(){return!isMobile.apple.device;}function maxRecommendedTextures(max){var allowMax=true;var navigator=settings.ADAPTER.getNavigator();if(isMobile.tablet||isMobile.phone){if(isMobile.apple.device){var match=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(match){var majorVersion=parseInt(match[1],10);if(majorVersion<11){allowMax=false;}}}if(isMobile.android.device){var _match=navigator.userAgent.match(/Android\s([0-9.]*)/);if(_match){var _majorVersion=parseInt(_match[1],10);if(_majorVersion<7){allowMax=false;}}}}return allowMax?max:4;}var ObjectRenderer=/*#__PURE__*/function(){function ObjectRenderer(renderer){_classCallCheck(this,ObjectRenderer);this.renderer=renderer;}return _createClass(ObjectRenderer,[{key:"flush",value:function flush(){}},{key:"destroy",value:function destroy(){this.renderer=null;}},{key:"start",value:function start(){}},{key:"stop",value:function stop(){this.flush();}},{key:"render",value:function render(_object){}}]);}();var defaultFragment$1="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n";var defaultVertex$2="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n";var _BatchRenderer=/*#__PURE__*/function(_ObjectRenderer){function _BatchRenderer(renderer){var _this6;_classCallCheck(this,_BatchRenderer);_this6=_callSuper(this,_BatchRenderer,[renderer]);_this6.setShaderGenerator();_this6.geometryClass=BatchGeometry;_this6.vertexSize=6;_this6.state=State.for2d();_this6.size=_BatchRenderer.defaultBatchSize*4;_this6._vertexCount=0;_this6._indexCount=0;_this6._bufferedElements=[];_this6._bufferedTextures=[];_this6._bufferSize=0;_this6._shader=null;_this6._packedGeometries=[];_this6._packedGeometryPoolSize=2;_this6._flushId=0;_this6._aBuffers={};_this6._iBuffers={};_this6.maxTextures=1;_this6.renderer.on("prerender",_this6.onPrerender,_this6);renderer.runners.contextChange.add(_this6);_this6._dcIndex=0;_this6._aIndex=0;_this6._iIndex=0;_this6._attributeBuffer=null;_this6._indexBuffer=null;_this6._tempBoundTextures=[];return _this6;}_inherits(_BatchRenderer,_ObjectRenderer);return _createClass(_BatchRenderer,[{key:"MAX_TEXTURES",get:function get(){deprecation("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures");return this.maxTextures;}},{key:"setShaderGenerator",value:function setShaderGenerator(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$vertex=_ref3.vertex,vertex=_ref3$vertex===void 0?_BatchRenderer.defaultVertexSrc:_ref3$vertex,_ref3$fragment=_ref3.fragment,fragment=_ref3$fragment===void 0?_BatchRenderer.defaultFragmentTemplate:_ref3$fragment;this.shaderGenerator=new BatchShaderGenerator(vertex,fragment);}},{key:"contextChange",value:function contextChange(){var gl=this.renderer.gl;if(settings.PREFER_ENV===ENV.WEBGL_LEGACY){this.maxTextures=1;}else{this.maxTextures=Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),_BatchRenderer.defaultMaxTextures);this.maxTextures=checkMaxIfStatementsInShader(this.maxTextures,gl);}this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(var i=0;i<this._packedGeometryPoolSize;i++){this._packedGeometries[i]=new this.geometryClass();}this.initFlushBuffers();}},{key:"initFlushBuffers",value:function initFlushBuffers(){var _drawCallPool=_BatchRenderer._drawCallPool,_textureArrayPool=_BatchRenderer._textureArrayPool;var MAX_SPRITES=this.size/4;var MAX_TA=Math.floor(MAX_SPRITES/this.maxTextures)+1;while(_drawCallPool.length<MAX_SPRITES){_drawCallPool.push(new BatchDrawCall());}while(_textureArrayPool.length<MAX_TA){_textureArrayPool.push(new BatchTextureArray());}for(var i=0;i<this.maxTextures;i++){this._tempBoundTextures[i]=null;}}},{key:"onPrerender",value:function onPrerender(){this._flushId=0;}},{key:"render",value:function render(element){if(!element._texture.valid){return;}if(this._vertexCount+element.vertexData.length/2>this.size){this.flush();}this._vertexCount+=element.vertexData.length/2;this._indexCount+=element.indices.length;this._bufferedTextures[this._bufferSize]=element._texture.baseTexture;this._bufferedElements[this._bufferSize++]=element;}},{key:"buildTexturesAndDrawCalls",value:function buildTexturesAndDrawCalls(){var textures=this._bufferedTextures,maxTextures=this.maxTextures;var textureArrays=_BatchRenderer._textureArrayPool;var batch=this.renderer.batch;var boundTextures=this._tempBoundTextures;var touch=this.renderer.textureGC.count;var TICK=++BaseTexture._globalBatch;var countTexArrays=0;var texArray=textureArrays[0];var start=0;batch.copyBoundTextures(boundTextures,maxTextures);for(var i=0;i<this._bufferSize;++i){var tex=textures[i];textures[i]=null;if(tex._batchEnabled===TICK){continue;}if(texArray.count>=maxTextures){batch.boundArray(texArray,boundTextures,TICK,maxTextures);this.buildDrawCalls(texArray,start,i);start=i;texArray=textureArrays[++countTexArrays];++TICK;}tex._batchEnabled=TICK;tex.touched=touch;texArray.elements[texArray.count++]=tex;}if(texArray.count>0){batch.boundArray(texArray,boundTextures,TICK,maxTextures);this.buildDrawCalls(texArray,start,this._bufferSize);++countTexArrays;++TICK;}for(var _i10=0;_i10<boundTextures.length;_i10++){boundTextures[_i10]=null;}BaseTexture._globalBatch=TICK;}},{key:"buildDrawCalls",value:function buildDrawCalls(texArray,start,finish){var elements=this._bufferedElements,_attributeBuffer=this._attributeBuffer,_indexBuffer=this._indexBuffer,vertexSize=this.vertexSize;var drawCalls=_BatchRenderer._drawCallPool;var dcIndex=this._dcIndex;var aIndex=this._aIndex;var iIndex=this._iIndex;var drawCall=drawCalls[dcIndex];drawCall.start=this._iIndex;drawCall.texArray=texArray;for(var i=start;i<finish;++i){var sprite=elements[i];var tex=sprite._texture.baseTexture;var spriteBlendMode=premultiplyBlendMode[tex.alphaMode?1:0][sprite.blendMode];elements[i]=null;if(start<i&&drawCall.blend!==spriteBlendMode){drawCall.size=iIndex-drawCall.start;start=i;drawCall=drawCalls[++dcIndex];drawCall.texArray=texArray;drawCall.start=iIndex;}this.packInterleavedGeometry(sprite,_attributeBuffer,_indexBuffer,aIndex,iIndex);aIndex+=sprite.vertexData.length/2*vertexSize;iIndex+=sprite.indices.length;drawCall.blend=spriteBlendMode;}if(start<finish){drawCall.size=iIndex-drawCall.start;++dcIndex;}this._dcIndex=dcIndex;this._aIndex=aIndex;this._iIndex=iIndex;}},{key:"bindAndClearTexArray",value:function bindAndClearTexArray(texArray){var textureSystem=this.renderer.texture;for(var j=0;j<texArray.count;j++){textureSystem.bind(texArray.elements[j],texArray.ids[j]);texArray.elements[j]=null;}texArray.count=0;}},{key:"updateGeometry",value:function updateGeometry(){var packedGeometries=this._packedGeometries,attributeBuffer=this._attributeBuffer,indexBuffer=this._indexBuffer;if(!_BatchRenderer.canUploadSameBuffer){if(this._packedGeometryPoolSize<=this._flushId){this._packedGeometryPoolSize++;packedGeometries[this._flushId]=new this.geometryClass();}packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData);packedGeometries[this._flushId]._indexBuffer.update(indexBuffer);this.renderer.geometry.bind(packedGeometries[this._flushId]);this.renderer.geometry.updateBuffers();this._flushId++;}else{packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData);packedGeometries[this._flushId]._indexBuffer.update(indexBuffer);this.renderer.geometry.updateBuffers();}}},{key:"drawBatches",value:function drawBatches(){var dcCount=this._dcIndex;var _this$renderer=this.renderer,gl=_this$renderer.gl,stateSystem=_this$renderer.state;var drawCalls=_BatchRenderer._drawCallPool;var curTexArray=null;for(var i=0;i<dcCount;i++){var _drawCalls$i=drawCalls[i],texArray=_drawCalls$i.texArray,_type4=_drawCalls$i.type,size=_drawCalls$i.size,start=_drawCalls$i.start,blend=_drawCalls$i.blend;if(curTexArray!==texArray){curTexArray=texArray;this.bindAndClearTexArray(texArray);}this.state.blendMode=blend;stateSystem.set(this.state);gl.drawElements(_type4,size,gl.UNSIGNED_SHORT,start*2);}}},{key:"flush",value:function flush(){if(this._vertexCount===0){return;}this._attributeBuffer=this.getAttributeBuffer(this._vertexCount);this._indexBuffer=this.getIndexBuffer(this._indexCount);this._aIndex=0;this._iIndex=0;this._dcIndex=0;this.buildTexturesAndDrawCalls();this.updateGeometry();this.drawBatches();this._bufferSize=0;this._vertexCount=0;this._indexCount=0;}},{key:"start",value:function start(){this.renderer.state.set(this.state);this.renderer.texture.ensureSamplerType(this.maxTextures);this.renderer.shader.bind(this._shader);if(_BatchRenderer.canUploadSameBuffer){this.renderer.geometry.bind(this._packedGeometries[this._flushId]);}}},{key:"stop",value:function stop(){this.flush();}},{key:"destroy",value:function destroy(){for(var i=0;i<this._packedGeometryPoolSize;i++){if(this._packedGeometries[i]){this._packedGeometries[i].destroy();}}this.renderer.off("prerender",this.onPrerender,this);this._aBuffers=null;this._iBuffers=null;this._packedGeometries=null;this._attributeBuffer=null;this._indexBuffer=null;if(this._shader){this._shader.destroy();this._shader=null;}_get(_getPrototypeOf(_BatchRenderer.prototype),"destroy",this).call(this);}},{key:"getAttributeBuffer",value:function getAttributeBuffer(size){var roundedP2=nextPow2(Math.ceil(size/8));var roundedSizeIndex=log2(roundedP2);var roundedSize=roundedP2*8;if(this._aBuffers.length<=roundedSizeIndex){this._iBuffers.length=roundedSizeIndex+1;}var buffer=this._aBuffers[roundedSize];if(!buffer){this._aBuffers[roundedSize]=buffer=new ViewableBuffer(roundedSize*this.vertexSize*4);}return buffer;}},{key:"getIndexBuffer",value:function getIndexBuffer(size){var roundedP2=nextPow2(Math.ceil(size/12));var roundedSizeIndex=log2(roundedP2);var roundedSize=roundedP2*12;if(this._iBuffers.length<=roundedSizeIndex){this._iBuffers.length=roundedSizeIndex+1;}var buffer=this._iBuffers[roundedSizeIndex];if(!buffer){this._iBuffers[roundedSizeIndex]=buffer=new Uint16Array(roundedSize);}return buffer;}},{key:"packInterleavedGeometry",value:function packInterleavedGeometry(element,attributeBuffer,indexBuffer,aIndex,iIndex){var uint32View=attributeBuffer.uint32View,float32View=attributeBuffer.float32View;var packedVertices=aIndex/this.vertexSize;var uvs=element.uvs;var indicies=element.indices;var vertexData=element.vertexData;var textureId=element._texture.baseTexture._batchLocation;var alpha=Math.min(element.worldAlpha,1);var argb=alpha<1&&element._texture.baseTexture.alphaMode?premultiplyTint(element._tintRGB,alpha):element._tintRGB+(alpha*255<<24);for(var i=0;i<vertexData.length;i+=2){float32View[aIndex++]=vertexData[i];float32View[aIndex++]=vertexData[i+1];float32View[aIndex++]=uvs[i];float32View[aIndex++]=uvs[i+1];uint32View[aIndex++]=argb;float32View[aIndex++]=textureId;}for(var _i11=0;_i11<indicies.length;_i11++){indexBuffer[iIndex++]=packedVertices+indicies[_i11];}}}],[{key:"defaultMaxTextures",get:function get(){var _this$_defaultMaxText;this._defaultMaxTextures=(_this$_defaultMaxText=this._defaultMaxTextures)!==null&&_this$_defaultMaxText!==void 0?_this$_defaultMaxText:maxRecommendedTextures(32);return this._defaultMaxTextures;},set:function set(value){this._defaultMaxTextures=value;}},{key:"canUploadSameBuffer",get:function get(){var _this$_canUploadSameB;this._canUploadSameBuffer=(_this$_canUploadSameB=this._canUploadSameBuffer)!==null&&_this$_canUploadSameB!==void 0?_this$_canUploadSameB:canUploadSameBuffer();return this._canUploadSameBuffer;},set:function set(value){this._canUploadSameBuffer=value;}},{key:"defaultVertexSrc",get:function get(){return defaultVertex$2;}},{key:"defaultFragmentTemplate",get:function get(){return defaultFragment$1;}}]);}(ObjectRenderer);var BatchRenderer=_BatchRenderer;BatchRenderer.defaultBatchSize=4096;BatchRenderer.extension={name:"batch",type:ExtensionType.RendererPlugin};BatchRenderer._drawCallPool=[];BatchRenderer._textureArrayPool=[];extensions$1.add(BatchRenderer);var defaultFragment="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n";var defaultVertex$1="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";var _Filter=/*#__PURE__*/function(_Shader){function _Filter(vertexSrc,fragmentSrc,uniforms){var _this7;_classCallCheck(this,_Filter);var program=Program.from(vertexSrc||_Filter.defaultVertexSrc,fragmentSrc||_Filter.defaultFragmentSrc);_this7=_callSuper(this,_Filter,[program,uniforms]);_this7.padding=0;_this7.resolution=_Filter.defaultResolution;_this7.multisample=_Filter.defaultMultisample;_this7.enabled=true;_this7.autoFit=true;_this7.state=new State();return _this7;}_inherits(_Filter,_Shader);return _createClass(_Filter,[{key:"apply",value:function apply(filterManager,input,output,clearMode,_currentState){filterManager.applyFilter(this,input,output,clearMode);}},{key:"blendMode",get:function get(){return this.state.blendMode;},set:function set(value){this.state.blendMode=value;}},{key:"resolution",get:function get(){return this._resolution;},set:function set(value){this._resolution=value;}}],[{key:"defaultVertexSrc",get:function get(){return defaultVertex$1;}},{key:"defaultFragmentSrc",get:function get(){return defaultFragment;}}]);}(Shader);var Filter=_Filter;Filter.defaultResolution=1;Filter.defaultMultisample=MSAA_QUALITY.NONE;var BackgroundSystem=/*#__PURE__*/function(){function BackgroundSystem(){_classCallCheck(this,BackgroundSystem);this.clearBeforeRender=true;this._backgroundColor=0;this._backgroundColorRgba=[0,0,0,1];this._backgroundColorString="#000000";this.color=this._backgroundColor;this.alpha=1;}return _createClass(BackgroundSystem,[{key:"init",value:function init(options){this.clearBeforeRender=options.clearBeforeRender;if(options.color){this.color=typeof options.color==="string"?string2hex(options.color):options.color;}this.alpha=options.alpha;}},{key:"color",get:function get(){return this._backgroundColor;},set:function set(value){this._backgroundColor=value;this._backgroundColorString=hex2string(value);hex2rgb(value,this._backgroundColorRgba);}},{key:"alpha",get:function get(){return this._backgroundColorRgba[3];},set:function set(value){this._backgroundColorRgba[3]=value;}},{key:"colorRgba",get:function get(){return this._backgroundColorRgba;}},{key:"colorString",get:function get(){return this._backgroundColorString;}},{key:"destroy",value:function destroy(){}}]);}();BackgroundSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"background"};extensions$1.add(BackgroundSystem);var BatchSystem=/*#__PURE__*/function(){function BatchSystem(renderer){_classCallCheck(this,BatchSystem);this.renderer=renderer;this.emptyRenderer=new ObjectRenderer(renderer);this.currentRenderer=this.emptyRenderer;}return _createClass(BatchSystem,[{key:"setObjectRenderer",value:function setObjectRenderer(objectRenderer){if(this.currentRenderer===objectRenderer){return;}this.currentRenderer.stop();this.currentRenderer=objectRenderer;this.currentRenderer.start();}},{key:"flush",value:function flush(){this.setObjectRenderer(this.emptyRenderer);}},{key:"reset",value:function reset(){this.setObjectRenderer(this.emptyRenderer);}},{key:"copyBoundTextures",value:function copyBoundTextures(arr,maxTextures){var boundTextures=this.renderer.texture.boundTextures;for(var i=maxTextures-1;i>=0;--i){arr[i]=boundTextures[i]||null;if(arr[i]){arr[i]._batchLocation=i;}}}},{key:"boundArray",value:function boundArray(texArray,boundTextures,batchId,maxTextures){var elements=texArray.elements,ids=texArray.ids,count=texArray.count;var j=0;for(var i=0;i<count;i++){var tex=elements[i];var loc=tex._batchLocation;if(loc>=0&&loc<maxTextures&&boundTextures[loc]===tex){ids[i]=loc;continue;}while(j<maxTextures){var bound=boundTextures[j];if(bound&&bound._batchEnabled===batchId&&bound._batchLocation===j){j++;continue;}ids[i]=j;tex._batchLocation=j;boundTextures[j]=tex;break;}}}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);}();BatchSystem.extension={type:ExtensionType.RendererSystem,name:"batch"};extensions$1.add(BatchSystem);var CONTEXT_UID_COUNTER=0;var ContextSystem=/*#__PURE__*/function(){function ContextSystem(renderer){_classCallCheck(this,ContextSystem);this.renderer=renderer;this.webGLVersion=1;this.extensions={};this.supports={uint32Indices:false};this.handleContextLost=this.handleContextLost.bind(this);this.handleContextRestored=this.handleContextRestored.bind(this);}return _createClass(ContextSystem,[{key:"isLost",get:function get(){return!this.gl||this.gl.isContextLost();}},{key:"contextChange",value:function contextChange(gl){this.gl=gl;this.renderer.gl=gl;this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++;}},{key:"init",value:function init(options){if(options.context){this.initFromContext(options.context);}else{var alpha=this.renderer.background.alpha<1;var premultipliedAlpha=options.premultipliedAlpha;this.preserveDrawingBuffer=options.preserveDrawingBuffer;this.useContextAlpha=options.useContextAlpha;this.powerPreference=options.powerPreference;this.initFromOptions({alpha:alpha,premultipliedAlpha:premultipliedAlpha,antialias:options.antialias,stencil:true,preserveDrawingBuffer:options.preserveDrawingBuffer,powerPreference:options.powerPreference});}}},{key:"initFromContext",value:function initFromContext(gl){this.gl=gl;this.validateContext(gl);this.renderer.gl=gl;this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++;this.renderer.runners.contextChange.emit(gl);var view=this.renderer.view;if(view.addEventListener!==void 0){view.addEventListener("webglcontextlost",this.handleContextLost,false);view.addEventListener("webglcontextrestored",this.handleContextRestored,false);}}},{key:"initFromOptions",value:function initFromOptions(options){var gl=this.createContext(this.renderer.view,options);this.initFromContext(gl);}},{key:"createContext",value:function createContext(canvas,options){var gl;if(settings.PREFER_ENV>=ENV.WEBGL2){gl=canvas.getContext("webgl2",options);}if(gl){this.webGLVersion=2;}else{this.webGLVersion=1;gl=canvas.getContext("webgl",options)||canvas.getContext("experimental-webgl",options);if(!gl){throw new Error("This browser does not support WebGL. Try using the canvas renderer");}}this.gl=gl;this.getExtensions();return this.gl;}},{key:"getExtensions",value:function getExtensions(){var gl=this.gl;var common={loseContext:gl.getExtension("WEBGL_lose_context"),anisotropicFiltering:gl.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),s3tc:gl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:gl.getExtension("WEBGL_compressed_texture_etc"),etc1:gl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gl.getExtension("WEBGL_compressed_texture_atc"),astc:gl.getExtension("WEBGL_compressed_texture_astc")};if(this.webGLVersion===1){Object.assign(this.extensions,common,{drawBuffers:gl.getExtension("WEBGL_draw_buffers"),depthTexture:gl.getExtension("WEBGL_depth_texture"),vertexArrayObject:gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:gl.getExtension("OES_element_index_uint"),floatTexture:gl.getExtension("OES_texture_float"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),textureHalfFloat:gl.getExtension("OES_texture_half_float"),textureHalfFloatLinear:gl.getExtension("OES_texture_half_float_linear")});}else if(this.webGLVersion===2){Object.assign(this.extensions,common,{colorBufferFloat:gl.getExtension("EXT_color_buffer_float")});}}},{key:"handleContextLost",value:function handleContextLost(event){var _this8=this;event.preventDefault();setTimeout(function(){if(_this8.gl.isContextLost()&&_this8.extensions.loseContext){_this8.extensions.loseContext.restoreContext();}},0);}},{key:"handleContextRestored",value:function handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl);}},{key:"destroy",value:function destroy(){var view=this.renderer.view;this.renderer=null;if(view.removeEventListener!==void 0){view.removeEventListener("webglcontextlost",this.handleContextLost);view.removeEventListener("webglcontextrestored",this.handleContextRestored);}this.gl.useProgram(null);if(this.extensions.loseContext){this.extensions.loseContext.loseContext();}}},{key:"postrender",value:function postrender(){if(this.renderer.objectRenderer.renderingToScreen){this.gl.flush();}}},{key:"validateContext",value:function validateContext(gl){var attributes=gl.getContextAttributes();var isWebGl2="WebGL2RenderingContext"in globalThis&&gl instanceof globalThis.WebGL2RenderingContext;if(isWebGl2){this.webGLVersion=2;}if(attributes&&!attributes.stencil){console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");}var hasuint32=isWebGl2||!!gl.getExtension("OES_element_index_uint");this.supports.uint32Indices=hasuint32;if(!hasuint32){console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly");}}}]);}();ContextSystem.extension={type:ExtensionType.RendererSystem,name:"context"};extensions$1.add(ContextSystem);var DepthResource=/*#__PURE__*/function(_BufferResource){function DepthResource(){_classCallCheck(this,DepthResource);return _callSuper(this,DepthResource,arguments);}_inherits(DepthResource,_BufferResource);return _createClass(DepthResource,[{key:"upload",value:function upload(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES.UNPACK);var width=baseTexture.realWidth;var height=baseTexture.realHeight;if(glTexture.width===width&&glTexture.height===height){gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,glTexture.type,this.data);}else{glTexture.width=width;glTexture.height=height;gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data);}return true;}}]);}(BufferResource);var Framebuffer=/*#__PURE__*/function(){function Framebuffer(width,height){_classCallCheck(this,Framebuffer);this.width=Math.round(width||100);this.height=Math.round(height||100);this.stencil=false;this.depth=false;this.dirtyId=0;this.dirtyFormat=0;this.dirtySize=0;this.depthTexture=null;this.colorTextures=[];this.glFramebuffers={};this.disposeRunner=new Runner("disposeFramebuffer");this.multisample=MSAA_QUALITY.NONE;}return _createClass(Framebuffer,[{key:"colorTexture",get:function get(){return this.colorTextures[0];}},{key:"addColorTexture",value:function addColorTexture(){var index=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var texture=arguments.length>1?arguments[1]:undefined;this.colorTextures[index]=texture||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,mipmap:MIPMAP_MODES.OFF,width:this.width,height:this.height});this.dirtyId++;this.dirtyFormat++;return this;}},{key:"addDepthTexture",value:function addDepthTexture(texture){this.depthTexture=texture||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES.OFF,format:FORMATS.DEPTH_COMPONENT,type:TYPES.UNSIGNED_SHORT});this.dirtyId++;this.dirtyFormat++;return this;}},{key:"enableDepth",value:function enableDepth(){this.depth=true;this.dirtyId++;this.dirtyFormat++;return this;}},{key:"enableStencil",value:function enableStencil(){this.stencil=true;this.dirtyId++;this.dirtyFormat++;return this;}},{key:"resize",value:function resize(width,height){width=Math.round(width);height=Math.round(height);if(width===this.width&&height===this.height)return;this.width=width;this.height=height;this.dirtyId++;this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var texture=this.colorTextures[i];var resolution=texture.resolution;texture.setSize(width/resolution,height/resolution);}if(this.depthTexture){var _resolution2=this.depthTexture.resolution;this.depthTexture.setSize(width/_resolution2,height/_resolution2);}}},{key:"dispose",value:function dispose(){this.disposeRunner.emit(this,false);}},{key:"destroyDepthTexture",value:function destroyDepthTexture(){if(this.depthTexture){this.depthTexture.destroy();this.depthTexture=null;++this.dirtyId;++this.dirtyFormat;}}}]);}();var BaseRenderTexture=/*#__PURE__*/function(_BaseTexture2){function BaseRenderTexture(){var _options$multisample;var _this9;var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,BaseRenderTexture);if(typeof options==="number"){var width=arguments[0];var height=arguments[1];var scaleMode=arguments[2];var resolution=arguments[3];options={width:width,height:height,scaleMode:scaleMode,resolution:resolution};}options.width=options.width||100;options.height=options.height||100;(_options$multisample=options.multisample)!==null&&_options$multisample!==void 0?_options$multisample:options.multisample=MSAA_QUALITY.NONE;_this9=_callSuper(this,BaseRenderTexture,[null,options]);_this9.mipmap=MIPMAP_MODES.OFF;_this9.valid=true;_this9.clearColor=[0,0,0,0];_this9.framebuffer=new Framebuffer(_this9.realWidth,_this9.realHeight).addColorTexture(0,_this9);_this9.framebuffer.multisample=options.multisample;_this9.maskStack=[];_this9.filterStack=[{}];return _this9;}_inherits(BaseRenderTexture,_BaseTexture2);return _createClass(BaseRenderTexture,[{key:"resize",value:function resize(desiredWidth,desiredHeight){this.framebuffer.resize(desiredWidth*this.resolution,desiredHeight*this.resolution);this.setRealSize(this.framebuffer.width,this.framebuffer.height);}},{key:"dispose",value:function dispose(){this.framebuffer.dispose();_get(_getPrototypeOf(BaseRenderTexture.prototype),"dispose",this).call(this);}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(BaseRenderTexture.prototype),"destroy",this).call(this);this.framebuffer.destroyDepthTexture();this.framebuffer=null;}}]);}(BaseTexture);var BaseImageResource=/*#__PURE__*/function(_Resource2){function BaseImageResource(source){var _this10;_classCallCheck(this,BaseImageResource);var sourceAny=source;var width=sourceAny.naturalWidth||sourceAny.videoWidth||sourceAny.width;var height=sourceAny.naturalHeight||sourceAny.videoHeight||sourceAny.height;_this10=_callSuper(this,BaseImageResource,[width,height]);_this10.source=source;_this10.noSubImage=false;return _this10;}_inherits(BaseImageResource,_Resource2);return _createClass(BaseImageResource,[{key:"upload",value:function upload(renderer,baseTexture,glTexture,source){var gl=renderer.gl;var width=baseTexture.realWidth;var height=baseTexture.realHeight;source=source||this.source;if(typeof HTMLImageElement!=="undefined"&&source instanceof HTMLImageElement){if(!source.complete||source.naturalWidth===0){return false;}}else if(typeof HTMLVideoElement!=="undefined"&&source instanceof HTMLVideoElement){if(source.readyState<=1&&source.buffered.length===0){return false;}}gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES.UNPACK);if(!this.noSubImage&&baseTexture.target===gl.TEXTURE_2D&&glTexture.width===width&&glTexture.height===height){gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,baseTexture.format,glTexture.type,source);}else{glTexture.width=width;glTexture.height=height;gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,baseTexture.format,glTexture.type,source);}return true;}},{key:"update",value:function update(){if(this.destroyed){return;}var source=this.source;var width=source.naturalWidth||source.videoWidth||source.width;var height=source.naturalHeight||source.videoHeight||source.height;this.resize(width,height);_get(_getPrototypeOf(BaseImageResource.prototype),"update",this).call(this);}},{key:"dispose",value:function dispose(){this.source=null;}}],[{key:"crossOrigin",value:function crossOrigin(element,url,crossorigin){if(crossorigin===void 0&&!url.startsWith("data:")){element.crossOrigin=determineCrossOrigin(url);}else if(crossorigin!==false){element.crossOrigin=typeof crossorigin==="string"?crossorigin:"anonymous";}}}]);}(Resource);var ImageResource=/*#__PURE__*/function(_BaseImageResource){function ImageResource(source,options){var _options$createBitmap;var _this11;_classCallCheck(this,ImageResource);options=options||{};if(typeof source==="string"){var imageElement=new Image();BaseImageResource.crossOrigin(imageElement,source,options.crossorigin);imageElement.src=source;source=imageElement;}_this11=_callSuper(this,ImageResource,[source]);if(!source.complete&&!!_this11._width&&!!_this11._height){_this11._width=0;_this11._height=0;}_this11.url=source.src;_this11._process=null;_this11.preserveBitmap=false;_this11.createBitmap=((_options$createBitmap=options.createBitmap)!==null&&_options$createBitmap!==void 0?_options$createBitmap:settings.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap;_this11.alphaMode=typeof options.alphaMode==="number"?options.alphaMode:null;_this11.bitmap=null;_this11._load=null;if(options.autoLoad!==false){_this11.load();}return _this11;}_inherits(ImageResource,_BaseImageResource);return _createClass(ImageResource,[{key:"load",value:function load(createBitmap){var _this12=this;if(this._load){return this._load;}if(createBitmap!==void 0){this.createBitmap=createBitmap;}this._load=new Promise(function(resolve,reject){var source=_this12.source;_this12.url=source.src;var completed=function completed(){if(_this12.destroyed){return;}source.onload=null;source.onerror=null;_this12.resize(source.width,source.height);_this12._load=null;if(_this12.createBitmap){resolve(_this12.process());}else{resolve(_this12);}};if(source.complete&&source.src){completed();}else{source.onload=completed;source.onerror=function(event){reject(event);_this12.onError.emit(event);};}});return this._load;}},{key:"process",value:function process(){var _this13=this;var source=this.source;if(this._process!==null){return this._process;}if(this.bitmap!==null||!globalThis.createImageBitmap){return Promise.resolve(this);}var createImageBitmap=globalThis.createImageBitmap;var cors=!source.crossOrigin||source.crossOrigin==="anonymous";this._process=fetch(source.src,{mode:cors?"cors":"no-cors"}).then(function(r){return r.blob();}).then(function(blob){return createImageBitmap(blob,0,0,source.width,source.height,{premultiplyAlpha:_this13.alphaMode===null||_this13.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"});}).then(function(bitmap){if(_this13.destroyed){return Promise.reject();}_this13.bitmap=bitmap;_this13.update();_this13._process=null;return Promise.resolve(_this13);});return this._process;}},{key:"upload",value:function upload(renderer,baseTexture,glTexture){if(typeof this.alphaMode==="number"){baseTexture.alphaMode=this.alphaMode;}if(!this.createBitmap){return _get(_getPrototypeOf(ImageResource.prototype),"upload",this).call(this,renderer,baseTexture,glTexture);}if(!this.bitmap){this.process();if(!this.bitmap){return false;}}_get(_getPrototypeOf(ImageResource.prototype),"upload",this).call(this,renderer,baseTexture,glTexture,this.bitmap);if(!this.preserveBitmap){var flag=true;var glTextures=baseTexture._glTextures;for(var key in glTextures){var otherTex=glTextures[key];if(otherTex!==glTexture&&otherTex.dirtyId!==baseTexture.dirtyId){flag=false;break;}}if(flag){if(this.bitmap.close){this.bitmap.close();}this.bitmap=null;}}return true;}},{key:"dispose",value:function dispose(){this.source.onload=null;this.source.onerror=null;_get(_getPrototypeOf(ImageResource.prototype),"dispose",this).call(this);if(this.bitmap){this.bitmap.close();this.bitmap=null;}this._process=null;this._load=null;}}],[{key:"test",value:function test(source){return typeof HTMLImageElement!=="undefined"&&(typeof source==="string"||source instanceof HTMLImageElement);}}]);}(BaseImageResource);var TextureUvs=/*#__PURE__*/function(){function TextureUvs(){_classCallCheck(this,TextureUvs);this.x0=0;this.y0=0;this.x1=1;this.y1=0;this.x2=1;this.y2=1;this.x3=0;this.y3=1;this.uvsFloat32=new Float32Array(8);}return _createClass(TextureUvs,[{key:"set",value:function set(frame,baseFrame,rotate){var tw=baseFrame.width;var th=baseFrame.height;if(rotate){var w2=frame.width/2/tw;var h2=frame.height/2/th;var cX=frame.x/tw+w2;var cY=frame.y/th+h2;rotate=groupD8.add(rotate,groupD8.NW);this.x0=cX+w2*groupD8.uX(rotate);this.y0=cY+h2*groupD8.uY(rotate);rotate=groupD8.add(rotate,2);this.x1=cX+w2*groupD8.uX(rotate);this.y1=cY+h2*groupD8.uY(rotate);rotate=groupD8.add(rotate,2);this.x2=cX+w2*groupD8.uX(rotate);this.y2=cY+h2*groupD8.uY(rotate);rotate=groupD8.add(rotate,2);this.x3=cX+w2*groupD8.uX(rotate);this.y3=cY+h2*groupD8.uY(rotate);}else{this.x0=frame.x/tw;this.y0=frame.y/th;this.x1=(frame.x+frame.width)/tw;this.y1=frame.y/th;this.x2=(frame.x+frame.width)/tw;this.y2=(frame.y+frame.height)/th;this.x3=frame.x/tw;this.y3=(frame.y+frame.height)/th;}this.uvsFloat32[0]=this.x0;this.uvsFloat32[1]=this.y0;this.uvsFloat32[2]=this.x1;this.uvsFloat32[3]=this.y1;this.uvsFloat32[4]=this.x2;this.uvsFloat32[5]=this.y2;this.uvsFloat32[6]=this.x3;this.uvsFloat32[7]=this.y3;}},{key:"toString",value:function toString(){return"[pixijs/core:TextureUvs x0=".concat(this.x0," y0=").concat(this.y0," x1=").concat(this.x1," y1=").concat(this.y1," x2=").concat(this.x2," y2=").concat(this.y2," x3=").concat(this.x3," y3=").concat(this.y3,"]");}}]);}();var DEFAULT_UVS=new TextureUvs();function removeAllHandlers(tex){tex.destroy=function _emptyDestroy(){};tex.on=function _emptyOn(){};tex.once=function _emptyOnce(){};tex.emit=function _emptyEmit(){};}var Texture=/*#__PURE__*/function(_EventEmitter2){function Texture(baseTexture,frame,orig,trim,rotate,anchor){var _this14;_classCallCheck(this,Texture);_this14=_callSuper(this,Texture);_this14.noFrame=false;if(!frame){_this14.noFrame=true;frame=new Rectangle(0,0,1,1);}if(baseTexture instanceof Texture){baseTexture=baseTexture.baseTexture;}_this14.baseTexture=baseTexture;_this14._frame=frame;_this14.trim=trim;_this14.valid=false;_this14._uvs=DEFAULT_UVS;_this14.uvMatrix=null;_this14.orig=orig||frame;_this14._rotate=Number(rotate||0);if(rotate===true){_this14._rotate=2;}else if(_this14._rotate%2!==0){throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");}_this14.defaultAnchor=anchor?new Point(anchor.x,anchor.y):new Point(0,0);_this14._updateID=0;_this14.textureCacheIds=[];if(!baseTexture.valid){baseTexture.once("loaded",_this14.onBaseTextureUpdated,_this14);}else if(_this14.noFrame){if(baseTexture.valid){_this14.onBaseTextureUpdated(baseTexture);}}else{_this14.frame=frame;}if(_this14.noFrame){baseTexture.on("update",_this14.onBaseTextureUpdated,_this14);}return _this14;}_inherits(Texture,_EventEmitter2);return _createClass(Texture,[{key:"update",value:function update(){if(this.baseTexture.resource){this.baseTexture.resource.update();}}},{key:"onBaseTextureUpdated",value:function onBaseTextureUpdated(baseTexture){if(this.noFrame){if(!this.baseTexture.valid){return;}this._frame.width=baseTexture.width;this._frame.height=baseTexture.height;this.valid=true;this.updateUvs();}else{this.frame=this._frame;}this.emit("update",this);}},{key:"destroy",value:function destroy(destroyBase){if(this.baseTexture){if(destroyBase){var resource=this.baseTexture.resource;if(resource!==null&&resource!==void 0&&resource.url&&TextureCache[resource.url]){Texture.removeFromCache(resource.url);}this.baseTexture.destroy();}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this);this.baseTexture.off("update",this.onBaseTextureUpdated,this);this.baseTexture=null;}this._frame=null;this._uvs=null;this.trim=null;this.orig=null;this.valid=false;Texture.removeFromCache(this);this.textureCacheIds=null;}},{key:"clone",value:function clone(){var _this$trim;var clonedFrame=this._frame.clone();var clonedOrig=this._frame===this.orig?clonedFrame:this.orig.clone();var clonedTexture=new Texture(this.baseTexture,!this.noFrame&&clonedFrame,clonedOrig,(_this$trim=this.trim)===null||_this$trim===void 0?void 0:_this$trim.clone(),this.rotate,this.defaultAnchor);if(this.noFrame){clonedTexture._frame=clonedFrame;}return clonedTexture;}},{key:"updateUvs",value:function updateUvs(){if(this._uvs===DEFAULT_UVS){this._uvs=new TextureUvs();}this._uvs.set(this._frame,this.baseTexture,this.rotate);this._updateID++;}},{key:"resolution",get:function get(){return this.baseTexture.resolution;}},{key:"frame",get:function get(){return this._frame;},set:function set(frame){this._frame=frame;this.noFrame=false;var x=frame.x,y=frame.y,width=frame.width,height=frame.height;var xNotFit=x+width>this.baseTexture.width;var yNotFit=y+height>this.baseTexture.height;if(xNotFit||yNotFit){var relationship=xNotFit&&yNotFit?"and":"or";var errorX="X: ".concat(x," + ").concat(width," = ").concat(x+width," > ").concat(this.baseTexture.width);var errorY="Y: ".concat(y," + ").concat(height," = ").concat(y+height," > ").concat(this.baseTexture.height);throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: ".concat(errorX," ").concat(relationship," ").concat(errorY));}this.valid=width&&height&&this.baseTexture.valid;if(!this.trim&&!this.rotate){this.orig=frame;}if(this.valid){this.updateUvs();}}},{key:"rotate",get:function get(){return this._rotate;},set:function set(rotate){this._rotate=rotate;if(this.valid){this.updateUvs();}}},{key:"width",get:function get(){return this.orig.width;}},{key:"height",get:function get(){return this.orig.height;}},{key:"castToBaseTexture",value:function castToBaseTexture(){return this.baseTexture;}}],[{key:"from",value:function from(source){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var strict=arguments.length>2&&arguments[2]!==undefined?arguments[2]:settings.STRICT_TEXTURE_CACHE;var isFrame=typeof source==="string";var cacheId=null;if(isFrame){cacheId=source;}else if(source instanceof BaseTexture){if(!source.cacheId){var prefix=(options===null||options===void 0?void 0:options.pixiIdPrefix)||"pixiid";source.cacheId="".concat(prefix,"-").concat(uid());BaseTexture.addToCache(source,source.cacheId);}cacheId=source.cacheId;}else{if(!source._pixiId){var _prefix=(options===null||options===void 0?void 0:options.pixiIdPrefix)||"pixiid";source._pixiId="".concat(_prefix,"_").concat(uid());}cacheId=source._pixiId;}var texture=TextureCache[cacheId];if(isFrame&&strict&&!texture){throw new Error("The cacheId \"".concat(cacheId,"\" does not exist in TextureCache."));}if(!texture&&!(source instanceof BaseTexture)){if(!options.resolution){options.resolution=getResolutionOfUrl(source);}texture=new Texture(new BaseTexture(source,options));texture.baseTexture.cacheId=cacheId;BaseTexture.addToCache(texture.baseTexture,cacheId);Texture.addToCache(texture,cacheId);}else if(!texture&&source instanceof BaseTexture){texture=new Texture(source);Texture.addToCache(texture,cacheId);}return texture;}},{key:"fromURL",value:function fromURL(url,options){var resourceOptions=Object.assign({autoLoad:false},options===null||options===void 0?void 0:options.resourceOptions);var texture=Texture.from(url,Object.assign({resourceOptions:resourceOptions},options),false);var resource=texture.baseTexture.resource;if(texture.baseTexture.valid){return Promise.resolve(texture);}return resource.load().then(function(){return Promise.resolve(texture);});}},{key:"fromBuffer",value:function fromBuffer(buffer,width,height,options){return new Texture(BaseTexture.fromBuffer(buffer,width,height,options));}},{key:"fromLoader",value:function fromLoader(source,imageUrl,name,options){var baseTexture=new BaseTexture(source,Object.assign({scaleMode:BaseTexture.defaultOptions.scaleMode,resolution:getResolutionOfUrl(imageUrl)},options));var resource=baseTexture.resource;if(resource instanceof ImageResource){resource.url=imageUrl;}var texture=new Texture(baseTexture);if(!name){name=imageUrl;}BaseTexture.addToCache(texture.baseTexture,name);Texture.addToCache(texture,name);if(name!==imageUrl){BaseTexture.addToCache(texture.baseTexture,imageUrl);Texture.addToCache(texture,imageUrl);}if(texture.baseTexture.valid){return Promise.resolve(texture);}return new Promise(function(resolve){texture.baseTexture.once("loaded",function(){return resolve(texture);});});}},{key:"addToCache",value:function addToCache(texture,id){if(id){if(!texture.textureCacheIds.includes(id)){texture.textureCacheIds.push(id);}if(TextureCache[id]&&TextureCache[id]!==texture){console.warn("Texture added to the cache with an id [".concat(id,"] that already had an entry"));}TextureCache[id]=texture;}}},{key:"removeFromCache",value:function removeFromCache(texture){if(typeof texture==="string"){var textureFromCache=TextureCache[texture];if(textureFromCache){var _index8=textureFromCache.textureCacheIds.indexOf(texture);if(_index8>-1){textureFromCache.textureCacheIds.splice(_index8,1);}delete TextureCache[texture];return textureFromCache;}}else if(texture!==null&&texture!==void 0&&texture.textureCacheIds){for(var i=0;i<texture.textureCacheIds.length;++i){if(TextureCache[texture.textureCacheIds[i]]===texture){delete TextureCache[texture.textureCacheIds[i]];}}texture.textureCacheIds.length=0;return texture;}return null;}},{key:"EMPTY",get:function get(){if(!Texture._EMPTY){Texture._EMPTY=new Texture(new BaseTexture());removeAllHandlers(Texture._EMPTY);removeAllHandlers(Texture._EMPTY.baseTexture);}return Texture._EMPTY;}},{key:"WHITE",get:function get(){if(!Texture._WHITE){var canvas=settings.ADAPTER.createCanvas(16,16);var _context3=canvas.getContext("2d");canvas.width=16;canvas.height=16;_context3.fillStyle="white";_context3.fillRect(0,0,16,16);Texture._WHITE=new Texture(BaseTexture.from(canvas));removeAllHandlers(Texture._WHITE);removeAllHandlers(Texture._WHITE.baseTexture);}return Texture._WHITE;}}]);}(EventEmitter);var RenderTexture=/*#__PURE__*/function(_Texture){function RenderTexture(baseRenderTexture,frame){var _this15;_classCallCheck(this,RenderTexture);_this15=_callSuper(this,RenderTexture,[baseRenderTexture,frame]);_this15.valid=true;_this15.filterFrame=null;_this15.filterPoolKey=null;_this15.updateUvs();return _this15;}_inherits(RenderTexture,_Texture);return _createClass(RenderTexture,[{key:"framebuffer",get:function get(){return this.baseTexture.framebuffer;}},{key:"multisample",get:function get(){return this.framebuffer.multisample;},set:function set(value){this.framebuffer.multisample=value;}},{key:"resize",value:function resize(desiredWidth,desiredHeight){var resizeBaseTexture=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var resolution=this.baseTexture.resolution;var width=Math.round(desiredWidth*resolution)/resolution;var height=Math.round(desiredHeight*resolution)/resolution;this.valid=width>0&&height>0;this._frame.width=this.orig.width=width;this._frame.height=this.orig.height=height;if(resizeBaseTexture){this.baseTexture.resize(width,height);}this.updateUvs();}},{key:"setResolution",value:function setResolution(resolution){var baseTexture=this.baseTexture;if(baseTexture.resolution===resolution){return;}baseTexture.setResolution(resolution);this.resize(baseTexture.width,baseTexture.height,false);}}],[{key:"create",value:function create(options){return new RenderTexture(new BaseRenderTexture(options));}}]);}(Texture);var RenderTexturePool=/*#__PURE__*/function(){function RenderTexturePool(textureOptions){_classCallCheck(this,RenderTexturePool);this.texturePool={};this.textureOptions=textureOptions||{};this.enableFullScreen=false;this._pixelsWidth=0;this._pixelsHeight=0;}return _createClass(RenderTexturePool,[{key:"createTexture",value:function createTexture(realWidth,realHeight){var multisample=arguments.length>2&&arguments[2]!==undefined?arguments[2]:MSAA_QUALITY.NONE;var baseRenderTexture=new BaseRenderTexture(Object.assign({width:realWidth,height:realHeight,resolution:1,multisample:multisample},this.textureOptions));return new RenderTexture(baseRenderTexture);}},{key:"getOptimalTexture",value:function getOptimalTexture(minWidth,minHeight){var resolution=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var multisample=arguments.length>3&&arguments[3]!==undefined?arguments[3]:MSAA_QUALITY.NONE;var key;minWidth=Math.ceil(minWidth*resolution-1e-6);minHeight=Math.ceil(minHeight*resolution-1e-6);if(!this.enableFullScreen||minWidth!==this._pixelsWidth||minHeight!==this._pixelsHeight){minWidth=nextPow2(minWidth);minHeight=nextPow2(minHeight);key=((minWidth&65535)<<16|minHeight&65535)>>>0;if(multisample>1){key+=multisample*4294967296;}}else{key=multisample>1?-multisample:-1;}if(!this.texturePool[key]){this.texturePool[key]=[];}var renderTexture=this.texturePool[key].pop();if(!renderTexture){renderTexture=this.createTexture(minWidth,minHeight,multisample);}renderTexture.filterPoolKey=key;renderTexture.setResolution(resolution);return renderTexture;}},{key:"getFilterTexture",value:function getFilterTexture(input,resolution,multisample){var filterTexture=this.getOptimalTexture(input.width,input.height,resolution||input.resolution,multisample||MSAA_QUALITY.NONE);filterTexture.filterFrame=input.filterFrame;return filterTexture;}},{key:"returnTexture",value:function returnTexture(renderTexture){var key=renderTexture.filterPoolKey;renderTexture.filterFrame=null;this.texturePool[key].push(renderTexture);}},{key:"returnFilterTexture",value:function returnFilterTexture(renderTexture){this.returnTexture(renderTexture);}},{key:"clear",value:function clear(destroyTextures){destroyTextures=destroyTextures!==false;if(destroyTextures){for(var i in this.texturePool){var textures=this.texturePool[i];if(textures){for(var j=0;j<textures.length;j++){textures[j].destroy(true);}}}}this.texturePool={};}},{key:"setScreenSize",value:function setScreenSize(size){if(size.width===this._pixelsWidth&&size.height===this._pixelsHeight){return;}this.enableFullScreen=size.width>0&&size.height>0;for(var i in this.texturePool){if(!(Number(i)<0)){continue;}var textures=this.texturePool[i];if(textures){for(var j=0;j<textures.length;j++){textures[j].destroy(true);}}this.texturePool[i]=[];}this._pixelsWidth=size.width;this._pixelsHeight=size.height;}}]);}();RenderTexturePool.SCREEN_KEY=-1;var Quad=/*#__PURE__*/function(_Geometry2){function Quad(){var _this16;_classCallCheck(this,Quad);_this16=_callSuper(this,Quad);_this16.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]);return _this16;}_inherits(Quad,_Geometry2);return _createClass(Quad);}(Geometry);var QuadUv=/*#__PURE__*/function(_Geometry3){function QuadUv(){var _this17;_classCallCheck(this,QuadUv);_this17=_callSuper(this,QuadUv);_this17.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]);_this17.uvs=new Float32Array([0,0,1,0,1,1,0,1]);_this17.vertexBuffer=new Buffer(_this17.vertices);_this17.uvBuffer=new Buffer(_this17.uvs);_this17.addAttribute("aVertexPosition",_this17.vertexBuffer).addAttribute("aTextureCoord",_this17.uvBuffer).addIndex([0,1,2,0,2,3]);return _this17;}_inherits(QuadUv,_Geometry3);return _createClass(QuadUv,[{key:"map",value:function map(targetTextureFrame,destinationFrame){var x=0;var y=0;this.uvs[0]=x;this.uvs[1]=y;this.uvs[2]=x+destinationFrame.width/targetTextureFrame.width;this.uvs[3]=y;this.uvs[4]=x+destinationFrame.width/targetTextureFrame.width;this.uvs[5]=y+destinationFrame.height/targetTextureFrame.height;this.uvs[6]=x;this.uvs[7]=y+destinationFrame.height/targetTextureFrame.height;x=destinationFrame.x;y=destinationFrame.y;this.vertices[0]=x;this.vertices[1]=y;this.vertices[2]=x+destinationFrame.width;this.vertices[3]=y;this.vertices[4]=x+destinationFrame.width;this.vertices[5]=y+destinationFrame.height;this.vertices[6]=x;this.vertices[7]=y+destinationFrame.height;this.invalidate();return this;}},{key:"invalidate",value:function invalidate(){this.vertexBuffer._updateID++;this.uvBuffer._updateID++;return this;}}]);}(Geometry);var FilterState=/*#__PURE__*/function(){function FilterState(){_classCallCheck(this,FilterState);this.renderTexture=null;this.target=null;this.legacy=false;this.resolution=1;this.multisample=MSAA_QUALITY.NONE;this.sourceFrame=new Rectangle();this.destinationFrame=new Rectangle();this.bindingSourceFrame=new Rectangle();this.bindingDestinationFrame=new Rectangle();this.filters=[];this.transform=null;}return _createClass(FilterState,[{key:"clear",value:function clear(){this.target=null;this.filters=null;this.renderTexture=null;}}]);}();var tempPoints=[new Point(),new Point(),new Point(),new Point()];var tempMatrix$2=new Matrix();var FilterSystem=/*#__PURE__*/function(){function FilterSystem(renderer){_classCallCheck(this,FilterSystem);this.renderer=renderer;this.defaultFilterStack=[{}];this.texturePool=new RenderTexturePool();this.statePool=[];this.quad=new Quad();this.quadUv=new QuadUv();this.tempRect=new Rectangle();this.activeState={};this.globalUniforms=new UniformGroup({outputFrame:new Rectangle(),inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},true);this.forceClear=false;this.useMaxPadding=false;}return _createClass(FilterSystem,[{key:"init",value:function init(){this.texturePool.setScreenSize(this.renderer.view);}},{key:"push",value:function push(target,filters){var _filters$0$legacy;var renderer=this.renderer;var filterStack=this.defaultFilterStack;var state=this.statePool.pop()||new FilterState();var renderTextureSystem=this.renderer.renderTexture;var resolution=filters[0].resolution;var multisample=filters[0].multisample;var padding=filters[0].padding;var autoFit=filters[0].autoFit;var legacy=(_filters$0$legacy=filters[0].legacy)!==null&&_filters$0$legacy!==void 0?_filters$0$legacy:true;for(var i=1;i<filters.length;i++){var _filter$legacy;var filter=filters[i];resolution=Math.min(resolution,filter.resolution);multisample=Math.min(multisample,filter.multisample);padding=this.useMaxPadding?Math.max(padding,filter.padding):padding+filter.padding;autoFit=autoFit&&filter.autoFit;legacy=legacy||((_filter$legacy=filter.legacy)!==null&&_filter$legacy!==void 0?_filter$legacy:true);}if(filterStack.length===1){this.defaultFilterStack[0].renderTexture=renderTextureSystem.current;}filterStack.push(state);state.resolution=resolution;state.multisample=multisample;state.legacy=legacy;state.target=target;state.sourceFrame.copyFrom(target.filterArea||target.getBounds(true));state.sourceFrame.pad(padding);var sourceFrameProjected=this.tempRect.copyFrom(renderTextureSystem.sourceFrame);if(renderer.projection.transform){this.transformAABB(tempMatrix$2.copyFrom(renderer.projection.transform).invert(),sourceFrameProjected);}if(autoFit){state.sourceFrame.fit(sourceFrameProjected);if(state.sourceFrame.width<=0||state.sourceFrame.height<=0){state.sourceFrame.width=0;state.sourceFrame.height=0;}}else if(!state.sourceFrame.intersects(sourceFrameProjected)){state.sourceFrame.width=0;state.sourceFrame.height=0;}this.roundFrame(state.sourceFrame,renderTextureSystem.current?renderTextureSystem.current.resolution:renderer.resolution,renderTextureSystem.sourceFrame,renderTextureSystem.destinationFrame,renderer.projection.transform);state.renderTexture=this.getOptimalFilterTexture(state.sourceFrame.width,state.sourceFrame.height,resolution,multisample);state.filters=filters;state.destinationFrame.width=state.renderTexture.width;state.destinationFrame.height=state.renderTexture.height;var destinationFrame=this.tempRect;destinationFrame.x=0;destinationFrame.y=0;destinationFrame.width=state.sourceFrame.width;destinationFrame.height=state.sourceFrame.height;state.renderTexture.filterFrame=state.sourceFrame;state.bindingSourceFrame.copyFrom(renderTextureSystem.sourceFrame);state.bindingDestinationFrame.copyFrom(renderTextureSystem.destinationFrame);state.transform=renderer.projection.transform;renderer.projection.transform=null;renderTextureSystem.bind(state.renderTexture,state.sourceFrame,destinationFrame);renderer.framebuffer.clear(0,0,0,0);}},{key:"pop",value:function pop(){var filterStack=this.defaultFilterStack;var state=filterStack.pop();var filters=state.filters;this.activeState=state;var globalUniforms=this.globalUniforms.uniforms;globalUniforms.outputFrame=state.sourceFrame;globalUniforms.resolution=state.resolution;var inputSize=globalUniforms.inputSize;var inputPixel=globalUniforms.inputPixel;var inputClamp=globalUniforms.inputClamp;inputSize[0]=state.destinationFrame.width;inputSize[1]=state.destinationFrame.height;inputSize[2]=1/inputSize[0];inputSize[3]=1/inputSize[1];inputPixel[0]=Math.round(inputSize[0]*state.resolution);inputPixel[1]=Math.round(inputSize[1]*state.resolution);inputPixel[2]=1/inputPixel[0];inputPixel[3]=1/inputPixel[1];inputClamp[0]=0.5*inputPixel[2];inputClamp[1]=0.5*inputPixel[3];inputClamp[2]=state.sourceFrame.width*inputSize[2]-0.5*inputPixel[2];inputClamp[3]=state.sourceFrame.height*inputSize[3]-0.5*inputPixel[3];if(state.legacy){var filterArea=globalUniforms.filterArea;filterArea[0]=state.destinationFrame.width;filterArea[1]=state.destinationFrame.height;filterArea[2]=state.sourceFrame.x;filterArea[3]=state.sourceFrame.y;globalUniforms.filterClamp=globalUniforms.inputClamp;}this.globalUniforms.update();var lastState=filterStack[filterStack.length-1];this.renderer.framebuffer.blit();if(filters.length===1){filters[0].apply(this,state.renderTexture,lastState.renderTexture,CLEAR_MODES.BLEND,state);this.returnFilterTexture(state.renderTexture);}else{var flip=state.renderTexture;var flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution);flop.filterFrame=flip.filterFrame;var i=0;for(i=0;i<filters.length-1;++i){if(i===1&&state.multisample>1){flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution);flop.filterFrame=flip.filterFrame;}filters[i].apply(this,flip,flop,CLEAR_MODES.CLEAR,state);var t=flip;flip=flop;flop=t;}filters[i].apply(this,flip,lastState.renderTexture,CLEAR_MODES.BLEND,state);if(i>1&&state.multisample>1){this.returnFilterTexture(state.renderTexture);}this.returnFilterTexture(flip);this.returnFilterTexture(flop);}state.clear();this.statePool.push(state);}},{key:"bindAndClear",value:function bindAndClear(filterTexture){var clearMode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:CLEAR_MODES.CLEAR;var _this$renderer2=this.renderer,renderTextureSystem=_this$renderer2.renderTexture,stateSystem=_this$renderer2.state;if(filterTexture===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture){this.renderer.projection.transform=this.activeState.transform;}else{this.renderer.projection.transform=null;}if(filterTexture!==null&&filterTexture!==void 0&&filterTexture.filterFrame){var destinationFrame=this.tempRect;destinationFrame.x=0;destinationFrame.y=0;destinationFrame.width=filterTexture.filterFrame.width;destinationFrame.height=filterTexture.filterFrame.height;renderTextureSystem.bind(filterTexture,filterTexture.filterFrame,destinationFrame);}else if(filterTexture!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture){renderTextureSystem.bind(filterTexture);}else{this.renderer.renderTexture.bind(filterTexture,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);}var autoClear=stateSystem.stateId&1||this.forceClear;if(clearMode===CLEAR_MODES.CLEAR||clearMode===CLEAR_MODES.BLIT&&autoClear){this.renderer.framebuffer.clear(0,0,0,0);}}},{key:"applyFilter",value:function applyFilter(filter,input,output,clearMode){var renderer=this.renderer;renderer.state.set(filter.state);this.bindAndClear(output,clearMode);filter.uniforms.uSampler=input;filter.uniforms.filterGlobals=this.globalUniforms;renderer.shader.bind(filter);filter.legacy=!!filter.program.attributeData.aTextureCoord;if(filter.legacy){this.quadUv.map(input._frame,input.filterFrame);renderer.geometry.bind(this.quadUv);renderer.geometry.draw(DRAW_MODES.TRIANGLES);}else{renderer.geometry.bind(this.quad);renderer.geometry.draw(DRAW_MODES.TRIANGLE_STRIP);}}},{key:"calculateSpriteMatrix",value:function calculateSpriteMatrix(outputMatrix,sprite){var _this$activeState=this.activeState,sourceFrame=_this$activeState.sourceFrame,destinationFrame=_this$activeState.destinationFrame;var orig=sprite._texture.orig;var mappedMatrix=outputMatrix.set(destinationFrame.width,0,0,destinationFrame.height,sourceFrame.x,sourceFrame.y);var worldTransform=sprite.worldTransform.copyTo(Matrix.TEMP_MATRIX);worldTransform.invert();mappedMatrix.prepend(worldTransform);mappedMatrix.scale(1/orig.width,1/orig.height);mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y);return mappedMatrix;}},{key:"destroy",value:function destroy(){this.renderer=null;this.texturePool.clear(false);}},{key:"getOptimalFilterTexture",value:function getOptimalFilterTexture(minWidth,minHeight){var resolution=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var multisample=arguments.length>3&&arguments[3]!==undefined?arguments[3]:MSAA_QUALITY.NONE;return this.texturePool.getOptimalTexture(minWidth,minHeight,resolution,multisample);}},{key:"getFilterTexture",value:function getFilterTexture(input,resolution,multisample){if(typeof input==="number"){var swap=input;input=resolution;resolution=swap;}input=input||this.activeState.renderTexture;var filterTexture=this.texturePool.getOptimalTexture(input.width,input.height,resolution||input.resolution,multisample||MSAA_QUALITY.NONE);filterTexture.filterFrame=input.filterFrame;return filterTexture;}},{key:"returnFilterTexture",value:function returnFilterTexture(renderTexture){this.texturePool.returnTexture(renderTexture);}},{key:"emptyPool",value:function emptyPool(){this.texturePool.clear(true);}},{key:"resize",value:function resize(){this.texturePool.setScreenSize(this.renderer.view);}},{key:"transformAABB",value:function transformAABB(matrix,rect){var lt=tempPoints[0];var lb=tempPoints[1];var rt=tempPoints[2];var rb=tempPoints[3];lt.set(rect.left,rect.top);lb.set(rect.left,rect.bottom);rt.set(rect.right,rect.top);rb.set(rect.right,rect.bottom);matrix.apply(lt,lt);matrix.apply(lb,lb);matrix.apply(rt,rt);matrix.apply(rb,rb);var x0=Math.min(lt.x,lb.x,rt.x,rb.x);var y0=Math.min(lt.y,lb.y,rt.y,rb.y);var x1=Math.max(lt.x,lb.x,rt.x,rb.x);var y1=Math.max(lt.y,lb.y,rt.y,rb.y);rect.x=x0;rect.y=y0;rect.width=x1-x0;rect.height=y1-y0;}},{key:"roundFrame",value:function roundFrame(frame,resolution,bindingSourceFrame,bindingDestinationFrame,transform){if(frame.width<=0||frame.height<=0||bindingSourceFrame.width<=0||bindingSourceFrame.height<=0){return;}if(transform){var _transform=transform,a=_transform.a,b=_transform.b,c=_transform.c,d=_transform.d;if((Math.abs(b)>1e-4||Math.abs(c)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(d)>1e-4)){return;}}transform=transform?tempMatrix$2.copyFrom(transform):tempMatrix$2.identity();transform.translate(-bindingSourceFrame.x,-bindingSourceFrame.y).scale(bindingDestinationFrame.width/bindingSourceFrame.width,bindingDestinationFrame.height/bindingSourceFrame.height).translate(bindingDestinationFrame.x,bindingDestinationFrame.y);this.transformAABB(transform,frame);frame.ceil(resolution);this.transformAABB(transform.invert(),frame);}}]);}();FilterSystem.extension={type:ExtensionType.RendererSystem,name:"filter"};extensions$1.add(FilterSystem);var GLFramebuffer=/*#__PURE__*/_createClass(function GLFramebuffer(framebuffer){_classCallCheck(this,GLFramebuffer);this.framebuffer=framebuffer;this.stencil=null;this.dirtyId=-1;this.dirtyFormat=-1;this.dirtySize=-1;this.multisample=MSAA_QUALITY.NONE;this.msaaBuffer=null;this.blitFramebuffer=null;this.mipLevel=0;});var tempRectangle=new Rectangle();var FramebufferSystem=/*#__PURE__*/function(){function FramebufferSystem(renderer){_classCallCheck(this,FramebufferSystem);this.renderer=renderer;this.managedFramebuffers=[];this.unknownFramebuffer=new Framebuffer(10,10);this.msaaSamples=null;}return _createClass(FramebufferSystem,[{key:"contextChange",value:function contextChange(){this.disposeAll(true);var gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.current=this.unknownFramebuffer;this.viewport=new Rectangle();this.hasMRT=true;this.writeDepthTexture=true;if(this.renderer.context.webGLVersion===1){var nativeDrawBuffersExtension=this.renderer.context.extensions.drawBuffers;var nativeDepthTextureExtension=this.renderer.context.extensions.depthTexture;if(settings.PREFER_ENV===ENV.WEBGL_LEGACY){nativeDrawBuffersExtension=null;nativeDepthTextureExtension=null;}if(nativeDrawBuffersExtension){gl.drawBuffers=function(activeTextures){return nativeDrawBuffersExtension.drawBuffersWEBGL(activeTextures);};}else{this.hasMRT=false;gl.drawBuffers=function(){};}if(!nativeDepthTextureExtension){this.writeDepthTexture=false;}}else{this.msaaSamples=gl.getInternalformatParameter(gl.RENDERBUFFER,gl.RGBA8,gl.SAMPLES);}}},{key:"bind",value:function bind(framebuffer,frame){var mipLevel=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var gl=this.gl;if(framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(framebuffer);if(this.current!==framebuffer){this.current=framebuffer;gl.bindFramebuffer(gl.FRAMEBUFFER,fbo.framebuffer);}if(fbo.mipLevel!==mipLevel){framebuffer.dirtyId++;framebuffer.dirtyFormat++;fbo.mipLevel=mipLevel;}if(fbo.dirtyId!==framebuffer.dirtyId){fbo.dirtyId=framebuffer.dirtyId;if(fbo.dirtyFormat!==framebuffer.dirtyFormat){fbo.dirtyFormat=framebuffer.dirtyFormat;fbo.dirtySize=framebuffer.dirtySize;this.updateFramebuffer(framebuffer,mipLevel);}else if(fbo.dirtySize!==framebuffer.dirtySize){fbo.dirtySize=framebuffer.dirtySize;this.resizeFramebuffer(framebuffer);}}for(var i=0;i<framebuffer.colorTextures.length;i++){var tex=framebuffer.colorTextures[i];this.renderer.texture.unbind(tex.parentTextureArray||tex);}if(framebuffer.depthTexture){this.renderer.texture.unbind(framebuffer.depthTexture);}if(frame){var mipWidth=frame.width>>mipLevel;var mipHeight=frame.height>>mipLevel;var scale=mipWidth/frame.width;this.setViewport(frame.x*scale,frame.y*scale,mipWidth,mipHeight);}else{var _mipWidth=framebuffer.width>>mipLevel;var _mipHeight=framebuffer.height>>mipLevel;this.setViewport(0,0,_mipWidth,_mipHeight);}}else{if(this.current){this.current=null;gl.bindFramebuffer(gl.FRAMEBUFFER,null);}if(frame){this.setViewport(frame.x,frame.y,frame.width,frame.height);}else{this.setViewport(0,0,this.renderer.width,this.renderer.height);}}}},{key:"setViewport",value:function setViewport(x,y,width,height){var v=this.viewport;x=Math.round(x);y=Math.round(y);width=Math.round(width);height=Math.round(height);if(v.width!==width||v.height!==height||v.x!==x||v.y!==y){v.x=x;v.y=y;v.width=width;v.height=height;this.gl.viewport(x,y,width,height);}}},{key:"size",get:function get(){if(this.current){return{x:0,y:0,width:this.current.width,height:this.current.height};}return{x:0,y:0,width:this.renderer.width,height:this.renderer.height};}},{key:"clear",value:function clear(r,g,b,a){var mask=arguments.length>4&&arguments[4]!==undefined?arguments[4]:BUFFER_BITS.COLOR|BUFFER_BITS.DEPTH;var gl=this.gl;gl.clearColor(r,g,b,a);gl.clear(mask);}},{key:"initFramebuffer",value:function initFramebuffer(framebuffer){var gl=this.gl;var fbo=new GLFramebuffer(gl.createFramebuffer());fbo.multisample=this.detectSamples(framebuffer.multisample);framebuffer.glFramebuffers[this.CONTEXT_UID]=fbo;this.managedFramebuffers.push(framebuffer);framebuffer.disposeRunner.add(this);return fbo;}},{key:"resizeFramebuffer",value:function resizeFramebuffer(framebuffer){var gl=this.gl;var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(fbo.stencil){gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil);if(fbo.msaaBuffer){gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,framebuffer.width,framebuffer.height);}else{gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height);}}var colorTextures=framebuffer.colorTextures;var count=colorTextures.length;if(!gl.drawBuffers){count=Math.min(count,1);}for(var i=0;i<count;i++){var texture=colorTextures[i];var parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0);if(i===0&&fbo.msaaBuffer){gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer);gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,parentTexture._glTextures[this.CONTEXT_UID].internalFormat,framebuffer.width,framebuffer.height);}}if(framebuffer.depthTexture&&this.writeDepthTexture){this.renderer.texture.bind(framebuffer.depthTexture,0);}}},{key:"updateFramebuffer",value:function updateFramebuffer(framebuffer,mipLevel){var gl=this.gl;var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];var colorTextures=framebuffer.colorTextures;var count=colorTextures.length;if(!gl.drawBuffers){count=Math.min(count,1);}if(fbo.multisample>1&&this.canMultisampleFramebuffer(framebuffer)){fbo.msaaBuffer=fbo.msaaBuffer||gl.createRenderbuffer();}else if(fbo.msaaBuffer){gl.deleteRenderbuffer(fbo.msaaBuffer);fbo.msaaBuffer=null;if(fbo.blitFramebuffer){fbo.blitFramebuffer.dispose();fbo.blitFramebuffer=null;}}var activeTextures=[];for(var i=0;i<count;i++){var texture=colorTextures[i];var parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0);if(i===0&&fbo.msaaBuffer){gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer);gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,parentTexture._glTextures[this.CONTEXT_UID].internalFormat,framebuffer.width,framebuffer.height);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,fbo.msaaBuffer);}else{gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+i,texture.target,parentTexture._glTextures[this.CONTEXT_UID].texture,mipLevel);activeTextures.push(gl.COLOR_ATTACHMENT0+i);}}if(activeTextures.length>1){gl.drawBuffers(activeTextures);}if(framebuffer.depthTexture){var writeDepthTexture=this.writeDepthTexture;if(writeDepthTexture){var depthTexture=framebuffer.depthTexture;this.renderer.texture.bind(depthTexture,0);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,depthTexture._glTextures[this.CONTEXT_UID].texture,mipLevel);}}if((framebuffer.stencil||framebuffer.depth)&&!(framebuffer.depthTexture&&this.writeDepthTexture)){fbo.stencil=fbo.stencil||gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil);if(fbo.msaaBuffer){gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,framebuffer.width,framebuffer.height);}else{gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height);}gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,fbo.stencil);}else if(fbo.stencil){gl.deleteRenderbuffer(fbo.stencil);fbo.stencil=null;}}},{key:"canMultisampleFramebuffer",value:function canMultisampleFramebuffer(framebuffer){return this.renderer.context.webGLVersion!==1&&framebuffer.colorTextures.length<=1&&!framebuffer.depthTexture;}},{key:"detectSamples",value:function detectSamples(samples){var msaaSamples=this.msaaSamples;var res=MSAA_QUALITY.NONE;if(samples<=1||msaaSamples===null){return res;}for(var i=0;i<msaaSamples.length;i++){if(msaaSamples[i]<=samples){res=msaaSamples[i];break;}}if(res===1){res=MSAA_QUALITY.NONE;}return res;}},{key:"blit",value:function blit(framebuffer,sourcePixels,destPixels){var current=this.current,renderer=this.renderer,gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;if(renderer.context.webGLVersion!==2){return;}if(!current){return;}var fbo=current.glFramebuffers[CONTEXT_UID];if(!fbo){return;}if(!framebuffer){if(!fbo.msaaBuffer){return;}var colorTexture=current.colorTextures[0];if(!colorTexture){return;}if(!fbo.blitFramebuffer){fbo.blitFramebuffer=new Framebuffer(current.width,current.height);fbo.blitFramebuffer.addColorTexture(0,colorTexture);}framebuffer=fbo.blitFramebuffer;if(framebuffer.colorTextures[0]!==colorTexture){framebuffer.colorTextures[0]=colorTexture;framebuffer.dirtyId++;framebuffer.dirtyFormat++;}if(framebuffer.width!==current.width||framebuffer.height!==current.height){framebuffer.width=current.width;framebuffer.height=current.height;framebuffer.dirtyId++;framebuffer.dirtySize++;}}if(!sourcePixels){sourcePixels=tempRectangle;sourcePixels.width=current.width;sourcePixels.height=current.height;}if(!destPixels){destPixels=sourcePixels;}var sameSize=sourcePixels.width===destPixels.width&&sourcePixels.height===destPixels.height;this.bind(framebuffer);gl.bindFramebuffer(gl.READ_FRAMEBUFFER,fbo.framebuffer);gl.blitFramebuffer(sourcePixels.left,sourcePixels.top,sourcePixels.right,sourcePixels.bottom,destPixels.left,destPixels.top,destPixels.right,destPixels.bottom,gl.COLOR_BUFFER_BIT,sameSize?gl.NEAREST:gl.LINEAR);}},{key:"disposeFramebuffer",value:function disposeFramebuffer(framebuffer,contextLost){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];var gl=this.gl;if(!fbo){return;}delete framebuffer.glFramebuffers[this.CONTEXT_UID];var index=this.managedFramebuffers.indexOf(framebuffer);if(index>=0){this.managedFramebuffers.splice(index,1);}framebuffer.disposeRunner.remove(this);if(!contextLost){gl.deleteFramebuffer(fbo.framebuffer);if(fbo.msaaBuffer){gl.deleteRenderbuffer(fbo.msaaBuffer);}if(fbo.stencil){gl.deleteRenderbuffer(fbo.stencil);}}if(fbo.blitFramebuffer){fbo.blitFramebuffer.dispose();}}},{key:"disposeAll",value:function disposeAll(contextLost){var list=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<list.length;i++){this.disposeFramebuffer(list[i],contextLost);}}},{key:"forceStencil",value:function forceStencil(){var framebuffer=this.current;if(!framebuffer){return;}var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(!fbo||fbo.stencil){return;}framebuffer.stencil=true;var w=framebuffer.width;var h=framebuffer.height;var gl=this.gl;var stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil);if(fbo.msaaBuffer){gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,w,h);}else{gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,w,h);}fbo.stencil=stencil;gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,stencil);}},{key:"reset",value:function reset(){this.current=this.unknownFramebuffer;this.viewport=new Rectangle();}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);}();FramebufferSystem.extension={type:ExtensionType.RendererSystem,name:"framebuffer"};extensions$1.add(FramebufferSystem);var byteSizeMap={5126:4,5123:2,5121:1};var GeometrySystem=/*#__PURE__*/function(){function GeometrySystem(renderer){_classCallCheck(this,GeometrySystem);this.renderer=renderer;this._activeGeometry=null;this._activeVao=null;this.hasVao=true;this.hasInstance=true;this.canUseUInt32ElementIndex=false;this.managedGeometries={};}return _createClass(GeometrySystem,[{key:"contextChange",value:function contextChange(){this.disposeAll(true);var gl=this.gl=this.renderer.gl;var context=this.renderer.context;this.CONTEXT_UID=this.renderer.CONTEXT_UID;if(context.webGLVersion!==2){var nativeVaoExtension=this.renderer.context.extensions.vertexArrayObject;if(settings.PREFER_ENV===ENV.WEBGL_LEGACY){nativeVaoExtension=null;}if(nativeVaoExtension){gl.createVertexArray=function(){return nativeVaoExtension.createVertexArrayOES();};gl.bindVertexArray=function(vao){return nativeVaoExtension.bindVertexArrayOES(vao);};gl.deleteVertexArray=function(vao){return nativeVaoExtension.deleteVertexArrayOES(vao);};}else{this.hasVao=false;gl.createVertexArray=function(){return null;};gl.bindVertexArray=function(){return null;};gl.deleteVertexArray=function(){return null;};}}if(context.webGLVersion!==2){var instanceExt=gl.getExtension("ANGLE_instanced_arrays");if(instanceExt){gl.vertexAttribDivisor=function(a,b){return instanceExt.vertexAttribDivisorANGLE(a,b);};gl.drawElementsInstanced=function(a,b,c,d,e){return instanceExt.drawElementsInstancedANGLE(a,b,c,d,e);};gl.drawArraysInstanced=function(a,b,c,d){return instanceExt.drawArraysInstancedANGLE(a,b,c,d);};}else{this.hasInstance=false;}}this.canUseUInt32ElementIndex=context.webGLVersion===2||!!context.extensions.uint32ElementIndex;}},{key:"bind",value:function bind(geometry,shader){shader=shader||this.renderer.shader.shader;var gl=this.gl;var vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID];var incRefCount=false;if(!vaos){this.managedGeometries[geometry.id]=geometry;geometry.disposeRunner.add(this);geometry.glVertexArrayObjects[this.CONTEXT_UID]=vaos={};incRefCount=true;}var vao=vaos[shader.program.id]||this.initGeometryVao(geometry,shader,incRefCount);this._activeGeometry=geometry;if(this._activeVao!==vao){this._activeVao=vao;if(this.hasVao){gl.bindVertexArray(vao);}else{this.activateVao(geometry,shader.program);}}this.updateBuffers();}},{key:"reset",value:function reset(){this.unbind();}},{key:"updateBuffers",value:function updateBuffers(){var geometry=this._activeGeometry;var bufferSystem=this.renderer.buffer;for(var i=0;i<geometry.buffers.length;i++){var buffer=geometry.buffers[i];bufferSystem.update(buffer);}}},{key:"checkCompatibility",value:function checkCompatibility(geometry,program){var geometryAttributes=geometry.attributes;var shaderAttributes=program.attributeData;for(var j in shaderAttributes){if(!geometryAttributes[j]){throw new Error("shader and geometry incompatible, geometry missing the \"".concat(j,"\" attribute"));}}}},{key:"getSignature",value:function getSignature(geometry,program){var attribs=geometry.attributes;var shaderAttributes=program.attributeData;var strings=["g",geometry.id];for(var i in attribs){if(shaderAttributes[i]){strings.push(i,shaderAttributes[i].location);}}return strings.join("-");}},{key:"initGeometryVao",value:function initGeometryVao(geometry,shader){var incRefCount=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var gl=this.gl;var CONTEXT_UID=this.CONTEXT_UID;var bufferSystem=this.renderer.buffer;var program=shader.program;if(!program.glPrograms[CONTEXT_UID]){this.renderer.shader.generateProgram(shader);}this.checkCompatibility(geometry,program);var signature=this.getSignature(geometry,program);var vaoObjectHash=geometry.glVertexArrayObjects[this.CONTEXT_UID];var vao=vaoObjectHash[signature];if(vao){vaoObjectHash[program.id]=vao;return vao;}var buffers=geometry.buffers;var attributes=geometry.attributes;var tempStride={};var tempStart={};for(var j in buffers){tempStride[j]=0;tempStart[j]=0;}for(var _j3 in attributes){if(!attributes[_j3].size&&program.attributeData[_j3]){attributes[_j3].size=program.attributeData[_j3].size;}else if(!attributes[_j3].size){console.warn("PIXI Geometry attribute '".concat(_j3,"' size cannot be determined (likely the bound shader does not have the attribute)"));}tempStride[attributes[_j3].buffer]+=attributes[_j3].size*byteSizeMap[attributes[_j3].type];}for(var _j4 in attributes){var attribute=attributes[_j4];var attribSize=attribute.size;if(attribute.stride===void 0){if(tempStride[attribute.buffer]===attribSize*byteSizeMap[attribute.type]){attribute.stride=0;}else{attribute.stride=tempStride[attribute.buffer];}}if(attribute.start===void 0){attribute.start=tempStart[attribute.buffer];tempStart[attribute.buffer]+=attribSize*byteSizeMap[attribute.type];}}vao=gl.createVertexArray();gl.bindVertexArray(vao);for(var i=0;i<buffers.length;i++){var buffer=buffers[i];bufferSystem.bind(buffer);if(incRefCount){buffer._glBuffers[CONTEXT_UID].refCount++;}}this.activateVao(geometry,program);vaoObjectHash[program.id]=vao;vaoObjectHash[signature]=vao;gl.bindVertexArray(null);bufferSystem.unbind(BUFFER_TYPE.ARRAY_BUFFER);return vao;}},{key:"disposeGeometry",value:function disposeGeometry(geometry,contextLost){var _this$renderer3;if(!this.managedGeometries[geometry.id]){return;}delete this.managedGeometries[geometry.id];var vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID];var gl=this.gl;var buffers=geometry.buffers;var bufferSystem=(_this$renderer3=this.renderer)===null||_this$renderer3===void 0?void 0:_this$renderer3.buffer;geometry.disposeRunner.remove(this);if(!vaos){return;}if(bufferSystem){for(var i=0;i<buffers.length;i++){var buf=buffers[i]._glBuffers[this.CONTEXT_UID];if(buf){buf.refCount--;if(buf.refCount===0&&!contextLost){bufferSystem.dispose(buffers[i],contextLost);}}}}if(!contextLost){for(var vaoId in vaos){if(vaoId[0]==="g"){var vao=vaos[vaoId];if(this._activeVao===vao){this.unbind();}gl.deleteVertexArray(vao);}}}delete geometry.glVertexArrayObjects[this.CONTEXT_UID];}},{key:"disposeAll",value:function disposeAll(contextLost){var all=Object.keys(this.managedGeometries);for(var i=0;i<all.length;i++){this.disposeGeometry(this.managedGeometries[all[i]],contextLost);}}},{key:"activateVao",value:function activateVao(geometry,program){var gl=this.gl;var CONTEXT_UID=this.CONTEXT_UID;var bufferSystem=this.renderer.buffer;var buffers=geometry.buffers;var attributes=geometry.attributes;if(geometry.indexBuffer){bufferSystem.bind(geometry.indexBuffer);}var lastBuffer=null;for(var j in attributes){var attribute=attributes[j];var buffer=buffers[attribute.buffer];var glBuffer=buffer._glBuffers[CONTEXT_UID];if(program.attributeData[j]){if(lastBuffer!==glBuffer){bufferSystem.bind(buffer);lastBuffer=glBuffer;}var location=program.attributeData[j].location;gl.enableVertexAttribArray(location);gl.vertexAttribPointer(location,attribute.size,attribute.type||gl.FLOAT,attribute.normalized,attribute.stride,attribute.start);if(attribute.instance){if(this.hasInstance){gl.vertexAttribDivisor(location,attribute.divisor);}else{throw new Error("geometry error, GPU Instancing is not supported on this device");}}}}}},{key:"draw",value:function draw(type,size,start,instanceCount){var gl=this.gl;var geometry=this._activeGeometry;if(geometry.indexBuffer){var byteSize=geometry.indexBuffer.data.BYTES_PER_ELEMENT;var glType=byteSize===2?gl.UNSIGNED_SHORT:gl.UNSIGNED_INT;if(byteSize===2||byteSize===4&&this.canUseUInt32ElementIndex){if(geometry.instanced){gl.drawElementsInstanced(type,size||geometry.indexBuffer.data.length,glType,(start||0)*byteSize,instanceCount||1);}else{gl.drawElements(type,size||geometry.indexBuffer.data.length,glType,(start||0)*byteSize);}}else{console.warn("unsupported index buffer type: uint32");}}else if(geometry.instanced){gl.drawArraysInstanced(type,start,size||geometry.getSize(),instanceCount||1);}else{gl.drawArrays(type,start,size||geometry.getSize());}return this;}},{key:"unbind",value:function unbind(){this.gl.bindVertexArray(null);this._activeVao=null;this._activeGeometry=null;}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);}();GeometrySystem.extension={type:ExtensionType.RendererSystem,name:"geometry"};extensions$1.add(GeometrySystem);var tempMat$1=new Matrix();var TextureMatrix=/*#__PURE__*/function(){function TextureMatrix(texture,clampMargin){_classCallCheck(this,TextureMatrix);this._texture=texture;this.mapCoord=new Matrix();this.uClampFrame=new Float32Array(4);this.uClampOffset=new Float32Array(2);this._textureID=-1;this._updateID=0;this.clampOffset=0;this.clampMargin=typeof clampMargin==="undefined"?0.5:clampMargin;this.isSimple=false;}return _createClass(TextureMatrix,[{key:"texture",get:function get(){return this._texture;},set:function set(value){this._texture=value;this._textureID=-1;}},{key:"multiplyUvs",value:function multiplyUvs(uvs,out){if(out===void 0){out=uvs;}var mat=this.mapCoord;for(var i=0;i<uvs.length;i+=2){var x=uvs[i];var y=uvs[i+1];out[i]=x*mat.a+y*mat.c+mat.tx;out[i+1]=x*mat.b+y*mat.d+mat.ty;}return out;}},{key:"update",value:function update(forceUpdate){var tex=this._texture;if(!tex||!tex.valid){return false;}if(!forceUpdate&&this._textureID===tex._updateID){return false;}this._textureID=tex._updateID;this._updateID++;var uvs=tex._uvs;this.mapCoord.set(uvs.x1-uvs.x0,uvs.y1-uvs.y0,uvs.x3-uvs.x0,uvs.y3-uvs.y0,uvs.x0,uvs.y0);var orig=tex.orig;var trim=tex.trim;if(trim){tempMat$1.set(orig.width/trim.width,0,0,orig.height/trim.height,-trim.x/trim.width,-trim.y/trim.height);this.mapCoord.append(tempMat$1);}var texBase=tex.baseTexture;var frame=this.uClampFrame;var margin=this.clampMargin/texBase.resolution;var offset=this.clampOffset;frame[0]=(tex._frame.x+margin+offset)/texBase.width;frame[1]=(tex._frame.y+margin+offset)/texBase.height;frame[2]=(tex._frame.x+tex._frame.width-margin+offset)/texBase.width;frame[3]=(tex._frame.y+tex._frame.height-margin+offset)/texBase.height;this.uClampOffset[0]=offset/texBase.realWidth;this.uClampOffset[1]=offset/texBase.realHeight;this.isSimple=tex._frame.width===texBase.width&&tex._frame.height===texBase.height&&tex.rotate===0;return true;}}]);}();var fragment$7="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n";var vertex$4="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n";var SpriteMaskFilter=/*#__PURE__*/function(_Filter2){function SpriteMaskFilter(vertexSrc,fragmentSrc,uniforms){var _this18;_classCallCheck(this,SpriteMaskFilter);var sprite=null;if(typeof vertexSrc!=="string"&&fragmentSrc===void 0&&uniforms===void 0){sprite=vertexSrc;vertexSrc=void 0;fragmentSrc=void 0;uniforms=void 0;}_this18=_callSuper(this,SpriteMaskFilter,[vertexSrc||vertex$4,fragmentSrc||fragment$7,uniforms]);_this18.maskSprite=sprite;_this18.maskMatrix=new Matrix();return _this18;}_inherits(SpriteMaskFilter,_Filter2);return _createClass(SpriteMaskFilter,[{key:"maskSprite",get:function get(){return this._maskSprite;},set:function set(value){this._maskSprite=value;if(this._maskSprite){this._maskSprite.renderable=false;}}},{key:"apply",value:function apply(filterManager,input,output,clearMode){var maskSprite=this._maskSprite;var tex=maskSprite._texture;if(!tex.valid){return;}if(!tex.uvMatrix){tex.uvMatrix=new TextureMatrix(tex,0);}tex.uvMatrix.update();this.uniforms.npmAlpha=tex.baseTexture.alphaMode?0:1;this.uniforms.mask=tex;this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.uvMatrix.mapCoord);this.uniforms.alpha=maskSprite.worldAlpha;this.uniforms.maskClamp=tex.uvMatrix.uClampFrame;filterManager.applyFilter(this,input,output,clearMode);}}]);}(Filter);var MaskData=/*#__PURE__*/function(){function MaskData(){var maskObject=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,MaskData);this.type=MASK_TYPES.NONE;this.autoDetect=true;this.maskObject=maskObject||null;this.pooled=false;this.isMaskData=true;this.resolution=null;this.multisample=Filter.defaultMultisample;this.enabled=true;this.colorMask=15;this._filters=null;this._stencilCounter=0;this._scissorCounter=0;this._scissorRect=null;this._scissorRectLocal=null;this._colorMask=15;this._target=null;}return _createClass(MaskData,[{key:"filter",get:function get(){return this._filters?this._filters[0]:null;},set:function set(value){if(value){if(this._filters){this._filters[0]=value;}else{this._filters=[value];}}else{this._filters=null;}}},{key:"reset",value:function reset(){if(this.pooled){this.maskObject=null;this.type=MASK_TYPES.NONE;this.autoDetect=true;}this._target=null;this._scissorRectLocal=null;}},{key:"copyCountersOrReset",value:function copyCountersOrReset(maskAbove){if(maskAbove){this._stencilCounter=maskAbove._stencilCounter;this._scissorCounter=maskAbove._scissorCounter;this._scissorRect=maskAbove._scissorRect;}else{this._stencilCounter=0;this._scissorCounter=0;this._scissorRect=null;}}}]);}();var MaskSystem=/*#__PURE__*/function(){function MaskSystem(renderer){_classCallCheck(this,MaskSystem);this.renderer=renderer;this.enableScissor=true;this.alphaMaskPool=[];this.maskDataPool=[];this.maskStack=[];this.alphaMaskIndex=0;}return _createClass(MaskSystem,[{key:"setMaskStack",value:function setMaskStack(maskStack){this.maskStack=maskStack;this.renderer.scissor.setMaskStack(maskStack);this.renderer.stencil.setMaskStack(maskStack);}},{key:"push",value:function push(target,maskDataOrTarget){var maskData=maskDataOrTarget;if(!maskData.isMaskData){var d=this.maskDataPool.pop()||new MaskData();d.pooled=true;d.maskObject=maskDataOrTarget;maskData=d;}var maskAbove=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;maskData.copyCountersOrReset(maskAbove);maskData._colorMask=maskAbove?maskAbove._colorMask:15;if(maskData.autoDetect){this.detect(maskData);}maskData._target=target;if(maskData.type!==MASK_TYPES.SPRITE){this.maskStack.push(maskData);}if(maskData.enabled){switch(maskData.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.push(maskData);break;case MASK_TYPES.STENCIL:this.renderer.stencil.push(maskData);break;case MASK_TYPES.SPRITE:maskData.copyCountersOrReset(null);this.pushSpriteMask(maskData);break;case MASK_TYPES.COLOR:this.pushColorMask(maskData);break;}}if(maskData.type===MASK_TYPES.SPRITE){this.maskStack.push(maskData);}}},{key:"pop",value:function pop(target){var maskData=this.maskStack.pop();if(!maskData||maskData._target!==target){return;}if(maskData.enabled){switch(maskData.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.pop(maskData);break;case MASK_TYPES.STENCIL:this.renderer.stencil.pop(maskData.maskObject);break;case MASK_TYPES.SPRITE:this.popSpriteMask(maskData);break;case MASK_TYPES.COLOR:this.popColorMask(maskData);break;}}maskData.reset();if(maskData.pooled){this.maskDataPool.push(maskData);}if(this.maskStack.length!==0){var maskCurrent=this.maskStack[this.maskStack.length-1];if(maskCurrent.type===MASK_TYPES.SPRITE&&maskCurrent._filters){maskCurrent._filters[0].maskSprite=maskCurrent.maskObject;}}}},{key:"detect",value:function detect(maskData){var maskObject=maskData.maskObject;if(!maskObject){maskData.type=MASK_TYPES.COLOR;}else if(maskObject.isSprite){maskData.type=MASK_TYPES.SPRITE;}else if(this.enableScissor&&this.renderer.scissor.testScissor(maskData)){maskData.type=MASK_TYPES.SCISSOR;}else{maskData.type=MASK_TYPES.STENCIL;}}},{key:"pushSpriteMask",value:function pushSpriteMask(maskData){var maskObject=maskData.maskObject;var target=maskData._target;var alphaMaskFilter=maskData._filters;if(!alphaMaskFilter){alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex];if(!alphaMaskFilter){alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter()];}}var renderer=this.renderer;var renderTextureSystem=renderer.renderTexture;var resolution;var multisample;if(renderTextureSystem.current){var _maskData$multisample;var renderTexture=renderTextureSystem.current;resolution=maskData.resolution||renderTexture.resolution;multisample=(_maskData$multisample=maskData.multisample)!==null&&_maskData$multisample!==void 0?_maskData$multisample:renderTexture.multisample;}else{var _maskData$multisample2;resolution=maskData.resolution||renderer.resolution;multisample=(_maskData$multisample2=maskData.multisample)!==null&&_maskData$multisample2!==void 0?_maskData$multisample2:renderer.multisample;}alphaMaskFilter[0].resolution=resolution;alphaMaskFilter[0].multisample=multisample;alphaMaskFilter[0].maskSprite=maskObject;var stashFilterArea=target.filterArea;target.filterArea=maskObject.getBounds(true);renderer.filter.push(target,alphaMaskFilter);target.filterArea=stashFilterArea;if(!maskData._filters){this.alphaMaskIndex++;}}},{key:"popSpriteMask",value:function popSpriteMask(maskData){this.renderer.filter.pop();if(maskData._filters){maskData._filters[0].maskSprite=null;}else{this.alphaMaskIndex--;this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null;}}},{key:"pushColorMask",value:function pushColorMask(maskData){var currColorMask=maskData._colorMask;var nextColorMask=maskData._colorMask=currColorMask&maskData.colorMask;if(nextColorMask!==currColorMask){this.renderer.gl.colorMask((nextColorMask&1)!==0,(nextColorMask&2)!==0,(nextColorMask&4)!==0,(nextColorMask&8)!==0);}}},{key:"popColorMask",value:function popColorMask(maskData){var currColorMask=maskData._colorMask;var nextColorMask=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;if(nextColorMask!==currColorMask){this.renderer.gl.colorMask((nextColorMask&1)!==0,(nextColorMask&2)!==0,(nextColorMask&4)!==0,(nextColorMask&8)!==0);}}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);}();MaskSystem.extension={type:ExtensionType.RendererSystem,name:"mask"};extensions$1.add(MaskSystem);var AbstractMaskSystem=/*#__PURE__*/function(){function AbstractMaskSystem(renderer){_classCallCheck(this,AbstractMaskSystem);this.renderer=renderer;this.maskStack=[];this.glConst=0;}return _createClass(AbstractMaskSystem,[{key:"getStackLength",value:function getStackLength(){return this.maskStack.length;}},{key:"setMaskStack",value:function setMaskStack(maskStack){var gl=this.renderer.gl;var curStackLen=this.getStackLength();this.maskStack=maskStack;var newStackLen=this.getStackLength();if(newStackLen!==curStackLen){if(newStackLen===0){gl.disable(this.glConst);}else{gl.enable(this.glConst);this._useCurrent();}}}},{key:"_useCurrent",value:function _useCurrent(){}},{key:"destroy",value:function destroy(){this.renderer=null;this.maskStack=null;}}]);}();var tempMatrix$1=new Matrix();var rectPool=[];var _ScissorSystem=/*#__PURE__*/function(_AbstractMaskSystem){function _ScissorSystem(renderer){var _this19;_classCallCheck(this,_ScissorSystem);_this19=_callSuper(this,_ScissorSystem,[renderer]);_this19.glConst=settings.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST;return _this19;}_inherits(_ScissorSystem,_AbstractMaskSystem);return _createClass(_ScissorSystem,[{key:"getStackLength",value:function getStackLength(){var maskData=this.maskStack[this.maskStack.length-1];if(maskData){return maskData._scissorCounter;}return 0;}},{key:"calcScissorRect",value:function calcScissorRect(maskData){var _rectPool$pop;if(maskData._scissorRectLocal){return;}var prevData=maskData._scissorRect;var maskObject=maskData.maskObject;var renderer=this.renderer;var renderTextureSystem=renderer.renderTexture;var rect=maskObject.getBounds(true,(_rectPool$pop=rectPool.pop())!==null&&_rectPool$pop!==void 0?_rectPool$pop:new Rectangle());this.roundFrameToPixels(rect,renderTextureSystem.current?renderTextureSystem.current.resolution:renderer.resolution,renderTextureSystem.sourceFrame,renderTextureSystem.destinationFrame,renderer.projection.transform);if(prevData){rect.fit(prevData);}maskData._scissorRectLocal=rect;}},{key:"testScissor",value:function testScissor(maskData){var maskObject=maskData.maskObject;if(!maskObject.isFastRect||!maskObject.isFastRect()){return false;}if(_ScissorSystem.isMatrixRotated(maskObject.worldTransform)){return false;}if(_ScissorSystem.isMatrixRotated(this.renderer.projection.transform)){return false;}this.calcScissorRect(maskData);var rect=maskData._scissorRectLocal;return rect.width>0&&rect.height>0;}},{key:"roundFrameToPixels",value:function roundFrameToPixels(frame,resolution,bindingSourceFrame,bindingDestinationFrame,transform){if(_ScissorSystem.isMatrixRotated(transform)){return;}transform=transform?tempMatrix$1.copyFrom(transform):tempMatrix$1.identity();transform.translate(-bindingSourceFrame.x,-bindingSourceFrame.y).scale(bindingDestinationFrame.width/bindingSourceFrame.width,bindingDestinationFrame.height/bindingSourceFrame.height).translate(bindingDestinationFrame.x,bindingDestinationFrame.y);this.renderer.filter.transformAABB(transform,frame);frame.fit(bindingDestinationFrame);frame.x=Math.round(frame.x*resolution);frame.y=Math.round(frame.y*resolution);frame.width=Math.round(frame.width*resolution);frame.height=Math.round(frame.height*resolution);}},{key:"push",value:function push(maskData){if(!maskData._scissorRectLocal){this.calcScissorRect(maskData);}var gl=this.renderer.gl;if(!maskData._scissorRect){gl.enable(gl.SCISSOR_TEST);}maskData._scissorCounter++;maskData._scissorRect=maskData._scissorRectLocal;this._useCurrent();}},{key:"pop",value:function pop(maskData){var gl=this.renderer.gl;if(maskData){rectPool.push(maskData._scissorRectLocal);}if(this.getStackLength()>0){this._useCurrent();}else{gl.disable(gl.SCISSOR_TEST);}}},{key:"_useCurrent",value:function _useCurrent(){var rect=this.maskStack[this.maskStack.length-1]._scissorRect;var y;if(this.renderer.renderTexture.current){y=rect.y;}else{y=this.renderer.height-rect.height-rect.y;}this.renderer.gl.scissor(rect.x,y,rect.width,rect.height);}}],[{key:"isMatrixRotated",value:function isMatrixRotated(matrix){if(!matrix){return false;}var a=matrix.a,b=matrix.b,c=matrix.c,d=matrix.d;return(Math.abs(b)>1e-4||Math.abs(c)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(d)>1e-4);}}]);}(AbstractMaskSystem);var ScissorSystem=_ScissorSystem;ScissorSystem.extension={type:ExtensionType.RendererSystem,name:"scissor"};extensions$1.add(ScissorSystem);var StencilSystem=/*#__PURE__*/function(_AbstractMaskSystem2){function StencilSystem(renderer){var _this20;_classCallCheck(this,StencilSystem);_this20=_callSuper(this,StencilSystem,[renderer]);_this20.glConst=settings.ADAPTER.getWebGLRenderingContext().STENCIL_TEST;return _this20;}_inherits(StencilSystem,_AbstractMaskSystem2);return _createClass(StencilSystem,[{key:"getStackLength",value:function getStackLength(){var maskData=this.maskStack[this.maskStack.length-1];if(maskData){return maskData._stencilCounter;}return 0;}},{key:"push",value:function push(maskData){var maskObject=maskData.maskObject;var gl=this.renderer.gl;var prevMaskCount=maskData._stencilCounter;if(prevMaskCount===0){this.renderer.framebuffer.forceStencil();gl.clearStencil(0);gl.clear(gl.STENCIL_BUFFER_BIT);gl.enable(gl.STENCIL_TEST);}maskData._stencilCounter++;var colorMask=maskData._colorMask;if(colorMask!==0){maskData._colorMask=0;gl.colorMask(false,false,false,false);}gl.stencilFunc(gl.EQUAL,prevMaskCount,4294967295);gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);maskObject.renderable=true;maskObject.render(this.renderer);this.renderer.batch.flush();maskObject.renderable=false;if(colorMask!==0){maskData._colorMask=colorMask;gl.colorMask((colorMask&1)!==0,(colorMask&2)!==0,(colorMask&4)!==0,(colorMask&8)!==0);}this._useCurrent();}},{key:"pop",value:function pop(maskObject){var gl=this.renderer.gl;if(this.getStackLength()===0){gl.disable(gl.STENCIL_TEST);}else{var maskData=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;var colorMask=maskData?maskData._colorMask:15;if(colorMask!==0){maskData._colorMask=0;gl.colorMask(false,false,false,false);}gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR);maskObject.renderable=true;maskObject.render(this.renderer);this.renderer.batch.flush();maskObject.renderable=false;if(colorMask!==0){maskData._colorMask=colorMask;gl.colorMask((colorMask&1)!==0,(colorMask&2)!==0,(colorMask&4)!==0,(colorMask&8)!==0);}this._useCurrent();}}},{key:"_useCurrent",value:function _useCurrent(){var gl=this.renderer.gl;gl.stencilFunc(gl.EQUAL,this.getStackLength(),4294967295);gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP);}}]);}(AbstractMaskSystem);StencilSystem.extension={type:ExtensionType.RendererSystem,name:"stencil"};extensions$1.add(StencilSystem);var PluginSystem=/*#__PURE__*/function(){function PluginSystem(renderer){_classCallCheck(this,PluginSystem);this.renderer=renderer;this.plugins={};Object.defineProperties(this.plugins,{extract:{enumerable:false,get:function get(){deprecation("7.0.0","renderer.plugins.extract has moved to renderer.extract");return renderer.extract;}},prepare:{enumerable:false,get:function get(){deprecation("7.0.0","renderer.plugins.prepare has moved to renderer.prepare");return renderer.prepare;}},interaction:{enumerable:false,get:function get(){deprecation("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events");return renderer.events;}}});}return _createClass(PluginSystem,[{key:"init",value:function init(staticMap){for(var o in staticMap){this.plugins[o]=new staticMap[o](this.renderer);}}},{key:"destroy",value:function destroy(){for(var o in this.plugins){this.plugins[o].destroy();this.plugins[o]=null;}}}]);}();PluginSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_plugin"};extensions$1.add(PluginSystem);var ProjectionSystem=/*#__PURE__*/function(){function ProjectionSystem(renderer){_classCallCheck(this,ProjectionSystem);this.renderer=renderer;this.destinationFrame=null;this.sourceFrame=null;this.defaultFrame=null;this.projectionMatrix=new Matrix();this.transform=null;}return _createClass(ProjectionSystem,[{key:"update",value:function update(destinationFrame,sourceFrame,resolution,root){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame;this.sourceFrame=sourceFrame||this.sourceFrame||destinationFrame;this.calculateProjection(this.destinationFrame,this.sourceFrame,resolution,root);if(this.transform){this.projectionMatrix.append(this.transform);}var renderer=this.renderer;renderer.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix;renderer.globalUniforms.update();if(renderer.shader.shader){renderer.shader.syncUniformGroup(renderer.shader.shader.uniforms.globals);}}},{key:"calculateProjection",value:function calculateProjection(_destinationFrame,sourceFrame,_resolution,root){var pm=this.projectionMatrix;var sign=!root?1:-1;pm.identity();pm.a=1/sourceFrame.width*2;pm.d=sign*(1/sourceFrame.height*2);pm.tx=-1-sourceFrame.x*pm.a;pm.ty=-sign-sourceFrame.y*pm.d;}},{key:"setTransform",value:function setTransform(_matrix){}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);}();ProjectionSystem.extension={type:ExtensionType.RendererSystem,name:"projection"};extensions$1.add(ProjectionSystem);var tempTransform=new Transform();var GenerateTextureSystem=/*#__PURE__*/function(){function GenerateTextureSystem(renderer){_classCallCheck(this,GenerateTextureSystem);this.renderer=renderer;this._tempMatrix=new Matrix();}return _createClass(GenerateTextureSystem,[{key:"generateTexture",value:function generateTexture(displayObject,options){var _ref4=options||{},manualRegion=_ref4.region,textureOptions=_objectWithoutProperties(_ref4,_excluded);var region=manualRegion||displayObject.getLocalBounds(null,true);if(region.width===0)region.width=1;if(region.height===0)region.height=1;var renderTexture=RenderTexture.create(_objectSpread({width:region.width,height:region.height},textureOptions));this._tempMatrix.tx=-region.x;this._tempMatrix.ty=-region.y;var transform=displayObject.transform;displayObject.transform=tempTransform;this.renderer.render(displayObject,{renderTexture:renderTexture,transform:this._tempMatrix,skipUpdateTransform:!!displayObject.parent,blit:true});displayObject.transform=transform;return renderTexture;}},{key:"destroy",value:function destroy(){}}]);}();GenerateTextureSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"textureGenerator"};extensions$1.add(GenerateTextureSystem);var tempRect=new Rectangle();var tempRect2=new Rectangle();var RenderTextureSystem=/*#__PURE__*/function(){function RenderTextureSystem(renderer){_classCallCheck(this,RenderTextureSystem);this.renderer=renderer;this.defaultMaskStack=[];this.current=null;this.sourceFrame=new Rectangle();this.destinationFrame=new Rectangle();this.viewportFrame=new Rectangle();}return _createClass(RenderTextureSystem,[{key:"bind",value:function bind(){var renderTexture=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var sourceFrame=arguments.length>1?arguments[1]:undefined;var destinationFrame=arguments.length>2?arguments[2]:undefined;var renderer=this.renderer;this.current=renderTexture;var baseTexture;var framebuffer;var resolution;if(renderTexture){baseTexture=renderTexture.baseTexture;resolution=baseTexture.resolution;if(!sourceFrame){tempRect.width=renderTexture.frame.width;tempRect.height=renderTexture.frame.height;sourceFrame=tempRect;}if(!destinationFrame){tempRect2.x=renderTexture.frame.x;tempRect2.y=renderTexture.frame.y;tempRect2.width=sourceFrame.width;tempRect2.height=sourceFrame.height;destinationFrame=tempRect2;}framebuffer=baseTexture.framebuffer;}else{resolution=renderer.resolution;if(!sourceFrame){tempRect.width=renderer._view.screen.width;tempRect.height=renderer._view.screen.height;sourceFrame=tempRect;}if(!destinationFrame){destinationFrame=tempRect;destinationFrame.width=sourceFrame.width;destinationFrame.height=sourceFrame.height;}}var viewportFrame=this.viewportFrame;viewportFrame.x=destinationFrame.x*resolution;viewportFrame.y=destinationFrame.y*resolution;viewportFrame.width=destinationFrame.width*resolution;viewportFrame.height=destinationFrame.height*resolution;if(!renderTexture){viewportFrame.y=renderer.view.height-(viewportFrame.y+viewportFrame.height);}viewportFrame.ceil();this.renderer.framebuffer.bind(framebuffer,viewportFrame);this.renderer.projection.update(destinationFrame,sourceFrame,resolution,!framebuffer);if(renderTexture){this.renderer.mask.setMaskStack(baseTexture.maskStack);}else{this.renderer.mask.setMaskStack(this.defaultMaskStack);}this.sourceFrame.copyFrom(sourceFrame);this.destinationFrame.copyFrom(destinationFrame);}},{key:"clear",value:function clear(clearColor,mask){if(this.current){clearColor=clearColor||this.current.baseTexture.clearColor;}else{clearColor=clearColor||this.renderer.background.colorRgba;}var destinationFrame=this.destinationFrame;var baseFrame=this.current?this.current.baseTexture:this.renderer._view.screen;var clearMask=destinationFrame.width!==baseFrame.width||destinationFrame.height!==baseFrame.height;if(clearMask){var _this$viewportFrame=this.viewportFrame,x=_this$viewportFrame.x,y=_this$viewportFrame.y,width=_this$viewportFrame.width,height=_this$viewportFrame.height;x=Math.round(x);y=Math.round(y);width=Math.round(width);height=Math.round(height);this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);this.renderer.gl.scissor(x,y,width,height);}this.renderer.framebuffer.clear(clearColor[0],clearColor[1],clearColor[2],clearColor[3],mask);if(clearMask){this.renderer.scissor.pop();}}},{key:"resize",value:function resize(){this.bind(null);}},{key:"reset",value:function reset(){this.bind(null);}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);}();RenderTextureSystem.extension={type:ExtensionType.RendererSystem,name:"renderTexture"};extensions$1.add(RenderTextureSystem);var IGLUniformData=/*#__PURE__*/_createClass(function IGLUniformData(){_classCallCheck(this,IGLUniformData);});var GLProgram=/*#__PURE__*/function(){function GLProgram(program,uniformData){_classCallCheck(this,GLProgram);this.program=program;this.uniformData=uniformData;this.uniformGroups={};this.uniformDirtyGroups={};this.uniformBufferBindings={};}return _createClass(GLProgram,[{key:"destroy",value:function destroy(){this.uniformData=null;this.uniformGroups=null;this.uniformDirtyGroups=null;this.uniformBufferBindings=null;this.program=null;}}]);}();function getAttributeData(program,gl){var attributes={};var totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);for(var i=0;i<totalAttributes;i++){var attribData=gl.getActiveAttrib(program,i);if(attribData.name.startsWith("gl_")){continue;}var _type5=mapType(gl,attribData.type);var data={type:_type5,name:attribData.name,size:mapSize(_type5),location:gl.getAttribLocation(program,attribData.name)};attributes[attribData.name]=data;}return attributes;}function getUniformData(program,gl){var uniforms={};var totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var i=0;i<totalUniforms;i++){var uniformData=gl.getActiveUniform(program,i);var name=uniformData.name.replace(/\[.*?\]$/,"");var _isArray=!!uniformData.name.match(/\[.*?\]$/);var _type6=mapType(gl,uniformData.type);uniforms[name]={name:name,index:i,type:_type6,size:uniformData.size,isArray:_isArray,value:defaultValue(_type6,uniformData.size)};}return uniforms;}function _generateProgram(gl,program){var _program$extra;var glVertShader=compileShader(gl,gl.VERTEX_SHADER,program.vertexSrc);var glFragShader=compileShader(gl,gl.FRAGMENT_SHADER,program.fragmentSrc);var webGLProgram=gl.createProgram();gl.attachShader(webGLProgram,glVertShader);gl.attachShader(webGLProgram,glFragShader);var transformFeedbackVaryings=(_program$extra=program.extra)===null||_program$extra===void 0?void 0:_program$extra.transformFeedbackVaryings;if(transformFeedbackVaryings){if(typeof gl.transformFeedbackVaryings!=="function"){console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given.");}else{gl.transformFeedbackVaryings(webGLProgram,transformFeedbackVaryings.names,transformFeedbackVaryings.bufferMode==="separate"?gl.SEPARATE_ATTRIBS:gl.INTERLEAVED_ATTRIBS);}}gl.linkProgram(webGLProgram);if(!gl.getProgramParameter(webGLProgram,gl.LINK_STATUS)){logProgramError(gl,webGLProgram,glVertShader,glFragShader);}program.attributeData=getAttributeData(webGLProgram,gl);program.uniformData=getUniformData(webGLProgram,gl);if(!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(program.vertexSrc)){var keys=Object.keys(program.attributeData);keys.sort(function(a,b){return a>b?1:-1;});for(var i=0;i<keys.length;i++){program.attributeData[keys[i]].location=i;gl.bindAttribLocation(webGLProgram,i,keys[i]);}gl.linkProgram(webGLProgram);}gl.deleteShader(glVertShader);gl.deleteShader(glFragShader);var uniformData={};for(var _i12 in program.uniformData){var data=program.uniformData[_i12];uniformData[_i12]={location:gl.getUniformLocation(webGLProgram,_i12),value:defaultValue(data.type,data.size)};}var glProgram=new GLProgram(webGLProgram,uniformData);return glProgram;}function uboUpdate(_ud,_uv,_renderer,_syncData,buffer){_renderer.buffer.update(buffer);}var UBO_TO_SINGLE_SETTERS={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "};var GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function createUBOElements(uniformData){var uboElements=uniformData.map(function(data){return{data:data,offset:0,dataLen:0,dirty:0};});var size=0;var chunkSize=0;var offset=0;for(var i=0;i<uboElements.length;i++){var uboElement=uboElements[i];size=GLSL_TO_STD40_SIZE[uboElement.data.type];if(uboElement.data.size>1){size=Math.max(size,16)*uboElement.data.size;}uboElement.dataLen=size;if(chunkSize%size!==0&&chunkSize<16){var lineUpValue=chunkSize%size%16;chunkSize+=lineUpValue;offset+=lineUpValue;}if(chunkSize+size>16){offset=Math.ceil(offset/16)*16;uboElement.offset=offset;offset+=size;chunkSize=size;}else{uboElement.offset=offset;chunkSize+=size;offset+=size;}}offset=Math.ceil(offset/16)*16;return{uboElements:uboElements,size:offset};}function getUBOData(uniforms,uniformData){var usedUniformDatas=[];for(var i in uniforms){if(uniformData[i]){usedUniformDatas.push(uniformData[i]);}}usedUniformDatas.sort(function(a,b){return a.index-b.index;});return usedUniformDatas;}function generateUniformBufferSync(group,uniformData){if(!group.autoManage){return{size:0,syncFunc:uboUpdate};}var usedUniformDatas=getUBOData(group.uniforms,uniformData);var _createUBOElements=createUBOElements(usedUniformDatas),uboElements=_createUBOElements.uboElements,size=_createUBOElements.size;var funcFragments=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(var i=0;i<uboElements.length;i++){var uboElement=uboElements[i];var uniform=group.uniforms[uboElement.data.name];var name=uboElement.data.name;var parsed=false;for(var j=0;j<uniformParsers.length;j++){var uniformParser=uniformParsers[j];if(uniformParser.codeUbo&&uniformParser.test(uboElement.data,uniform)){funcFragments.push("offset = ".concat(uboElement.offset/4,";"),uniformParsers[j].codeUbo(uboElement.data.name,uniform));parsed=true;break;}}if(!parsed){if(uboElement.data.size>1){var size2=mapSize(uboElement.data.type);var rowSize=Math.max(GLSL_TO_STD40_SIZE[uboElement.data.type]/16,1);var elementSize=size2/rowSize;var remainder=(4-elementSize%4)%4;funcFragments.push("\n                cv = ud.".concat(name,".value;\n                v = uv.").concat(name,";\n                offset = ").concat(uboElement.offset/4,";\n\n                t = 0;\n\n                for(var i=0; i < ").concat(uboElement.data.size*rowSize,"; i++)\n                {\n                    for(var j = 0; j < ").concat(elementSize,"; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ").concat(remainder,";\n                }\n\n                "));}else{var template=UBO_TO_SINGLE_SETTERS[uboElement.data.type];funcFragments.push("\n                cv = ud.".concat(name,".value;\n                v = uv.").concat(name,";\n                offset = ").concat(uboElement.offset/4,";\n                ").concat(template,";\n                "));}}}funcFragments.push("\n       renderer.buffer.update(buffer);\n    ");return{size:size,syncFunc:new Function("ud","uv","renderer","syncData","buffer",funcFragments.join("\n"))};}var UID=0;var defaultSyncData={textureCount:0,uboCount:0};var ShaderSystem=/*#__PURE__*/function(){function ShaderSystem(renderer){_classCallCheck(this,ShaderSystem);this.destroyed=false;this.renderer=renderer;this.systemCheck();this.gl=null;this.shader=null;this.program=null;this.cache={};this._uboCache={};this.id=UID++;}return _createClass(ShaderSystem,[{key:"systemCheck",value:function systemCheck(){if(!unsafeEvalSupported()){throw new Error("Current environment does not allow unsafe-eval, please use pixijs/unsafe-eval module to enable support.");}}},{key:"contextChange",value:function contextChange(gl){this.gl=gl;this.reset();}},{key:"bind",value:function bind(shader,dontSync){shader.disposeRunner.add(this);shader.uniforms.globals=this.renderer.globalUniforms;var program=shader.program;var glProgram=program.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(shader);this.shader=shader;if(this.program!==program){this.program=program;this.gl.useProgram(glProgram.program);}if(!dontSync){defaultSyncData.textureCount=0;defaultSyncData.uboCount=0;this.syncUniformGroup(shader.uniformGroup,defaultSyncData);}return glProgram;}},{key:"setUniforms",value:function setUniforms(uniforms){var shader=this.shader.program;var glProgram=shader.glPrograms[this.renderer.CONTEXT_UID];shader.syncUniforms(glProgram.uniformData,uniforms,this.renderer);}},{key:"syncUniformGroup",value:function syncUniformGroup(group,syncData){var glProgram=this.getGlProgram();if(!group.static||group.dirtyId!==glProgram.uniformDirtyGroups[group.id]){glProgram.uniformDirtyGroups[group.id]=group.dirtyId;this.syncUniforms(group,glProgram,syncData);}}},{key:"syncUniforms",value:function syncUniforms(group,glProgram,syncData){var syncFunc=group.syncUniforms[this.shader.program.id]||this.createSyncGroups(group);syncFunc(glProgram.uniformData,group.uniforms,this.renderer,syncData);}},{key:"createSyncGroups",value:function createSyncGroups(group){var id=this.getSignature(group,this.shader.program.uniformData,"u");if(!this.cache[id]){this.cache[id]=generateUniformsSync(group,this.shader.program.uniformData);}group.syncUniforms[this.shader.program.id]=this.cache[id];return group.syncUniforms[this.shader.program.id];}},{key:"syncUniformBufferGroup",value:function syncUniformBufferGroup(group,name){var glProgram=this.getGlProgram();if(!group.static||group.dirtyId!==0||!glProgram.uniformGroups[group.id]){group.dirtyId=0;var syncFunc=glProgram.uniformGroups[group.id]||this.createSyncBufferGroup(group,glProgram,name);group.buffer.update();syncFunc(glProgram.uniformData,group.uniforms,this.renderer,defaultSyncData,group.buffer);}this.renderer.buffer.bindBufferBase(group.buffer,glProgram.uniformBufferBindings[name]);}},{key:"createSyncBufferGroup",value:function createSyncBufferGroup(group,glProgram,name){var gl=this.renderer.gl;this.renderer.buffer.bind(group.buffer);var uniformBlockIndex=this.gl.getUniformBlockIndex(glProgram.program,name);glProgram.uniformBufferBindings[name]=this.shader.uniformBindCount;gl.uniformBlockBinding(glProgram.program,uniformBlockIndex,this.shader.uniformBindCount);this.shader.uniformBindCount++;var id=this.getSignature(group,this.shader.program.uniformData,"ubo");var uboData=this._uboCache[id];if(!uboData){uboData=this._uboCache[id]=generateUniformBufferSync(group,this.shader.program.uniformData);}if(group.autoManage){var data=new Float32Array(uboData.size/4);group.buffer.update(data);}glProgram.uniformGroups[group.id]=uboData.syncFunc;return glProgram.uniformGroups[group.id];}},{key:"getSignature",value:function getSignature(group,uniformData,preFix){var uniforms=group.uniforms;var strings=["".concat(preFix,"-")];for(var i in uniforms){strings.push(i);if(uniformData[i]){strings.push(uniformData[i].type);}}return strings.join("-");}},{key:"getGlProgram",value:function getGlProgram(){if(this.shader){return this.shader.program.glPrograms[this.renderer.CONTEXT_UID];}return null;}},{key:"generateProgram",value:function generateProgram(shader){var gl=this.gl;var program=shader.program;var glProgram=_generateProgram(gl,program);program.glPrograms[this.renderer.CONTEXT_UID]=glProgram;return glProgram;}},{key:"reset",value:function reset(){this.program=null;this.shader=null;}},{key:"disposeShader",value:function disposeShader(shader){if(this.shader===shader){this.shader=null;}}},{key:"destroy",value:function destroy(){this.renderer=null;this.destroyed=true;}}]);}();ShaderSystem.extension={type:ExtensionType.RendererSystem,name:"shader"};extensions$1.add(ShaderSystem);var StartupSystem=/*#__PURE__*/function(){function StartupSystem(renderer){_classCallCheck(this,StartupSystem);this.renderer=renderer;}return _createClass(StartupSystem,[{key:"run",value:function run(options){var renderer=this.renderer;renderer.emitWithCustomOptions(renderer.runners.init,options);if(options.hello){console.log("PixiJS ".concat("7.1.4"," - ",renderer.rendererLogId," - https://pixijs.com"));}renderer.resize(this.renderer.screen.width,this.renderer.screen.height);}},{key:"destroy",value:function destroy(){}}]);}();StartupSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"startup"};extensions$1.add(StartupSystem);function mapWebGLBlendModesToPixi(gl){var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];array[BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.ADD]=[gl.ONE,gl.ONE];array[BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.NONE]=[0,0];array[BLEND_MODES.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.ADD_NPM]=[gl.SRC_ALPHA,gl.ONE,gl.ONE,gl.ONE];array[BLEND_MODES.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.SRC_IN]=[gl.DST_ALPHA,gl.ZERO];array[BLEND_MODES.SRC_OUT]=[gl.ONE_MINUS_DST_ALPHA,gl.ZERO];array[BLEND_MODES.SRC_ATOP]=[gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.DST_OVER]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE];array[BLEND_MODES.DST_IN]=[gl.ZERO,gl.SRC_ALPHA];array[BLEND_MODES.DST_OUT]=[gl.ZERO,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.DST_ATOP]=[gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA];array[BLEND_MODES.XOR]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.SUBTRACT]=[gl.ONE,gl.ONE,gl.ONE,gl.ONE,gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD];return array;}var BLEND=0;var OFFSET=1;var CULLING=2;var DEPTH_TEST=3;var WINDING=4;var DEPTH_MASK=5;var _StateSystem=/*#__PURE__*/function(){function _StateSystem(){_classCallCheck(this,_StateSystem);this.gl=null;this.stateId=0;this.polygonOffset=0;this.blendMode=BLEND_MODES.NONE;this._blendEq=false;this.map=[];this.map[BLEND]=this.setBlend;this.map[OFFSET]=this.setOffset;this.map[CULLING]=this.setCullFace;this.map[DEPTH_TEST]=this.setDepthTest;this.map[WINDING]=this.setFrontFace;this.map[DEPTH_MASK]=this.setDepthMask;this.checks=[];this.defaultState=new State();this.defaultState.blend=true;}return _createClass(_StateSystem,[{key:"contextChange",value:function contextChange(gl){this.gl=gl;this.blendModes=mapWebGLBlendModesToPixi(gl);this.set(this.defaultState);this.reset();}},{key:"set",value:function set(state){state=state||this.defaultState;if(this.stateId!==state.data){var diff=this.stateId^state.data;var i=0;while(diff){if(diff&1){this.map[i].call(this,!!(state.data&1<<i));}diff=diff>>1;i++;}this.stateId=state.data;}for(var _i13=0;_i13<this.checks.length;_i13++){this.checks[_i13](this,state);}}},{key:"forceState",value:function forceState(state){state=state||this.defaultState;for(var i=0;i<this.map.length;i++){this.map[i].call(this,!!(state.data&1<<i));}for(var _i14=0;_i14<this.checks.length;_i14++){this.checks[_i14](this,state);}this.stateId=state.data;}},{key:"setBlend",value:function setBlend(value){this.updateCheck(_StateSystem.checkBlendMode,value);this.gl[value?"enable":"disable"](this.gl.BLEND);}},{key:"setOffset",value:function setOffset(value){this.updateCheck(_StateSystem.checkPolygonOffset,value);this.gl[value?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL);}},{key:"setDepthTest",value:function setDepthTest(value){this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST);}},{key:"setDepthMask",value:function setDepthMask(value){this.gl.depthMask(value);}},{key:"setCullFace",value:function setCullFace(value){this.gl[value?"enable":"disable"](this.gl.CULL_FACE);}},{key:"setFrontFace",value:function setFrontFace(value){this.gl.frontFace(this.gl[value?"CW":"CCW"]);}},{key:"setBlendMode",value:function setBlendMode(value){if(value===this.blendMode){return;}this.blendMode=value;var mode=this.blendModes[value];var gl=this.gl;if(mode.length===2){gl.blendFunc(mode[0],mode[1]);}else{gl.blendFuncSeparate(mode[0],mode[1],mode[2],mode[3]);}if(mode.length===6){this._blendEq=true;gl.blendEquationSeparate(mode[4],mode[5]);}else if(this._blendEq){this._blendEq=false;gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);}}},{key:"setPolygonOffset",value:function setPolygonOffset(value,scale){this.gl.polygonOffset(value,scale);}},{key:"reset",value:function reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,false);this.forceState(this.defaultState);this._blendEq=true;this.blendMode=-1;this.setBlendMode(0);}},{key:"updateCheck",value:function updateCheck(func,value){var index=this.checks.indexOf(func);if(value&&index===-1){this.checks.push(func);}else if(!value&&index!==-1){this.checks.splice(index,1);}}},{key:"destroy",value:function destroy(){this.gl=null;}}],[{key:"checkBlendMode",value:function checkBlendMode(system,state){system.setBlendMode(state.blendMode);}},{key:"checkPolygonOffset",value:function checkPolygonOffset(system,state){system.setPolygonOffset(1,state.polygonOffset);}}]);}();var StateSystem=_StateSystem;StateSystem.extension={type:ExtensionType.RendererSystem,name:"state"};extensions$1.add(StateSystem);var SystemManager=/*#__PURE__*/function(_EventEmitter3){function SystemManager(){var _this21;_classCallCheck(this,SystemManager);_this21=_callSuper(this,SystemManager,arguments);_this21.runners={};_this21._systemsHash={};return _this21;}_inherits(SystemManager,_EventEmitter3);return _createClass(SystemManager,[{key:"setup",value:function setup(config){var _config$priority;this.addRunners.apply(this,_toConsumableArray(config.runners));var priority=((_config$priority=config.priority)!==null&&_config$priority!==void 0?_config$priority:[]).filter(function(key){return config.systems[key];});var orderByPriority=[].concat(_toConsumableArray(priority),_toConsumableArray(Object.keys(config.systems).filter(function(key){return!priority.includes(key);})));var _iterator=_createForOfIteratorHelper(orderByPriority),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var i=_step.value;this.addSystem(config.systems[i],i);}}catch(err){_iterator.e(err);}finally{_iterator.f();}}},{key:"addRunners",value:function addRunners(){var _this22=this;for(var _len4=arguments.length,runnerIds=new Array(_len4),_key4=0;_key4<_len4;_key4++){runnerIds[_key4]=arguments[_key4];}runnerIds.forEach(function(runnerId){_this22.runners[runnerId]=new Runner(runnerId);});}},{key:"addSystem",value:function addSystem(ClassRef,name){var system=new ClassRef(this);if(this[name]){throw new Error("Whoops! The name \"".concat(name,"\" is already in use"));}this[name]=system;this._systemsHash[name]=system;for(var i in this.runners){this.runners[i].add(system);}return this;}},{key:"emitWithCustomOptions",value:function emitWithCustomOptions(runner,options){var _this23=this;var systemHashKeys=Object.keys(this._systemsHash);runner.items.forEach(function(system){var systemName=systemHashKeys.find(function(systemId){return _this23._systemsHash[systemId]===system;});system[runner.name](options[systemName]);});}},{key:"destroy",value:function destroy(){Object.values(this.runners).forEach(function(runner){runner.destroy();});this._systemsHash={};}}]);}(EventEmitter);var _TextureGCSystem=/*#__PURE__*/function(){function _TextureGCSystem(renderer){_classCallCheck(this,_TextureGCSystem);this.renderer=renderer;this.count=0;this.checkCount=0;this.maxIdle=_TextureGCSystem.defaultMaxIdle;this.checkCountMax=_TextureGCSystem.defaultCheckCountMax;this.mode=_TextureGCSystem.defaultMode;}return _createClass(_TextureGCSystem,[{key:"postrender",value:function postrender(){if(!this.renderer.objectRenderer.renderingToScreen){return;}this.count++;if(this.mode===GC_MODES.MANUAL){return;}this.checkCount++;if(this.checkCount>this.checkCountMax){this.checkCount=0;this.run();}}},{key:"run",value:function run(){var tm=this.renderer.texture;var managedTextures=tm.managedTextures;var wasRemoved=false;for(var i=0;i<managedTextures.length;i++){var texture=managedTextures[i];if(!texture.framebuffer&&this.count-texture.touched>this.maxIdle){tm.destroyTexture(texture,true);managedTextures[i]=null;wasRemoved=true;}}if(wasRemoved){var j=0;for(var _i15=0;_i15<managedTextures.length;_i15++){if(managedTextures[_i15]!==null){managedTextures[j++]=managedTextures[_i15];}}managedTextures.length=j;}}},{key:"unload",value:function unload(displayObject){var tm=this.renderer.texture;var texture=displayObject._texture;if(texture&&!texture.framebuffer){tm.destroyTexture(texture);}for(var i=displayObject.children.length-1;i>=0;i--){this.unload(displayObject.children[i]);}}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);}();var TextureGCSystem=_TextureGCSystem;TextureGCSystem.defaultMode=GC_MODES.AUTO;TextureGCSystem.defaultMaxIdle=60*60;TextureGCSystem.defaultCheckCountMax=60*10;TextureGCSystem.extension={type:ExtensionType.RendererSystem,name:"textureGC"};extensions$1.add(TextureGCSystem);var GLTexture=/*#__PURE__*/_createClass(function GLTexture(texture){_classCallCheck(this,GLTexture);this.texture=texture;this.width=-1;this.height=-1;this.dirtyId=-1;this.dirtyStyleId=-1;this.mipmap=false;this.wrapMode=33071;this.type=TYPES.UNSIGNED_BYTE;this.internalFormat=FORMATS.RGBA;this.samplerType=0;});function mapTypeAndFormatToInternalFormat(gl){var table;if("WebGL2RenderingContext"in globalThis&&gl instanceof globalThis.WebGL2RenderingContext){var _TYPES$UNSIGNED_BYTE,_table;table=(_table={},_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_table,TYPES.UNSIGNED_BYTE,(_TYPES$UNSIGNED_BYTE={},_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_TYPES$UNSIGNED_BYTE,FORMATS.RGBA,gl.RGBA8),FORMATS.RGB,gl.RGB8),FORMATS.RG,gl.RG8),FORMATS.RED,gl.R8),FORMATS.RGBA_INTEGER,gl.RGBA8UI),FORMATS.RGB_INTEGER,gl.RGB8UI),FORMATS.RG_INTEGER,gl.RG8UI),FORMATS.RED_INTEGER,gl.R8UI),FORMATS.ALPHA,gl.ALPHA),FORMATS.LUMINANCE,gl.LUMINANCE),_defineProperty(_TYPES$UNSIGNED_BYTE,FORMATS.LUMINANCE_ALPHA,gl.LUMINANCE_ALPHA))),TYPES.BYTE,_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},FORMATS.RGBA,gl.RGBA8_SNORM),FORMATS.RGB,gl.RGB8_SNORM),FORMATS.RG,gl.RG8_SNORM),FORMATS.RED,gl.R8_SNORM),FORMATS.RGBA_INTEGER,gl.RGBA8I),FORMATS.RGB_INTEGER,gl.RGB8I),FORMATS.RG_INTEGER,gl.RG8I),FORMATS.RED_INTEGER,gl.R8I)),TYPES.UNSIGNED_SHORT,_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},FORMATS.RGBA_INTEGER,gl.RGBA16UI),FORMATS.RGB_INTEGER,gl.RGB16UI),FORMATS.RG_INTEGER,gl.RG16UI),FORMATS.RED_INTEGER,gl.R16UI),FORMATS.DEPTH_COMPONENT,gl.DEPTH_COMPONENT16)),TYPES.SHORT,_defineProperty(_defineProperty(_defineProperty(_defineProperty({},FORMATS.RGBA_INTEGER,gl.RGBA16I),FORMATS.RGB_INTEGER,gl.RGB16I),FORMATS.RG_INTEGER,gl.RG16I),FORMATS.RED_INTEGER,gl.R16I)),TYPES.UNSIGNED_INT,_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},FORMATS.RGBA_INTEGER,gl.RGBA32UI),FORMATS.RGB_INTEGER,gl.RGB32UI),FORMATS.RG_INTEGER,gl.RG32UI),FORMATS.RED_INTEGER,gl.R32UI),FORMATS.DEPTH_COMPONENT,gl.DEPTH_COMPONENT24)),TYPES.INT,_defineProperty(_defineProperty(_defineProperty(_defineProperty({},FORMATS.RGBA_INTEGER,gl.RGBA32I),FORMATS.RGB_INTEGER,gl.RGB32I),FORMATS.RG_INTEGER,gl.RG32I),FORMATS.RED_INTEGER,gl.R32I)),TYPES.FLOAT,_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},FORMATS.RGBA,gl.RGBA32F),FORMATS.RGB,gl.RGB32F),FORMATS.RG,gl.RG32F),FORMATS.RED,gl.R32F),FORMATS.DEPTH_COMPONENT,gl.DEPTH_COMPONENT32F)),TYPES.HALF_FLOAT,_defineProperty(_defineProperty(_defineProperty(_defineProperty({},FORMATS.RGBA,gl.RGBA16F),FORMATS.RGB,gl.RGB16F),FORMATS.RG,gl.RG16F),FORMATS.RED,gl.R16F)),TYPES.UNSIGNED_SHORT_5_6_5,_defineProperty({},FORMATS.RGB,gl.RGB565)),TYPES.UNSIGNED_SHORT_4_4_4_4,_defineProperty({},FORMATS.RGBA,gl.RGBA4)),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_table,TYPES.UNSIGNED_SHORT_5_5_5_1,_defineProperty({},FORMATS.RGBA,gl.RGB5_A1)),TYPES.UNSIGNED_INT_2_10_10_10_REV,_defineProperty(_defineProperty({},FORMATS.RGBA,gl.RGB10_A2),FORMATS.RGBA_INTEGER,gl.RGB10_A2UI)),TYPES.UNSIGNED_INT_10F_11F_11F_REV,_defineProperty({},FORMATS.RGB,gl.R11F_G11F_B10F)),TYPES.UNSIGNED_INT_5_9_9_9_REV,_defineProperty({},FORMATS.RGB,gl.RGB9_E5)),TYPES.UNSIGNED_INT_24_8,_defineProperty({},FORMATS.DEPTH_STENCIL,gl.DEPTH24_STENCIL8)),TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV,_defineProperty({},FORMATS.DEPTH_STENCIL,gl.DEPTH32F_STENCIL8)));}else{table=_defineProperty(_defineProperty(_defineProperty(_defineProperty({},TYPES.UNSIGNED_BYTE,_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},FORMATS.RGBA,gl.RGBA),FORMATS.RGB,gl.RGB),FORMATS.ALPHA,gl.ALPHA),FORMATS.LUMINANCE,gl.LUMINANCE),FORMATS.LUMINANCE_ALPHA,gl.LUMINANCE_ALPHA)),TYPES.UNSIGNED_SHORT_5_6_5,_defineProperty({},FORMATS.RGB,gl.RGB)),TYPES.UNSIGNED_SHORT_4_4_4_4,_defineProperty({},FORMATS.RGBA,gl.RGBA)),TYPES.UNSIGNED_SHORT_5_5_5_1,_defineProperty({},FORMATS.RGBA,gl.RGBA));}return table;}var TextureSystem=/*#__PURE__*/function(){function TextureSystem(renderer){_classCallCheck(this,TextureSystem);this.renderer=renderer;this.boundTextures=[];this.currentLocation=-1;this.managedTextures=[];this._unknownBoundTextures=false;this.unknownTexture=new BaseTexture();this.hasIntegerTextures=false;}return _createClass(TextureSystem,[{key:"contextChange",value:function contextChange(){var gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.webGLVersion=this.renderer.context.webGLVersion;this.internalFormats=mapTypeAndFormatToInternalFormat(gl);var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=maxTextures;for(var i=0;i<maxTextures;i++){this.boundTextures[i]=null;}this.emptyTextures={};var emptyTexture2D=new GLTexture(gl.createTexture());gl.bindTexture(gl.TEXTURE_2D,emptyTexture2D.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(4));this.emptyTextures[gl.TEXTURE_2D]=emptyTexture2D;this.emptyTextures[gl.TEXTURE_CUBE_MAP]=new GLTexture(gl.createTexture());gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.emptyTextures[gl.TEXTURE_CUBE_MAP].texture);for(var _i16=0;_i16<6;_i16++){gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+_i16,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,null);}gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.LINEAR);for(var _i17=0;_i17<this.boundTextures.length;_i17++){this.bind(null,_i17);}}},{key:"bind",value:function bind(texture){var _texture2,_texture3;var location=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var gl=this.gl;texture=(_texture2=texture)===null||_texture2===void 0?void 0:_texture2.castToBaseTexture();if((_texture3=texture)!==null&&_texture3!==void 0&&_texture3.valid&&!texture.parentTextureArray){texture.touched=this.renderer.textureGC.count;var glTexture=texture._glTextures[this.CONTEXT_UID]||this.initTexture(texture);if(this.boundTextures[location]!==texture){if(this.currentLocation!==location){this.currentLocation=location;gl.activeTexture(gl.TEXTURE0+location);}gl.bindTexture(texture.target,glTexture.texture);}if(glTexture.dirtyId!==texture.dirtyId){if(this.currentLocation!==location){this.currentLocation=location;gl.activeTexture(gl.TEXTURE0+location);}this.updateTexture(texture);}else if(glTexture.dirtyStyleId!==texture.dirtyStyleId){this.updateTextureStyle(texture);}this.boundTextures[location]=texture;}else{if(this.currentLocation!==location){this.currentLocation=location;gl.activeTexture(gl.TEXTURE0+location);}gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[gl.TEXTURE_2D].texture);this.boundTextures[location]=null;}}},{key:"reset",value:function reset(){this._unknownBoundTextures=true;this.hasIntegerTextures=false;this.currentLocation=-1;for(var i=0;i<this.boundTextures.length;i++){this.boundTextures[i]=this.unknownTexture;}}},{key:"unbind",value:function unbind(texture){var gl=this.gl,boundTextures=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=false;for(var i=0;i<boundTextures.length;i++){if(boundTextures[i]===this.unknownTexture){this.bind(null,i);}}}for(var _i18=0;_i18<boundTextures.length;_i18++){if(boundTextures[_i18]===texture){if(this.currentLocation!==_i18){gl.activeTexture(gl.TEXTURE0+_i18);this.currentLocation=_i18;}gl.bindTexture(texture.target,this.emptyTextures[texture.target].texture);boundTextures[_i18]=null;}}}},{key:"ensureSamplerType",value:function ensureSamplerType(maxTextures){var boundTextures=this.boundTextures,hasIntegerTextures=this.hasIntegerTextures,CONTEXT_UID=this.CONTEXT_UID;if(!hasIntegerTextures){return;}for(var i=maxTextures-1;i>=0;--i){var tex=boundTextures[i];if(tex){var glTexture=tex._glTextures[CONTEXT_UID];if(glTexture.samplerType!==SAMPLER_TYPES.FLOAT){this.renderer.texture.unbind(tex);}}}}},{key:"initTexture",value:function initTexture(texture){var glTexture=new GLTexture(this.gl.createTexture());glTexture.dirtyId=-1;texture._glTextures[this.CONTEXT_UID]=glTexture;this.managedTextures.push(texture);texture.on("dispose",this.destroyTexture,this);return glTexture;}},{key:"initTextureType",value:function initTextureType(texture,glTexture){var _this$internalFormats,_this$internalFormats2;glTexture.internalFormat=(_this$internalFormats=(_this$internalFormats2=this.internalFormats[texture.type])===null||_this$internalFormats2===void 0?void 0:_this$internalFormats2[texture.format])!==null&&_this$internalFormats!==void 0?_this$internalFormats:texture.format;if(this.webGLVersion===2&&texture.type===TYPES.HALF_FLOAT){glTexture.type=this.gl.HALF_FLOAT;}else{glTexture.type=texture.type;}}},{key:"updateTexture",value:function updateTexture(texture){var _texture$resource;var glTexture=texture._glTextures[this.CONTEXT_UID];if(!glTexture){return;}var renderer=this.renderer;this.initTextureType(texture,glTexture);if((_texture$resource=texture.resource)!==null&&_texture$resource!==void 0&&_texture$resource.upload(renderer,texture,glTexture)){if(glTexture.samplerType!==SAMPLER_TYPES.FLOAT){this.hasIntegerTextures=true;}}else{var width=texture.realWidth;var height=texture.realHeight;var gl=renderer.gl;if(glTexture.width!==width||glTexture.height!==height||glTexture.dirtyId<0){glTexture.width=width;glTexture.height=height;gl.texImage2D(texture.target,0,glTexture.internalFormat,width,height,0,texture.format,glTexture.type,null);}}if(texture.dirtyStyleId!==glTexture.dirtyStyleId){this.updateTextureStyle(texture);}glTexture.dirtyId=texture.dirtyId;}},{key:"destroyTexture",value:function destroyTexture(texture,skipRemove){var gl=this.gl;texture=texture.castToBaseTexture();if(texture._glTextures[this.CONTEXT_UID]){this.unbind(texture);gl.deleteTexture(texture._glTextures[this.CONTEXT_UID].texture);texture.off("dispose",this.destroyTexture,this);delete texture._glTextures[this.CONTEXT_UID];if(!skipRemove){var i=this.managedTextures.indexOf(texture);if(i!==-1){removeItems(this.managedTextures,i,1);}}}}},{key:"updateTextureStyle",value:function updateTextureStyle(texture){var _texture$resource2;var glTexture=texture._glTextures[this.CONTEXT_UID];if(!glTexture){return;}if((texture.mipmap===MIPMAP_MODES.POW2||this.webGLVersion!==2)&&!texture.isPowerOfTwo){glTexture.mipmap=false;}else{glTexture.mipmap=texture.mipmap>=1;}if(this.webGLVersion!==2&&!texture.isPowerOfTwo){glTexture.wrapMode=WRAP_MODES.CLAMP;}else{glTexture.wrapMode=texture.wrapMode;}if((_texture$resource2=texture.resource)!==null&&_texture$resource2!==void 0&&_texture$resource2.style(this.renderer,texture,glTexture));else{this.setStyle(texture,glTexture);}glTexture.dirtyStyleId=texture.dirtyStyleId;}},{key:"setStyle",value:function setStyle(texture,glTexture){var gl=this.gl;if(glTexture.mipmap&&texture.mipmap!==MIPMAP_MODES.ON_MANUAL){gl.generateMipmap(texture.target);}gl.texParameteri(texture.target,gl.TEXTURE_WRAP_S,glTexture.wrapMode);gl.texParameteri(texture.target,gl.TEXTURE_WRAP_T,glTexture.wrapMode);if(glTexture.mipmap){gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===SCALE_MODES.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST);var anisotropicExt=this.renderer.context.extensions.anisotropicFiltering;if(anisotropicExt&&texture.anisotropicLevel>0&&texture.scaleMode===SCALE_MODES.LINEAR){var level=Math.min(texture.anisotropicLevel,gl.getParameter(anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT));gl.texParameterf(texture.target,anisotropicExt.TEXTURE_MAX_ANISOTROPY_EXT,level);}}else{gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST);}gl.texParameteri(texture.target,gl.TEXTURE_MAG_FILTER,texture.scaleMode===SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST);}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);}();TextureSystem.extension={type:ExtensionType.RendererSystem,name:"texture"};extensions$1.add(TextureSystem);var TransformFeedbackSystem=/*#__PURE__*/function(){function TransformFeedbackSystem(renderer){_classCallCheck(this,TransformFeedbackSystem);this.renderer=renderer;}return _createClass(TransformFeedbackSystem,[{key:"contextChange",value:function contextChange(){this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;}},{key:"bind",value:function bind(transformFeedback){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;var glTransformFeedback=transformFeedback._glTransformFeedbacks[CONTEXT_UID]||this.createGLTransformFeedback(transformFeedback);gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK,glTransformFeedback);}},{key:"unbind",value:function unbind(){var gl=this.gl;gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK,null);}},{key:"beginTransformFeedback",value:function beginTransformFeedback(drawMode,shader){var gl=this.gl,renderer=this.renderer;if(shader){renderer.shader.bind(shader);}gl.beginTransformFeedback(drawMode);}},{key:"endTransformFeedback",value:function endTransformFeedback(){var gl=this.gl;gl.endTransformFeedback();}},{key:"createGLTransformFeedback",value:function createGLTransformFeedback(tf){var gl=this.gl,renderer=this.renderer,CONTEXT_UID=this.CONTEXT_UID;var glTransformFeedback=gl.createTransformFeedback();tf._glTransformFeedbacks[CONTEXT_UID]=glTransformFeedback;gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK,glTransformFeedback);for(var i=0;i<tf.buffers.length;i++){var buffer=tf.buffers[i];if(!buffer)continue;renderer.buffer.update(buffer);buffer._glBuffers[CONTEXT_UID].refCount++;gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER,i,buffer._glBuffers[CONTEXT_UID].buffer||null);}gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK,null);tf.disposeRunner.add(this);return glTransformFeedback;}},{key:"disposeTransformFeedback",value:function disposeTransformFeedback(tf,contextLost){var glTF=tf._glTransformFeedbacks[this.CONTEXT_UID];var gl=this.gl;tf.disposeRunner.remove(this);var bufferSystem=this.renderer.buffer;if(bufferSystem){for(var i=0;i<tf.buffers.length;i++){var buffer=tf.buffers[i];if(!buffer)continue;var buf=buffer._glBuffers[this.CONTEXT_UID];if(buf){buf.refCount--;if(buf.refCount===0&&!contextLost){bufferSystem.dispose(buffer,contextLost);}}}}if(!glTF){return;}if(!contextLost){gl.deleteTransformFeedback(glTF);}delete tf._glTransformFeedbacks[this.CONTEXT_UID];}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);}();TransformFeedbackSystem.extension={type:ExtensionType.RendererSystem,name:"transformFeedback"};extensions$1.add(TransformFeedbackSystem);var ViewSystem=/*#__PURE__*/function(){function ViewSystem(renderer){_classCallCheck(this,ViewSystem);this.renderer=renderer;}return _createClass(ViewSystem,[{key:"init",value:function init(options){this.screen=new Rectangle(0,0,options.width,options.height);this.element=options.view||settings.ADAPTER.createCanvas();this.resolution=options.resolution||settings.RESOLUTION;this.autoDensity=!!options.autoDensity;}},{key:"resizeView",value:function resizeView(desiredScreenWidth,desiredScreenHeight){this.element.width=Math.round(desiredScreenWidth*this.resolution);this.element.height=Math.round(desiredScreenHeight*this.resolution);var screenWidth=this.element.width/this.resolution;var screenHeight=this.element.height/this.resolution;this.screen.width=screenWidth;this.screen.height=screenHeight;if(this.autoDensity){this.element.style.width="".concat(screenWidth,"px");this.element.style.height="".concat(screenHeight,"px");}this.renderer.emit("resize",screenWidth,screenHeight);this.renderer.runners.resize.emit(this.screen.width,this.screen.height);}},{key:"destroy",value:function destroy(removeView){if(removeView){var _this$element$parentN;(_this$element$parentN=this.element.parentNode)===null||_this$element$parentN===void 0||_this$element$parentN.removeChild(this.element);}this.renderer=null;this.element=null;this.screen=null;}}]);}();ViewSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_view"};extensions$1.add(ViewSystem);settings.PREFER_ENV=ENV.WEBGL2;settings.STRICT_TEXTURE_CACHE=false;Object.defineProperties(settings,{WRAP_MODE:{get:function get(){return BaseTexture.defaultOptions.wrapMode;},set:function set(value){deprecation("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode");BaseTexture.defaultOptions.wrapMode=value;}},SCALE_MODE:{get:function get(){return BaseTexture.defaultOptions.scaleMode;},set:function set(value){deprecation("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode");BaseTexture.defaultOptions.scaleMode=value;}},MIPMAP_TEXTURES:{get:function get(){return BaseTexture.defaultOptions.mipmap;},set:function set(value){deprecation("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap");BaseTexture.defaultOptions.mipmap=value;}},ANISOTROPIC_LEVEL:{get:function get(){return BaseTexture.defaultOptions.anisotropicLevel;},set:function set(value){deprecation("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel");BaseTexture.defaultOptions.anisotropicLevel=value;}},FILTER_RESOLUTION:{get:function get(){deprecation("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution");return Filter.defaultResolution;},set:function set(value){Filter.defaultResolution=value;}},FILTER_MULTISAMPLE:{get:function get(){deprecation("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample");return Filter.defaultMultisample;},set:function set(value){Filter.defaultMultisample=value;}},SPRITE_MAX_TEXTURES:{get:function get(){return BatchRenderer.defaultMaxTextures;},set:function set(value){deprecation("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures");BatchRenderer.defaultMaxTextures=value;}},SPRITE_BATCH_SIZE:{get:function get(){return BatchRenderer.defaultBatchSize;},set:function set(value){deprecation("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize");BatchRenderer.defaultBatchSize=value;}},CAN_UPLOAD_SAME_BUFFER:{get:function get(){return BatchRenderer.canUploadSameBuffer;},set:function set(value){deprecation("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer");BatchRenderer.canUploadSameBuffer=value;}},GC_MODE:{get:function get(){return TextureGCSystem.defaultMode;},set:function set(value){deprecation("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode");TextureGCSystem.defaultMode=value;}},GC_MAX_IDLE:{get:function get(){return TextureGCSystem.defaultMaxIdle;},set:function set(value){deprecation("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle");TextureGCSystem.defaultMaxIdle=value;}},GC_MAX_CHECK_COUNT:{get:function get(){return TextureGCSystem.defaultCheckCountMax;},set:function set(value){deprecation("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax");TextureGCSystem.defaultCheckCountMax=value;}},PRECISION_VERTEX:{get:function get(){return Program.defaultVertexPrecision;},set:function set(value){deprecation("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision");Program.defaultVertexPrecision=value;}},PRECISION_FRAGMENT:{get:function get(){return Program.defaultFragmentPrecision;},set:function set(value){deprecation("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision");Program.defaultFragmentPrecision=value;}}});var UPDATE_PRIORITY=/* @__PURE__ */function(UPDATE_PRIORITY2){UPDATE_PRIORITY2[UPDATE_PRIORITY2["HIGH"]=25]="HIGH";UPDATE_PRIORITY2[UPDATE_PRIORITY2["NORMAL"]=0]="NORMAL";UPDATE_PRIORITY2[UPDATE_PRIORITY2["LOW"]=-25]="LOW";UPDATE_PRIORITY2[UPDATE_PRIORITY2["UTILITY"]=-50]="UTILITY";return UPDATE_PRIORITY2;}(UPDATE_PRIORITY||{});var TickerListener=/*#__PURE__*/function(){function TickerListener(fn){var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var priority=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var once=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,TickerListener);this.next=null;this.previous=null;this._destroyed=false;this.fn=fn;this.context=context;this.priority=priority;this.once=once;}return _createClass(TickerListener,[{key:"match",value:function match(fn){var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.fn===fn&&this.context===context;}},{key:"emit",value:function emit(deltaTime){if(this.fn){if(this.context){this.fn.call(this.context,deltaTime);}else{this.fn(deltaTime);}}var redirect=this.next;if(this.once){this.destroy(true);}if(this._destroyed){this.next=null;}return redirect;}},{key:"connect",value:function connect(previous){this.previous=previous;if(previous.next){previous.next.previous=this;}this.next=previous.next;previous.next=this;}},{key:"destroy",value:function destroy(){var hard=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this._destroyed=true;this.fn=null;this.context=null;if(this.previous){this.previous.next=this.next;}if(this.next){this.next.previous=this.previous;}var redirect=this.next;this.next=hard?null:redirect;this.previous=null;return redirect;}}]);}();var _Ticker=/*#__PURE__*/function(){function _Ticker(){var _this24=this;_classCallCheck(this,_Ticker);this.autoStart=false;this.deltaTime=1;this.lastTime=-1;this.speed=1;this.started=false;this._requestId=null;this._maxElapsedMS=100;this._minElapsedMS=0;this._protected=false;this._lastFrame=-1;this._head=new TickerListener(null,null,Infinity);this.deltaMS=1/_Ticker.targetFPMS;this.elapsedMS=1/_Ticker.targetFPMS;this._tick=function(time){_this24._requestId=null;if(_this24.started){_this24.update(time);if(_this24.started&&_this24._requestId===null&&_this24._head.next){_this24._requestId=requestAnimationFrame(_this24._tick);}}};}return _createClass(_Ticker,[{key:"_requestIfNeeded",value:function _requestIfNeeded(){if(this._requestId===null&&this._head.next){this.lastTime=performance.now();this._lastFrame=this.lastTime;this._requestId=requestAnimationFrame(this._tick);}}},{key:"_cancelIfNeeded",value:function _cancelIfNeeded(){if(this._requestId!==null){cancelAnimationFrame(this._requestId);this._requestId=null;}}},{key:"_startIfPossible",value:function _startIfPossible(){if(this.started){this._requestIfNeeded();}else if(this.autoStart){this.start();}}},{key:"add",value:function add(fn,context){var priority=arguments.length>2&&arguments[2]!==undefined?arguments[2]:UPDATE_PRIORITY.NORMAL;return this._addListener(new TickerListener(fn,context,priority));}},{key:"addOnce",value:function addOnce(fn,context){var priority=arguments.length>2&&arguments[2]!==undefined?arguments[2]:UPDATE_PRIORITY.NORMAL;return this._addListener(new TickerListener(fn,context,priority,true));}},{key:"_addListener",value:function _addListener(listener){var current=this._head.next;var previous=this._head;if(!current){listener.connect(previous);}else{while(current){if(listener.priority>current.priority){listener.connect(previous);break;}previous=current;current=current.next;}if(!listener.previous){listener.connect(previous);}}this._startIfPossible();return this;}},{key:"remove",value:function remove(fn,context){var listener=this._head.next;while(listener){if(listener.match(fn,context)){listener=listener.destroy();}else{listener=listener.next;}}if(!this._head.next){this._cancelIfNeeded();}return this;}},{key:"count",get:function get(){if(!this._head){return 0;}var count=0;var current=this._head;while(current=current.next){count++;}return count;}},{key:"start",value:function start(){if(!this.started){this.started=true;this._requestIfNeeded();}}},{key:"stop",value:function stop(){if(this.started){this.started=false;this._cancelIfNeeded();}}},{key:"destroy",value:function destroy(){if(!this._protected){this.stop();var listener=this._head.next;while(listener){listener=listener.destroy(true);}this._head.destroy();this._head=null;}}},{key:"update",value:function update(){var currentTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:performance.now();var elapsedMS;if(currentTime>this.lastTime){elapsedMS=this.elapsedMS=currentTime-this.lastTime;if(elapsedMS>this._maxElapsedMS){elapsedMS=this._maxElapsedMS;}elapsedMS*=this.speed;if(this._minElapsedMS){var delta=currentTime-this._lastFrame|0;if(delta<this._minElapsedMS){return;}this._lastFrame=currentTime-delta%this._minElapsedMS;}this.deltaMS=elapsedMS;this.deltaTime=this.deltaMS*_Ticker.targetFPMS;var head=this._head;var listener=head.next;while(listener){listener=listener.emit(this.deltaTime);}if(!head.next){this._cancelIfNeeded();}}else{this.deltaTime=this.deltaMS=this.elapsedMS=0;}this.lastTime=currentTime;}},{key:"FPS",get:function get(){return 1e3/this.elapsedMS;}},{key:"minFPS",get:function get(){return 1e3/this._maxElapsedMS;},set:function set(fps){var minFPS=Math.min(this.maxFPS,fps);var minFPMS=Math.min(Math.max(0,minFPS)/1e3,_Ticker.targetFPMS);this._maxElapsedMS=1/minFPMS;}},{key:"maxFPS",get:function get(){if(this._minElapsedMS){return Math.round(1e3/this._minElapsedMS);}return 0;},set:function set(fps){if(fps===0){this._minElapsedMS=0;}else{var maxFPS=Math.max(this.minFPS,fps);this._minElapsedMS=1/(maxFPS/1e3);}}}],[{key:"shared",get:function get(){if(!_Ticker._shared){var shared=_Ticker._shared=new _Ticker();shared.autoStart=true;shared._protected=true;}return _Ticker._shared;}},{key:"system",get:function get(){if(!_Ticker._system){var system=_Ticker._system=new _Ticker();system.autoStart=true;system._protected=true;}return _Ticker._system;}}]);}();var Ticker=_Ticker;Ticker.targetFPMS=0.06;Object.defineProperties(settings,{TARGET_FPMS:{get:function get(){return Ticker.targetFPMS;},set:function set(value){deprecation("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS");Ticker.targetFPMS=value;}}});var TickerPlugin=/*#__PURE__*/function(){function TickerPlugin(){_classCallCheck(this,TickerPlugin);}return _createClass(TickerPlugin,null,[{key:"init",value:function init(options){var _this25=this;options=Object.assign({autoStart:true,sharedTicker:false},options);Object.defineProperty(this,"ticker",{set:function set(ticker){if(this._ticker){this._ticker.remove(this.render,this);}this._ticker=ticker;if(ticker){ticker.add(this.render,this,UPDATE_PRIORITY.LOW);}},get:function get(){return this._ticker;}});this.stop=function(){_this25._ticker.stop();};this.start=function(){_this25._ticker.start();};this._ticker=null;this.ticker=options.sharedTicker?Ticker.shared:new Ticker();if(options.autoStart){this.start();}}},{key:"destroy",value:function destroy(){if(this._ticker){var oldTicker=this._ticker;this.ticker=null;oldTicker.destroy();}}}]);}();TickerPlugin.extension=ExtensionType.Application;extensions$1.add(TickerPlugin);var renderers=[];extensions$1.handleByList(ExtensionType.Renderer,renderers);function autoDetectRenderer(options){var _iterator2=_createForOfIteratorHelper(renderers),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var RendererType=_step2.value;if(RendererType.test(options)){return new RendererType(options);}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}throw new Error("Unable to auto-detect a suitable renderer.");}var $defaultVertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}";var $defaultFilterVertex="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";var defaultVertex=$defaultVertex;var defaultFilterVertex=$defaultFilterVertex;var MultisampleSystem=/*#__PURE__*/function(){function MultisampleSystem(renderer){_classCallCheck(this,MultisampleSystem);this.renderer=renderer;}return _createClass(MultisampleSystem,[{key:"contextChange",value:function contextChange(gl){var samples;if(this.renderer.context.webGLVersion===1){var framebuffer=gl.getParameter(gl.FRAMEBUFFER_BINDING);gl.bindFramebuffer(gl.FRAMEBUFFER,null);samples=gl.getParameter(gl.SAMPLES);gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer);}else{var _framebuffer=gl.getParameter(gl.DRAW_FRAMEBUFFER_BINDING);gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,null);samples=gl.getParameter(gl.SAMPLES);gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,_framebuffer);}if(samples>=MSAA_QUALITY.HIGH){this.multisample=MSAA_QUALITY.HIGH;}else if(samples>=MSAA_QUALITY.MEDIUM){this.multisample=MSAA_QUALITY.MEDIUM;}else if(samples>=MSAA_QUALITY.LOW){this.multisample=MSAA_QUALITY.LOW;}else{this.multisample=MSAA_QUALITY.NONE;}}},{key:"destroy",value:function destroy(){}}]);}();MultisampleSystem.extension={type:ExtensionType.RendererSystem,name:"_multisample"};extensions$1.add(MultisampleSystem);var GLBuffer=/*#__PURE__*/_createClass(function GLBuffer(buffer){_classCallCheck(this,GLBuffer);this.buffer=buffer||null;this.updateID=-1;this.byteLength=-1;this.refCount=0;});var BufferSystem=/*#__PURE__*/function(){function BufferSystem(renderer){_classCallCheck(this,BufferSystem);this.renderer=renderer;this.managedBuffers={};this.boundBufferBases={};}return _createClass(BufferSystem,[{key:"destroy",value:function destroy(){this.renderer=null;}},{key:"contextChange",value:function contextChange(){this.disposeAll(true);this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;}},{key:"bind",value:function bind(buffer){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;var glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);gl.bindBuffer(buffer.type,glBuffer.buffer);}},{key:"unbind",value:function unbind(type){var gl=this.gl;gl.bindBuffer(type,null);}},{key:"bindBufferBase",value:function bindBufferBase(buffer,index){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;if(this.boundBufferBases[index]!==buffer){var glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);this.boundBufferBases[index]=buffer;gl.bindBufferBase(gl.UNIFORM_BUFFER,index,glBuffer.buffer);}}},{key:"bindBufferRange",value:function bindBufferRange(buffer,index,offset){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;offset=offset||0;var glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);gl.bindBufferRange(gl.UNIFORM_BUFFER,index||0,glBuffer.buffer,offset*256,256);}},{key:"update",value:function update(buffer){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;var glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);if(buffer._updateID===glBuffer.updateID){return;}glBuffer.updateID=buffer._updateID;gl.bindBuffer(buffer.type,glBuffer.buffer);if(glBuffer.byteLength>=buffer.data.byteLength){gl.bufferSubData(buffer.type,0,buffer.data);}else{var drawType=buffer.static?gl.STATIC_DRAW:gl.DYNAMIC_DRAW;glBuffer.byteLength=buffer.data.byteLength;gl.bufferData(buffer.type,buffer.data,drawType);}}},{key:"dispose",value:function dispose(buffer,contextLost){if(!this.managedBuffers[buffer.id]){return;}delete this.managedBuffers[buffer.id];var glBuffer=buffer._glBuffers[this.CONTEXT_UID];var gl=this.gl;buffer.disposeRunner.remove(this);if(!glBuffer){return;}if(!contextLost){gl.deleteBuffer(glBuffer.buffer);}delete buffer._glBuffers[this.CONTEXT_UID];}},{key:"disposeAll",value:function disposeAll(contextLost){var all=Object.keys(this.managedBuffers);for(var i=0;i<all.length;i++){this.dispose(this.managedBuffers[all[i]],contextLost);}}},{key:"createGLBuffer",value:function createGLBuffer(buffer){var CONTEXT_UID=this.CONTEXT_UID,gl=this.gl;buffer._glBuffers[CONTEXT_UID]=new GLBuffer(gl.createBuffer());this.managedBuffers[buffer.id]=buffer;buffer.disposeRunner.add(this);return buffer._glBuffers[CONTEXT_UID];}}]);}();BufferSystem.extension={type:ExtensionType.RendererSystem,name:"buffer"};extensions$1.add(BufferSystem);var ObjectRendererSystem=/*#__PURE__*/function(){function ObjectRendererSystem(renderer){_classCallCheck(this,ObjectRendererSystem);this.renderer=renderer;}return _createClass(ObjectRendererSystem,[{key:"render",value:function render(displayObject,options){var _clear;var renderer=this.renderer;var renderTexture;var clear;var transform;var skipUpdateTransform;if(options){renderTexture=options.renderTexture;clear=options.clear;transform=options.transform;skipUpdateTransform=options.skipUpdateTransform;}this.renderingToScreen=!renderTexture;renderer.runners.prerender.emit();renderer.emit("prerender");renderer.projection.transform=transform;if(renderer.context.isLost){return;}if(!renderTexture){this.lastObjectRendered=displayObject;}if(!skipUpdateTransform){var cacheParent=displayObject.enableTempParent();displayObject.updateTransform();displayObject.disableTempParent(cacheParent);}renderer.renderTexture.bind(renderTexture);renderer.batch.currentRenderer.start();if((_clear=clear)!==null&&_clear!==void 0?_clear:renderer.background.clearBeforeRender){renderer.renderTexture.clear();}displayObject.render(renderer);renderer.batch.currentRenderer.flush();if(renderTexture){if(options.blit){renderer.framebuffer.blit();}renderTexture.baseTexture.update();}renderer.runners.postrender.emit();renderer.projection.transform=null;renderer.emit("postrender");}},{key:"destroy",value:function destroy(){this.renderer=null;this.lastObjectRendered=null;}}]);}();ObjectRendererSystem.extension={type:ExtensionType.RendererSystem,name:"objectRenderer"};extensions$1.add(ObjectRendererSystem);var _Renderer=/*#__PURE__*/function(_SystemManager){function _Renderer(options){var _options$background;var _this26;_classCallCheck(this,_Renderer);_this26=_callSuper(this,_Renderer);_this26.type=RENDERER_TYPE.WEBGL;options=Object.assign({},settings.RENDER_OPTIONS,options);_this26.gl=null;_this26.CONTEXT_UID=0;_this26.globalUniforms=new UniformGroup({projectionMatrix:new Matrix()},true);var systemConfig={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:_Renderer.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};_this26.setup(systemConfig);if("useContextAlpha"in options){deprecation("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead");options.premultipliedAlpha=options.useContextAlpha&&options.useContextAlpha!=="notMultiplied";options.backgroundAlpha=options.useContextAlpha===false?1:options.backgroundAlpha;}var startupOptions={hello:options.hello,_plugin:_Renderer.__plugins,background:{alpha:options.backgroundAlpha,color:(_options$background=options.background)!==null&&_options$background!==void 0?_options$background:options.backgroundColor,clearBeforeRender:options.clearBeforeRender},_view:{height:options.height,width:options.width,autoDensity:options.autoDensity,resolution:options.resolution,view:options.view},context:{antialias:options.antialias,context:options.context,powerPreference:options.powerPreference,premultipliedAlpha:options.premultipliedAlpha,preserveDrawingBuffer:options.preserveDrawingBuffer}};_this26.options=options;_this26.startup.run(startupOptions);return _this26;}_inherits(_Renderer,_SystemManager);return _createClass(_Renderer,[{key:"render",value:function render(displayObject,options){this.objectRenderer.render(displayObject,options);}},{key:"resize",value:function resize(desiredScreenWidth,desiredScreenHeight){this._view.resizeView(desiredScreenWidth,desiredScreenHeight);}},{key:"reset",value:function reset(){this.runners.reset.emit();return this;}},{key:"clear",value:function clear(){this.renderTexture.bind();this.renderTexture.clear();}},{key:"destroy",value:function destroy(){var removeView=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.runners.destroy.items.reverse();this.emitWithCustomOptions(this.runners.destroy,{_view:removeView});_get(_getPrototypeOf(_Renderer.prototype),"destroy",this).call(this);}},{key:"plugins",get:function get(){return this._plugin.plugins;}},{key:"multisample",get:function get(){return this._multisample.multisample;}},{key:"width",get:function get(){return this._view.element.width;}},{key:"height",get:function get(){return this._view.element.height;}},{key:"resolution",get:function get(){return this._view.resolution;},set:function set(value){this._view.resolution=value;this.runners.resolutionChange.emit(value);}},{key:"autoDensity",get:function get(){return this._view.autoDensity;}},{key:"view",get:function get(){return this._view.element;}},{key:"screen",get:function get(){return this._view.screen;}},{key:"lastObjectRendered",get:function get(){return this.objectRenderer.lastObjectRendered;}},{key:"renderingToScreen",get:function get(){return this.objectRenderer.renderingToScreen;}},{key:"rendererLogId",get:function get(){return"WebGL ".concat(this.context.webGLVersion);}},{key:"clearBeforeRender",get:function get(){deprecation("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead.");return this.background.clearBeforeRender;}},{key:"useContextAlpha",get:function get(){deprecation("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead.");return this.context.useContextAlpha;}},{key:"preserveDrawingBuffer",get:function get(){deprecation("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context");return this.context.preserveDrawingBuffer;}},{key:"backgroundColor",get:function get(){deprecation("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead.");return this.background.color;},set:function set(value){deprecation("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead.");this.background.color=value;}},{key:"backgroundAlpha",get:function get(){deprecation("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead.");return this.background.color;},set:function set(value){deprecation("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead.");this.background.alpha=value;}},{key:"powerPreference",get:function get(){deprecation("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context");return this.context.powerPreference;}},{key:"generateTexture",value:function generateTexture(displayObject,options){return this.textureGenerator.generateTexture(displayObject,options);}}],[{key:"test",value:function test(options){if(options!==null&&options!==void 0&&options.forceCanvas){return false;}return isWebGLSupported();}}]);}(SystemManager);var Renderer=_Renderer;Renderer.extension={type:ExtensionType.Renderer,priority:1};Renderer.__plugins={};Renderer.__systems={};extensions$1.handleByMap(ExtensionType.RendererPlugin,Renderer.__plugins);extensions$1.handleByMap(ExtensionType.RendererSystem,Renderer.__systems);extensions$1.add(Renderer);var AbstractMultiResource=/*#__PURE__*/function(_Resource3){function AbstractMultiResource(length,options){var _this27;_classCallCheck(this,AbstractMultiResource);var _ref5=options||{},width=_ref5.width,height=_ref5.height;_this27=_callSuper(this,AbstractMultiResource,[width,height]);_this27.items=[];_this27.itemDirtyIds=[];for(var i=0;i<length;i++){var partTexture=new BaseTexture();_this27.items.push(partTexture);_this27.itemDirtyIds.push(-2);}_this27.length=length;_this27._load=null;_this27.baseTexture=null;return _this27;}_inherits(AbstractMultiResource,_Resource3);return _createClass(AbstractMultiResource,[{key:"initFromArray",value:function initFromArray(resources,options){for(var i=0;i<this.length;i++){if(!resources[i]){continue;}if(resources[i].castToBaseTexture){this.addBaseTextureAt(resources[i].castToBaseTexture(),i);}else if(resources[i]instanceof Resource){this.addResourceAt(resources[i],i);}else{this.addResourceAt(autoDetectResource(resources[i],options),i);}}}},{key:"dispose",value:function dispose(){for(var i=0,len=this.length;i<len;i++){this.items[i].destroy();}this.items=null;this.itemDirtyIds=null;this._load=null;}},{key:"addResourceAt",value:function addResourceAt(resource,index){if(!this.items[index]){throw new Error("Index ".concat(index," is out of bounds"));}if(resource.valid&&!this.valid){this.resize(resource.width,resource.height);}this.items[index].setResource(resource);return this;}},{key:"bind",value:function bind(baseTexture){if(this.baseTexture!==null){throw new Error("Only one base texture per TextureArray is allowed");}_get(_getPrototypeOf(AbstractMultiResource.prototype),"bind",this).call(this,baseTexture);for(var i=0;i<this.length;i++){this.items[i].parentTextureArray=baseTexture;this.items[i].on("update",baseTexture.update,baseTexture);}}},{key:"unbind",value:function unbind(baseTexture){_get(_getPrototypeOf(AbstractMultiResource.prototype),"unbind",this).call(this,baseTexture);for(var i=0;i<this.length;i++){this.items[i].parentTextureArray=null;this.items[i].off("update",baseTexture.update,baseTexture);}}},{key:"load",value:function load(){var _this28=this;if(this._load){return this._load;}var resources=this.items.map(function(item){return item.resource;}).filter(function(item){return item;});var promises=resources.map(function(item){return item.load();});this._load=Promise.all(promises).then(function(){var _this28$items$=_this28.items[0],realWidth=_this28$items$.realWidth,realHeight=_this28$items$.realHeight;_this28.resize(realWidth,realHeight);return Promise.resolve(_this28);});return this._load;}}]);}(Resource);var ArrayResource=/*#__PURE__*/function(_AbstractMultiResourc){function ArrayResource(source,options){var _this29;_classCallCheck(this,ArrayResource);var _ref6=options||{},width=_ref6.width,height=_ref6.height;var urls;var length;if(Array.isArray(source)){urls=source;length=source.length;}else{length=source;}_this29=_callSuper(this,ArrayResource,[length,{width:width,height:height}]);if(urls){_this29.initFromArray(urls,options);}return _this29;}_inherits(ArrayResource,_AbstractMultiResourc);return _createClass(ArrayResource,[{key:"addBaseTextureAt",value:function addBaseTextureAt(baseTexture,index){if(baseTexture.resource){this.addResourceAt(baseTexture.resource,index);}else{throw new Error("ArrayResource does not support RenderTexture");}return this;}},{key:"bind",value:function bind(baseTexture){_get(_getPrototypeOf(ArrayResource.prototype),"bind",this).call(this,baseTexture);baseTexture.target=TARGETS.TEXTURE_2D_ARRAY;}},{key:"upload",value:function upload(renderer,texture,glTexture){var length=this.length,itemDirtyIds=this.itemDirtyIds,items=this.items;var gl=renderer.gl;if(glTexture.dirtyId<0){gl.texImage3D(gl.TEXTURE_2D_ARRAY,0,glTexture.internalFormat,this._width,this._height,length,0,texture.format,glTexture.type,null);}for(var i=0;i<length;i++){var item=items[i];if(itemDirtyIds[i]<item.dirtyId){itemDirtyIds[i]=item.dirtyId;if(item.valid){gl.texSubImage3D(gl.TEXTURE_2D_ARRAY,0,0,0,i,item.resource.width,item.resource.height,1,texture.format,glTexture.type,item.resource.source);}}}return true;}}]);}(AbstractMultiResource);var CanvasResource=/*#__PURE__*/function(_BaseImageResource2){function CanvasResource(source){_classCallCheck(this,CanvasResource);return _callSuper(this,CanvasResource,[source]);}_inherits(CanvasResource,_BaseImageResource2);return _createClass(CanvasResource,null,[{key:"test",value:function test(source){var OffscreenCanvas=globalThis.OffscreenCanvas;if(OffscreenCanvas&&source instanceof OffscreenCanvas){return true;}return globalThis.HTMLCanvasElement&&source instanceof HTMLCanvasElement;}}]);}(BaseImageResource);var _CubeResource=/*#__PURE__*/function(_AbstractMultiResourc2){function _CubeResource(source,options){var _this30;_classCallCheck(this,_CubeResource);var _ref7=options||{},width=_ref7.width,height=_ref7.height,autoLoad=_ref7.autoLoad,linkBaseTexture=_ref7.linkBaseTexture;if(source&&source.length!==_CubeResource.SIDES){throw new Error("Invalid length. Got ".concat(source.length,", expected 6"));}_this30=_callSuper(this,_CubeResource,[6,{width:width,height:height}]);for(var i=0;i<_CubeResource.SIDES;i++){_this30.items[i].target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+i;}_this30.linkBaseTexture=linkBaseTexture!==false;if(source){_this30.initFromArray(source,options);}if(autoLoad!==false){_this30.load();}return _this30;}_inherits(_CubeResource,_AbstractMultiResourc2);return _createClass(_CubeResource,[{key:"bind",value:function bind(baseTexture){_get(_getPrototypeOf(_CubeResource.prototype),"bind",this).call(this,baseTexture);baseTexture.target=TARGETS.TEXTURE_CUBE_MAP;}},{key:"addBaseTextureAt",value:function addBaseTextureAt(baseTexture,index,linkBaseTexture){if(linkBaseTexture===void 0){linkBaseTexture=this.linkBaseTexture;}if(!this.items[index]){throw new Error("Index ".concat(index," is out of bounds"));}if(!this.linkBaseTexture||baseTexture.parentTextureArray||Object.keys(baseTexture._glTextures).length>0){if(baseTexture.resource){this.addResourceAt(baseTexture.resource,index);}else{throw new Error("CubeResource does not support copying of renderTexture.");}}else{baseTexture.target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+index;baseTexture.parentTextureArray=this.baseTexture;this.items[index]=baseTexture;}if(baseTexture.valid&&!this.valid){this.resize(baseTexture.realWidth,baseTexture.realHeight);}this.items[index]=baseTexture;return this;}},{key:"upload",value:function upload(renderer,_baseTexture,glTexture){var dirty=this.itemDirtyIds;for(var i=0;i<_CubeResource.SIDES;i++){var side=this.items[i];if(dirty[i]<side.dirtyId||glTexture.dirtyId<_baseTexture.dirtyId){if(side.valid&&side.resource){side.resource.upload(renderer,side,glTexture);dirty[i]=side.dirtyId;}else if(dirty[i]<-1){renderer.gl.texImage2D(side.target,0,glTexture.internalFormat,_baseTexture.realWidth,_baseTexture.realHeight,0,_baseTexture.format,glTexture.type,null);dirty[i]=-1;}}}return true;}}],[{key:"test",value:function test(source){return Array.isArray(source)&&source.length===_CubeResource.SIDES;}}]);}(AbstractMultiResource);var CubeResource=_CubeResource;CubeResource.SIDES=6;var ImageBitmapResource=/*#__PURE__*/function(_BaseImageResource3){function ImageBitmapResource(source,options){var _options$crossOrigin;var _this31;_classCallCheck(this,ImageBitmapResource);options=options||{};var baseSource;var url;if(typeof source==="string"){baseSource=ImageBitmapResource.EMPTY;url=source;}else{baseSource=source;url=null;}_this31=_callSuper(this,ImageBitmapResource,[baseSource]);_this31.url=url;_this31.crossOrigin=(_options$crossOrigin=options.crossOrigin)!==null&&_options$crossOrigin!==void 0?_options$crossOrigin:true;_this31.alphaMode=typeof options.alphaMode==="number"?options.alphaMode:null;_this31._load=null;if(options.autoLoad!==false){_this31.load();}return _this31;}_inherits(ImageBitmapResource,_BaseImageResource3);return _createClass(ImageBitmapResource,[{key:"load",value:function load(){var _this32=this;if(this._load){return this._load;}this._load=new Promise(/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(resolve,reject){var response,imageBlob,imageBitmap;return _regeneratorRuntime().wrap(function _callee$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:if(!(_this32.url===null)){_context4.next=3;break;}resolve(_this32);return _context4.abrupt("return");case 3:_context4.prev=3;_context4.next=6;return settings.ADAPTER.fetch(_this32.url,{mode:_this32.crossOrigin?"cors":"no-cors"});case 6:response=_context4.sent;if(!_this32.destroyed){_context4.next=9;break;}return _context4.abrupt("return");case 9:_context4.next=11;return response.blob();case 11:imageBlob=_context4.sent;if(!_this32.destroyed){_context4.next=14;break;}return _context4.abrupt("return");case 14:_context4.next=16;return createImageBitmap(imageBlob,{premultiplyAlpha:_this32.alphaMode===null||_this32.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"});case 16:imageBitmap=_context4.sent;if(!_this32.destroyed){_context4.next=19;break;}return _context4.abrupt("return");case 19:_this32.source=imageBitmap;_this32.update();resolve(_this32);_context4.next=30;break;case 24:_context4.prev=24;_context4.t0=_context4["catch"](3);if(!_this32.destroyed){_context4.next=28;break;}return _context4.abrupt("return");case 28:reject(_context4.t0);_this32.onError.emit(_context4.t0);case 30:case"end":return _context4.stop();}},_callee,null,[[3,24]]);}));return function(_x3,_x4){return _ref8.apply(this,arguments);};}());return this._load;}},{key:"upload",value:function upload(renderer,baseTexture,glTexture){if(!(this.source instanceof ImageBitmap)){this.load();return false;}if(typeof this.alphaMode==="number"){baseTexture.alphaMode=this.alphaMode;}return _get(_getPrototypeOf(ImageBitmapResource.prototype),"upload",this).call(this,renderer,baseTexture,glTexture);}},{key:"dispose",value:function dispose(){if(this.source instanceof ImageBitmap){this.source.close();}_get(_getPrototypeOf(ImageBitmapResource.prototype),"dispose",this).call(this);this._load=null;}}],[{key:"test",value:function test(source){return!!globalThis.createImageBitmap&&typeof ImageBitmap!=="undefined"&&(typeof source==="string"||source instanceof ImageBitmap);}},{key:"EMPTY",get:function get(){var _ImageBitmapResource$;ImageBitmapResource._EMPTY=(_ImageBitmapResource$=ImageBitmapResource._EMPTY)!==null&&_ImageBitmapResource$!==void 0?_ImageBitmapResource$:settings.ADAPTER.createCanvas(0,0);return ImageBitmapResource._EMPTY;}}]);}(BaseImageResource);var _SVGResource=/*#__PURE__*/function(_BaseImageResource4){function _SVGResource(sourceBase64,options){var _this33;_classCallCheck(this,_SVGResource);options=options||{};_this33=_callSuper(this,_SVGResource,[settings.ADAPTER.createCanvas()]);_this33._width=0;_this33._height=0;_this33.svg=sourceBase64;_this33.scale=options.scale||1;_this33._overrideWidth=options.width;_this33._overrideHeight=options.height;_this33._resolve=null;_this33._crossorigin=options.crossorigin;_this33._load=null;if(options.autoLoad!==false){_this33.load();}return _this33;}_inherits(_SVGResource,_BaseImageResource4);return _createClass(_SVGResource,[{key:"load",value:function load(){var _this34=this;if(this._load){return this._load;}this._load=new Promise(function(resolve){_this34._resolve=function(){_this34.resize(_this34.source.width,_this34.source.height);resolve(_this34);};if(_SVGResource.SVG_XML.test(_this34.svg.trim())){if(!btoa){throw new Error("Your browser doesn't support base64 conversions.");}_this34.svg="data:image/svg+xml;base64,".concat(btoa(unescape(encodeURIComponent(_this34.svg))));}_this34._loadSvg();});return this._load;}},{key:"_loadSvg",value:function _loadSvg(){var _this35=this;var tempImage=new Image();BaseImageResource.crossOrigin(tempImage,this.svg,this._crossorigin);tempImage.src=this.svg;tempImage.onerror=function(event){if(!_this35._resolve){return;}tempImage.onerror=null;_this35.onError.emit(event);};tempImage.onload=function(){if(!_this35._resolve){return;}var svgWidth=tempImage.width;var svgHeight=tempImage.height;if(!svgWidth||!svgHeight){throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");}var width=svgWidth*_this35.scale;var height=svgHeight*_this35.scale;if(_this35._overrideWidth||_this35._overrideHeight){width=_this35._overrideWidth||_this35._overrideHeight/svgHeight*svgWidth;height=_this35._overrideHeight||_this35._overrideWidth/svgWidth*svgHeight;}width=Math.round(width);height=Math.round(height);var canvas=_this35.source;canvas.width=width;canvas.height=height;canvas._pixiId="canvas_".concat(uid());canvas.getContext("2d").drawImage(tempImage,0,0,svgWidth,svgHeight,0,0,width,height);_this35._resolve();_this35._resolve=null;};}},{key:"dispose",value:function dispose(){_get(_getPrototypeOf(_SVGResource.prototype),"dispose",this).call(this);this._resolve=null;this._crossorigin=null;}}],[{key:"getSize",value:function getSize(svgString){var sizeMatch=_SVGResource.SVG_SIZE.exec(svgString);var size={};if(sizeMatch){size[sizeMatch[1]]=Math.round(parseFloat(sizeMatch[3]));size[sizeMatch[5]]=Math.round(parseFloat(sizeMatch[7]));}return size;}},{key:"test",value:function test(source,extension){return extension==="svg"||typeof source==="string"&&source.startsWith("data:image/svg+xml")||typeof source==="string"&&_SVGResource.SVG_XML.test(source);}}]);}(BaseImageResource);var SVGResource=_SVGResource;SVGResource.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var _VideoResource=/*#__PURE__*/function(_BaseImageResource5){function _VideoResource(source,options){var _this36;_classCallCheck(this,_VideoResource);options=options||{};if(!(source instanceof HTMLVideoElement)){var videoElement=document.createElement("video");videoElement.setAttribute("preload","auto");videoElement.setAttribute("webkit-playsinline","");videoElement.setAttribute("playsinline","");if(typeof source==="string"){source=[source];}var firstSrc=source[0].src||source[0];BaseImageResource.crossOrigin(videoElement,firstSrc,options.crossorigin);for(var i=0;i<source.length;++i){var sourceElement=document.createElement("source");var _source$i=source[i],src=_source$i.src,mime=_source$i.mime;src=src||source[i];var baseSrc=src.split("?").shift().toLowerCase();var ext=baseSrc.slice(baseSrc.lastIndexOf(".")+1);mime=mime||_VideoResource.MIME_TYPES[ext]||"video/".concat(ext);sourceElement.src=src;sourceElement.type=mime;videoElement.appendChild(sourceElement);}source=videoElement;}_this36=_callSuper(this,_VideoResource,[source]);_this36.noSubImage=true;_this36._autoUpdate=true;_this36._isConnectedToTicker=false;_this36._updateFPS=options.updateFPS||0;_this36._msToNextUpdate=0;_this36.autoPlay=options.autoPlay!==false;_this36._load=null;_this36._resolve=null;_this36._onCanPlay=_this36._onCanPlay.bind(_this36);_this36._onError=_this36._onError.bind(_this36);if(options.autoLoad!==false){_this36.load();}return _this36;}_inherits(_VideoResource,_BaseImageResource5);return _createClass(_VideoResource,[{key:"update",value:function update(){var _deltaTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(!this.destroyed){var elapsedMS=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-elapsedMS);if(!this._updateFPS||this._msToNextUpdate<=0){_get(_getPrototypeOf(_VideoResource.prototype),"update",this).call(this);this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0;}}}},{key:"load",value:function load(){var _this37=this;if(this._load){return this._load;}var source=this.source;if((source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height){source.complete=true;}source.addEventListener("play",this._onPlayStart.bind(this));source.addEventListener("pause",this._onPlayStop.bind(this));if(!this._isSourceReady()){source.addEventListener("canplay",this._onCanPlay);source.addEventListener("canplaythrough",this._onCanPlay);source.addEventListener("error",this._onError,true);}else{this._onCanPlay();}this._load=new Promise(function(resolve){if(_this37.valid){resolve(_this37);}else{_this37._resolve=resolve;source.load();}});return this._load;}},{key:"_onError",value:function _onError(event){this.source.removeEventListener("error",this._onError,true);this.onError.emit(event);}},{key:"_isSourcePlaying",value:function _isSourcePlaying(){var source=this.source;return!source.paused&&!source.ended&&this._isSourceReady();}},{key:"_isSourceReady",value:function _isSourceReady(){var source=this.source;return source.readyState>2;}},{key:"_onPlayStart",value:function _onPlayStart(){if(!this.valid){this._onCanPlay();}if(this.autoUpdate&&!this._isConnectedToTicker){Ticker.shared.add(this.update,this);this._isConnectedToTicker=true;}}},{key:"_onPlayStop",value:function _onPlayStop(){if(this._isConnectedToTicker){Ticker.shared.remove(this.update,this);this._isConnectedToTicker=false;}}},{key:"_onCanPlay",value:function _onCanPlay(){var source=this.source;source.removeEventListener("canplay",this._onCanPlay);source.removeEventListener("canplaythrough",this._onCanPlay);var valid=this.valid;this.resize(source.videoWidth,source.videoHeight);if(!valid&&this._resolve){this._resolve(this);this._resolve=null;}if(this._isSourcePlaying()){this._onPlayStart();}else if(this.autoPlay){source.play();}}},{key:"dispose",value:function dispose(){if(this._isConnectedToTicker){Ticker.shared.remove(this.update,this);this._isConnectedToTicker=false;}var source=this.source;if(source){source.removeEventListener("error",this._onError,true);source.pause();source.src="";source.load();}_get(_getPrototypeOf(_VideoResource.prototype),"dispose",this).call(this);}},{key:"autoUpdate",get:function get(){return this._autoUpdate;},set:function set(value){if(value!==this._autoUpdate){this._autoUpdate=value;if(!this._autoUpdate&&this._isConnectedToTicker){Ticker.shared.remove(this.update,this);this._isConnectedToTicker=false;}else if(this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()){Ticker.shared.add(this.update,this);this._isConnectedToTicker=true;}}}},{key:"updateFPS",get:function get(){return this._updateFPS;},set:function set(value){if(value!==this._updateFPS){this._updateFPS=value;}}}],[{key:"test",value:function test(source,extension){return globalThis.HTMLVideoElement&&source instanceof HTMLVideoElement||_VideoResource.TYPES.includes(extension);}}]);}(BaseImageResource);var VideoResource=_VideoResource;VideoResource.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];VideoResource.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};INSTALLED.push(ImageBitmapResource,ImageResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);var TransformFeedback=/*#__PURE__*/function(){function TransformFeedback(){_classCallCheck(this,TransformFeedback);this._glTransformFeedbacks={};this.buffers=[];this.disposeRunner=new Runner("disposeTransformFeedback");}return _createClass(TransformFeedback,[{key:"bindBuffer",value:function bindBuffer(index,buffer){this.buffers[index]=buffer;}},{key:"destroy",value:function destroy(){this.disposeRunner.emit(this,false);}}]);}();var VERSION="7.1.4";var Bounds=/*#__PURE__*/function(){function Bounds(){_classCallCheck(this,Bounds);this.minX=Infinity;this.minY=Infinity;this.maxX=-Infinity;this.maxY=-Infinity;this.rect=null;this.updateID=-1;}return _createClass(Bounds,[{key:"isEmpty",value:function isEmpty(){return this.minX>this.maxX||this.minY>this.maxY;}},{key:"clear",value:function clear(){this.minX=Infinity;this.minY=Infinity;this.maxX=-Infinity;this.maxY=-Infinity;}},{key:"getRectangle",value:function getRectangle(rect){if(this.minX>this.maxX||this.minY>this.maxY){return Rectangle.EMPTY;}rect=rect||new Rectangle(0,0,1,1);rect.x=this.minX;rect.y=this.minY;rect.width=this.maxX-this.minX;rect.height=this.maxY-this.minY;return rect;}},{key:"addPoint",value:function addPoint(point){this.minX=Math.min(this.minX,point.x);this.maxX=Math.max(this.maxX,point.x);this.minY=Math.min(this.minY,point.y);this.maxY=Math.max(this.maxY,point.y);}},{key:"addPointMatrix",value:function addPointMatrix(matrix,point){var a=matrix.a,b=matrix.b,c=matrix.c,d=matrix.d,tx=matrix.tx,ty=matrix.ty;var x=a*point.x+c*point.y+tx;var y=b*point.x+d*point.y+ty;this.minX=Math.min(this.minX,x);this.maxX=Math.max(this.maxX,x);this.minY=Math.min(this.minY,y);this.maxY=Math.max(this.maxY,y);}},{key:"addQuad",value:function addQuad(vertices){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;var x=vertices[0];var y=vertices[1];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[2];y=vertices[3];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[4];y=vertices[5];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[6];y=vertices[7];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY;}},{key:"addFrame",value:function addFrame(transform,x0,y0,x1,y1){this.addFrameMatrix(transform.worldTransform,x0,y0,x1,y1);}},{key:"addFrameMatrix",value:function addFrameMatrix(matrix,x0,y0,x1,y1){var a=matrix.a;var b=matrix.b;var c=matrix.c;var d=matrix.d;var tx=matrix.tx;var ty=matrix.ty;var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;var x=a*x0+c*y0+tx;var y=b*x0+d*y0+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x1+c*y0+tx;y=b*x1+d*y0+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x0+c*y1+tx;y=b*x0+d*y1+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x1+c*y1+tx;y=b*x1+d*y1+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY;}},{key:"addVertexData",value:function addVertexData(vertexData,beginOffset,endOffset){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;for(var i=beginOffset;i<endOffset;i+=2){var x=vertexData[i];var y=vertexData[i+1];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;}this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY;}},{key:"addVertices",value:function addVertices(transform,vertices,beginOffset,endOffset){this.addVerticesMatrix(transform.worldTransform,vertices,beginOffset,endOffset);}},{key:"addVerticesMatrix",value:function addVerticesMatrix(matrix,vertices,beginOffset,endOffset){var padX=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var padY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:padX;var a=matrix.a;var b=matrix.b;var c=matrix.c;var d=matrix.d;var tx=matrix.tx;var ty=matrix.ty;var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;for(var i=beginOffset;i<endOffset;i+=2){var rawX=vertices[i];var rawY=vertices[i+1];var x=a*rawX+c*rawY+tx;var y=d*rawY+b*rawX+ty;minX=Math.min(minX,x-padX);maxX=Math.max(maxX,x+padX);minY=Math.min(minY,y-padY);maxY=Math.max(maxY,y+padY);}this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY;}},{key:"addBounds",value:function addBounds(bounds){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=bounds.minX<minX?bounds.minX:minX;this.minY=bounds.minY<minY?bounds.minY:minY;this.maxX=bounds.maxX>maxX?bounds.maxX:maxX;this.maxY=bounds.maxY>maxY?bounds.maxY:maxY;}},{key:"addBoundsMask",value:function addBoundsMask(bounds,mask){var _minX=bounds.minX>mask.minX?bounds.minX:mask.minX;var _minY=bounds.minY>mask.minY?bounds.minY:mask.minY;var _maxX=bounds.maxX<mask.maxX?bounds.maxX:mask.maxX;var _maxY=bounds.maxY<mask.maxY?bounds.maxY:mask.maxY;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=_minX<minX?_minX:minX;this.minY=_minY<minY?_minY:minY;this.maxX=_maxX>maxX?_maxX:maxX;this.maxY=_maxY>maxY?_maxY:maxY;}}},{key:"addBoundsMatrix",value:function addBoundsMatrix(bounds,matrix){this.addFrameMatrix(matrix,bounds.minX,bounds.minY,bounds.maxX,bounds.maxY);}},{key:"addBoundsArea",value:function addBoundsArea(bounds,area){var _minX=bounds.minX>area.x?bounds.minX:area.x;var _minY=bounds.minY>area.y?bounds.minY:area.y;var _maxX=bounds.maxX<area.x+area.width?bounds.maxX:area.x+area.width;var _maxY=bounds.maxY<area.y+area.height?bounds.maxY:area.y+area.height;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=_minX<minX?_minX:minX;this.minY=_minY<minY?_minY:minY;this.maxX=_maxX>maxX?_maxX:maxX;this.maxY=_maxY>maxY?_maxY:maxY;}}},{key:"pad",value:function pad(){var paddingX=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var paddingY=arguments.length>1&&arguments[1]!==undefined?arguments[1]:paddingX;if(!this.isEmpty()){this.minX-=paddingX;this.maxX+=paddingX;this.minY-=paddingY;this.maxY+=paddingY;}}},{key:"addFramePad",value:function addFramePad(x0,y0,x1,y1,padX,padY){x0-=padX;y0-=padY;x1+=padX;y1+=padY;this.minX=this.minX<x0?this.minX:x0;this.maxX=this.maxX>x1?this.maxX:x1;this.minY=this.minY<y0?this.minY:y0;this.maxY=this.maxY>y1?this.maxY:y1;}}]);}();var DisplayObject=/*#__PURE__*/function(_EventEmitter4){function DisplayObject(){var _this38;_classCallCheck(this,DisplayObject);_this38=_callSuper(this,DisplayObject);_this38.tempDisplayObjectParent=null;_this38.transform=new Transform();_this38.alpha=1;_this38.visible=true;_this38.renderable=true;_this38.cullable=false;_this38.cullArea=null;_this38.parent=null;_this38.worldAlpha=1;_this38._lastSortedIndex=0;_this38._zIndex=0;_this38.filterArea=null;_this38.filters=null;_this38._enabledFilters=null;_this38._bounds=new Bounds();_this38._localBounds=null;_this38._boundsID=0;_this38._boundsRect=null;_this38._localBoundsRect=null;_this38._mask=null;_this38._maskRefCount=0;_this38._destroyed=false;_this38.isSprite=false;_this38.isMask=false;return _this38;}_inherits(DisplayObject,_EventEmitter4);return _createClass(DisplayObject,[{key:"destroyed",get:function get(){return this._destroyed;}},{key:"_recursivePostUpdateTransform",value:function _recursivePostUpdateTransform(){if(this.parent){this.parent._recursivePostUpdateTransform();this.transform.updateTransform(this.parent.transform);}else{this.transform.updateTransform(this._tempDisplayObjectParent.transform);}}},{key:"updateTransform",value:function updateTransform(){this._boundsID++;this.transform.updateTransform(this.parent.transform);this.worldAlpha=this.alpha*this.parent.worldAlpha;}},{key:"getBounds",value:function getBounds(skipUpdate,rect){if(!skipUpdate){if(!this.parent){this.parent=this._tempDisplayObjectParent;this.updateTransform();this.parent=null;}else{this._recursivePostUpdateTransform();this.updateTransform();}}if(this._bounds.updateID!==this._boundsID){this.calculateBounds();this._bounds.updateID=this._boundsID;}if(!rect){if(!this._boundsRect){this._boundsRect=new Rectangle();}rect=this._boundsRect;}return this._bounds.getRectangle(rect);}},{key:"getLocalBounds",value:function getLocalBounds(rect){if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new Rectangle();}rect=this._localBoundsRect;}if(!this._localBounds){this._localBounds=new Bounds();}var transformRef=this.transform;var parentRef=this.parent;this.parent=null;this.transform=this._tempDisplayObjectParent.transform;var worldBounds=this._bounds;var worldBoundsID=this._boundsID;this._bounds=this._localBounds;var bounds=this.getBounds(false,rect);this.parent=parentRef;this.transform=transformRef;this._bounds=worldBounds;this._bounds.updateID+=this._boundsID-worldBoundsID;return bounds;}},{key:"toGlobal",value:function toGlobal(position,point){var skipUpdate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!skipUpdate){this._recursivePostUpdateTransform();if(!this.parent){this.parent=this._tempDisplayObjectParent;this.displayObjectUpdateTransform();this.parent=null;}else{this.displayObjectUpdateTransform();}}return this.worldTransform.apply(position,point);}},{key:"toLocal",value:function toLocal(position,from,point,skipUpdate){if(from){position=from.toGlobal(position,point,skipUpdate);}if(!skipUpdate){this._recursivePostUpdateTransform();if(!this.parent){this.parent=this._tempDisplayObjectParent;this.displayObjectUpdateTransform();this.parent=null;}else{this.displayObjectUpdateTransform();}}return this.worldTransform.applyInverse(position,point);}},{key:"setParent",value:function setParent(container){if(!container||!container.addChild){throw new Error("setParent: Argument must be a Container");}container.addChild(this);return container;}},{key:"removeFromParent",value:function removeFromParent(){var _this$parent;(_this$parent=this.parent)===null||_this$parent===void 0||_this$parent.removeChild(this);}},{key:"setTransform",value:function setTransform(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var scaleX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var scaleY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var rotation=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var skewX=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var skewY=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var pivotX=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var pivotY=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;this.position.x=x;this.position.y=y;this.scale.x=!scaleX?1:scaleX;this.scale.y=!scaleY?1:scaleY;this.rotation=rotation;this.skew.x=skewX;this.skew.y=skewY;this.pivot.x=pivotX;this.pivot.y=pivotY;return this;}},{key:"destroy",value:function destroy(_options){this.removeFromParent();this._destroyed=true;this.transform=null;this.parent=null;this._bounds=null;this.mask=null;this.cullArea=null;this.filters=null;this.filterArea=null;this.hitArea=null;this.interactive=false;this.interactiveChildren=false;this.emit("destroyed");this.removeAllListeners();}},{key:"_tempDisplayObjectParent",get:function get(){if(this.tempDisplayObjectParent===null){this.tempDisplayObjectParent=new TemporaryDisplayObject();}return this.tempDisplayObjectParent;}},{key:"enableTempParent",value:function enableTempParent(){var myParent=this.parent;this.parent=this._tempDisplayObjectParent;return myParent;}},{key:"disableTempParent",value:function disableTempParent(cacheParent){this.parent=cacheParent;}},{key:"x",get:function get(){return this.position.x;},set:function set(value){this.transform.position.x=value;}},{key:"y",get:function get(){return this.position.y;},set:function set(value){this.transform.position.y=value;}},{key:"worldTransform",get:function get(){return this.transform.worldTransform;}},{key:"localTransform",get:function get(){return this.transform.localTransform;}},{key:"position",get:function get(){return this.transform.position;},set:function set(value){this.transform.position.copyFrom(value);}},{key:"scale",get:function get(){return this.transform.scale;},set:function set(value){this.transform.scale.copyFrom(value);}},{key:"pivot",get:function get(){return this.transform.pivot;},set:function set(value){this.transform.pivot.copyFrom(value);}},{key:"skew",get:function get(){return this.transform.skew;},set:function set(value){this.transform.skew.copyFrom(value);}},{key:"rotation",get:function get(){return this.transform.rotation;},set:function set(value){this.transform.rotation=value;}},{key:"angle",get:function get(){return this.transform.rotation*RAD_TO_DEG;},set:function set(value){this.transform.rotation=value*DEG_TO_RAD;}},{key:"zIndex",get:function get(){return this._zIndex;},set:function set(value){this._zIndex=value;if(this.parent){this.parent.sortDirty=true;}}},{key:"worldVisible",get:function get(){var item=this;do{if(!item.visible){return false;}item=item.parent;}while(item);return true;}},{key:"mask",get:function get(){return this._mask;},set:function set(value){if(this._mask===value){return;}if(this._mask){var maskObject=this._mask.isMaskData?this._mask.maskObject:this._mask;if(maskObject){maskObject._maskRefCount--;if(maskObject._maskRefCount===0){maskObject.renderable=true;maskObject.isMask=false;}}}this._mask=value;if(this._mask){var _maskObject=this._mask.isMaskData?this._mask.maskObject:this._mask;if(_maskObject){if(_maskObject._maskRefCount===0){_maskObject.renderable=false;_maskObject.isMask=true;}_maskObject._maskRefCount++;}}}}],[{key:"mixin",value:function mixin(source){var keys=Object.keys(source);for(var i=0;i<keys.length;++i){var propertyName=keys[i];Object.defineProperty(DisplayObject.prototype,propertyName,Object.getOwnPropertyDescriptor(source,propertyName));}}}]);}(EventEmitter);var TemporaryDisplayObject=/*#__PURE__*/function(_DisplayObject){function TemporaryDisplayObject(){var _this39;_classCallCheck(this,TemporaryDisplayObject);_this39=_callSuper(this,TemporaryDisplayObject,arguments);_this39.sortDirty=null;return _this39;}_inherits(TemporaryDisplayObject,_DisplayObject);return _createClass(TemporaryDisplayObject);}(DisplayObject);DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;var tempMatrix=new Matrix();function _sortChildren(a,b){if(a.zIndex===b.zIndex){return a._lastSortedIndex-b._lastSortedIndex;}return a.zIndex-b.zIndex;}var _Container=/*#__PURE__*/function(_DisplayObject2){function _Container(){var _this40;_classCallCheck(this,_Container);_this40=_callSuper(this,_Container);_this40.children=[];_this40.sortableChildren=_Container.defaultSortableChildren;_this40.sortDirty=false;return _this40;}_inherits(_Container,_DisplayObject2);return _createClass(_Container,[{key:"onChildrenChange",value:function onChildrenChange(_length){}},{key:"addChild",value:function addChild(){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.addChild(i<0||arguments.length<=i?undefined:arguments[i]);}}else{var child=arguments.length<=0?undefined:arguments[0];if(child.parent){child.parent.removeChild(child);}child.parent=this;this.sortDirty=true;child.transform._parentID=-1;this.children.push(child);this._boundsID++;this.onChildrenChange(this.children.length-1);this.emit("childAdded",child,this,this.children.length-1);child.emit("added",this);}return arguments.length<=0?undefined:arguments[0];}},{key:"addChildAt",value:function addChildAt(child,index){if(index<0||index>this.children.length){throw new Error("".concat(child,"addChildAt: The index ").concat(index," supplied is out of bounds ").concat(this.children.length));}if(child.parent){child.parent.removeChild(child);}child.parent=this;this.sortDirty=true;child.transform._parentID=-1;this.children.splice(index,0,child);this._boundsID++;this.onChildrenChange(index);child.emit("added",this);this.emit("childAdded",child,this,index);return child;}},{key:"swapChildren",value:function swapChildren(child,child2){if(child===child2){return;}var index1=this.getChildIndex(child);var index2=this.getChildIndex(child2);this.children[index1]=child2;this.children[index2]=child;this.onChildrenChange(index1<index2?index1:index2);}},{key:"getChildIndex",value:function getChildIndex(child){var index=this.children.indexOf(child);if(index===-1){throw new Error("The supplied DisplayObject must be a child of the caller");}return index;}},{key:"setChildIndex",value:function setChildIndex(child,index$1){if(index$1<0||index$1>=this.children.length){throw new Error("The index ".concat(index$1," supplied is out of bounds ").concat(this.children.length));}var currentIndex=this.getChildIndex(child);removeItems(this.children,currentIndex,1);this.children.splice(index$1,0,child);this.onChildrenChange(index$1);}},{key:"getChildAt",value:function getChildAt(index){if(index<0||index>=this.children.length){throw new Error("getChildAt: Index (".concat(index,") does not exist."));}return this.children[index];}},{key:"removeChild",value:function removeChild(){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.removeChild(i<0||arguments.length<=i?undefined:arguments[i]);}}else{var child=arguments.length<=0?undefined:arguments[0];var index$1=this.children.indexOf(child);if(index$1===-1)return null;child.parent=null;child.transform._parentID=-1;removeItems(this.children,index$1,1);this._boundsID++;this.onChildrenChange(index$1);child.emit("removed",this);this.emit("childRemoved",child,this,index$1);}return arguments.length<=0?undefined:arguments[0];}},{key:"removeChildAt",value:function removeChildAt(index$1){var child=this.getChildAt(index$1);child.parent=null;child.transform._parentID=-1;removeItems(this.children,index$1,1);this._boundsID++;this.onChildrenChange(index$1);child.emit("removed",this);this.emit("childRemoved",child,this,index$1);return child;}},{key:"removeChildren",value:function removeChildren(){var beginIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var endIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.children.length;var begin=beginIndex;var end=endIndex;var range=end-begin;var removed;if(range>0&&range<=end){removed=this.children.splice(begin,range);for(var i=0;i<removed.length;++i){removed[i].parent=null;if(removed[i].transform){removed[i].transform._parentID=-1;}}this._boundsID++;this.onChildrenChange(beginIndex);for(var _i19=0;_i19<removed.length;++_i19){removed[_i19].emit("removed",this);this.emit("childRemoved",removed[_i19],this,_i19);}return removed;}else if(range===0&&this.children.length===0){return[];}throw new RangeError("removeChildren: numeric values are outside the acceptable range.");}},{key:"sortChildren",value:function sortChildren(){var sortRequired=false;for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];child._lastSortedIndex=i;if(!sortRequired&&child.zIndex!==0){sortRequired=true;}}if(sortRequired&&this.children.length>1){this.children.sort(_sortChildren);}this.sortDirty=false;}},{key:"updateTransform",value:function updateTransform(){if(this.sortableChildren&&this.sortDirty){this.sortChildren();}this._boundsID++;this.transform.updateTransform(this.parent.transform);this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];if(child.visible){child.updateTransform();}}}},{key:"calculateBounds",value:function calculateBounds(){this._bounds.clear();this._calculateBounds();for(var i=0;i<this.children.length;i++){var child=this.children[i];if(!child.visible||!child.renderable){continue;}child.calculateBounds();if(child._mask){var maskObject=child._mask.isMaskData?child._mask.maskObject:child._mask;if(maskObject){maskObject.calculateBounds();this._bounds.addBoundsMask(child._bounds,maskObject._bounds);}else{this._bounds.addBounds(child._bounds);}}else if(child.filterArea){this._bounds.addBoundsArea(child._bounds,child.filterArea);}else{this._bounds.addBounds(child._bounds);}}this._bounds.updateID=this._boundsID;}},{key:"getLocalBounds",value:function getLocalBounds(rect){var skipChildrenUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var result=_get(_getPrototypeOf(_Container.prototype),"getLocalBounds",this).call(this,rect);if(!skipChildrenUpdate){for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];if(child.visible){child.updateTransform();}}}return result;}},{key:"_calculateBounds",value:function _calculateBounds(){}},{key:"_renderWithCulling",value:function _renderWithCulling(renderer){var sourceFrame=renderer.renderTexture.sourceFrame;if(!(sourceFrame.width>0&&sourceFrame.height>0)){return;}var bounds;var transform;if(this.cullArea){bounds=this.cullArea;transform=this.worldTransform;}else if(this._render!==_Container.prototype._render){bounds=this.getBounds(true);}var projectionTransform=renderer.projection.transform;if(projectionTransform){if(transform){transform=tempMatrix.copyFrom(transform);transform.prepend(projectionTransform);}else{transform=projectionTransform;}}if(bounds&&sourceFrame.intersects(bounds,transform)){this._render(renderer);}else if(this.cullArea){return;}for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];var childCullable=child.cullable;child.cullable=childCullable||!this.cullArea;child.render(renderer);child.cullable=childCullable;}}},{key:"render",value:function render(renderer){var _this$filters;if(!this.visible||this.worldAlpha<=0||!this.renderable){return;}if(this._mask||(_this$filters=this.filters)!==null&&_this$filters!==void 0&&_this$filters.length){this.renderAdvanced(renderer);}else if(this.cullable){this._renderWithCulling(renderer);}else{this._render(renderer);for(var i=0,j=this.children.length;i<j;++i){this.children[i].render(renderer);}}}},{key:"renderAdvanced",value:function renderAdvanced(renderer){var _this$_enabledFilters,_this$_enabledFilters2,_this$_enabledFilters3;var filters=this.filters;var mask=this._mask;if(filters){if(!this._enabledFilters){this._enabledFilters=[];}this._enabledFilters.length=0;for(var i=0;i<filters.length;i++){if(filters[i].enabled){this._enabledFilters.push(filters[i]);}}}var flush=filters&&((_this$_enabledFilters=this._enabledFilters)===null||_this$_enabledFilters===void 0?void 0:_this$_enabledFilters.length)||mask&&(!mask.isMaskData||mask.enabled&&(mask.autoDetect||mask.type!==MASK_TYPES.NONE));if(flush){renderer.batch.flush();}if(filters&&(_this$_enabledFilters2=this._enabledFilters)!==null&&_this$_enabledFilters2!==void 0&&_this$_enabledFilters2.length){renderer.filter.push(this,this._enabledFilters);}if(mask){renderer.mask.push(this,this._mask);}if(this.cullable){this._renderWithCulling(renderer);}else{this._render(renderer);for(var _i20=0,j=this.children.length;_i20<j;++_i20){this.children[_i20].render(renderer);}}if(flush){renderer.batch.flush();}if(mask){renderer.mask.pop(this);}if(filters&&(_this$_enabledFilters3=this._enabledFilters)!==null&&_this$_enabledFilters3!==void 0&&_this$_enabledFilters3.length){renderer.filter.pop();}}},{key:"_render",value:function _render(_renderer){}},{key:"destroy",value:function destroy(options){_get(_getPrototypeOf(_Container.prototype),"destroy",this).call(this);this.sortDirty=false;var destroyChildren=typeof options==="boolean"?options:options===null||options===void 0?void 0:options.children;var oldChildren=this.removeChildren(0,this.children.length);if(destroyChildren){for(var i=0;i<oldChildren.length;++i){oldChildren[i].destroy(options);}}}},{key:"width",get:function get(){return this.scale.x*this.getLocalBounds().width;},set:function set(value){var width=this.getLocalBounds().width;if(width!==0){this.scale.x=value/width;}else{this.scale.x=1;}this._width=value;}},{key:"height",get:function get(){return this.scale.y*this.getLocalBounds().height;},set:function set(value){var height=this.getLocalBounds().height;if(height!==0){this.scale.y=value/height;}else{this.scale.y=1;}this._height=value;}}]);}(DisplayObject);var Container=_Container;Container.defaultSortableChildren=false;Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;Object.defineProperties(settings,{SORTABLE_CHILDREN:{get:function get(){return Container.defaultSortableChildren;},set:function set(value){deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren");Container.defaultSortableChildren=value;}}});var tempPoint$2=new Point();var indices=new Uint16Array([0,1,2,0,2,3]);var Sprite=/*#__PURE__*/function(_Container2){function Sprite(texture){var _this41;_classCallCheck(this,Sprite);_this41=_callSuper(this,Sprite);_this41._anchor=new ObservablePoint(_this41._onAnchorUpdate,_this41,texture?texture.defaultAnchor.x:0,texture?texture.defaultAnchor.y:0);_this41._texture=null;_this41._width=0;_this41._height=0;_this41._tint=null;_this41._tintRGB=null;_this41.tint=16777215;_this41.blendMode=BLEND_MODES.NORMAL;_this41._cachedTint=16777215;_this41.uvs=null;_this41.texture=texture||Texture.EMPTY;_this41.vertexData=new Float32Array(8);_this41.vertexTrimmedData=null;_this41._transformID=-1;_this41._textureID=-1;_this41._transformTrimmedID=-1;_this41._textureTrimmedID=-1;_this41.indices=indices;_this41.pluginName="batch";_this41.isSprite=true;_this41._roundPixels=settings.ROUND_PIXELS;return _this41;}_inherits(Sprite,_Container2);return _createClass(Sprite,[{key:"_onTextureUpdate",value:function _onTextureUpdate(){this._textureID=-1;this._textureTrimmedID=-1;this._cachedTint=16777215;if(this._width){this.scale.x=sign(this.scale.x)*this._width/this._texture.orig.width;}if(this._height){this.scale.y=sign(this.scale.y)*this._height/this._texture.orig.height;}}},{key:"_onAnchorUpdate",value:function _onAnchorUpdate(){this._transformID=-1;this._transformTrimmedID=-1;}},{key:"calculateVertices",value:function calculateVertices(){var texture=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===texture._updateID){return;}if(this._textureID!==texture._updateID){this.uvs=this._texture._uvs.uvsFloat32;}this._transformID=this.transform._worldID;this._textureID=texture._updateID;var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var vertexData=this.vertexData;var trim=texture.trim;var orig=texture.orig;var anchor=this._anchor;var w0=0;var w1=0;var h0=0;var h1=0;if(trim){w1=trim.x-anchor._x*orig.width;w0=w1+trim.width;h1=trim.y-anchor._y*orig.height;h0=h1+trim.height;}else{w1=-anchor._x*orig.width;w0=w1+orig.width;h1=-anchor._y*orig.height;h0=h1+orig.height;}vertexData[0]=a*w1+c*h1+tx;vertexData[1]=d*h1+b*w1+ty;vertexData[2]=a*w0+c*h1+tx;vertexData[3]=d*h1+b*w0+ty;vertexData[4]=a*w0+c*h0+tx;vertexData[5]=d*h0+b*w0+ty;vertexData[6]=a*w1+c*h0+tx;vertexData[7]=d*h0+b*w1+ty;if(this._roundPixels){var resolution=settings.RESOLUTION;for(var i=0;i<vertexData.length;++i){vertexData[i]=Math.round(vertexData[i]*resolution)/resolution;}}}},{key:"calculateTrimmedVertices",value:function calculateTrimmedVertices(){if(!this.vertexTrimmedData){this.vertexTrimmedData=new Float32Array(8);}else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID){return;}this._transformTrimmedID=this.transform._worldID;this._textureTrimmedID=this._texture._updateID;var texture=this._texture;var vertexData=this.vertexTrimmedData;var orig=texture.orig;var anchor=this._anchor;var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var w1=-anchor._x*orig.width;var w0=w1+orig.width;var h1=-anchor._y*orig.height;var h0=h1+orig.height;vertexData[0]=a*w1+c*h1+tx;vertexData[1]=d*h1+b*w1+ty;vertexData[2]=a*w0+c*h1+tx;vertexData[3]=d*h1+b*w0+ty;vertexData[4]=a*w0+c*h0+tx;vertexData[5]=d*h0+b*w0+ty;vertexData[6]=a*w1+c*h0+tx;vertexData[7]=d*h0+b*w1+ty;}},{key:"_render",value:function _render(renderer){this.calculateVertices();renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]);renderer.plugins[this.pluginName].render(this);}},{key:"_calculateBounds",value:function _calculateBounds(){var trim=this._texture.trim;var orig=this._texture.orig;if(!trim||trim.width===orig.width&&trim.height===orig.height){this.calculateVertices();this._bounds.addQuad(this.vertexData);}else{this.calculateTrimmedVertices();this._bounds.addQuad(this.vertexTrimmedData);}}},{key:"getLocalBounds",value:function getLocalBounds(rect){if(this.children.length===0){if(!this._localBounds){this._localBounds=new Bounds();}this._localBounds.minX=this._texture.orig.width*-this._anchor._x;this._localBounds.minY=this._texture.orig.height*-this._anchor._y;this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x);this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y);if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new Rectangle();}rect=this._localBoundsRect;}return this._localBounds.getRectangle(rect);}return _get(_getPrototypeOf(Sprite.prototype),"getLocalBounds",this).call(this,rect);}},{key:"containsPoint",value:function containsPoint(point){this.worldTransform.applyInverse(point,tempPoint$2);var width=this._texture.orig.width;var height=this._texture.orig.height;var x1=-width*this.anchor.x;var y1=0;if(tempPoint$2.x>=x1&&tempPoint$2.x<x1+width){y1=-height*this.anchor.y;if(tempPoint$2.y>=y1&&tempPoint$2.y<y1+height){return true;}}return false;}},{key:"destroy",value:function destroy(options){_get(_getPrototypeOf(Sprite.prototype),"destroy",this).call(this,options);this._texture.off("update",this._onTextureUpdate,this);this._anchor=null;var destroyTexture=typeof options==="boolean"?options:options===null||options===void 0?void 0:options.texture;if(destroyTexture){var destroyBaseTexture=typeof options==="boolean"?options:options===null||options===void 0?void 0:options.baseTexture;this._texture.destroy(!!destroyBaseTexture);}this._texture=null;}},{key:"roundPixels",get:function get(){return this._roundPixels;},set:function set(value){if(this._roundPixels!==value){this._transformID=-1;}this._roundPixels=value;}},{key:"width",get:function get(){return Math.abs(this.scale.x)*this._texture.orig.width;},set:function set(value){var s=sign(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width;this._width=value;}},{key:"height",get:function get(){return Math.abs(this.scale.y)*this._texture.orig.height;},set:function set(value){var s=sign(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height;this._height=value;}},{key:"anchor",get:function get(){return this._anchor;},set:function set(value){this._anchor.copyFrom(value);}},{key:"tint",get:function get(){return this._tint;},set:function set(value){this._tint=value;this._tintRGB=(value>>16)+(value&65280)+((value&255)<<16);}},{key:"texture",get:function get(){return this._texture;},set:function set(value){if(this._texture===value){return;}if(this._texture){this._texture.off("update",this._onTextureUpdate,this);}this._texture=value||Texture.EMPTY;this._cachedTint=16777215;this._textureID=-1;this._textureTrimmedID=-1;if(value){if(value.baseTexture.valid){this._onTextureUpdate();}else{value.once("update",this._onTextureUpdate,this);}}}}],[{key:"from",value:function from(source,options){var texture=source instanceof Texture?source:Texture.from(source,options);return new Sprite(texture);}}]);}(Container);var _tempMatrix=new Matrix();DisplayObject.prototype._cacheAsBitmap=false;DisplayObject.prototype._cacheData=null;DisplayObject.prototype._cacheAsBitmapResolution=null;DisplayObject.prototype._cacheAsBitmapMultisample=null;var CacheData=/*#__PURE__*/_createClass(function CacheData(){_classCallCheck(this,CacheData);this.textureCacheId=null;this.originalRender=null;this.originalRenderCanvas=null;this.originalCalculateBounds=null;this.originalGetLocalBounds=null;this.originalUpdateTransform=null;this.originalDestroy=null;this.originalMask=null;this.originalFilterArea=null;this.originalContainsPoint=null;this.sprite=null;});Object.defineProperties(DisplayObject.prototype,{cacheAsBitmapResolution:{get:function get(){return this._cacheAsBitmapResolution;},set:function set(resolution){if(resolution===this._cacheAsBitmapResolution){return;}this._cacheAsBitmapResolution=resolution;if(this.cacheAsBitmap){this.cacheAsBitmap=false;this.cacheAsBitmap=true;}}},cacheAsBitmapMultisample:{get:function get(){return this._cacheAsBitmapMultisample;},set:function set(multisample){if(multisample===this._cacheAsBitmapMultisample){return;}this._cacheAsBitmapMultisample=multisample;if(this.cacheAsBitmap){this.cacheAsBitmap=false;this.cacheAsBitmap=true;}}},cacheAsBitmap:{get:function get(){return this._cacheAsBitmap;},set:function set(value){if(this._cacheAsBitmap===value){return;}this._cacheAsBitmap=value;var data;if(value){if(!this._cacheData){this._cacheData=new CacheData();}data=this._cacheData;data.originalRender=this.render;data.originalRenderCanvas=this.renderCanvas;data.originalUpdateTransform=this.updateTransform;data.originalCalculateBounds=this.calculateBounds;data.originalGetLocalBounds=this.getLocalBounds;data.originalDestroy=this.destroy;data.originalContainsPoint=this.containsPoint;data.originalMask=this._mask;data.originalFilterArea=this.filterArea;this.render=this._renderCached;this.renderCanvas=this._renderCachedCanvas;this.destroy=this._cacheAsBitmapDestroy;}else{data=this._cacheData;if(data.sprite){this._destroyCachedDisplayObject();}this.render=data.originalRender;this.renderCanvas=data.originalRenderCanvas;this.calculateBounds=data.originalCalculateBounds;this.getLocalBounds=data.originalGetLocalBounds;this.destroy=data.originalDestroy;this.updateTransform=data.originalUpdateTransform;this.containsPoint=data.originalContainsPoint;this._mask=data.originalMask;this.filterArea=data.originalFilterArea;}}}});DisplayObject.prototype._renderCached=function _renderCached(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return;}this._initCachedDisplayObject(renderer);this._cacheData.sprite.transform._worldID=this.transform._worldID;this._cacheData.sprite.worldAlpha=this.worldAlpha;this._cacheData.sprite._render(renderer);};DisplayObject.prototype._initCachedDisplayObject=function _initCachedDisplayObject(renderer){var _this$_cacheData,_this$filters2,_this$cacheAsBitmapMu;if((_this$_cacheData=this._cacheData)!==null&&_this$_cacheData!==void 0&&_this$_cacheData.sprite){return;}var cacheAlpha=this.alpha;this.alpha=1;renderer.batch.flush();var bounds=this.getLocalBounds(null,true).clone();if((_this$filters2=this.filters)!==null&&_this$filters2!==void 0&&_this$filters2.length){var padding=this.filters[0].padding;bounds.pad(padding);}bounds.ceil(settings.RESOLUTION);var cachedRenderTexture=renderer.renderTexture.current;var cachedSourceFrame=renderer.renderTexture.sourceFrame.clone();var cachedDestinationFrame=renderer.renderTexture.destinationFrame.clone();var cachedProjectionTransform=renderer.projection.transform;var renderTexture=RenderTexture.create({width:bounds.width,height:bounds.height,resolution:this.cacheAsBitmapResolution||renderer.resolution,multisample:(_this$cacheAsBitmapMu=this.cacheAsBitmapMultisample)!==null&&_this$cacheAsBitmapMu!==void 0?_this$cacheAsBitmapMu:renderer.multisample});var textureCacheId="cacheAsBitmap_".concat(uid());this._cacheData.textureCacheId=textureCacheId;BaseTexture.addToCache(renderTexture.baseTexture,textureCacheId);Texture.addToCache(renderTexture,textureCacheId);var m=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-bounds.x,-bounds.y);this.render=this._cacheData.originalRender;renderer.render(this,{renderTexture:renderTexture,clear:true,transform:m,skipUpdateTransform:false});renderer.framebuffer.blit();renderer.projection.transform=cachedProjectionTransform;renderer.renderTexture.bind(cachedRenderTexture,cachedSourceFrame,cachedDestinationFrame);this.render=this._renderCached;this.updateTransform=this.displayObjectUpdateTransform;this.calculateBounds=this._calculateCachedBounds;this.getLocalBounds=this._getCachedLocalBounds;this._mask=null;this.filterArea=null;this.alpha=cacheAlpha;var cachedSprite=new Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform;cachedSprite.anchor.x=-(bounds.x/bounds.width);cachedSprite.anchor.y=-(bounds.y/bounds.height);cachedSprite.alpha=cacheAlpha;cachedSprite._bounds=this._bounds;this._cacheData.sprite=cachedSprite;this.transform._parentID=-1;if(!this.parent){this.enableTempParent();this.updateTransform();this.disableTempParent(null);}else{this.updateTransform();}this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite);};DisplayObject.prototype._renderCachedCanvas=function _renderCachedCanvas(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return;}this._initCachedDisplayObjectCanvas(renderer);this._cacheData.sprite.worldAlpha=this.worldAlpha;this._cacheData.sprite._renderCanvas(renderer);};DisplayObject.prototype._initCachedDisplayObjectCanvas=function _initCachedDisplayObjectCanvas(renderer){var _this$_cacheData2;if((_this$_cacheData2=this._cacheData)!==null&&_this$_cacheData2!==void 0&&_this$_cacheData2.sprite){return;}var bounds=this.getLocalBounds(null,true);var cacheAlpha=this.alpha;this.alpha=1;var cachedRenderTarget=renderer.canvasContext.activeContext;var cachedProjectionTransform=renderer._projTransform;bounds.ceil(settings.RESOLUTION);var renderTexture=RenderTexture.create({width:bounds.width,height:bounds.height});var textureCacheId="cacheAsBitmap_".concat(uid());this._cacheData.textureCacheId=textureCacheId;BaseTexture.addToCache(renderTexture.baseTexture,textureCacheId);Texture.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;this.transform.localTransform.copyTo(m);m.invert();m.tx-=bounds.x;m.ty-=bounds.y;this.renderCanvas=this._cacheData.originalRenderCanvas;renderer.render(this,{renderTexture:renderTexture,clear:true,transform:m,skipUpdateTransform:false});renderer.canvasContext.activeContext=cachedRenderTarget;renderer._projTransform=cachedProjectionTransform;this.renderCanvas=this._renderCachedCanvas;this.updateTransform=this.displayObjectUpdateTransform;this.calculateBounds=this._calculateCachedBounds;this.getLocalBounds=this._getCachedLocalBounds;this._mask=null;this.filterArea=null;this.alpha=cacheAlpha;var cachedSprite=new Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform;cachedSprite.anchor.x=-(bounds.x/bounds.width);cachedSprite.anchor.y=-(bounds.y/bounds.height);cachedSprite.alpha=cacheAlpha;cachedSprite._bounds=this._bounds;this._cacheData.sprite=cachedSprite;this.transform._parentID=-1;if(!this.parent){this.parent=renderer._tempDisplayObjectParent;this.updateTransform();this.parent=null;}else{this.updateTransform();}this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite);};DisplayObject.prototype._calculateCachedBounds=function _calculateCachedBounds(){this._bounds.clear();this._cacheData.sprite.transform._worldID=this.transform._worldID;this._cacheData.sprite._calculateBounds();this._bounds.updateID=this._boundsID;};DisplayObject.prototype._getCachedLocalBounds=function _getCachedLocalBounds(){return this._cacheData.sprite.getLocalBounds(null);};DisplayObject.prototype._destroyCachedDisplayObject=function _destroyCachedDisplayObject(){this._cacheData.sprite._texture.destroy(true);this._cacheData.sprite=null;BaseTexture.removeFromCache(this._cacheData.textureCacheId);Texture.removeFromCache(this._cacheData.textureCacheId);this._cacheData.textureCacheId=null;};DisplayObject.prototype._cacheAsBitmapDestroy=function _cacheAsBitmapDestroy(options){this.cacheAsBitmap=false;this.destroy(options);};DisplayObject.prototype.name=null;Container.prototype.getChildByName=function getChildByName(name,deep){for(var i=0,j=this.children.length;i<j;i++){if(this.children[i].name===name){return this.children[i];}}if(deep){for(var _i21=0,_j5=this.children.length;_i21<_j5;_i21++){var child=this.children[_i21];if(!child.getChildByName){continue;}var target=child.getChildByName(name,true);if(target){return target;}}}return null;};DisplayObject.prototype.getGlobalPosition=function getGlobalPosition(){var point=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Point();var skipUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.parent){this.parent.toGlobal(this.position,point,skipUpdate);}else{point.x=this.position.x;point.y=this.position.y;}return point;};var fragment$6="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n";var AlphaFilter=/*#__PURE__*/function(_Filter3){function AlphaFilter(){var _this42;var alpha=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;_classCallCheck(this,AlphaFilter);_this42=_callSuper(this,AlphaFilter,[defaultVertex,fragment$6,{uAlpha:1}]);_this42.alpha=alpha;return _this42;}_inherits(AlphaFilter,_Filter3);return _createClass(AlphaFilter,[{key:"alpha",get:function get(){return this.uniforms.uAlpha;},set:function set(value){this.uniforms.uAlpha=value;}}]);}(Filter);var GAUSSIAN_VALUES={5:[0.153388,0.221461,0.250301],7:[0.071303,0.131514,0.189879,0.214607],9:[0.028532,0.067234,0.124009,0.179044,0.20236],11:[93e-4,0.028002,0.065984,0.121703,0.175713,0.198596],13:[2406e-6,9255e-6,0.027867,0.065666,0.121117,0.174868,0.197641],15:[489e-6,2403e-6,9246e-6,0.02784,0.065602,0.120999,0.174697,0.197448]};var fragTemplate=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");function generateBlurFragSource(kernelSize){var kernel=GAUSSIAN_VALUES[kernelSize];var halfLength=kernel.length;var fragSource=fragTemplate;var blurLoop="";var template="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";var value;for(var i=0;i<kernelSize;i++){var blur=template.replace("%index%",i.toString());value=i;if(i>=halfLength){value=kernelSize-i-1;}blur=blur.replace("%value%",kernel[value].toString());blurLoop+=blur;blurLoop+="\n";}fragSource=fragSource.replace("%blur%",blurLoop);fragSource=fragSource.replace("%size%",kernelSize.toString());return fragSource;}var vertTemplate="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }";function generateBlurVertSource(kernelSize,x){var halfLength=Math.ceil(kernelSize/2);var vertSource=vertTemplate;var blurLoop="";var template;if(x){template="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);";}else{template="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";}for(var i=0;i<kernelSize;i++){var blur=template.replace("%index%",i.toString());blur=blur.replace("%sampleIndex%","".concat(i-(halfLength-1),".0"));blurLoop+=blur;blurLoop+="\n";}vertSource=vertSource.replace("%blur%",blurLoop);vertSource=vertSource.replace("%size%",kernelSize.toString());return vertSource;}var BlurFilterPass=/*#__PURE__*/function(_Filter4){function BlurFilterPass(horizontal){var _this43;var strength=arguments.length>1&&arguments[1]!==undefined?arguments[1]:8;var quality=arguments.length>2&&arguments[2]!==undefined?arguments[2]:4;var resolution=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Filter.defaultResolution;var kernelSize=arguments.length>4&&arguments[4]!==undefined?arguments[4]:5;_classCallCheck(this,BlurFilterPass);var vertSrc=generateBlurVertSource(kernelSize,horizontal);var fragSrc=generateBlurFragSource(kernelSize);_this43=_callSuper(this,BlurFilterPass,[vertSrc,fragSrc]);_this43.horizontal=horizontal;_this43.resolution=resolution;_this43._quality=0;_this43.quality=quality;_this43.blur=strength;return _this43;}_inherits(BlurFilterPass,_Filter4);return _createClass(BlurFilterPass,[{key:"apply",value:function apply(filterManager,input,output,clearMode){if(output){if(this.horizontal){this.uniforms.strength=1/output.width*(output.width/input.width);}else{this.uniforms.strength=1/output.height*(output.height/input.height);}}else{if(this.horizontal){this.uniforms.strength=1/filterManager.renderer.width*(filterManager.renderer.width/input.width);}else{this.uniforms.strength=1/filterManager.renderer.height*(filterManager.renderer.height/input.height);}}this.uniforms.strength*=this.strength;this.uniforms.strength/=this.passes;if(this.passes===1){filterManager.applyFilter(this,input,output,clearMode);}else{var renderTarget=filterManager.getFilterTexture();var renderer=filterManager.renderer;var flip=input;var flop=renderTarget;this.state.blend=false;filterManager.applyFilter(this,flip,flop,CLEAR_MODES.CLEAR);for(var i=1;i<this.passes-1;i++){filterManager.bindAndClear(flip,CLEAR_MODES.BLIT);this.uniforms.uSampler=flop;var _temp=flop;flop=flip;flip=_temp;renderer.shader.bind(this);renderer.geometry.draw(5);}this.state.blend=true;filterManager.applyFilter(this,flop,output,clearMode);filterManager.returnFilterTexture(renderTarget);}}},{key:"blur",get:function get(){return this.strength;},set:function set(value){this.padding=1+Math.abs(value)*2;this.strength=value;}},{key:"quality",get:function get(){return this._quality;},set:function set(value){this._quality=value;this.passes=value;}}]);}(Filter);var BlurFilter=/*#__PURE__*/function(_Filter5){function BlurFilter(){var _this44;var strength=arguments.length>0&&arguments[0]!==undefined?arguments[0]:8;var quality=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var resolution=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Filter.defaultResolution;var kernelSize=arguments.length>3&&arguments[3]!==undefined?arguments[3]:5;_classCallCheck(this,BlurFilter);_this44=_callSuper(this,BlurFilter);_this44.blurXFilter=new BlurFilterPass(true,strength,quality,resolution,kernelSize);_this44.blurYFilter=new BlurFilterPass(false,strength,quality,resolution,kernelSize);_this44.resolution=resolution;_this44.quality=quality;_this44.blur=strength;_this44.repeatEdgePixels=false;return _this44;}_inherits(BlurFilter,_Filter5);return _createClass(BlurFilter,[{key:"apply",value:function apply(filterManager,input,output,clearMode){var xStrength=Math.abs(this.blurXFilter.strength);var yStrength=Math.abs(this.blurYFilter.strength);if(xStrength&&yStrength){var renderTarget=filterManager.getFilterTexture();this.blurXFilter.apply(filterManager,input,renderTarget,CLEAR_MODES.CLEAR);this.blurYFilter.apply(filterManager,renderTarget,output,clearMode);filterManager.returnFilterTexture(renderTarget);}else if(yStrength){this.blurYFilter.apply(filterManager,input,output,clearMode);}else{this.blurXFilter.apply(filterManager,input,output,clearMode);}}},{key:"updatePadding",value:function updatePadding(){if(this._repeatEdgePixels){this.padding=0;}else{this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2;}}},{key:"blur",get:function get(){return this.blurXFilter.blur;},set:function set(value){this.blurXFilter.blur=this.blurYFilter.blur=value;this.updatePadding();}},{key:"quality",get:function get(){return this.blurXFilter.quality;},set:function set(value){this.blurXFilter.quality=this.blurYFilter.quality=value;}},{key:"blurX",get:function get(){return this.blurXFilter.blur;},set:function set(value){this.blurXFilter.blur=value;this.updatePadding();}},{key:"blurY",get:function get(){return this.blurYFilter.blur;},set:function set(value){this.blurYFilter.blur=value;this.updatePadding();}},{key:"blendMode",get:function get(){return this.blurYFilter.blendMode;},set:function set(value){this.blurYFilter.blendMode=value;}},{key:"repeatEdgePixels",get:function get(){return this._repeatEdgePixels;},set:function set(value){this._repeatEdgePixels=value;this.updatePadding();}}]);}(Filter);var fragment$5="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n";var ColorMatrixFilter=/*#__PURE__*/function(_Filter6){function ColorMatrixFilter(){var _this45;_classCallCheck(this,ColorMatrixFilter);var uniforms={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};_this45=_callSuper(this,ColorMatrixFilter,[defaultFilterVertex,fragment$5,uniforms]);_this45.alpha=1;return _this45;}_inherits(ColorMatrixFilter,_Filter6);return _createClass(ColorMatrixFilter,[{key:"_loadMatrix",value:function _loadMatrix(matrix){var multiply=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var newMatrix=matrix;if(multiply){this._multiply(newMatrix,this.uniforms.m,matrix);newMatrix=this._colorMatrix(newMatrix);}this.uniforms.m=newMatrix;}},{key:"_multiply",value:function _multiply(out,a,b){out[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15];out[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16];out[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17];out[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18];out[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19]+a[4];out[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15];out[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16];out[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17];out[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18];out[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19]+a[9];out[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15];out[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16];out[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17];out[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18];out[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19]+a[14];out[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15];out[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16];out[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17];out[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18];out[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19]+a[19];return out;}},{key:"_colorMatrix",value:function _colorMatrix(matrix){var m=new Float32Array(matrix);m[4]/=255;m[9]/=255;m[14]/=255;m[19]/=255;return m;}},{key:"brightness",value:function brightness(b,multiply){var matrix=[b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"tint",value:function tint(color,multiply){var r=color>>16&255;var g=color>>8&255;var b=color&255;var matrix=[r/255,0,0,0,0,0,g/255,0,0,0,0,0,b/255,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"greyscale",value:function greyscale(scale,multiply){var matrix=[scale,scale,scale,0,0,scale,scale,scale,0,0,scale,scale,scale,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"blackAndWhite",value:function blackAndWhite(multiply){var matrix=[0.3,0.6,0.1,0,0,0.3,0.6,0.1,0,0,0.3,0.6,0.1,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"hue",value:function hue(rotation,multiply){rotation=(rotation||0)/180*Math.PI;var cosR=Math.cos(rotation);var sinR=Math.sin(rotation);var sqrt=Math.sqrt;var w=1/3;var sqrW=sqrt(w);var a00=cosR+(1-cosR)*w;var a01=w*(1-cosR)-sqrW*sinR;var a02=w*(1-cosR)+sqrW*sinR;var a10=w*(1-cosR)+sqrW*sinR;var a11=cosR+w*(1-cosR);var a12=w*(1-cosR)-sqrW*sinR;var a20=w*(1-cosR)-sqrW*sinR;var a21=w*(1-cosR)+sqrW*sinR;var a22=cosR+w*(1-cosR);var matrix=[a00,a01,a02,0,0,a10,a11,a12,0,0,a20,a21,a22,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"contrast",value:function contrast(amount,multiply){var v=(amount||0)+1;var o=-0.5*(v-1);var matrix=[v,0,0,0,o,0,v,0,0,o,0,0,v,0,o,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"saturate",value:function saturate(){var amount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var multiply=arguments.length>1?arguments[1]:undefined;var x=amount*2/3+1;var y=(x-1)*-0.5;var matrix=[x,y,y,0,0,y,x,y,0,0,y,y,x,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"desaturate",value:function desaturate(){this.saturate(-1);}},{key:"negative",value:function negative(multiply){var matrix=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"sepia",value:function sepia(multiply){var matrix=[0.393,0.7689999,0.18899999,0,0,0.349,0.6859999,0.16799999,0,0,0.272,0.5339999,0.13099999,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"technicolor",value:function technicolor(multiply){var matrix=[1.9125277891456083,-0.8545344976951645,-0.09155508482755585,0,11.793603434377337,-0.3087833385928097,1.7658908555458428,-0.10601743074722245,0,-70.35205161461398,-0.231103377548616,-0.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"polaroid",value:function polaroid(multiply){var matrix=[1.438,-0.062,-0.062,0,0,-0.122,1.378,-0.122,0,0,-0.016,-0.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"toBGR",value:function toBGR(multiply){var matrix=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"kodachrome",value:function kodachrome(multiply){var matrix=[1.1285582396593525,-0.3967382283601348,-0.03992559172921793,0,63.72958762196502,-0.16404339962244616,1.0835251566291304,-0.05498805115633132,0,24.732407896706203,-0.16786010706155763,-0.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"browni",value:function browni(multiply){var matrix=[0.5997023498159715,0.34553243048391263,-0.2708298674538042,0,47.43192855600873,-0.037703249837783157,0.8609577587992641,0.15059552388459913,0,-36.96841498319127,0.24113635128153335,-0.07441037908422492,0.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"vintage",value:function vintage(multiply){var matrix=[0.6279345635605994,0.3202183420819367,-0.03965408211312453,0,9.651285835294123,0.02578397704808868,0.6441188644374771,0.03259127616149294,0,7.462829176470591,0.0466055556782719,-0.0851232987247891,0.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"colorTone",value:function colorTone(desaturation,toned,lightColor,darkColor,multiply){desaturation=desaturation||0.2;toned=toned||0.15;lightColor=lightColor||16770432;darkColor=darkColor||3375104;var lR=(lightColor>>16&255)/255;var lG=(lightColor>>8&255)/255;var lB=(lightColor&255)/255;var dR=(darkColor>>16&255)/255;var dG=(darkColor>>8&255)/255;var dB=(darkColor&255)/255;var matrix=[0.3,0.59,0.11,0,0,lR,lG,lB,desaturation,0,dR,dG,dB,toned,0,lR-dR,lG-dG,lB-dB,0,0];this._loadMatrix(matrix,multiply);}},{key:"night",value:function night(intensity,multiply){intensity=intensity||0.1;var matrix=[intensity*-2,-intensity,0,0,0,-intensity,0,intensity,0,0,0,intensity,intensity*2,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"predator",value:function predator(amount,multiply){var matrix=[11.224130630493164*amount,-4.794486999511719*amount,-2.8746118545532227*amount,0*amount,0.40342438220977783*amount,-3.6330697536468506*amount,9.193157196044922*amount,-2.951810836791992*amount,0*amount,-1.316135048866272*amount,-3.2184197902679443*amount,-4.2375030517578125*amount,7.476448059082031*amount,0*amount,0.8044459223747253*amount,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"lsd",value:function lsd(multiply){var matrix=[2,-0.4,0.5,0,0,-0.5,2,-0.4,0,0,-0.4,-0.5,3,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply);}},{key:"reset",value:function reset(){var matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(matrix,false);}},{key:"matrix",get:function get(){return this.uniforms.m;},set:function set(value){this.uniforms.m=value;}},{key:"alpha",get:function get(){return this.uniforms.uAlpha;},set:function set(value){this.uniforms.uAlpha=value;}}]);}(Filter);ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;var fragment$4="varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n";var vertex$3="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n";var DisplacementFilter=/*#__PURE__*/function(_Filter7){function DisplacementFilter(sprite,scale){var _this46;_classCallCheck(this,DisplacementFilter);var maskMatrix=new Matrix();sprite.renderable=false;_this46=_callSuper(this,DisplacementFilter,[vertex$3,fragment$4,{mapSampler:sprite._texture,filterMatrix:maskMatrix,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}]);_this46.maskSprite=sprite;_this46.maskMatrix=maskMatrix;if(scale===null||scale===void 0){scale=20;}_this46.scale=new Point(scale,scale);return _this46;}_inherits(DisplacementFilter,_Filter7);return _createClass(DisplacementFilter,[{key:"apply",value:function apply(filterManager,input,output,clearMode){this.uniforms.filterMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,this.maskSprite);this.uniforms.scale.x=this.scale.x;this.uniforms.scale.y=this.scale.y;var wt=this.maskSprite.worldTransform;var lenX=Math.sqrt(wt.a*wt.a+wt.b*wt.b);var lenY=Math.sqrt(wt.c*wt.c+wt.d*wt.d);if(lenX!==0&&lenY!==0){this.uniforms.rotation[0]=wt.a/lenX;this.uniforms.rotation[1]=wt.b/lenX;this.uniforms.rotation[2]=wt.c/lenY;this.uniforms.rotation[3]=wt.d/lenY;}filterManager.applyFilter(this,input,output,clearMode);}},{key:"map",get:function get(){return this.uniforms.mapSampler;},set:function set(value){this.uniforms.mapSampler=value;}}]);}(Filter);var fragment$3="varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it's\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n";var vertex$2="\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n";var FXAAFilter=/*#__PURE__*/function(_Filter8){function FXAAFilter(){_classCallCheck(this,FXAAFilter);return _callSuper(this,FXAAFilter,[vertex$2,fragment$3]);}_inherits(FXAAFilter,_Filter8);return _createClass(FXAAFilter);}(Filter);var fragment$2="precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n";var NoiseFilter=/*#__PURE__*/function(_Filter9){function NoiseFilter(){var _this47;var noise=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0.5;var seed=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Math.random();_classCallCheck(this,NoiseFilter);_this47=_callSuper(this,NoiseFilter,[defaultFilterVertex,fragment$2,{uNoise:0,uSeed:0}]);_this47.noise=noise;_this47.seed=seed;return _this47;}_inherits(NoiseFilter,_Filter9);return _createClass(NoiseFilter,[{key:"noise",get:function get(){return this.uniforms.uNoise;},set:function set(value){this.uniforms.uNoise=value;}},{key:"seed",get:function get(){return this.uniforms.uSeed;},set:function set(value){this.uniforms.uSeed=value;}}]);}(Filter);var filters={AlphaFilter:AlphaFilter,BlurFilter:BlurFilter,BlurFilterPass:BlurFilterPass,ColorMatrixFilter:ColorMatrixFilter,DisplacementFilter:DisplacementFilter,FXAAFilter:FXAAFilter,NoiseFilter:NoiseFilter};Object.entries(filters).forEach(function(_ref9){var _ref10=_slicedToArray(_ref9,2),key=_ref10[0],FilterClass=_ref10[1];Object.defineProperty(filters,key,{get:function get(){deprecation("7.1.0","filters.".concat(key," has moved to ").concat(key));return FilterClass;}});});var FederatedEvent=/*#__PURE__*/function(){function FederatedEvent(manager){_classCallCheck(this,FederatedEvent);this.bubbles=true;this.cancelBubble=true;this.cancelable=false;this.composed=false;this.defaultPrevented=false;this.eventPhase=FederatedEvent.prototype.NONE;this.propagationStopped=false;this.propagationImmediatelyStopped=false;this.layer=new Point();this.page=new Point();this.AT_TARGET=1;this.BUBBLING_PHASE=2;this.CAPTURING_PHASE=3;this.NONE=0;this.manager=manager;}return _createClass(FederatedEvent,[{key:"layerX",get:function get(){return this.layer.x;}},{key:"layerY",get:function get(){return this.layer.y;}},{key:"pageX",get:function get(){return this.page.x;}},{key:"pageY",get:function get(){return this.page.y;}},{key:"data",get:function get(){return this;}},{key:"composedPath",value:function composedPath(){if(this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)){this.path=this.target?this.manager.propagationPath(this.target):[];}return this.path;}},{key:"initEvent",value:function initEvent(_type,_bubbles,_cancelable){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.");}},{key:"initUIEvent",value:function initUIEvent(_typeArg,_bubblesArg,_cancelableArg,_viewArg,_detailArg){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.");}},{key:"preventDefault",value:function preventDefault(){if(this.nativeEvent instanceof Event&&this.nativeEvent.cancelable){this.nativeEvent.preventDefault();}this.defaultPrevented=true;}},{key:"stopImmediatePropagation",value:function stopImmediatePropagation(){this.propagationImmediatelyStopped=true;}},{key:"stopPropagation",value:function stopPropagation(){this.propagationStopped=true;}}]);}();var FederatedMouseEvent=/*#__PURE__*/function(_FederatedEvent){function FederatedMouseEvent(){var _this48;_classCallCheck(this,FederatedMouseEvent);_this48=_callSuper(this,FederatedMouseEvent,arguments);_this48.client=new Point();_this48.movement=new Point();_this48.offset=new Point();_this48.global=new Point();_this48.screen=new Point();return _this48;}_inherits(FederatedMouseEvent,_FederatedEvent);return _createClass(FederatedMouseEvent,[{key:"clientX",get:function get(){return this.client.x;}},{key:"clientY",get:function get(){return this.client.y;}},{key:"x",get:function get(){return this.clientX;}},{key:"y",get:function get(){return this.clientY;}},{key:"movementX",get:function get(){return this.movement.x;}},{key:"movementY",get:function get(){return this.movement.y;}},{key:"offsetX",get:function get(){return this.offset.x;}},{key:"offsetY",get:function get(){return this.offset.y;}},{key:"globalX",get:function get(){return this.global.x;}},{key:"globalY",get:function get(){return this.global.y;}},{key:"screenX",get:function get(){return this.screen.x;}},{key:"screenY",get:function get(){return this.screen.y;}},{key:"getModifierState",value:function getModifierState(key){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(key);}},{key:"initMouseEvent",value:function initMouseEvent(_typeArg,_canBubbleArg,_cancelableArg,_viewArg,_detailArg,_screenXArg,_screenYArg,_clientXArg,_clientYArg,_ctrlKeyArg,_altKeyArg,_shiftKeyArg,_metaKeyArg,_buttonArg,_relatedTargetArg){throw new Error("Method not implemented.");}}]);}(FederatedEvent);var FederatedPointerEvent=/*#__PURE__*/function(_FederatedMouseEvent){function FederatedPointerEvent(){var _this49;_classCallCheck(this,FederatedPointerEvent);_this49=_callSuper(this,FederatedPointerEvent,arguments);_this49.width=0;_this49.height=0;_this49.isPrimary=false;return _this49;}_inherits(FederatedPointerEvent,_FederatedMouseEvent);return _createClass(FederatedPointerEvent,[{key:"getCoalescedEvents",value:function getCoalescedEvents(){if(this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"){return[this];}return[];}},{key:"getPredictedEvents",value:function getPredictedEvents(){throw new Error("getPredictedEvents is not supported!");}}]);}(FederatedMouseEvent);var FederatedWheelEvent=/*#__PURE__*/function(_FederatedMouseEvent2){function FederatedWheelEvent(){var _this50;_classCallCheck(this,FederatedWheelEvent);_this50=_callSuper(this,FederatedWheelEvent,arguments);_this50.DOM_DELTA_PIXEL=0;_this50.DOM_DELTA_LINE=1;_this50.DOM_DELTA_PAGE=2;return _this50;}_inherits(FederatedWheelEvent,_FederatedMouseEvent2);return _createClass(FederatedWheelEvent);}(FederatedMouseEvent);FederatedWheelEvent.DOM_DELTA_PIXEL=0;FederatedWheelEvent.DOM_DELTA_LINE=1;FederatedWheelEvent.DOM_DELTA_PAGE=2;var PROPAGATION_LIMIT=2048;var tempHitLocation=new Point();var tempLocalMapping=new Point();var EventBoundary=/*#__PURE__*/function(){function EventBoundary(rootTarget){_classCallCheck(this,EventBoundary);this.dispatch=new EventEmitter();this.moveOnAll=false;this.mappingState={trackingData:{}};this.eventPool=/* @__PURE__ */new Map();this.rootTarget=rootTarget;this.hitPruneFn=this.hitPruneFn.bind(this);this.hitTestFn=this.hitTestFn.bind(this);this.mapPointerDown=this.mapPointerDown.bind(this);this.mapPointerMove=this.mapPointerMove.bind(this);this.mapPointerOut=this.mapPointerOut.bind(this);this.mapPointerOver=this.mapPointerOver.bind(this);this.mapPointerUp=this.mapPointerUp.bind(this);this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this);this.mapWheel=this.mapWheel.bind(this);this.mappingTable={};this.addEventMapping("pointerdown",this.mapPointerDown);this.addEventMapping("pointermove",this.mapPointerMove);this.addEventMapping("pointerout",this.mapPointerOut);this.addEventMapping("pointerleave",this.mapPointerOut);this.addEventMapping("pointerover",this.mapPointerOver);this.addEventMapping("pointerup",this.mapPointerUp);this.addEventMapping("pointerupoutside",this.mapPointerUpOutside);this.addEventMapping("wheel",this.mapWheel);}return _createClass(EventBoundary,[{key:"addEventMapping",value:function addEventMapping(type,fn){if(!this.mappingTable[type]){this.mappingTable[type]=[];}this.mappingTable[type].push({fn:fn,priority:0});this.mappingTable[type].sort(function(a,b){return a.priority-b.priority;});}},{key:"dispatchEvent",value:function dispatchEvent(e,type){e.propagationStopped=false;e.propagationImmediatelyStopped=false;this.propagate(e,type);this.dispatch.emit(type||e.type,e);}},{key:"mapEvent",value:function mapEvent(e){if(!this.rootTarget){return;}var mappers=this.mappingTable[e.type];if(mappers){for(var i=0,j=mappers.length;i<j;i++){mappers[i].fn(e);}}else{console.warn("[EventBoundary]: Event mapping not defined for ".concat(e.type));}}},{key:"hitTest",value:function hitTest(x,y){var invertedPath=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,tempHitLocation.set(x,y),this.hitTestFn,this.hitPruneFn);return invertedPath&&invertedPath[0];}},{key:"propagate",value:function propagate(e,type){if(!e.target){return;}var composedPath=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(var i=0,j=composedPath.length-1;i<j;i++){e.currentTarget=composedPath[i];this.notifyTarget(e,type);if(e.propagationStopped||e.propagationImmediatelyStopped)return;}e.eventPhase=e.AT_TARGET;e.currentTarget=e.target;this.notifyTarget(e,type);if(e.propagationStopped||e.propagationImmediatelyStopped)return;e.eventPhase=e.BUBBLING_PHASE;for(var _i22=composedPath.length-2;_i22>=0;_i22--){e.currentTarget=composedPath[_i22];this.notifyTarget(e,type);if(e.propagationStopped||e.propagationImmediatelyStopped)return;}}},{key:"all",value:function all(e,type){var target=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.rootTarget;e.eventPhase=e.BUBBLING_PHASE;var children=target.children;if(children){for(var i=0;i<children.length;i++){this.all(e,type,children[i]);}}e.currentTarget=target;this.notifyTarget(e,type);}},{key:"propagationPath",value:function propagationPath(target){var propagationPath=[target];for(var i=0;i<PROPAGATION_LIMIT&&target!==this.rootTarget;i++){if(!target.parent){throw new Error("Cannot find propagation path to disconnected target");}propagationPath.push(target.parent);target=target.parent;}propagationPath.reverse();return propagationPath;}},{key:"hitTestRecursive",value:function hitTestRecursive(currentTarget,interactive,location,testFn,pruneFn){if(!currentTarget||!currentTarget.visible){return null;}if(pruneFn(currentTarget,location)){return null;}if(currentTarget.interactiveChildren&&currentTarget.children){var children=currentTarget.children;for(var i=children.length-1;i>=0;i--){var child=children[i];var nestedHit=this.hitTestRecursive(child,interactive||child.interactive,location,testFn,pruneFn);if(nestedHit){if(nestedHit.length>0&&!nestedHit[nestedHit.length-1].parent){continue;}if(nestedHit.length>0||currentTarget.interactive){nestedHit.push(currentTarget);}return nestedHit;}}}if(interactive&&testFn(currentTarget,location)){return currentTarget.interactive?[currentTarget]:[];}return null;}},{key:"hitPruneFn",value:function hitPruneFn(displayObject,location){if(displayObject.hitArea){displayObject.worldTransform.applyInverse(location,tempLocalMapping);if(!displayObject.hitArea.contains(tempLocalMapping.x,tempLocalMapping.y)){return true;}}if(displayObject._mask){var _maskObject$containsP;var maskObject=displayObject._mask.isMaskData?displayObject._mask.maskObject:displayObject._mask;if(maskObject&&!((_maskObject$containsP=maskObject.containsPoint)!==null&&_maskObject$containsP!==void 0&&_maskObject$containsP.call(maskObject,location))){return true;}}return false;}},{key:"hitTestFn",value:function hitTestFn(displayObject,location){if(displayObject.hitArea){return true;}if(displayObject.containsPoint){return displayObject.containsPoint(location);}return false;}},{key:"notifyTarget",value:function notifyTarget(e,type){var _type7,_e$currentTarget$hand,_e$currentTarget;type=(_type7=type)!==null&&_type7!==void 0?_type7:e.type;var handlerKey="on".concat(type);(_e$currentTarget$hand=(_e$currentTarget=e.currentTarget)[handlerKey])===null||_e$currentTarget$hand===void 0||_e$currentTarget$hand.call(_e$currentTarget,e);var key=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?"".concat(type,"capture"):type;this.notifyListeners(e,key);if(e.eventPhase===e.AT_TARGET){this.notifyListeners(e,type);}}},{key:"mapPointerDown",value:function mapPointerDown(from){if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var e=this.createPointerEvent(from);this.dispatchEvent(e,"pointerdown");if(e.pointerType==="touch"){this.dispatchEvent(e,"touchstart");}else if(e.pointerType==="mouse"||e.pointerType==="pen"){var isRightButton=e.button===2;this.dispatchEvent(e,isRightButton?"rightdown":"mousedown");}var trackingData=this.trackingData(from.pointerId);trackingData.pressTargetsByButton[from.button]=e.composedPath();this.freeEvent(e);}},{key:"mapPointerMove",value:function mapPointerMove(from){var _trackingData$overTar;if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var e=this.createPointerEvent(from);var isMouse=e.pointerType==="mouse"||e.pointerType==="pen";var trackingData=this.trackingData(from.pointerId);var outTarget=this.findMountedTarget(trackingData.overTargets);if(((_trackingData$overTar=trackingData.overTargets)===null||_trackingData$overTar===void 0?void 0:_trackingData$overTar.length)>0&&outTarget!==e.target){var outType=from.type==="mousemove"?"mouseout":"pointerout";var outEvent=this.createPointerEvent(from,outType,outTarget);this.dispatchEvent(outEvent,"pointerout");if(isMouse)this.dispatchEvent(outEvent,"mouseout");if(!e.composedPath().includes(outTarget)){var leaveEvent=this.createPointerEvent(from,"pointerleave",outTarget);leaveEvent.eventPhase=leaveEvent.AT_TARGET;while(leaveEvent.target&&!e.composedPath().includes(leaveEvent.target)){leaveEvent.currentTarget=leaveEvent.target;this.notifyTarget(leaveEvent);if(isMouse)this.notifyTarget(leaveEvent,"mouseleave");leaveEvent.target=leaveEvent.target.parent;}this.freeEvent(leaveEvent);}this.freeEvent(outEvent);}if(outTarget!==e.target){var overType=from.type==="mousemove"?"mouseover":"pointerover";var overEvent=this.clonePointerEvent(e,overType);this.dispatchEvent(overEvent,"pointerover");if(isMouse)this.dispatchEvent(overEvent,"mouseover");var overTargetAncestor=outTarget===null||outTarget===void 0?void 0:outTarget.parent;while(overTargetAncestor&&overTargetAncestor!==this.rootTarget.parent){if(overTargetAncestor===e.target)break;overTargetAncestor=overTargetAncestor.parent;}var didPointerEnter=!overTargetAncestor||overTargetAncestor===this.rootTarget.parent;if(didPointerEnter){var enterEvent=this.clonePointerEvent(e,"pointerenter");enterEvent.eventPhase=enterEvent.AT_TARGET;while(enterEvent.target&&enterEvent.target!==outTarget&&enterEvent.target!==this.rootTarget.parent){enterEvent.currentTarget=enterEvent.target;this.notifyTarget(enterEvent);if(isMouse)this.notifyTarget(enterEvent,"mouseenter");enterEvent.target=enterEvent.target.parent;}this.freeEvent(enterEvent);}this.freeEvent(overEvent);}var propagationMethod=this.moveOnAll?"all":"dispatchEvent";this[propagationMethod](e,"pointermove");this.all(e,"globalpointermove");if(e.pointerType==="touch"){this[propagationMethod](e,"touchmove");this.all(e,"globaltouchmove");}if(isMouse){var _e$target;this[propagationMethod](e,"mousemove");this.all(e,"globalmousemove");this.cursor=(_e$target=e.target)===null||_e$target===void 0?void 0:_e$target.cursor;}trackingData.overTargets=e.composedPath();this.freeEvent(e);}},{key:"mapPointerOver",value:function mapPointerOver(from){var _e$target2;if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var trackingData=this.trackingData(from.pointerId);var e=this.createPointerEvent(from);var isMouse=e.pointerType==="mouse"||e.pointerType==="pen";this.dispatchEvent(e,"pointerover");if(isMouse)this.dispatchEvent(e,"mouseover");if(e.pointerType==="mouse")this.cursor=(_e$target2=e.target)===null||_e$target2===void 0?void 0:_e$target2.cursor;var enterEvent=this.clonePointerEvent(e,"pointerenter");enterEvent.eventPhase=enterEvent.AT_TARGET;while(enterEvent.target&&enterEvent.target!==this.rootTarget.parent){enterEvent.currentTarget=enterEvent.target;this.notifyTarget(enterEvent);if(isMouse)this.notifyTarget(enterEvent,"mouseenter");enterEvent.target=enterEvent.target.parent;}trackingData.overTargets=e.composedPath();this.freeEvent(e);this.freeEvent(enterEvent);}},{key:"mapPointerOut",value:function mapPointerOut(from){if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var trackingData=this.trackingData(from.pointerId);if(trackingData.overTargets){var isMouse=from.pointerType==="mouse"||from.pointerType==="pen";var outTarget=this.findMountedTarget(trackingData.overTargets);var outEvent=this.createPointerEvent(from,"pointerout",outTarget);this.dispatchEvent(outEvent);if(isMouse)this.dispatchEvent(outEvent,"mouseout");var leaveEvent=this.createPointerEvent(from,"pointerleave",outTarget);leaveEvent.eventPhase=leaveEvent.AT_TARGET;while(leaveEvent.target&&leaveEvent.target!==this.rootTarget.parent){leaveEvent.currentTarget=leaveEvent.target;this.notifyTarget(leaveEvent);if(isMouse)this.notifyTarget(leaveEvent,"mouseleave");leaveEvent.target=leaveEvent.target.parent;}trackingData.overTargets=null;this.freeEvent(outEvent);this.freeEvent(leaveEvent);}this.cursor=null;}},{key:"mapPointerUp",value:function mapPointerUp(from){if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var now=performance.now();var e=this.createPointerEvent(from);this.dispatchEvent(e,"pointerup");if(e.pointerType==="touch"){this.dispatchEvent(e,"touchend");}else if(e.pointerType==="mouse"||e.pointerType==="pen"){var isRightButton=e.button===2;this.dispatchEvent(e,isRightButton?"rightup":"mouseup");}var trackingData=this.trackingData(from.pointerId);var pressTarget=this.findMountedTarget(trackingData.pressTargetsByButton[from.button]);var clickTarget=pressTarget;if(pressTarget&&!e.composedPath().includes(pressTarget)){var currentTarget=pressTarget;while(currentTarget&&!e.composedPath().includes(currentTarget)){e.currentTarget=currentTarget;this.notifyTarget(e,"pointerupoutside");if(e.pointerType==="touch"){this.notifyTarget(e,"touchendoutside");}else if(e.pointerType==="mouse"||e.pointerType==="pen"){var _isRightButton=e.button===2;this.notifyTarget(e,_isRightButton?"rightupoutside":"mouseupoutside");}currentTarget=currentTarget.parent;}delete trackingData.pressTargetsByButton[from.button];clickTarget=currentTarget;}if(clickTarget){var clickEvent=this.clonePointerEvent(e,"click");clickEvent.target=clickTarget;clickEvent.path=null;if(!trackingData.clicksByButton[from.button]){trackingData.clicksByButton[from.button]={clickCount:0,target:clickEvent.target,timeStamp:now};}var clickHistory=trackingData.clicksByButton[from.button];if(clickHistory.target===clickEvent.target&&now-clickHistory.timeStamp<200){++clickHistory.clickCount;}else{clickHistory.clickCount=1;}clickHistory.target=clickEvent.target;clickHistory.timeStamp=now;clickEvent.detail=clickHistory.clickCount;if(clickEvent.pointerType==="mouse"){var _isRightButton2=clickEvent.button===2;this.dispatchEvent(clickEvent,_isRightButton2?"rightclick":"click");}else if(clickEvent.pointerType==="touch"){this.dispatchEvent(clickEvent,"tap");}this.dispatchEvent(clickEvent,"pointertap");this.freeEvent(clickEvent);}this.freeEvent(e);}},{key:"mapPointerUpOutside",value:function mapPointerUpOutside(from){if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var trackingData=this.trackingData(from.pointerId);var pressTarget=this.findMountedTarget(trackingData.pressTargetsByButton[from.button]);var e=this.createPointerEvent(from);if(pressTarget){var currentTarget=pressTarget;while(currentTarget){e.currentTarget=currentTarget;this.notifyTarget(e,"pointerupoutside");if(e.pointerType==="touch"){this.notifyTarget(e,"touchendoutside");}else if(e.pointerType==="mouse"||e.pointerType==="pen"){this.notifyTarget(e,e.button===2?"rightupoutside":"mouseupoutside");}currentTarget=currentTarget.parent;}delete trackingData.pressTargetsByButton[from.button];}this.freeEvent(e);}},{key:"mapWheel",value:function mapWheel(from){if(!(from instanceof FederatedWheelEvent)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return;}var wheelEvent=this.createWheelEvent(from);this.dispatchEvent(wheelEvent);this.freeEvent(wheelEvent);}},{key:"findMountedTarget",value:function findMountedTarget(propagationPath){if(!propagationPath){return null;}var currentTarget=propagationPath[0];for(var i=1;i<propagationPath.length;i++){if(propagationPath[i].parent===currentTarget){currentTarget=propagationPath[i];}else{break;}}return currentTarget;}},{key:"createPointerEvent",value:function createPointerEvent(from,type,target){var event=this.allocateEvent(FederatedPointerEvent);this.copyPointerData(from,event);this.copyMouseData(from,event);this.copyData(from,event);event.nativeEvent=from.nativeEvent;event.originalEvent=from;event.target=target!==null&&target!==void 0?target:this.hitTest(event.global.x,event.global.y);if(typeof type==="string"){event.type=type;}return event;}},{key:"createWheelEvent",value:function createWheelEvent(from){var event=this.allocateEvent(FederatedWheelEvent);this.copyWheelData(from,event);this.copyMouseData(from,event);this.copyData(from,event);event.nativeEvent=from.nativeEvent;event.originalEvent=from;event.target=this.hitTest(event.global.x,event.global.y);return event;}},{key:"clonePointerEvent",value:function clonePointerEvent(from,type){var event=this.allocateEvent(FederatedPointerEvent);event.nativeEvent=from.nativeEvent;event.originalEvent=from.originalEvent;this.copyPointerData(from,event);this.copyMouseData(from,event);this.copyData(from,event);event.target=from.target;event.path=from.composedPath().slice();event.type=type!==null&&type!==void 0?type:event.type;return event;}},{key:"copyWheelData",value:function copyWheelData(from,to){to.deltaMode=from.deltaMode;to.deltaX=from.deltaX;to.deltaY=from.deltaY;to.deltaZ=from.deltaZ;}},{key:"copyPointerData",value:function copyPointerData(from,to){if(!(from instanceof FederatedPointerEvent&&to instanceof FederatedPointerEvent))return;to.pointerId=from.pointerId;to.width=from.width;to.height=from.height;to.isPrimary=from.isPrimary;to.pointerType=from.pointerType;to.pressure=from.pressure;to.tangentialPressure=from.tangentialPressure;to.tiltX=from.tiltX;to.tiltY=from.tiltY;to.twist=from.twist;}},{key:"copyMouseData",value:function copyMouseData(from,to){if(!(from instanceof FederatedMouseEvent&&to instanceof FederatedMouseEvent))return;to.altKey=from.altKey;to.button=from.button;to.buttons=from.buttons;to.client.copyFrom(from.client);to.ctrlKey=from.ctrlKey;to.metaKey=from.metaKey;to.movement.copyFrom(from.movement);to.screen.copyFrom(from.screen);to.global.copyFrom(from.global);}},{key:"copyData",value:function copyData(from,to){to.isTrusted=from.isTrusted;to.srcElement=from.srcElement;to.timeStamp=performance.now();to.type=from.type;to.detail=from.detail;to.view=from.view;to.which=from.which;to.layer.copyFrom(from.layer);to.page.copyFrom(from.page);}},{key:"trackingData",value:function trackingData(id){if(!this.mappingState.trackingData[id]){this.mappingState.trackingData[id]={pressTargetsByButton:{},clicksByButton:{},overTarget:null};}return this.mappingState.trackingData[id];}},{key:"allocateEvent",value:function allocateEvent(constructor){if(!this.eventPool.has(constructor)){this.eventPool.set(constructor,[]);}var event=this.eventPool.get(constructor).pop()||new constructor(this);event.eventPhase=event.NONE;event.currentTarget=null;event.path=null;event.target=null;return event;}},{key:"freeEvent",value:function freeEvent(event){if(event.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");var constructor=event.constructor;if(!this.eventPool.has(constructor)){this.eventPool.set(constructor,[]);}this.eventPool.get(constructor).push(event);}},{key:"notifyListeners",value:function notifyListeners(e,type){var listeners=e.currentTarget._events[type];if(!listeners)return;if("fn"in listeners){if(listeners.once)e.currentTarget.removeListener(type,listeners.fn,void 0,true);listeners.fn.call(listeners.context,e);}else{for(var i=0,j=listeners.length;i<j&&!e.propagationImmediatelyStopped;i++){if(listeners[i].once)e.currentTarget.removeListener(type,listeners[i].fn,void 0,true);listeners[i].fn.call(listeners[i].context,e);}}}}]);}();var MOUSE_POINTER_ID=1;var TOUCH_TO_POINTER={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};var EventSystem=/*#__PURE__*/function(){function EventSystem(renderer){_classCallCheck(this,EventSystem);this.supportsTouchEvents="ontouchstart"in globalThis;this.supportsPointerEvents=!!globalThis.PointerEvent;this.domElement=null;this.resolution=1;this.renderer=renderer;this.rootBoundary=new EventBoundary(null);this.autoPreventDefault=true;this.eventsAdded=false;this.rootPointerEvent=new FederatedPointerEvent(null);this.rootWheelEvent=new FederatedWheelEvent(null);this.cursorStyles={default:"inherit",pointer:"pointer"};this.onPointerDown=this.onPointerDown.bind(this);this.onPointerMove=this.onPointerMove.bind(this);this.onPointerUp=this.onPointerUp.bind(this);this.onPointerOverOut=this.onPointerOverOut.bind(this);this.onWheel=this.onWheel.bind(this);}return _createClass(EventSystem,[{key:"init",value:function init(){var _this$renderer4=this.renderer,view=_this$renderer4.view,resolution=_this$renderer4.resolution;this.setTargetElement(view);this.resolution=resolution;}},{key:"resolutionChange",value:function resolutionChange(resolution){this.resolution=resolution;}},{key:"destroy",value:function destroy(){this.setTargetElement(null);this.renderer=null;}},{key:"setCursor",value:function setCursor(mode){mode=mode||"default";var applyStyles=true;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas){applyStyles=false;}if(this.currentCursor===mode){return;}this.currentCursor=mode;var style=this.cursorStyles[mode];if(style){switch(_typeof(style)){case"string":if(applyStyles){this.domElement.style.cursor=style;}break;case"function":style(mode);break;case"object":if(applyStyles){Object.assign(this.domElement.style,style);}break;}}else if(applyStyles&&typeof mode==="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,mode)){this.domElement.style.cursor=mode;}}},{key:"onPointerDown",value:function onPointerDown(nativeEvent){this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;if(this.supportsTouchEvents&&nativeEvent.pointerType==="touch")return;var events=this.normalizeToPointerData(nativeEvent);if(this.autoPreventDefault&&events[0].isNormalized){var cancelable=nativeEvent.cancelable||!("cancelable"in nativeEvent);if(cancelable){nativeEvent.preventDefault();}}for(var i=0,j=events.length;i<j;i++){var nativeEvent2=events[i];var federatedEvent=this.bootstrapEvent(this.rootPointerEvent,nativeEvent2);this.rootBoundary.mapEvent(federatedEvent);}this.setCursor(this.rootBoundary.cursor);}},{key:"onPointerMove",value:function onPointerMove(nativeEvent){this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;if(this.supportsTouchEvents&&nativeEvent.pointerType==="touch")return;var normalizedEvents=this.normalizeToPointerData(nativeEvent);for(var i=0,j=normalizedEvents.length;i<j;i++){var event=this.bootstrapEvent(this.rootPointerEvent,normalizedEvents[i]);this.rootBoundary.mapEvent(event);}this.setCursor(this.rootBoundary.cursor);}},{key:"onPointerUp",value:function onPointerUp(nativeEvent){this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;if(this.supportsTouchEvents&&nativeEvent.pointerType==="touch")return;var target=nativeEvent.target;if(nativeEvent.composedPath&&nativeEvent.composedPath().length>0){target=nativeEvent.composedPath()[0];}var outside=target!==this.domElement?"outside":"";var normalizedEvents=this.normalizeToPointerData(nativeEvent);for(var i=0,j=normalizedEvents.length;i<j;i++){var event=this.bootstrapEvent(this.rootPointerEvent,normalizedEvents[i]);event.type+=outside;this.rootBoundary.mapEvent(event);}this.setCursor(this.rootBoundary.cursor);}},{key:"onPointerOverOut",value:function onPointerOverOut(nativeEvent){this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;if(this.supportsTouchEvents&&nativeEvent.pointerType==="touch")return;var normalizedEvents=this.normalizeToPointerData(nativeEvent);for(var i=0,j=normalizedEvents.length;i<j;i++){var event=this.bootstrapEvent(this.rootPointerEvent,normalizedEvents[i]);this.rootBoundary.mapEvent(event);}this.setCursor(this.rootBoundary.cursor);}},{key:"onWheel",value:function onWheel(nativeEvent){var wheelEvent=this.normalizeWheelEvent(nativeEvent);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;this.rootBoundary.mapEvent(wheelEvent);}},{key:"setTargetElement",value:function setTargetElement(element){this.removeEvents();this.domElement=element;this.addEvents();}},{key:"addEvents",value:function addEvents(){if(this.eventsAdded||!this.domElement){return;}var style=this.domElement.style;if(style){if(globalThis.navigator.msPointerEnabled){style.msContentZooming="none";style.msTouchAction="none";}else if(this.supportsPointerEvents){style.touchAction="none";}}if(this.supportsPointerEvents){globalThis.document.addEventListener("pointermove",this.onPointerMove,true);this.domElement.addEventListener("pointerdown",this.onPointerDown,true);this.domElement.addEventListener("pointerleave",this.onPointerOverOut,true);this.domElement.addEventListener("pointerover",this.onPointerOverOut,true);globalThis.addEventListener("pointerup",this.onPointerUp,true);}else{globalThis.document.addEventListener("mousemove",this.onPointerMove,true);this.domElement.addEventListener("mousedown",this.onPointerDown,true);this.domElement.addEventListener("mouseout",this.onPointerOverOut,true);this.domElement.addEventListener("mouseover",this.onPointerOverOut,true);globalThis.addEventListener("mouseup",this.onPointerUp,true);}if(this.supportsTouchEvents){this.domElement.addEventListener("touchstart",this.onPointerDown,true);this.domElement.addEventListener("touchend",this.onPointerUp,true);this.domElement.addEventListener("touchmove",this.onPointerMove,true);}this.domElement.addEventListener("wheel",this.onWheel,{passive:true,capture:true});this.eventsAdded=true;}},{key:"removeEvents",value:function removeEvents(){if(!this.eventsAdded||!this.domElement){return;}var style=this.domElement.style;if(globalThis.navigator.msPointerEnabled){style.msContentZooming="";style.msTouchAction="";}else if(this.supportsPointerEvents){style.touchAction="";}if(this.supportsPointerEvents){globalThis.document.removeEventListener("pointermove",this.onPointerMove,true);this.domElement.removeEventListener("pointerdown",this.onPointerDown,true);this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,true);this.domElement.removeEventListener("pointerover",this.onPointerOverOut,true);globalThis.removeEventListener("pointerup",this.onPointerUp,true);}else{globalThis.document.removeEventListener("mousemove",this.onPointerMove,true);this.domElement.removeEventListener("mousedown",this.onPointerDown,true);this.domElement.removeEventListener("mouseout",this.onPointerOverOut,true);this.domElement.removeEventListener("mouseover",this.onPointerOverOut,true);globalThis.removeEventListener("mouseup",this.onPointerUp,true);}if(this.supportsTouchEvents){this.domElement.removeEventListener("touchstart",this.onPointerDown,true);this.domElement.removeEventListener("touchend",this.onPointerUp,true);this.domElement.removeEventListener("touchmove",this.onPointerMove,true);}this.domElement.removeEventListener("wheel",this.onWheel,true);this.domElement=null;this.eventsAdded=false;}},{key:"mapPositionToPoint",value:function mapPositionToPoint(point,x,y){var rect;if(!this.domElement.parentElement){rect={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};}else{rect=this.domElement.getBoundingClientRect();}var resolutionMultiplier=1/this.resolution;point.x=(x-rect.left)*(this.domElement.width/rect.width)*resolutionMultiplier;point.y=(y-rect.top)*(this.domElement.height/rect.height)*resolutionMultiplier;}},{key:"normalizeToPointerData",value:function normalizeToPointerData(event){var normalizedEvents=[];if(this.supportsTouchEvents&&event instanceof TouchEvent){for(var i=0,li=event.changedTouches.length;i<li;i++){var touch=event.changedTouches[i];if(typeof touch.button==="undefined")touch.button=0;if(typeof touch.buttons==="undefined")touch.buttons=1;if(typeof touch.isPrimary==="undefined"){touch.isPrimary=event.touches.length===1&&event.type==="touchstart";}if(typeof touch.width==="undefined")touch.width=touch.radiusX||1;if(typeof touch.height==="undefined")touch.height=touch.radiusY||1;if(typeof touch.tiltX==="undefined")touch.tiltX=0;if(typeof touch.tiltY==="undefined")touch.tiltY=0;if(typeof touch.pointerType==="undefined")touch.pointerType="touch";if(typeof touch.pointerId==="undefined")touch.pointerId=touch.identifier||0;if(typeof touch.pressure==="undefined")touch.pressure=touch.force||0.5;if(typeof touch.twist==="undefined")touch.twist=0;if(typeof touch.tangentialPressure==="undefined")touch.tangentialPressure=0;if(typeof touch.layerX==="undefined")touch.layerX=touch.offsetX=touch.clientX;if(typeof touch.layerY==="undefined")touch.layerY=touch.offsetY=touch.clientY;touch.isNormalized=true;touch.type=event.type;normalizedEvents.push(touch);}}else if(!globalThis.MouseEvent||event instanceof MouseEvent&&(!this.supportsPointerEvents||!(event instanceof globalThis.PointerEvent))){var tempEvent=event;if(typeof tempEvent.isPrimary==="undefined")tempEvent.isPrimary=true;if(typeof tempEvent.width==="undefined")tempEvent.width=1;if(typeof tempEvent.height==="undefined")tempEvent.height=1;if(typeof tempEvent.tiltX==="undefined")tempEvent.tiltX=0;if(typeof tempEvent.tiltY==="undefined")tempEvent.tiltY=0;if(typeof tempEvent.pointerType==="undefined")tempEvent.pointerType="mouse";if(typeof tempEvent.pointerId==="undefined")tempEvent.pointerId=MOUSE_POINTER_ID;if(typeof tempEvent.pressure==="undefined")tempEvent.pressure=0.5;if(typeof tempEvent.twist==="undefined")tempEvent.twist=0;if(typeof tempEvent.tangentialPressure==="undefined")tempEvent.tangentialPressure=0;tempEvent.isNormalized=true;normalizedEvents.push(tempEvent);}else{normalizedEvents.push(event);}return normalizedEvents;}},{key:"normalizeWheelEvent",value:function normalizeWheelEvent(nativeEvent){var event=this.rootWheelEvent;this.transferMouseData(event,nativeEvent);event.deltaX=nativeEvent.deltaX;event.deltaY=nativeEvent.deltaY;event.deltaZ=nativeEvent.deltaZ;event.deltaMode=nativeEvent.deltaMode;this.mapPositionToPoint(event.screen,nativeEvent.clientX,nativeEvent.clientY);event.global.copyFrom(event.screen);event.offset.copyFrom(event.screen);event.nativeEvent=nativeEvent;event.type=nativeEvent.type;return event;}},{key:"bootstrapEvent",value:function bootstrapEvent(event,nativeEvent){event.originalEvent=null;event.nativeEvent=nativeEvent;event.pointerId=nativeEvent.pointerId;event.width=nativeEvent.width;event.height=nativeEvent.height;event.isPrimary=nativeEvent.isPrimary;event.pointerType=nativeEvent.pointerType;event.pressure=nativeEvent.pressure;event.tangentialPressure=nativeEvent.tangentialPressure;event.tiltX=nativeEvent.tiltX;event.tiltY=nativeEvent.tiltY;event.twist=nativeEvent.twist;this.transferMouseData(event,nativeEvent);this.mapPositionToPoint(event.screen,nativeEvent.clientX,nativeEvent.clientY);event.global.copyFrom(event.screen);event.offset.copyFrom(event.screen);event.isTrusted=nativeEvent.isTrusted;if(event.type==="pointerleave"){event.type="pointerout";}if(event.type.startsWith("mouse")){event.type=event.type.replace("mouse","pointer");}if(event.type.startsWith("touch")){event.type=TOUCH_TO_POINTER[event.type]||event.type;}return event;}},{key:"transferMouseData",value:function transferMouseData(event,nativeEvent){event.isTrusted=nativeEvent.isTrusted;event.srcElement=nativeEvent.srcElement;event.timeStamp=performance.now();event.type=nativeEvent.type;event.altKey=nativeEvent.altKey;event.button=nativeEvent.button;event.buttons=nativeEvent.buttons;event.client.x=nativeEvent.clientX;event.client.y=nativeEvent.clientY;event.ctrlKey=nativeEvent.ctrlKey;event.metaKey=nativeEvent.metaKey;event.movement.x=nativeEvent.movementX;event.movement.y=nativeEvent.movementY;event.page.x=nativeEvent.pageX;event.page.y=nativeEvent.pageY;event.relatedTarget=null;event.shiftKey=nativeEvent.shiftKey;}}]);}();EventSystem.extension={name:"events",type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem]};extensions$1.add(EventSystem);var FederatedDisplayObject={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,interactive:false,interactiveChildren:true,hitArea:null,addEventListener:function addEventListener(type,listener,options){var capture=typeof options==="boolean"&&options||_typeof(options)==="object"&&options.capture;var context=typeof listener==="function"?void 0:listener;type=capture?"".concat(type,"capture"):type;listener=typeof listener==="function"?listener:listener.handleEvent;this.on(type,listener,context);},removeEventListener:function removeEventListener(type,listener,options){var capture=typeof options==="boolean"&&options||_typeof(options)==="object"&&options.capture;var context=typeof listener==="function"?void 0:listener;type=capture?"".concat(type,"capture"):type;listener=typeof listener==="function"?listener:listener.handleEvent;this.off(type,listener,context);},dispatchEvent:function dispatchEvent(e){if(!(e instanceof FederatedEvent)){throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");}e.defaultPrevented=false;e.path=null;e.target=this;e.manager.dispatchEvent(e);return!e.defaultPrevented;}};DisplayObject.mixin(FederatedDisplayObject);var accessibleTarget={accessible:false,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:false,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:true,renderId:-1};DisplayObject.mixin(accessibleTarget);var KEY_CODE_TAB=9;var DIV_TOUCH_SIZE=100;var DIV_TOUCH_POS_X=0;var DIV_TOUCH_POS_Y=0;var DIV_TOUCH_ZINDEX=2;var DIV_HOOK_SIZE=1;var DIV_HOOK_POS_X=-1e3;var DIV_HOOK_POS_Y=-1e3;var DIV_HOOK_ZINDEX=2;var AccessibilityManager=/*#__PURE__*/function(){function AccessibilityManager(renderer){_classCallCheck(this,AccessibilityManager);this.debug=false;this._isActive=false;this._isMobileAccessibility=false;this.pool=[];this.renderId=0;this.children=[];this.androidUpdateCount=0;this.androidUpdateFrequency=500;this._hookDiv=null;if(isMobile.tablet||isMobile.phone){this.createTouchHook();}var div=document.createElement("div");div.style.width="".concat(DIV_TOUCH_SIZE,"px");div.style.height="".concat(DIV_TOUCH_SIZE,"px");div.style.position="absolute";div.style.top="".concat(DIV_TOUCH_POS_X,"px");div.style.left="".concat(DIV_TOUCH_POS_Y,"px");div.style.zIndex=DIV_TOUCH_ZINDEX.toString();this.div=div;this.renderer=renderer;this._onKeyDown=this._onKeyDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);globalThis.addEventListener("keydown",this._onKeyDown,false);}return _createClass(AccessibilityManager,[{key:"isActive",get:function get(){return this._isActive;}},{key:"isMobileAccessibility",get:function get(){return this._isMobileAccessibility;}},{key:"createTouchHook",value:function createTouchHook(){var _this51=this;var hookDiv=document.createElement("button");hookDiv.style.width="".concat(DIV_HOOK_SIZE,"px");hookDiv.style.height="".concat(DIV_HOOK_SIZE,"px");hookDiv.style.position="absolute";hookDiv.style.top="".concat(DIV_HOOK_POS_X,"px");hookDiv.style.left="".concat(DIV_HOOK_POS_Y,"px");hookDiv.style.zIndex=DIV_HOOK_ZINDEX.toString();hookDiv.style.backgroundColor="#FF0000";hookDiv.title="select to enable accessibility for this content";hookDiv.addEventListener("focus",function(){_this51._isMobileAccessibility=true;_this51.activate();_this51.destroyTouchHook();});document.body.appendChild(hookDiv);this._hookDiv=hookDiv;}},{key:"destroyTouchHook",value:function destroyTouchHook(){if(!this._hookDiv){return;}document.body.removeChild(this._hookDiv);this._hookDiv=null;}},{key:"activate",value:function activate(){var _this$renderer$view$p;if(this._isActive){return;}this._isActive=true;globalThis.document.addEventListener("mousemove",this._onMouseMove,true);globalThis.removeEventListener("keydown",this._onKeyDown,false);this.renderer.on("postrender",this.update,this);(_this$renderer$view$p=this.renderer.view.parentNode)===null||_this$renderer$view$p===void 0||_this$renderer$view$p.appendChild(this.div);}},{key:"deactivate",value:function deactivate(){var _this$div$parentNode;if(!this._isActive||this._isMobileAccessibility){return;}this._isActive=false;globalThis.document.removeEventListener("mousemove",this._onMouseMove,true);globalThis.addEventListener("keydown",this._onKeyDown,false);this.renderer.off("postrender",this.update);(_this$div$parentNode=this.div.parentNode)===null||_this$div$parentNode===void 0||_this$div$parentNode.removeChild(this.div);}},{key:"updateAccessibleObjects",value:function updateAccessibleObjects(displayObject){if(!displayObject.visible||!displayObject.accessibleChildren){return;}if(displayObject.accessible&&displayObject.interactive){if(!displayObject._accessibleActive){this.addChild(displayObject);}displayObject.renderId=this.renderId;}var children=displayObject.children;if(children){for(var i=0;i<children.length;i++){this.updateAccessibleObjects(children[i]);}}}},{key:"update",value:function update(){var now=performance.now();if(isMobile.android.device&&now<this.androidUpdateCount){return;}this.androidUpdateCount=now+this.androidUpdateFrequency;if(!this.renderer.renderingToScreen){return;}if(this.renderer.lastObjectRendered){this.updateAccessibleObjects(this.renderer.lastObjectRendered);}var _this$renderer$view$g=this.renderer.view.getBoundingClientRect(),x=_this$renderer$view$g.x,y=_this$renderer$view$g.y,width=_this$renderer$view$g.width,height=_this$renderer$view$g.height;var _this$renderer5=this.renderer,viewWidth=_this$renderer5.width,viewHeight=_this$renderer5.height,resolution=_this$renderer5.resolution;var sx=width/viewWidth*resolution;var sy=height/viewHeight*resolution;var div=this.div;div.style.left="".concat(x,"px");div.style.top="".concat(y,"px");div.style.width="".concat(viewWidth,"px");div.style.height="".concat(viewHeight,"px");for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.renderId!==this.renderId){child._accessibleActive=false;removeItems(this.children,i,1);this.div.removeChild(child._accessibleDiv);this.pool.push(child._accessibleDiv);child._accessibleDiv=null;i--;}else{div=child._accessibleDiv;var hitArea=child.hitArea;var wt=child.worldTransform;if(child.hitArea){div.style.left="".concat((wt.tx+hitArea.x*wt.a)*sx,"px");div.style.top="".concat((wt.ty+hitArea.y*wt.d)*sy,"px");div.style.width="".concat(hitArea.width*wt.a*sx,"px");div.style.height="".concat(hitArea.height*wt.d*sy,"px");}else{hitArea=child.getBounds();this.capHitArea(hitArea);div.style.left="".concat(hitArea.x*sx,"px");div.style.top="".concat(hitArea.y*sy,"px");div.style.width="".concat(hitArea.width*sx,"px");div.style.height="".concat(hitArea.height*sy,"px");if(div.title!==child.accessibleTitle&&child.accessibleTitle!==null){div.title=child.accessibleTitle;}if(div.getAttribute("aria-label")!==child.accessibleHint&&child.accessibleHint!==null){div.setAttribute("aria-label",child.accessibleHint);}}if(child.accessibleTitle!==div.title||child.tabIndex!==div.tabIndex){div.title=child.accessibleTitle;div.tabIndex=child.tabIndex;if(this.debug)this.updateDebugHTML(div);}}}this.renderId++;}},{key:"updateDebugHTML",value:function updateDebugHTML(div){div.innerHTML="type: ".concat(div.type,"</br> title : ").concat(div.title,"</br> tabIndex: ").concat(div.tabIndex);}},{key:"capHitArea",value:function capHitArea(hitArea){if(hitArea.x<0){hitArea.width+=hitArea.x;hitArea.x=0;}if(hitArea.y<0){hitArea.height+=hitArea.y;hitArea.y=0;}var _this$renderer6=this.renderer,viewWidth=_this$renderer6.width,viewHeight=_this$renderer6.height;if(hitArea.x+hitArea.width>viewWidth){hitArea.width=viewWidth-hitArea.x;}if(hitArea.y+hitArea.height>viewHeight){hitArea.height=viewHeight-hitArea.y;}}},{key:"addChild",value:function addChild(displayObject){var div=this.pool.pop();if(!div){div=document.createElement("button");div.style.width="".concat(DIV_TOUCH_SIZE,"px");div.style.height="".concat(DIV_TOUCH_SIZE,"px");div.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent";div.style.position="absolute";div.style.zIndex=DIV_TOUCH_ZINDEX.toString();div.style.borderStyle="none";if(navigator.userAgent.toLowerCase().includes("chrome")){div.setAttribute("aria-live","off");}else{div.setAttribute("aria-live","polite");}if(navigator.userAgent.match(/rv:.*Gecko\//)){div.setAttribute("aria-relevant","additions");}else{div.setAttribute("aria-relevant","text");}div.addEventListener("click",this._onClick.bind(this));div.addEventListener("focus",this._onFocus.bind(this));div.addEventListener("focusout",this._onFocusOut.bind(this));}div.style.pointerEvents=displayObject.accessiblePointerEvents;div.type=displayObject.accessibleType;if(displayObject.accessibleTitle&&displayObject.accessibleTitle!==null){div.title=displayObject.accessibleTitle;}else if(!displayObject.accessibleHint||displayObject.accessibleHint===null){div.title="displayObject ".concat(displayObject.tabIndex);}if(displayObject.accessibleHint&&displayObject.accessibleHint!==null){div.setAttribute("aria-label",displayObject.accessibleHint);}if(this.debug)this.updateDebugHTML(div);displayObject._accessibleActive=true;displayObject._accessibleDiv=div;div.displayObject=displayObject;this.children.push(displayObject);this.div.appendChild(displayObject._accessibleDiv);displayObject._accessibleDiv.tabIndex=displayObject.tabIndex;}},{key:"_dispatchEvent",value:function _dispatchEvent(e,type){var target=e.target.displayObject;var boundry=this.renderer.events.rootBoundary;var event=Object.assign(new FederatedEvent(boundry),{target:target});boundry.rootTarget=this.renderer.lastObjectRendered;type.forEach(function(type2){return boundry.dispatchEvent(event,type2);});}},{key:"_onClick",value:function _onClick(e){this._dispatchEvent(e,["click","pointertap","tap"]);}},{key:"_onFocus",value:function _onFocus(e){if(!e.target.getAttribute("aria-live")){e.target.setAttribute("aria-live","assertive");}this._dispatchEvent(e,["mouseover"]);}},{key:"_onFocusOut",value:function _onFocusOut(e){if(!e.target.getAttribute("aria-live")){e.target.setAttribute("aria-live","polite");}this._dispatchEvent(e,["mouseout"]);}},{key:"_onKeyDown",value:function _onKeyDown(e){if(e.keyCode!==KEY_CODE_TAB){return;}this.activate();}},{key:"_onMouseMove",value:function _onMouseMove(e){if(e.movementX===0&&e.movementY===0){return;}this.deactivate();}},{key:"destroy",value:function destroy(){this.destroyTouchHook();this.div=null;globalThis.document.removeEventListener("mousemove",this._onMouseMove,true);globalThis.removeEventListener("keydown",this._onKeyDown);this.pool=null;this.children=null;this.renderer=null;}}]);}();AccessibilityManager.extension={name:"accessibility",type:[ExtensionType.RendererPlugin,ExtensionType.CanvasRendererPlugin]};extensions$1.add(AccessibilityManager);var _Application=/*#__PURE__*/function(){function _Application(options){var _this52=this;_classCallCheck(this,_Application);this.stage=new Container();options=Object.assign({forceCanvas:false},options);this.renderer=autoDetectRenderer(options);_Application._plugins.forEach(function(plugin){plugin.init.call(_this52,options);});}return _createClass(_Application,[{key:"render",value:function render(){this.renderer.render(this.stage);}},{key:"view",get:function get(){return this.renderer.view;}},{key:"screen",get:function get(){return this.renderer.screen;}},{key:"destroy",value:function destroy(removeView,stageOptions){var _this53=this;var plugins=_Application._plugins.slice(0);plugins.reverse();plugins.forEach(function(plugin){plugin.destroy.call(_this53);});this.stage.destroy(stageOptions);this.stage=null;this.renderer.destroy(removeView);this.renderer=null;}}]);}();var Application=_Application;Application._plugins=[];extensions$1.handleByList(ExtensionType.Application,Application._plugins);var ResizePlugin=/*#__PURE__*/function(){function ResizePlugin(){_classCallCheck(this,ResizePlugin);}return _createClass(ResizePlugin,null,[{key:"init",value:function init(options){var _this54=this;Object.defineProperty(this,"resizeTo",{set:function set(dom){globalThis.removeEventListener("resize",this.queueResize);this._resizeTo=dom;if(dom){globalThis.addEventListener("resize",this.queueResize);this.resize();}},get:function get(){return this._resizeTo;}});this.queueResize=function(){if(!_this54._resizeTo){return;}_this54.cancelResize();_this54._resizeId=requestAnimationFrame(function(){return _this54.resize();});};this.cancelResize=function(){if(_this54._resizeId){cancelAnimationFrame(_this54._resizeId);_this54._resizeId=null;}};this.resize=function(){if(!_this54._resizeTo){return;}_this54.cancelResize();var width;var height;if(_this54._resizeTo===globalThis.window){width=globalThis.innerWidth;height=globalThis.innerHeight;}else{var _this54$_resizeTo=_this54._resizeTo,clientWidth=_this54$_resizeTo.clientWidth,clientHeight=_this54$_resizeTo.clientHeight;width=clientWidth;height=clientHeight;}_this54.renderer.resize(width,height);_this54.render();};this._resizeId=null;this._resizeTo=null;this.resizeTo=options.resizeTo||null;}},{key:"destroy",value:function destroy(){globalThis.removeEventListener("resize",this.queueResize);this.cancelResize();this.cancelResize=null;this.queueResize=null;this.resizeTo=null;this.resize=null;}}]);}();ResizePlugin.extension=ExtensionType.Application;extensions$1.add(ResizePlugin);var assetKeyMap={loader:ExtensionType.LoadParser,resolver:ExtensionType.ResolveParser,cache:ExtensionType.CacheParser,detection:ExtensionType.DetectionParser};extensions$1.handle(ExtensionType.Asset,function(extension){var ref=extension.ref;Object.entries(assetKeyMap).filter(function(_ref11){var _ref12=_slicedToArray(_ref11,1),key=_ref12[0];return!!ref[key];}).forEach(function(_ref13){var _ref$key$extension;var _ref14=_slicedToArray(_ref13,2),key=_ref14[0],type=_ref14[1];return extensions$1.add(Object.assign(ref[key],{extension:(_ref$key$extension=ref[key].extension)!==null&&_ref$key$extension!==void 0?_ref$key$extension:type}));});},function(extension){var ref=extension.ref;Object.keys(assetKeyMap).filter(function(key){return!!ref[key];}).forEach(function(key){return extensions$1.remove(ref[key]);});});var BackgroundLoader=/*#__PURE__*/function(){function BackgroundLoader(loader){var verbose=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_classCallCheck(this,BackgroundLoader);this._loader=loader;this._assetList=[];this._isLoading=false;this._maxConcurrent=1;this.verbose=verbose;}return _createClass(BackgroundLoader,[{key:"add",value:function add(assetUrls){var _this55=this;assetUrls.forEach(function(a){_this55._assetList.push(a);});if(this.verbose)console.log("[BackgroundLoader] assets: ",this._assetList);if(this._isActive&&!this._isLoading){this._next();}}},{key:"_next",value:function(){var _next2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var toLoad,toLoadAmount,i;return _regeneratorRuntime().wrap(function _callee2$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:if(!(this._assetList.length&&this._isActive)){_context5.next=9;break;}this._isLoading=true;toLoad=[];toLoadAmount=Math.min(this._assetList.length,this._maxConcurrent);for(i=0;i<toLoadAmount;i++){toLoad.push(this._assetList.pop());}_context5.next=7;return this._loader.load(toLoad);case 7:this._isLoading=false;this._next();case 9:case"end":return _context5.stop();}},_callee2,this);}));function _next(){return _next2.apply(this,arguments);}return _next;}()},{key:"active",get:function get(){return this._isActive;},set:function set(value){if(this._isActive===value)return;this._isActive=value;if(value&&!this._isLoading){this._next();}}}]);}();function checkDataUrl(url,mimes){if(Array.isArray(mimes)){var _iterator3=_createForOfIteratorHelper(mimes),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var mime=_step3.value;if(url.startsWith("data:".concat(mime)))return true;}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}return false;}return url.startsWith("data:".concat(mimes));}function checkExtension(url,extension){var tempURL=url.split("?")[0];var ext=path.extname(tempURL).toLowerCase();if(Array.isArray(extension)){return extension.includes(ext);}return ext===extension;}var convertToList=function convertToList(input,transform){if(!Array.isArray(input)){input=[input];}if(!transform){return input;}return input.map(function(item){if(typeof item==="string"){return transform(item);}return item;});};var copySearchParams=function copySearchParams(targetUrl,sourceUrl){var searchParams=sourceUrl.split("?")[1];if(searchParams){targetUrl+="?".concat(searchParams);}return targetUrl;};function processX(base,ids,depth,result,tags){var id=ids[depth];for(var i=0;i<id.length;i++){var value=id[i];if(depth<ids.length-1){processX(base.replace(result[depth],value),ids,depth+1,result,tags);}else{tags.push(base.replace(result[depth],value));}}}function createStringVariations(string){var regex=/\{(.*?)\}/g;var result=string.match(regex);var tags=[];if(result){var ids=[];result.forEach(function(vars){var split=vars.substring(1,vars.length-1).split(",");ids.push(split);});processX(string,ids,0,result,tags);}else{tags.push(string);}return tags;}var isSingleItem=function isSingleItem(item){return!Array.isArray(item);};var CacheClass=/*#__PURE__*/function(){function CacheClass(){_classCallCheck(this,CacheClass);this._parsers=[];this._cache=/* @__PURE__ */new Map();this._cacheMap=/* @__PURE__ */new Map();}return _createClass(CacheClass,[{key:"reset",value:function reset(){this._cacheMap.clear();this._cache.clear();}},{key:"has",value:function has(key){return this._cache.has(key);}},{key:"get",value:function get(key){var result=this._cache.get(key);if(!result){console.warn("[Assets] Asset id ".concat(key," was not found in the Cache"));}return result;}},{key:"set",value:function set(key,value){var _this56=this;var keys=convertToList(key);var cacheableAssets;for(var i=0;i<this.parsers.length;i++){var parser=this.parsers[i];if(parser.test(value)){cacheableAssets=parser.getCacheableAssets(keys,value);break;}}if(!cacheableAssets){cacheableAssets={};keys.forEach(function(key2){cacheableAssets[key2]=value;});}var cacheKeys=Object.keys(cacheableAssets);var cachedAssets={cacheKeys:cacheKeys,keys:keys};keys.forEach(function(key2){_this56._cacheMap.set(key2,cachedAssets);});cacheKeys.forEach(function(key2){if(_this56._cache.has(key2)&&_this56._cache.get(key2)!==value){console.warn("[Cache] already has key:",key2);}_this56._cache.set(key2,cacheableAssets[key2]);});if(value instanceof Texture){var texture=value;keys.forEach(function(key2){if(texture.baseTexture!==Texture.EMPTY.baseTexture){BaseTexture.addToCache(texture.baseTexture,key2);}Texture.addToCache(texture,key2);});}}},{key:"remove",value:function remove(key){var _this57=this;this._cacheMap.get(key);if(!this._cacheMap.has(key)){console.warn("[Assets] Asset id ".concat(key," was not found in the Cache"));return;}var cacheMap=this._cacheMap.get(key);var cacheKeys=cacheMap.cacheKeys;cacheKeys.forEach(function(key2){_this57._cache.delete(key2);});cacheMap.keys.forEach(function(key2){_this57._cacheMap.delete(key2);});}},{key:"parsers",get:function get(){return this._parsers;}}]);}();var Cache=new CacheClass();var Loader=/*#__PURE__*/function(){function Loader(){_classCallCheck(this,Loader);this._parsers=[];this.promiseCache={};}return _createClass(Loader,[{key:"reset",value:function reset(){this.promiseCache={};}},{key:"_getLoadPromiseAndParser",value:function _getLoadPromiseAndParser(url,data){var _this58=this;var result={promise:null,parser:null};result.promise=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var asset,i,_parser$test,parser,_i23,_parser,_parser$testParse;return _regeneratorRuntime().wrap(function _callee3$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:asset=null;i=0;case 2:if(!(i<_this58.parsers.length)){_context6.next=13;break;}parser=_this58.parsers[i];if(!(parser.load&&(_parser$test=parser.test)!==null&&_parser$test!==void 0&&_parser$test.call(parser,url,data,_this58))){_context6.next=10;break;}_context6.next=7;return parser.load(url,data,_this58);case 7:asset=_context6.sent;result.parser=parser;return _context6.abrupt("break",13);case 10:i++;_context6.next=2;break;case 13:if(result.parser){_context6.next=16;break;}console.warn("[Assets] ".concat(url," could not be loaded as we don't know how to parse it, ensure the correct parser has being added"));return _context6.abrupt("return",null);case 16:_i23=0;case 17:if(!(_i23<_this58.parsers.length)){_context6.next=36;break;}_parser=_this58.parsers[_i23];if(!_parser.parse){_context6.next=33;break;}_context6.t0=_parser.parse;if(!_context6.t0){_context6.next=25;break;}_context6.next=24;return(_parser$testParse=_parser.testParse)===null||_parser$testParse===void 0?void 0:_parser$testParse.call(_parser,asset,data,_this58);case 24:_context6.t0=_context6.sent;case 25:if(!_context6.t0){_context6.next=33;break;}_context6.next=28;return _parser.parse(asset,data,_this58);case 28:_context6.t1=_context6.sent;if(_context6.t1){_context6.next=31;break;}_context6.t1=asset;case 31:asset=_context6.t1;result.parser=_parser;case 33:_i23++;_context6.next=17;break;case 36:return _context6.abrupt("return",asset);case 37:case"end":return _context6.stop();}},_callee3);}))();return result;}},{key:"load",value:function(){var _load=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(assetsToLoadIn,onProgress){var _this59=this;var count,assets,singleAsset,assetsToLoad,total,promises;return _regeneratorRuntime().wrap(function _callee5$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:count=0;assets={};singleAsset=isSingleItem(assetsToLoadIn);assetsToLoad=convertToList(assetsToLoadIn,function(item){return{src:item};});total=assetsToLoad.length;promises=assetsToLoad.map(/*#__PURE__*/function(){var _ref16=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(asset){var url;return _regeneratorRuntime().wrap(function _callee4$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:url=path.toAbsolute(asset.src);if(assets[asset.src]){_context7.next=15;break;}_context7.prev=2;if(!_this59.promiseCache[url]){_this59.promiseCache[url]=_this59._getLoadPromiseAndParser(url,asset);}_context7.next=6;return _this59.promiseCache[url].promise;case 6:assets[asset.src]=_context7.sent;if(onProgress)onProgress(++count/total);_context7.next=15;break;case 10:_context7.prev=10;_context7.t0=_context7["catch"](2);delete _this59.promiseCache[url];delete assets[asset.src];throw new Error("[Loader.load] Failed to load ".concat(url,".\n").concat(_context7.t0));case 15:case"end":return _context7.stop();}},_callee4,null,[[2,10]]);}));return function(_x7){return _ref16.apply(this,arguments);};}());_context8.next=8;return Promise.all(promises);case 8:return _context8.abrupt("return",singleAsset?assets[assetsToLoad[0].src]:assets);case 9:case"end":return _context8.stop();}},_callee5);}));function load(_x5,_x6){return _load.apply(this,arguments);}return load;}()},{key:"unload",value:function(){var _unload=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(assetsToUnloadIn){var _this60=this;var assetsToUnload,promises;return _regeneratorRuntime().wrap(function _callee7$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:assetsToUnload=convertToList(assetsToUnloadIn,function(item){return{src:item};});promises=assetsToUnload.map(/*#__PURE__*/function(){var _ref17=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(asset){var url,loadPromise,_loadPromise$parser,_loadPromise$parser$u,loadedAsset;return _regeneratorRuntime().wrap(function _callee6$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:url=path.toAbsolute(asset.src);loadPromise=_this60.promiseCache[url];if(!loadPromise){_context9.next=8;break;}_context9.next=5;return loadPromise.promise;case 5:loadedAsset=_context9.sent;(_loadPromise$parser=loadPromise.parser)===null||_loadPromise$parser===void 0||(_loadPromise$parser$u=_loadPromise$parser.unload)===null||_loadPromise$parser$u===void 0||_loadPromise$parser$u.call(_loadPromise$parser,loadedAsset,asset,_this60);delete _this60.promiseCache[url];case 8:case"end":return _context9.stop();}},_callee6);}));return function(_x9){return _ref17.apply(this,arguments);};}());_context10.next=4;return Promise.all(promises);case 4:case"end":return _context10.stop();}},_callee7);}));function unload(_x8){return _unload.apply(this,arguments);}return unload;}()},{key:"parsers",get:function get(){return this._parsers;}}]);}();var LoaderParserPriority=/* @__PURE__ */function(LoaderParserPriority2){LoaderParserPriority2[LoaderParserPriority2["Low"]=0]="Low";LoaderParserPriority2[LoaderParserPriority2["Normal"]=1]="Normal";LoaderParserPriority2[LoaderParserPriority2["High"]=2]="High";return LoaderParserPriority2;}(LoaderParserPriority||{});var loadJson={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test:function test(url){return path.extname(url).toLowerCase()===".json";},load:function load(url){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(){var response,json;return _regeneratorRuntime().wrap(function _callee8$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:_context11.next=2;return settings.ADAPTER.fetch(url);case 2:response=_context11.sent;_context11.next=5;return response.json();case 5:json=_context11.sent;return _context11.abrupt("return",json);case 7:case"end":return _context11.stop();}},_callee8);}))();}};extensions$1.add(loadJson);var loadTxt={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test:function test(url){return path.extname(url).toLowerCase()===".txt";},load:function load(url){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(){var response,txt;return _regeneratorRuntime().wrap(function _callee9$(_context12){while(1)switch(_context12.prev=_context12.next){case 0:_context12.next=2;return settings.ADAPTER.fetch(url);case 2:response=_context12.sent;_context12.next=5;return response.text();case 5:txt=_context12.sent;return _context12.abrupt("return",txt);case 7:case"end":return _context12.stop();}},_callee9);}))();}};extensions$1.add(loadTxt);var validWeights=["normal","bold","100","200","300","400","500","600","700","800","900"];var validFontExtensions=[".ttf",".otf",".woff",".woff2"];var validFontMIMEs=["font/ttf","font/otf","font/woff","font/woff2"];function getFontFamilyName(url){var ext=path.extname(url);var name=path.basename(url,ext);var nameWithSpaces=name.replace(/(-|_)/g," ");var nameTitleCase=nameWithSpaces.toLowerCase().split(" ").map(function(word){return word.charAt(0).toUpperCase()+word.slice(1);}).join(" ");return nameTitleCase;}var loadWebFont={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test:function test(url){return checkDataUrl(url,validFontMIMEs)||checkExtension(url,validFontExtensions);},load:function load(url,options){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(){var fonts,_options$data$family,_options$data,_options$data$weights,_options$data2,_options$data3,fontFaces,name,weights,data,i,weight,font;return _regeneratorRuntime().wrap(function _callee10$(_context13){while(1)switch(_context13.prev=_context13.next){case 0:fonts=settings.ADAPTER.getFontFaceSet();if(!fonts){_context13.next=18;break;}fontFaces=[];name=(_options$data$family=(_options$data=options.data)===null||_options$data===void 0?void 0:_options$data.family)!==null&&_options$data$family!==void 0?_options$data$family:getFontFamilyName(url);weights=(_options$data$weights=(_options$data2=options.data)===null||_options$data2===void 0||(_options$data2=_options$data2.weights)===null||_options$data2===void 0?void 0:_options$data2.filter(function(weight){return validWeights.includes(weight);}))!==null&&_options$data$weights!==void 0?_options$data$weights:["normal"];data=(_options$data3=options.data)!==null&&_options$data3!==void 0?_options$data3:{};i=0;case 7:if(!(i<weights.length)){_context13.next=17;break;}weight=weights[i];font=new FontFace(name,"url(".concat(encodeURI(url),")"),_objectSpread(_objectSpread({},data),{},{weight:weight}));_context13.next=12;return font.load();case 12:fonts.add(font);fontFaces.push(font);case 14:i++;_context13.next=7;break;case 17:return _context13.abrupt("return",fontFaces.length===1?fontFaces[0]:fontFaces);case 18:console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font");return _context13.abrupt("return",null);case 20:case"end":return _context13.stop();}},_callee10);}))();},unload:function unload(font){(Array.isArray(font)?font:[font]).forEach(function(t){return settings.ADAPTER.getFontFaceSet().delete(t);});}};extensions$1.add(loadWebFont);var UUID=0;var MAX_WORKERS;var WHITE_PNG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";var checkImageBitmapCode={id:"checkImageBitmap",code:"\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('".concat(WHITE_PNG,"');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    ")};var workerCode={id:"loadImageBitmap",code:"\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };"};var workerURL;var WorkerManagerClass=/*#__PURE__*/function(){function WorkerManagerClass(){_classCallCheck(this,WorkerManagerClass);this._initialized=false;this._createdWorkers=0;this.workerPool=[];this.queue=[];this.resolveHash={};}return _createClass(WorkerManagerClass,[{key:"isImageBitmapSupported",value:function isImageBitmapSupported(){if(this._isImageBitmapSupported!==void 0)return this._isImageBitmapSupported;this._isImageBitmapSupported=new Promise(function(resolve){var workerURL2=URL.createObjectURL(new Blob([checkImageBitmapCode.code],{type:"application/javascript"}));var worker=new Worker(workerURL2);worker.addEventListener("message",function(event){worker.terminate();URL.revokeObjectURL(workerURL2);resolve(event.data);});});return this._isImageBitmapSupported;}},{key:"loadImageBitmap",value:function loadImageBitmap(src){return this._run("loadImageBitmap",[src]);}},{key:"_initWorkers",value:function(){var _initWorkers2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11(){return _regeneratorRuntime().wrap(function _callee11$(_context14){while(1)switch(_context14.prev=_context14.next){case 0:if(!this._initialized){_context14.next=2;break;}return _context14.abrupt("return");case 2:this._initialized=true;case 3:case"end":return _context14.stop();}},_callee11,this);}));function _initWorkers(){return _initWorkers2.apply(this,arguments);}return _initWorkers;}()},{key:"getWorker",value:function getWorker(){var _this61=this;if(MAX_WORKERS===void 0){MAX_WORKERS=navigator.hardwareConcurrency||4;}var worker=this.workerPool.pop();if(!worker&&this._createdWorkers<MAX_WORKERS){if(!workerURL){workerURL=URL.createObjectURL(new Blob([workerCode.code],{type:"application/javascript"}));}this._createdWorkers++;worker=new Worker(workerURL);worker.addEventListener("message",function(event){_this61.complete(event.data);_this61.returnWorker(event.target);_this61.next();});}return worker;}},{key:"returnWorker",value:function returnWorker(worker){this.workerPool.push(worker);}},{key:"complete",value:function complete(data){if(data.error!==void 0){this.resolveHash[data.uuid].reject(data.error);}else{this.resolveHash[data.uuid].resolve(data.data);}this.resolveHash[data.uuid]=null;}},{key:"_run",value:function(){var _run2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12(id,args){var _this62=this;var promise;return _regeneratorRuntime().wrap(function _callee12$(_context15){while(1)switch(_context15.prev=_context15.next){case 0:_context15.next=2;return this._initWorkers();case 2:promise=new Promise(function(resolve,reject){_this62.queue.push({id:id,arguments:args,resolve:resolve,reject:reject});});this.next();return _context15.abrupt("return",promise);case 5:case"end":return _context15.stop();}},_callee12,this);}));function _run(_x10,_x11){return _run2.apply(this,arguments);}return _run;}()},{key:"next",value:function next(){if(!this.queue.length)return;var worker=this.getWorker();if(!worker){return;}var toDo=this.queue.pop();var id=toDo.id;this.resolveHash[UUID]={resolve:toDo.resolve,reject:toDo.reject};worker.postMessage({data:toDo.arguments,uuid:UUID++,id:id});}}]);}();var WorkerManager=new WorkerManagerClass();function createTexture(base,loader,url){var texture=new Texture(base);texture.baseTexture.on("dispose",function(){delete loader.promiseCache[url];});return texture;}var validImageExtensions=[".jpeg",".jpg",".png",".webp",".avif"];var validImageMIMEs=["image/jpeg","image/png","image/webp","image/avif"];function loadImageBitmap(_x12){return _loadImageBitmap.apply(this,arguments);}function _loadImageBitmap(){_loadImageBitmap=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee47(url){var response,imageBlob,imageBitmap;return _regeneratorRuntime().wrap(function _callee47$(_context51){while(1)switch(_context51.prev=_context51.next){case 0:_context51.next=2;return settings.ADAPTER.fetch(url);case 2:response=_context51.sent;if(response.ok){_context51.next=5;break;}throw new Error("[loadImageBitmap] Failed to fetch ".concat(url,": ").concat(response.status," ").concat(response.statusText));case 5:_context51.next=7;return response.blob();case 7:imageBlob=_context51.sent;_context51.next=10;return createImageBitmap(imageBlob);case 10:imageBitmap=_context51.sent;return _context51.abrupt("return",imageBitmap);case 12:case"end":return _context51.stop();}},_callee47);}));return _loadImageBitmap.apply(this,arguments);}var loadTextures={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},config:{preferWorkers:true},test:function test(url){return checkDataUrl(url,validImageMIMEs)||checkExtension(url,validImageExtensions);},load:function load(url,asset,loader){var _this63=this;return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee13(){var src,base;return _regeneratorRuntime().wrap(function _callee13$(_context16){while(1)switch(_context16.prev=_context16.next){case 0:src=null;if(!globalThis.createImageBitmap){_context16.next=18;break;}_context16.t0=_this63.config.preferWorkers;if(!_context16.t0){_context16.next=7;break;}_context16.next=6;return WorkerManager.isImageBitmapSupported();case 6:_context16.t0=_context16.sent;case 7:if(!_context16.t0){_context16.next=13;break;}_context16.next=10;return WorkerManager.loadImageBitmap(url);case 10:src=_context16.sent;_context16.next=16;break;case 13:_context16.next=15;return loadImageBitmap(url);case 15:src=_context16.sent;case 16:_context16.next=21;break;case 18:_context16.next=20;return new Promise(function(resolve){src=new Image();src.crossOrigin="anonymous";src.src=url;if(src.complete){resolve(src);}else{src.onload=function(){resolve(src);};}});case 20:src=_context16.sent;case 21:base=new BaseTexture(src,_objectSpread({resolution:getResolutionOfUrl(url)},asset.data));base.resource.src=url;return _context16.abrupt("return",createTexture(base,loader,url));case 24:case"end":return _context16.stop();}},_callee13);}))();},unload:function unload(texture){texture.destroy(true);}};extensions$1.add(loadTextures);var loadSVG={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},test:function test(url){return path.extname(url).toLowerCase()===".svg";},testParse:function testParse(data){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee14(){return _regeneratorRuntime().wrap(function _callee14$(_context17){while(1)switch(_context17.prev=_context17.next){case 0:return _context17.abrupt("return",SVGResource.test(data));case 1:case"end":return _context17.stop();}},_callee14);}))();},parse:function parse(asset,data,loader){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee15(){var _data$data,_data$data2;var src,base,texture;return _regeneratorRuntime().wrap(function _callee15$(_context18){while(1)switch(_context18.prev=_context18.next){case 0:src=new SVGResource(asset,data===null||data===void 0||(_data$data=data.data)===null||_data$data===void 0?void 0:_data$data.resourceOptions);base=new BaseTexture(src,_objectSpread({resolution:getResolutionOfUrl(asset)},data===null||data===void 0?void 0:data.data));base.resource.src=asset;texture=createTexture(base,loader,asset);if(data!==null&&data!==void 0&&(_data$data2=data.data)!==null&&_data$data2!==void 0&&(_data$data2=_data$data2.resourceOptions)!==null&&_data$data2!==void 0&&_data$data2.autoLoad){_context18.next=7;break;}_context18.next=7;return src.load();case 7:return _context18.abrupt("return",texture);case 8:case"end":return _context18.stop();}},_callee15);}))();},load:function load(url,_options){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee16(){var response;return _regeneratorRuntime().wrap(function _callee16$(_context19){while(1)switch(_context19.prev=_context19.next){case 0:_context19.next=2;return settings.ADAPTER.fetch(url);case 2:response=_context19.sent;return _context19.abrupt("return",response.text());case 4:case"end":return _context19.stop();}},_callee16);}))();},unload:loadTextures.unload};extensions$1.add(loadSVG);var Resolver=/*#__PURE__*/function(){function Resolver(){var _this64=this;_classCallCheck(this,Resolver);this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:function createBundleAssetId(bundleId,assetId){return"".concat(bundleId).concat(_this64._bundleIdConnector).concat(assetId);},extractAssetIdFromBundle:function extractAssetIdFromBundle(bundleId,assetBundleId){return assetBundleId.replace("".concat(bundleId).concat(_this64._bundleIdConnector),"");}};this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector;this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId;this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle;this._assetMap={};this._preferredOrder=[];this._parsers=[];this._resolverHash={};this._bundles={};}return _createClass(Resolver,[{key:"setBundleIdentifier",value:function setBundleIdentifier(bundleIdentifier){var _bundleIdentifier$con,_bundleIdentifier$cre,_bundleIdentifier$ext;this._bundleIdConnector=(_bundleIdentifier$con=bundleIdentifier.connector)!==null&&_bundleIdentifier$con!==void 0?_bundleIdentifier$con:this._bundleIdConnector;this._createBundleAssetId=(_bundleIdentifier$cre=bundleIdentifier.createBundleAssetId)!==null&&_bundleIdentifier$cre!==void 0?_bundleIdentifier$cre:this._createBundleAssetId;this._extractAssetIdFromBundle=(_bundleIdentifier$ext=bundleIdentifier.extractAssetIdFromBundle)!==null&&_bundleIdentifier$ext!==void 0?_bundleIdentifier$ext:this._extractAssetIdFromBundle;if(this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar"){throw new Error("[Resolver] GenerateBundleAssetId are not working correctly");}}},{key:"prefer",value:function prefer(){var _this65=this;for(var _len5=arguments.length,preferOrders=new Array(_len5),_key5=0;_key5<_len5;_key5++){preferOrders[_key5]=arguments[_key5];}preferOrders.forEach(function(prefer){_this65._preferredOrder.push(prefer);if(!prefer.priority){prefer.priority=Object.keys(prefer.params);}});this._resolverHash={};}},{key:"basePath",get:function get(){return this._basePath;},set:function set(basePath){this._basePath=basePath;}},{key:"rootPath",get:function get(){return this._rootPath;},set:function set(rootPath){this._rootPath=rootPath;}},{key:"parsers",get:function get(){return this._parsers;}},{key:"reset",value:function reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions);this._assetMap={};this._preferredOrder=[];this._resolverHash={};this._rootPath=null;this._basePath=null;this._manifest=null;this._bundles={};this._defaultSearchParams=null;}},{key:"setDefaultSearchParams",value:function setDefaultSearchParams(searchParams){if(typeof searchParams==="string"){this._defaultSearchParams=searchParams;}else{var queryValues=searchParams;this._defaultSearchParams=Object.keys(queryValues).map(function(key){return"".concat(encodeURIComponent(key),"=").concat(encodeURIComponent(queryValues[key]));}).join("&");}}},{key:"addManifest",value:function addManifest(manifest){var _this66=this;if(this._manifest){console.warn("[Resolver] Manifest already exists, this will be overwritten");}this._manifest=manifest;manifest.bundles.forEach(function(bundle){_this66.addBundle(bundle.name,bundle.assets);});}},{key:"addBundle",value:function addBundle(bundleId,assets){var _this67=this;var assetNames=[];if(Array.isArray(assets)){assets.forEach(function(asset){if(typeof asset.name==="string"){var bundleAssetId=_this67._createBundleAssetId(bundleId,asset.name);assetNames.push(bundleAssetId);_this67.add([asset.name,bundleAssetId],asset.srcs,asset.data);}else{var bundleIds=asset.name.map(function(name){return _this67._createBundleAssetId(bundleId,name);});bundleIds.forEach(function(bundleId2){assetNames.push(bundleId2);});_this67.add([].concat(_toConsumableArray(asset.name),_toConsumableArray(bundleIds)),asset.srcs);}});}else{Object.keys(assets).forEach(function(key){assetNames.push(_this67._createBundleAssetId(bundleId,key));_this67.add([key,_this67._createBundleAssetId(bundleId,key)],assets[key]);});}this._bundles[bundleId]=assetNames;}},{key:"add",value:function add(keysIn,assetsIn,data){var _this68=this;var keys=convertToList(keysIn);keys.forEach(function(key){if(_this68.hasKey(key)){console.warn("[Resolver] already has key: ".concat(key," overwriting"));}});if(!Array.isArray(assetsIn)){if(typeof assetsIn==="string"){assetsIn=createStringVariations(assetsIn);}else{assetsIn=[assetsIn];}}var assetMap=assetsIn.map(function(asset){var _formattedAsset$data;var formattedAsset=asset;if(typeof asset==="string"){var parsed=false;for(var i=0;i<_this68._parsers.length;i++){var parser=_this68._parsers[i];if(parser.test(asset)){formattedAsset=parser.parse(asset);parsed=true;break;}}if(!parsed){formattedAsset={src:asset};}}if(!formattedAsset.format){formattedAsset.format=formattedAsset.src.split(".").pop();}if(!formattedAsset.alias){formattedAsset.alias=keys;}if(_this68._basePath||_this68._rootPath){formattedAsset.src=path.toAbsolute(formattedAsset.src,_this68._basePath,_this68._rootPath);}formattedAsset.src=_this68._appendDefaultSearchParams(formattedAsset.src);formattedAsset.data=(_formattedAsset$data=formattedAsset.data)!==null&&_formattedAsset$data!==void 0?_formattedAsset$data:data;return formattedAsset;});keys.forEach(function(key){_this68._assetMap[key]=assetMap;});}},{key:"resolveBundle",value:function resolveBundle(bundleIds){var _this69=this;var singleAsset=isSingleItem(bundleIds);bundleIds=convertToList(bundleIds);var out={};bundleIds.forEach(function(bundleId){var assetNames=_this69._bundles[bundleId];if(assetNames){var results=_this69.resolve(assetNames);var assets={};for(var key in results){var asset=results[key];assets[_this69._extractAssetIdFromBundle(bundleId,key)]=asset;}out[bundleId]=assets;}});return singleAsset?out[bundleIds[0]]:out;}},{key:"resolveUrl",value:function resolveUrl(key){var result=this.resolve(key);if(typeof key!=="string"){var out={};for(var i in result){out[i]=result[i].src;}return out;}return result.src;}},{key:"resolve",value:function resolve(keys){var _this70=this;var singleAsset=isSingleItem(keys);keys=convertToList(keys);var result={};keys.forEach(function(key){if(!_this70._resolverHash[key]){if(_this70._assetMap[key]){var _assets$;var assets=_this70._assetMap[key];var preferredOrder=_this70._getPreferredOrder(assets);var bestAsset=assets[0];preferredOrder===null||preferredOrder===void 0||preferredOrder.priority.forEach(function(priorityKey){preferredOrder.params[priorityKey].forEach(function(value){var filteredAssets=assets.filter(function(asset){if(asset[priorityKey]){return asset[priorityKey]===value;}return false;});if(filteredAssets.length){assets=filteredAssets;}});});_this70._resolverHash[key]=(_assets$=assets[0])!==null&&_assets$!==void 0?_assets$:bestAsset;}else{var src=key;if(_this70._basePath||_this70._rootPath){src=path.toAbsolute(src,_this70._basePath,_this70._rootPath);}src=_this70._appendDefaultSearchParams(src);_this70._resolverHash[key]={src:src};}}result[key]=_this70._resolverHash[key];});return singleAsset?result[keys[0]]:result;}},{key:"hasKey",value:function hasKey(key){return!!this._assetMap[key];}},{key:"hasBundle",value:function hasBundle(key){return!!this._bundles[key];}},{key:"_getPreferredOrder",value:function _getPreferredOrder(assets){var _this71=this;var _loop=function _loop(){var asset=assets[0];var preferred=_this71._preferredOrder.find(function(preference){return preference.params.format.includes(asset.format);});if(preferred){return{v:preferred};}},_ret;for(var i=0;i<assets.length;i++){_ret=_loop();if(_ret)return _ret.v;}return this._preferredOrder[0];}},{key:"_appendDefaultSearchParams",value:function _appendDefaultSearchParams(url){if(!this._defaultSearchParams)return url;var paramConnector=/\?/.test(url)?"&":"?";return"".concat(url).concat(paramConnector).concat(this._defaultSearchParams);}}]);}();var AssetsClass=/*#__PURE__*/function(){function AssetsClass(){_classCallCheck(this,AssetsClass);this._detections=[];this._initialized=false;this.resolver=new Resolver();this.loader=new Loader();this.cache=Cache;this._backgroundLoader=new BackgroundLoader(this.loader);this._backgroundLoader.active=true;this.reset();}return _createClass(AssetsClass,[{key:"init",value:function(){var _init=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee17(){var _options$texturePrefe,_options$texturePrefe2,_options$texturePrefe3;var options,manifest,resolutionPref,resolution,formats,_options$texturePrefe4,formatPref,_iterator4,_step4,detection,_iterator5,_step5,_detection,_args17=arguments;return _regeneratorRuntime().wrap(function _callee17$(_context20){while(1)switch(_context20.prev=_context20.next){case 0:options=_args17.length>0&&_args17[0]!==undefined?_args17[0]:{};if(!this._initialized){_context20.next=4;break;}console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return _context20.abrupt("return");case 4:this._initialized=true;if(options.defaultSearchParams){this.resolver.setDefaultSearchParams(options.defaultSearchParams);}if(options.basePath){this.resolver.basePath=options.basePath;}if(options.bundleIdentifier){this.resolver.setBundleIdentifier(options.bundleIdentifier);}if(!options.manifest){_context20.next=15;break;}manifest=options.manifest;if(!(typeof manifest==="string")){_context20.next=14;break;}_context20.next=13;return this.load(manifest);case 13:manifest=_context20.sent;case 14:this.resolver.addManifest(manifest);case 15:resolutionPref=(_options$texturePrefe=(_options$texturePrefe2=options.texturePreference)===null||_options$texturePrefe2===void 0?void 0:_options$texturePrefe2.resolution)!==null&&_options$texturePrefe!==void 0?_options$texturePrefe:1;resolution=typeof resolutionPref==="number"?[resolutionPref]:resolutionPref;formats=[];if(!((_options$texturePrefe3=options.texturePreference)!==null&&_options$texturePrefe3!==void 0&&_options$texturePrefe3.format)){_context20.next=44;break;}formatPref=(_options$texturePrefe4=options.texturePreference)===null||_options$texturePrefe4===void 0?void 0:_options$texturePrefe4.format;formats=typeof formatPref==="string"?[formatPref]:formatPref;_iterator4=_createForOfIteratorHelper(this._detections);_context20.prev=22;_iterator4.s();case 24:if((_step4=_iterator4.n()).done){_context20.next=34;break;}detection=_step4.value;_context20.next=28;return detection.test();case 28:if(_context20.sent){_context20.next=32;break;}_context20.next=31;return detection.remove(formats);case 31:formats=_context20.sent;case 32:_context20.next=24;break;case 34:_context20.next=39;break;case 36:_context20.prev=36;_context20.t0=_context20["catch"](22);_iterator4.e(_context20.t0);case 39:_context20.prev=39;_iterator4.f();return _context20.finish(39);case 42:_context20.next=65;break;case 44:_iterator5=_createForOfIteratorHelper(this._detections);_context20.prev=45;_iterator5.s();case 47:if((_step5=_iterator5.n()).done){_context20.next=57;break;}_detection=_step5.value;_context20.next=51;return _detection.test();case 51:if(!_context20.sent){_context20.next=55;break;}_context20.next=54;return _detection.add(formats);case 54:formats=_context20.sent;case 55:_context20.next=47;break;case 57:_context20.next=62;break;case 59:_context20.prev=59;_context20.t1=_context20["catch"](45);_iterator5.e(_context20.t1);case 62:_context20.prev=62;_iterator5.f();return _context20.finish(62);case 65:this.resolver.prefer({params:{format:formats,resolution:resolution}});case 66:case"end":return _context20.stop();}},_callee17,this,[[22,36,39,42],[45,59,62,65]]);}));function init(){return _init.apply(this,arguments);}return init;}()},{key:"add",value:function add(keysIn,assetsIn,data){this.resolver.add(keysIn,assetsIn,data);}},{key:"load",value:function(){var _load2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee18(urls,onProgress){var _this72=this;var singleAsset,urlArray,resolveResults,out;return _regeneratorRuntime().wrap(function _callee18$(_context21){while(1)switch(_context21.prev=_context21.next){case 0:if(this._initialized){_context21.next=3;break;}_context21.next=3;return this.init();case 3:singleAsset=isSingleItem(urls);urlArray=convertToList(urls).map(function(url){if(typeof url!=="string"){_this72.resolver.add(url.src,url);return url.src;}if(!_this72.resolver.hasKey(url)){_this72.resolver.add(url,url);}return url;});resolveResults=this.resolver.resolve(urlArray);_context21.next=8;return this._mapLoadToResolve(resolveResults,onProgress);case 8:out=_context21.sent;return _context21.abrupt("return",singleAsset?out[urlArray[0]]:out);case 10:case"end":return _context21.stop();}},_callee18,this);}));function load(_x13,_x14){return _load2.apply(this,arguments);}return load;}()},{key:"addBundle",value:function addBundle(bundleId,assets){this.resolver.addBundle(bundleId,assets);}},{key:"loadBundle",value:function(){var _loadBundle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee19(bundleIds,onProgress){var _this73=this;var singleAsset,resolveResults,out,keys,count,total,_onProgress,promises;return _regeneratorRuntime().wrap(function _callee19$(_context22){while(1)switch(_context22.prev=_context22.next){case 0:if(this._initialized){_context22.next=3;break;}_context22.next=3;return this.init();case 3:singleAsset=false;if(typeof bundleIds==="string"){singleAsset=true;bundleIds=[bundleIds];}resolveResults=this.resolver.resolveBundle(bundleIds);out={};keys=Object.keys(resolveResults);count=0;total=0;_onProgress=function _onProgress(){onProgress===null||onProgress===void 0||onProgress(++count/total);};promises=keys.map(function(bundleId){var resolveResult=resolveResults[bundleId];total+=Object.keys(resolveResult).length;return _this73._mapLoadToResolve(resolveResult,_onProgress).then(function(resolveResult2){out[bundleId]=resolveResult2;});});_context22.next=14;return Promise.all(promises);case 14:return _context22.abrupt("return",singleAsset?out[bundleIds[0]]:out);case 15:case"end":return _context22.stop();}},_callee19,this);}));function loadBundle(_x15,_x16){return _loadBundle.apply(this,arguments);}return loadBundle;}()},{key:"backgroundLoad",value:function(){var _backgroundLoad=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee20(urls){var resolveResults;return _regeneratorRuntime().wrap(function _callee20$(_context23){while(1)switch(_context23.prev=_context23.next){case 0:if(this._initialized){_context23.next=3;break;}_context23.next=3;return this.init();case 3:if(typeof urls==="string"){urls=[urls];}resolveResults=this.resolver.resolve(urls);this._backgroundLoader.add(Object.values(resolveResults));case 6:case"end":return _context23.stop();}},_callee20,this);}));function backgroundLoad(_x17){return _backgroundLoad.apply(this,arguments);}return backgroundLoad;}()},{key:"backgroundLoadBundle",value:function(){var _backgroundLoadBundle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee21(bundleIds){var _this74=this;var resolveResults;return _regeneratorRuntime().wrap(function _callee21$(_context24){while(1)switch(_context24.prev=_context24.next){case 0:if(this._initialized){_context24.next=3;break;}_context24.next=3;return this.init();case 3:if(typeof bundleIds==="string"){bundleIds=[bundleIds];}resolveResults=this.resolver.resolveBundle(bundleIds);Object.values(resolveResults).forEach(function(resolveResult){_this74._backgroundLoader.add(Object.values(resolveResult));});case 6:case"end":return _context24.stop();}},_callee21,this);}));function backgroundLoadBundle(_x18){return _backgroundLoadBundle.apply(this,arguments);}return backgroundLoadBundle;}()},{key:"reset",value:function reset(){this.resolver.reset();this.loader.reset();this.cache.reset();this._initialized=false;}},{key:"get",value:function get(keys){if(typeof keys==="string"){return Cache.get(keys);}var assets={};for(var i=0;i<keys.length;i++){assets[i]=Cache.get(keys[i]);}return assets;}},{key:"_mapLoadToResolve",value:function(){var _mapLoadToResolve2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee22(resolveResults,onProgress){var resolveArray,resolveKeys,loadedAssets,out;return _regeneratorRuntime().wrap(function _callee22$(_context25){while(1)switch(_context25.prev=_context25.next){case 0:resolveArray=Object.values(resolveResults);resolveKeys=Object.keys(resolveResults);this._backgroundLoader.active=false;_context25.next=5;return this.loader.load(resolveArray,onProgress);case 5:loadedAssets=_context25.sent;this._backgroundLoader.active=true;out={};resolveArray.forEach(function(resolveResult,i){var asset=loadedAssets[resolveResult.src];var keys=[resolveResult.src];if(resolveResult.alias){keys.push.apply(keys,_toConsumableArray(resolveResult.alias));}out[resolveKeys[i]]=asset;Cache.set(keys,asset);});return _context25.abrupt("return",out);case 10:case"end":return _context25.stop();}},_callee22,this);}));function _mapLoadToResolve(_x19,_x20){return _mapLoadToResolve2.apply(this,arguments);}return _mapLoadToResolve;}()},{key:"unload",value:function(){var _unload2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee23(urls){var urlArray,resolveResults;return _regeneratorRuntime().wrap(function _callee23$(_context26){while(1)switch(_context26.prev=_context26.next){case 0:if(this._initialized){_context26.next=3;break;}_context26.next=3;return this.init();case 3:urlArray=convertToList(urls).map(function(url){return typeof url!=="string"?url.src:url;});resolveResults=this.resolver.resolve(urlArray);_context26.next=7;return this._unloadFromResolved(resolveResults);case 7:case"end":return _context26.stop();}},_callee23,this);}));function unload(_x21){return _unload2.apply(this,arguments);}return unload;}()},{key:"unloadBundle",value:function(){var _unloadBundle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee24(bundleIds){var _this75=this;var resolveResults,promises;return _regeneratorRuntime().wrap(function _callee24$(_context27){while(1)switch(_context27.prev=_context27.next){case 0:if(this._initialized){_context27.next=3;break;}_context27.next=3;return this.init();case 3:bundleIds=convertToList(bundleIds);resolveResults=this.resolver.resolveBundle(bundleIds);promises=Object.keys(resolveResults).map(function(bundleId){return _this75._unloadFromResolved(resolveResults[bundleId]);});_context27.next=8;return Promise.all(promises);case 8:case"end":return _context27.stop();}},_callee24,this);}));function unloadBundle(_x22){return _unloadBundle.apply(this,arguments);}return unloadBundle;}()},{key:"_unloadFromResolved",value:function(){var _unloadFromResolved2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee25(resolveResult){var resolveArray;return _regeneratorRuntime().wrap(function _callee25$(_context28){while(1)switch(_context28.prev=_context28.next){case 0:resolveArray=Object.values(resolveResult);resolveArray.forEach(function(resolveResult2){Cache.remove(resolveResult2.src);});_context28.next=4;return this.loader.unload(resolveArray);case 4:case"end":return _context28.stop();}},_callee25,this);}));function _unloadFromResolved(_x23){return _unloadFromResolved2.apply(this,arguments);}return _unloadFromResolved;}()},{key:"detections",get:function get(){return this._detections;}},{key:"preferWorkers",get:function get(){return loadTextures.config.preferWorkers;},set:function set(value){loadTextures.config.preferWorkers=value;}}]);}();var Assets=new AssetsClass();extensions$1.handleByList(ExtensionType.LoadParser,Assets.loader.parsers).handleByList(ExtensionType.ResolveParser,Assets.resolver.parsers).handleByList(ExtensionType.CacheParser,Assets.cache.parsers).handleByList(ExtensionType.DetectionParser,Assets.detections);var cacheTextureArray={extension:ExtensionType.CacheParser,test:function test(asset){return Array.isArray(asset)&&asset.every(function(t){return t instanceof Texture;});},getCacheableAssets:function getCacheableAssets(keys,asset){var out={};keys.forEach(function(key){asset.forEach(function(item,i){out[key+(i===0?"":i+1)]=item;});});return out;}};extensions$1.add(cacheTextureArray);var detectAvif={extension:{type:ExtensionType.DetectionParser,priority:1},test:function(){var _test=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee26(){var avifData,blob;return _regeneratorRuntime().wrap(function _callee26$(_context29){while(1)switch(_context29.prev=_context29.next){case 0:if(globalThis.createImageBitmap){_context29.next=2;break;}return _context29.abrupt("return",false);case 2:avifData="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=";_context29.next=5;return settings.ADAPTER.fetch(avifData).then(function(r){return r.blob();});case 5:blob=_context29.sent;return _context29.abrupt("return",createImageBitmap(blob).then(function(){return true;},function(){return false;}));case 7:case"end":return _context29.stop();}},_callee26);}));function test(){return _test.apply(this,arguments);}return test;}(),add:function(){var _add=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee27(formats){return _regeneratorRuntime().wrap(function _callee27$(_context30){while(1)switch(_context30.prev=_context30.next){case 0:return _context30.abrupt("return",[].concat(_toConsumableArray(formats),["avif"]));case 1:case"end":return _context30.stop();}},_callee27);}));function add(_x24){return _add.apply(this,arguments);}return add;}(),remove:function(){var _remove=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee28(formats){return _regeneratorRuntime().wrap(function _callee28$(_context31){while(1)switch(_context31.prev=_context31.next){case 0:return _context31.abrupt("return",formats.filter(function(f){return f!=="avif";}));case 1:case"end":return _context31.stop();}},_callee28);}));function remove(_x25){return _remove.apply(this,arguments);}return remove;}()};extensions$1.add(detectAvif);var detectWebp={extension:{type:ExtensionType.DetectionParser,priority:0},test:function(){var _test2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee29(){var webpData,blob;return _regeneratorRuntime().wrap(function _callee29$(_context32){while(1)switch(_context32.prev=_context32.next){case 0:if(globalThis.createImageBitmap){_context32.next=2;break;}return _context32.abrupt("return",false);case 2:webpData="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=";_context32.next=5;return settings.ADAPTER.fetch(webpData).then(function(r){return r.blob();});case 5:blob=_context32.sent;return _context32.abrupt("return",createImageBitmap(blob).then(function(){return true;},function(){return false;}));case 7:case"end":return _context32.stop();}},_callee29);}));function test(){return _test2.apply(this,arguments);}return test;}(),add:function(){var _add2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee30(formats){return _regeneratorRuntime().wrap(function _callee30$(_context33){while(1)switch(_context33.prev=_context33.next){case 0:return _context33.abrupt("return",[].concat(_toConsumableArray(formats),["webp"]));case 1:case"end":return _context33.stop();}},_callee30);}));function add(_x26){return _add2.apply(this,arguments);}return add;}(),remove:function(){var _remove2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee31(formats){return _regeneratorRuntime().wrap(function _callee31$(_context34){while(1)switch(_context34.prev=_context34.next){case 0:return _context34.abrupt("return",formats.filter(function(f){return f!=="webp";}));case 1:case"end":return _context34.stop();}},_callee31);}));function remove(_x27){return _remove2.apply(this,arguments);}return remove;}()};extensions$1.add(detectWebp);var imageFormats=["png","jpg","jpeg"];var detectDefaults={extension:{type:ExtensionType.DetectionParser,priority:-1},test:function test(){return Promise.resolve(true);},add:function(){var _add3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee32(formats){return _regeneratorRuntime().wrap(function _callee32$(_context35){while(1)switch(_context35.prev=_context35.next){case 0:return _context35.abrupt("return",[].concat(_toConsumableArray(formats),imageFormats));case 1:case"end":return _context35.stop();}},_callee32);}));function add(_x28){return _add3.apply(this,arguments);}return add;}(),remove:function(){var _remove3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee33(formats){return _regeneratorRuntime().wrap(function _callee33$(_context36){while(1)switch(_context36.prev=_context36.next){case 0:return _context36.abrupt("return",formats.filter(function(f){return!imageFormats.includes(f);}));case 1:case"end":return _context36.stop();}},_callee33);}));function remove(_x29){return _remove3.apply(this,arguments);}return remove;}()};extensions$1.add(detectDefaults);var resolveTextureUrl={extension:ExtensionType.ResolveParser,test:loadTextures.test,parse:function parse(value){var _settings$RETINA_PREF2,_settings$RETINA_PREF3;return{resolution:parseFloat((_settings$RETINA_PREF2=(_settings$RETINA_PREF3=settings.RETINA_PREFIX.exec(value))===null||_settings$RETINA_PREF3===void 0?void 0:_settings$RETINA_PREF3[1])!==null&&_settings$RETINA_PREF2!==void 0?_settings$RETINA_PREF2:"1"),format:value.split(".").pop(),src:value};}};extensions$1.add(resolveTextureUrl);var INTERNAL_FORMATS=/* @__PURE__ */function(INTERNAL_FORMATS2){INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGB_S3TC_DXT1_EXT"]=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGBA_S3TC_DXT1_EXT"]=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGBA_S3TC_DXT3_EXT"]=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGBA_S3TC_DXT5_EXT"]=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT"]=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT"]=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT"]=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_SRGB_S3TC_DXT1_EXT"]=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_R11_EAC"]=37488]="COMPRESSED_R11_EAC";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_SIGNED_R11_EAC"]=37489]="COMPRESSED_SIGNED_R11_EAC";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RG11_EAC"]=37490]="COMPRESSED_RG11_EAC";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_SIGNED_RG11_EAC"]=37491]="COMPRESSED_SIGNED_RG11_EAC";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGB8_ETC2"]=37492]="COMPRESSED_RGB8_ETC2";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGBA8_ETC2_EAC"]=37496]="COMPRESSED_RGBA8_ETC2_EAC";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_SRGB8_ETC2"]=37493]="COMPRESSED_SRGB8_ETC2";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"]=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2"]=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2"]=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGB_PVRTC_4BPPV1_IMG"]=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGBA_PVRTC_4BPPV1_IMG"]=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGB_PVRTC_2BPPV1_IMG"]=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGBA_PVRTC_2BPPV1_IMG"]=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGB_ETC1_WEBGL"]=36196]="COMPRESSED_RGB_ETC1_WEBGL";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGB_ATC_WEBGL"]=35986]="COMPRESSED_RGB_ATC_WEBGL";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL"]=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"]=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL";INTERNAL_FORMATS2[INTERNAL_FORMATS2["COMPRESSED_RGBA_ASTC_4x4_KHR"]=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR";return INTERNAL_FORMATS2;}(INTERNAL_FORMATS||{});var INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=(_INTERNAL_FORMAT_TO_B={},_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_INTERNAL_FORMAT_TO_B,33776/* COMPRESSED_RGB_S3TC_DXT1_EXT */,0.5),33777/* COMPRESSED_RGBA_S3TC_DXT1_EXT */,0.5),33778/* COMPRESSED_RGBA_S3TC_DXT3_EXT */,1),33779/* COMPRESSED_RGBA_S3TC_DXT5_EXT */,1),35916/* COMPRESSED_SRGB_S3TC_DXT1_EXT */,0.5),35917/* COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT */,0.5),35918/* COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT */,1),35919/* COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT */,1),37488/* COMPRESSED_R11_EAC */,0.5),37489/* COMPRESSED_SIGNED_R11_EAC */,0.5),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_INTERNAL_FORMAT_TO_B,37490/* COMPRESSED_RG11_EAC */,1),37491/* COMPRESSED_SIGNED_RG11_EAC */,1),37492/* COMPRESSED_RGB8_ETC2 */,0.5),37496/* COMPRESSED_RGBA8_ETC2_EAC */,1),37493/* COMPRESSED_SRGB8_ETC2 */,0.5),37497/* COMPRESSED_SRGB8_ALPHA8_ETC2_EAC */,1),37494/* COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2 */,0.5),37495/* COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2 */,0.5),35840/* COMPRESSED_RGB_PVRTC_4BPPV1_IMG */,0.5),35842/* COMPRESSED_RGBA_PVRTC_4BPPV1_IMG */,0.5),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_INTERNAL_FORMAT_TO_B,35841/* COMPRESSED_RGB_PVRTC_2BPPV1_IMG */,0.25),35843/* COMPRESSED_RGBA_PVRTC_2BPPV1_IMG */,0.25),36196/* COMPRESSED_RGB_ETC1_WEBGL */,0.5),35986/* COMPRESSED_RGB_ATC_WEBGL */,0.5),35986/* COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL */,1),34798/* COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL */,1),37808/* COMPRESSED_RGBA_ASTC_4x4_KHR */,1));var storedGl;var extensions;function getCompressedTextureExtensions(){extensions={s3tc:storedGl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:storedGl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:storedGl.getExtension("WEBGL_compressed_texture_etc"),etc1:storedGl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:storedGl.getExtension("WEBGL_compressed_texture_pvrtc")||storedGl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:storedGl.getExtension("WEBGL_compressed_texture_atc"),astc:storedGl.getExtension("WEBGL_compressed_texture_astc")};}var detectCompressedTextures={extension:{type:ExtensionType.DetectionParser,priority:2},test:function(){var _test3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee34(){var canvas,gl;return _regeneratorRuntime().wrap(function _callee34$(_context37){while(1)switch(_context37.prev=_context37.next){case 0:canvas=settings.ADAPTER.createCanvas();gl=canvas.getContext("webgl");if(gl){_context37.next=5;break;}console.warn("WebGL not available for compressed textures.");return _context37.abrupt("return",false);case 5:storedGl=gl;return _context37.abrupt("return",true);case 7:case"end":return _context37.stop();}},_callee34);}));function test(){return _test3.apply(this,arguments);}return test;}(),add:function(){var _add4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee35(formats){var textureFormats,extensionName,extension;return _regeneratorRuntime().wrap(function _callee35$(_context38){while(1)switch(_context38.prev=_context38.next){case 0:if(!extensions)getCompressedTextureExtensions();textureFormats=[];_context38.t0=_regeneratorRuntime().keys(extensions);case 3:if((_context38.t1=_context38.t0()).done){_context38.next=11;break;}extensionName=_context38.t1.value;extension=extensions[extensionName];if(extension){_context38.next=8;break;}return _context38.abrupt("continue",3);case 8:textureFormats.push(extensionName);_context38.next=3;break;case 11:return _context38.abrupt("return",[].concat(textureFormats,_toConsumableArray(formats)));case 12:case"end":return _context38.stop();}},_callee35);}));function add(_x30){return _add4.apply(this,arguments);}return add;}(),remove:function(){var _remove4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee36(formats){return _regeneratorRuntime().wrap(function _callee36$(_context39){while(1)switch(_context39.prev=_context39.next){case 0:if(!extensions)getCompressedTextureExtensions();return _context39.abrupt("return",formats.filter(function(f){return!(f in extensions);}));case 2:case"end":return _context39.stop();}},_callee36);}));function remove(_x31){return _remove4.apply(this,arguments);}return remove;}()};extensions$1.add(detectCompressedTextures);var BlobResource=/*#__PURE__*/function(_BufferResource2){function BlobResource(source){var _data2;var _this76;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{width:1,height:1,autoLoad:true};_classCallCheck(this,BlobResource);var origin;var data;if(typeof source==="string"){origin=source;data=new Uint8Array();}else{origin=null;data=source;}_this76=_callSuper(this,BlobResource,[data,options]);_this76.origin=origin;_this76.buffer=data?new ViewableBuffer(data):null;if(_this76.origin&&options.autoLoad!==false){_this76.load();}if((_data2=data)!==null&&_data2!==void 0&&_data2.length){_this76.loaded=true;_this76.onBlobLoaded(_this76.buffer.rawBinaryData);}return _this76;}_inherits(BlobResource,_BufferResource2);return _createClass(BlobResource,[{key:"onBlobLoaded",value:function onBlobLoaded(_data){}},{key:"load",value:function(){var _load3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee37(){var response,blob,arrayBuffer;return _regeneratorRuntime().wrap(function _callee37$(_context40){while(1)switch(_context40.prev=_context40.next){case 0:_context40.next=2;return fetch(this.origin);case 2:response=_context40.sent;_context40.next=5;return response.blob();case 5:blob=_context40.sent;_context40.next=8;return blob.arrayBuffer();case 8:arrayBuffer=_context40.sent;this.data=new Uint32Array(arrayBuffer);this.buffer=new ViewableBuffer(arrayBuffer);this.loaded=true;this.onBlobLoaded(arrayBuffer);this.update();return _context40.abrupt("return",this);case 15:case"end":return _context40.stop();}},_callee37,this);}));function load(){return _load3.apply(this,arguments);}return load;}()}]);}(BufferResource);var CompressedTextureResource=/*#__PURE__*/function(_BlobResource){function CompressedTextureResource(source,options){var _this77;_classCallCheck(this,CompressedTextureResource);_this77=_callSuper(this,CompressedTextureResource,[source,options]);_this77.format=options.format;_this77.levels=options.levels||1;_this77._width=options.width;_this77._height=options.height;_this77._extension=CompressedTextureResource._formatToExtension(_this77.format);if(options.levelBuffers||_this77.buffer){_this77._levelBuffers=options.levelBuffers||CompressedTextureResource._createLevelBuffers(source instanceof Uint8Array?source:_this77.buffer.uint8View,_this77.format,_this77.levels,4,4,_this77.width,_this77.height);}return _this77;}_inherits(CompressedTextureResource,_BlobResource);return _createClass(CompressedTextureResource,[{key:"upload",value:function upload(renderer,_texture,_glTexture){var gl=renderer.gl;var extension=renderer.context.extensions[this._extension];if(!extension){throw new Error("".concat(this._extension," textures are not supported on the current machine"));}if(!this._levelBuffers){return false;}for(var i=0,j=this.levels;i<j;i++){var _this$_levelBuffers$i=this._levelBuffers[i],levelID=_this$_levelBuffers$i.levelID,levelWidth=_this$_levelBuffers$i.levelWidth,levelHeight=_this$_levelBuffers$i.levelHeight,levelBuffer=_this$_levelBuffers$i.levelBuffer;gl.compressedTexImage2D(gl.TEXTURE_2D,levelID,this.format,levelWidth,levelHeight,0,levelBuffer);}return true;}},{key:"onBlobLoaded",value:function onBlobLoaded(){this._levelBuffers=CompressedTextureResource._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height);}}],[{key:"_formatToExtension",value:function _formatToExtension(format){if(format>=33776&&format<=33779){return"s3tc";}else if(format>=37488&&format<=37497){return"etc";}else if(format>=35840&&format<=35843){return"pvrtc";}else if(format>=36196){return"etc1";}else if(format>=35986&&format<=34798){return"atc";}throw new Error("Invalid (compressed) texture format given!");}},{key:"_createLevelBuffers",value:function _createLevelBuffers(buffer,format,levels,blockWidth,blockHeight,imageWidth,imageHeight){var buffers=new Array(levels);var offset=buffer.byteOffset;var levelWidth=imageWidth;var levelHeight=imageHeight;var alignedLevelWidth=levelWidth+blockWidth-1&~(blockWidth-1);var alignedLevelHeight=levelHeight+blockHeight-1&~(blockHeight-1);var levelSize=alignedLevelWidth*alignedLevelHeight*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[format];for(var i=0;i<levels;i++){buffers[i]={levelID:i,levelWidth:levels>1?levelWidth:alignedLevelWidth,levelHeight:levels>1?levelHeight:alignedLevelHeight,levelBuffer:new Uint8Array(buffer.buffer,offset,levelSize)};offset+=levelSize;levelWidth=levelWidth>>1||1;levelHeight=levelHeight>>1||1;alignedLevelWidth=levelWidth+blockWidth-1&~(blockWidth-1);alignedLevelHeight=levelHeight+blockHeight-1&~(blockHeight-1);levelSize=alignedLevelWidth*alignedLevelHeight*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[format];}return buffers;}}]);}(BlobResource);var DDS_MAGIC_SIZE=4;var DDS_HEADER_SIZE=124;var DDS_HEADER_PF_SIZE=32;var DDS_HEADER_DX10_SIZE=20;var DDS_MAGIC=542327876;var DDS_FIELDS={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19};var DDS_PF_FIELDS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7};var DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4};var PF_FLAGS=1;var DDPF_ALPHA=2;var DDPF_FOURCC=4;var DDPF_RGB=64;var DDPF_YUV=512;var DDPF_LUMINANCE=131072;var FOURCC_DXT1=827611204;var FOURCC_DXT3=861165636;var FOURCC_DXT5=894720068;var FOURCC_DX10=808540228;var DDS_RESOURCE_MISC_TEXTURECUBE=4;var FOURCC_TO_FORMAT=_defineProperty(_defineProperty(_defineProperty({},FOURCC_DXT1,INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT),FOURCC_DXT3,INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT),FOURCC_DXT5,INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT);var DXGI_TO_FORMAT=_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},70/* DXGI_FORMAT_BC1_TYPELESS */,INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT),71/* DXGI_FORMAT_BC1_UNORM */,INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT),73/* DXGI_FORMAT_BC2_TYPELESS */,INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT),74/* DXGI_FORMAT_BC2_UNORM */,INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT),76/* DXGI_FORMAT_BC3_TYPELESS */,INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT),77/* DXGI_FORMAT_BC3_UNORM */,INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT),72/* DXGI_FORMAT_BC1_UNORM_SRGB */,INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT),75/* DXGI_FORMAT_BC2_UNORM_SRGB */,INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT),78/* DXGI_FORMAT_BC3_UNORM_SRGB */,INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT);function parseDDS(arrayBuffer){var data=new Uint32Array(arrayBuffer);var magicWord=data[0];if(magicWord!==DDS_MAGIC){throw new Error("Invalid DDS file magic word");}var header=new Uint32Array(arrayBuffer,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT);var height=header[DDS_FIELDS.HEIGHT];var width=header[DDS_FIELDS.WIDTH];var mipmapCount=header[DDS_FIELDS.MIPMAP_COUNT];var pixelFormat=new Uint32Array(arrayBuffer,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT);var formatFlags=pixelFormat[PF_FLAGS];if(formatFlags&DDPF_FOURCC){var fourCC=pixelFormat[DDS_PF_FIELDS.FOURCC];if(fourCC!==FOURCC_DX10){var internalFormat2=FOURCC_TO_FORMAT[fourCC];var dataOffset2=DDS_MAGIC_SIZE+DDS_HEADER_SIZE;var texData=new Uint8Array(arrayBuffer,dataOffset2);var resource=new CompressedTextureResource(texData,{format:internalFormat2,width:width,height:height,levels:mipmapCount});return[resource];}var dx10Offset=DDS_MAGIC_SIZE+DDS_HEADER_SIZE;var dx10Header=new Uint32Array(data.buffer,dx10Offset,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT);var dxgiFormat=dx10Header[DDS_DX10_FIELDS.DXGI_FORMAT];var resourceDimension=dx10Header[DDS_DX10_FIELDS.RESOURCE_DIMENSION];var miscFlag=dx10Header[DDS_DX10_FIELDS.MISC_FLAG];var arraySize=dx10Header[DDS_DX10_FIELDS.ARRAY_SIZE];var internalFormat=DXGI_TO_FORMAT[dxgiFormat];if(internalFormat===void 0){throw new Error("DDSParser cannot parse texture data with DXGI format ".concat(dxgiFormat));}if(miscFlag===DDS_RESOURCE_MISC_TEXTURECUBE){throw new Error("DDSParser does not support cubemap textures");}if(resourceDimension===6/* DDS_DIMENSION_TEXTURE3D */){throw new Error("DDSParser does not supported 3D texture data");}var imageBuffers=new Array();var dataOffset=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(arraySize===1){imageBuffers.push(new Uint8Array(arrayBuffer,dataOffset));}else{var pixelSize=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[internalFormat];var imageSize=0;var levelWidth=width;var levelHeight=height;for(var i=0;i<mipmapCount;i++){var alignedLevelWidth=Math.max(1,levelWidth+3&~3);var alignedLevelHeight=Math.max(1,levelHeight+3&~3);var levelSize=alignedLevelWidth*alignedLevelHeight*pixelSize;imageSize+=levelSize;levelWidth=levelWidth>>>1;levelHeight=levelHeight>>>1;}var imageOffset=dataOffset;for(var _i24=0;_i24<arraySize;_i24++){imageBuffers.push(new Uint8Array(arrayBuffer,imageOffset,imageSize));imageOffset+=imageSize;}}return imageBuffers.map(function(buffer){return new CompressedTextureResource(buffer,{format:internalFormat,width:width,height:height,levels:mipmapCount});});}if(formatFlags&DDPF_RGB){throw new Error("DDSParser does not support uncompressed texture data.");}if(formatFlags&DDPF_YUV){throw new Error("DDSParser does not supported YUV uncompressed texture data.");}if(formatFlags&DDPF_LUMINANCE){throw new Error("DDSParser does not support single-channel (lumninance) texture data!");}if(formatFlags&DDPF_ALPHA){throw new Error("DDSParser does not support single-channel (alpha) texture data!");}throw new Error("DDSParser failed to load a texture file due to an unknown reason!");}var FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10];var ENDIANNESS=67305985;var KTX_FIELDS={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60};var FILE_HEADER_SIZE=64;var TYPES_TO_BYTES_PER_COMPONENT=_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},TYPES.UNSIGNED_BYTE,1),TYPES.UNSIGNED_SHORT,2),TYPES.INT,4),TYPES.UNSIGNED_INT,4),TYPES.FLOAT,4),TYPES.HALF_FLOAT,8);var FORMATS_TO_COMPONENTS=_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},FORMATS.RGBA,4),FORMATS.RGB,3),FORMATS.RG,2),FORMATS.RED,1),FORMATS.LUMINANCE,1),FORMATS.LUMINANCE_ALPHA,2),FORMATS.ALPHA,1);var TYPES_TO_BYTES_PER_PIXEL=_defineProperty(_defineProperty(_defineProperty({},TYPES.UNSIGNED_SHORT_4_4_4_4,2),TYPES.UNSIGNED_SHORT_5_5_5_1,2),TYPES.UNSIGNED_SHORT_5_6_5,2);function parseKTX(url,arrayBuffer){var loadKeyValueData=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var dataView=new DataView(arrayBuffer);if(!validate(url,dataView)){return null;}var littleEndian=dataView.getUint32(KTX_FIELDS.ENDIANNESS,true)===ENDIANNESS;var glType=dataView.getUint32(KTX_FIELDS.GL_TYPE,littleEndian);var glFormat=dataView.getUint32(KTX_FIELDS.GL_FORMAT,littleEndian);var glInternalFormat=dataView.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,littleEndian);var pixelWidth=dataView.getUint32(KTX_FIELDS.PIXEL_WIDTH,littleEndian);var pixelHeight=dataView.getUint32(KTX_FIELDS.PIXEL_HEIGHT,littleEndian)||1;var pixelDepth=dataView.getUint32(KTX_FIELDS.PIXEL_DEPTH,littleEndian)||1;var numberOfArrayElements=dataView.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,littleEndian)||1;var numberOfFaces=dataView.getUint32(KTX_FIELDS.NUMBER_OF_FACES,littleEndian);var numberOfMipmapLevels=dataView.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,littleEndian);var bytesOfKeyValueData=dataView.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,littleEndian);if(pixelHeight===0||pixelDepth!==1){throw new Error("Only 2D textures are supported");}if(numberOfFaces!==1){throw new Error("CubeTextures are not supported by KTXLoader yet!");}if(numberOfArrayElements!==1){throw new Error("WebGL does not support array textures");}var blockWidth=4;var blockHeight=4;var alignedWidth=pixelWidth+3&~3;var alignedHeight=pixelHeight+3&~3;var imageBuffers=new Array(numberOfArrayElements);var imagePixels=pixelWidth*pixelHeight;if(glType===0){imagePixels=alignedWidth*alignedHeight;}var imagePixelByteSize;if(glType!==0){if(TYPES_TO_BYTES_PER_COMPONENT[glType]){imagePixelByteSize=TYPES_TO_BYTES_PER_COMPONENT[glType]*FORMATS_TO_COMPONENTS[glFormat];}else{imagePixelByteSize=TYPES_TO_BYTES_PER_PIXEL[glType];}}else{imagePixelByteSize=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[glInternalFormat];}if(imagePixelByteSize===void 0){throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");}var kvData=loadKeyValueData?parseKvData(dataView,bytesOfKeyValueData,littleEndian):null;var imageByteSize=imagePixels*imagePixelByteSize;var mipByteSize=imageByteSize;var mipWidth=pixelWidth;var mipHeight=pixelHeight;var alignedMipWidth=alignedWidth;var alignedMipHeight=alignedHeight;var imageOffset=FILE_HEADER_SIZE+bytesOfKeyValueData;for(var mipmapLevel=0;mipmapLevel<numberOfMipmapLevels;mipmapLevel++){var imageSize=dataView.getUint32(imageOffset,littleEndian);var elementOffset=imageOffset+4;for(var arrayElement=0;arrayElement<numberOfArrayElements;arrayElement++){var mips=imageBuffers[arrayElement];if(!mips){mips=imageBuffers[arrayElement]=new Array(numberOfMipmapLevels);}mips[mipmapLevel]={levelID:mipmapLevel,levelWidth:numberOfMipmapLevels>1||glType!==0?mipWidth:alignedMipWidth,levelHeight:numberOfMipmapLevels>1||glType!==0?mipHeight:alignedMipHeight,levelBuffer:new Uint8Array(arrayBuffer,elementOffset,mipByteSize)};elementOffset+=mipByteSize;}imageOffset+=imageSize+4;imageOffset=imageOffset%4!==0?imageOffset+4-imageOffset%4:imageOffset;mipWidth=mipWidth>>1||1;mipHeight=mipHeight>>1||1;alignedMipWidth=mipWidth+blockWidth-1&~(blockWidth-1);alignedMipHeight=mipHeight+blockHeight-1&~(blockHeight-1);mipByteSize=alignedMipWidth*alignedMipHeight*imagePixelByteSize;}if(glType!==0){return{uncompressed:imageBuffers.map(function(levelBuffers){var buffer=levelBuffers[0].levelBuffer;var convertToInt=false;if(glType===TYPES.FLOAT){buffer=new Float32Array(levelBuffers[0].levelBuffer.buffer,levelBuffers[0].levelBuffer.byteOffset,levelBuffers[0].levelBuffer.byteLength/4);}else if(glType===TYPES.UNSIGNED_INT){convertToInt=true;buffer=new Uint32Array(levelBuffers[0].levelBuffer.buffer,levelBuffers[0].levelBuffer.byteOffset,levelBuffers[0].levelBuffer.byteLength/4);}else if(glType===TYPES.INT){convertToInt=true;buffer=new Int32Array(levelBuffers[0].levelBuffer.buffer,levelBuffers[0].levelBuffer.byteOffset,levelBuffers[0].levelBuffer.byteLength/4);}return{resource:new BufferResource(buffer,{width:levelBuffers[0].levelWidth,height:levelBuffers[0].levelHeight}),type:glType,format:convertToInt?convertFormatToInteger(glFormat):glFormat};}),kvData:kvData};}return{compressed:imageBuffers.map(function(levelBuffers){return new CompressedTextureResource(null,{format:glInternalFormat,width:pixelWidth,height:pixelHeight,levels:numberOfMipmapLevels,levelBuffers:levelBuffers});}),kvData:kvData};}function validate(url,dataView){for(var i=0;i<FILE_IDENTIFIER.length;i++){if(dataView.getUint8(i)!==FILE_IDENTIFIER[i]){console.error("".concat(url," is not a valid *.ktx file!"));return false;}}return true;}function convertFormatToInteger(format){switch(format){case FORMATS.RGBA:return FORMATS.RGBA_INTEGER;case FORMATS.RGB:return FORMATS.RGB_INTEGER;case FORMATS.RG:return FORMATS.RG_INTEGER;case FORMATS.RED:return FORMATS.RED_INTEGER;default:return format;}}function parseKvData(dataView,bytesOfKeyValueData,littleEndian){var kvData=/* @__PURE__ */new Map();var bytesIntoKeyValueData=0;while(bytesIntoKeyValueData<bytesOfKeyValueData){var keyAndValueByteSize=dataView.getUint32(FILE_HEADER_SIZE+bytesIntoKeyValueData,littleEndian);var keyAndValueByteOffset=FILE_HEADER_SIZE+bytesIntoKeyValueData+4;var valuePadding=3-(keyAndValueByteSize+3)%4;if(keyAndValueByteSize===0||keyAndValueByteSize>bytesOfKeyValueData-bytesIntoKeyValueData){console.error("KTXLoader: keyAndValueByteSize out of bounds");break;}var keyNulByte=0;for(;keyNulByte<keyAndValueByteSize;keyNulByte++){if(dataView.getUint8(keyAndValueByteOffset+keyNulByte)===0){break;}}if(keyNulByte===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break;}var key=new TextDecoder().decode(new Uint8Array(dataView.buffer,keyAndValueByteOffset,keyNulByte));var value=new DataView(dataView.buffer,keyAndValueByteOffset+keyNulByte+1,keyAndValueByteSize-keyNulByte-1);kvData.set(key,value);bytesIntoKeyValueData+=4+keyAndValueByteSize+valuePadding;}return kvData;}var loadDDS={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},test:function test(url){return checkExtension(url,".dds");},load:function load(url,asset,loader){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee38(){var response,arrayBuffer,resources,textures;return _regeneratorRuntime().wrap(function _callee38$(_context41){while(1)switch(_context41.prev=_context41.next){case 0:_context41.next=2;return settings.ADAPTER.fetch(url);case 2:response=_context41.sent;_context41.next=5;return response.arrayBuffer();case 5:arrayBuffer=_context41.sent;resources=parseDDS(arrayBuffer);textures=resources.map(function(resource){var base=new BaseTexture(resource,_objectSpread({mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:getResolutionOfUrl(url)},asset.data));return createTexture(base,loader,url);});return _context41.abrupt("return",textures.length===1?textures[0]:textures);case 9:case"end":return _context41.stop();}},_callee38);}))();},unload:function unload(texture){if(Array.isArray(texture)){texture.forEach(function(t){return t.destroy(true);});}else{texture.destroy(true);}}};extensions$1.add(loadDDS);var loadKTX={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},test:function test(url){return checkExtension(url,".ktx");},load:function load(url,asset,loader){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee39(){var response,arrayBuffer,_parseKTX,compressed,uncompressed,kvData,resources,options,textures;return _regeneratorRuntime().wrap(function _callee39$(_context42){while(1)switch(_context42.prev=_context42.next){case 0:_context42.next=2;return settings.ADAPTER.fetch(url);case 2:response=_context42.sent;_context42.next=5;return response.arrayBuffer();case 5:arrayBuffer=_context42.sent;_parseKTX=parseKTX(url,arrayBuffer),compressed=_parseKTX.compressed,uncompressed=_parseKTX.uncompressed,kvData=_parseKTX.kvData;resources=compressed!==null&&compressed!==void 0?compressed:uncompressed;options=_objectSpread({mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:getResolutionOfUrl(url)},asset.data);textures=resources.map(function(resource){if(resources===uncompressed){Object.assign(options,{type:resource.type,format:resource.format});}var base=new BaseTexture(resource,options);base.ktxKeyValueData=kvData;return createTexture(base,loader,url);});return _context42.abrupt("return",textures.length===1?textures[0]:textures);case 11:case"end":return _context42.stop();}},_callee39);}))();},unload:function unload(texture){if(Array.isArray(texture)){texture.forEach(function(t){return t.destroy(true);});}else{texture.destroy(true);}}};extensions$1.add(loadKTX);var resolveCompressedTextureUrl={extension:ExtensionType.ResolveParser,test:function test(value){var temp=value.split("?")[0];var extension=temp.split(".").pop();return["basis","ktx","dds"].includes(extension);},parse:function parse(value){var _settings$RETINA_PREF6,_settings$RETINA_PREF7;var temp=value.split("?")[0];var extension=temp.split(".").pop();if(extension==="ktx"){var extensions2=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(extensions2.some(function(ext){return value.endsWith(ext);})){var _settings$RETINA_PREF4,_settings$RETINA_PREF5;return{resolution:parseFloat((_settings$RETINA_PREF4=(_settings$RETINA_PREF5=settings.RETINA_PREFIX.exec(value))===null||_settings$RETINA_PREF5===void 0?void 0:_settings$RETINA_PREF5[1])!==null&&_settings$RETINA_PREF4!==void 0?_settings$RETINA_PREF4:"1"),format:extensions2.find(function(ext){return value.endsWith(ext);}),src:value};}}return{resolution:parseFloat((_settings$RETINA_PREF6=(_settings$RETINA_PREF7=settings.RETINA_PREFIX.exec(value))===null||_settings$RETINA_PREF7===void 0?void 0:_settings$RETINA_PREF7[1])!==null&&_settings$RETINA_PREF6!==void 0?_settings$RETINA_PREF6:"1"),format:value.split(".").pop(),src:value};}};extensions$1.add(resolveCompressedTextureUrl);var TEMP_RECT=new Rectangle();var BYTES_PER_PIXEL=4;var _Extract=/*#__PURE__*/function(){function _Extract(renderer){_classCallCheck(this,_Extract);this.renderer=renderer;}return _createClass(_Extract,[{key:"image",value:function(){var _image=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee40(target,format,quality){var image;return _regeneratorRuntime().wrap(function _callee40$(_context43){while(1)switch(_context43.prev=_context43.next){case 0:image=new Image();_context43.next=3;return this.base64(target,format,quality);case 3:image.src=_context43.sent;return _context43.abrupt("return",image);case 5:case"end":return _context43.stop();}},_callee40,this);}));function image(_x32,_x33,_x34){return _image.apply(this,arguments);}return image;}()},{key:"base64",value:function(){var _base=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee41(target,format,quality){var canvas,blob;return _regeneratorRuntime().wrap(function _callee41$(_context44){while(1)switch(_context44.prev=_context44.next){case 0:canvas=this.canvas(target);if(!(canvas.toDataURL!==void 0)){_context44.next=3;break;}return _context44.abrupt("return",canvas.toDataURL(format,quality));case 3:if(!(canvas.convertToBlob!==void 0)){_context44.next=10;break;}_context44.next=6;return canvas.convertToBlob({type:format,quality:quality});case 6:blob=_context44.sent;_context44.next=9;return new Promise(function(resolve){var reader=new FileReader();reader.onload=function(){return resolve(reader.result);};reader.readAsDataURL(blob);});case 9:return _context44.abrupt("return",_context44.sent);case 10:throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented");case 11:case"end":return _context44.stop();}},_callee41,this);}));function base64(_x35,_x36,_x37){return _base.apply(this,arguments);}return base64;}()},{key:"canvas",value:function canvas(target,frame){var _this$_rawPixels=this._rawPixels(target,frame),pixels=_this$_rawPixels.pixels,width=_this$_rawPixels.width,height=_this$_rawPixels.height,flipY=_this$_rawPixels.flipY;var canvasBuffer=new CanvasRenderTarget(width,height,1);var canvasData=canvasBuffer.context.getImageData(0,0,width,height);_Extract.arrayPostDivide(pixels,canvasData.data);canvasBuffer.context.putImageData(canvasData,0,0);if(flipY){var target2=new CanvasRenderTarget(canvasBuffer.width,canvasBuffer.height,1);target2.context.scale(1,-1);target2.context.drawImage(canvasBuffer.canvas,0,-height);canvasBuffer.destroy();canvasBuffer=target2;}return canvasBuffer.canvas;}},{key:"pixels",value:function pixels(target,frame){var _this$_rawPixels2=this._rawPixels(target,frame),pixels=_this$_rawPixels2.pixels;_Extract.arrayPostDivide(pixels,pixels);return pixels;}},{key:"_rawPixels",value:function _rawPixels(target,frame){var renderer=this.renderer;var resolution;var flipY=false;var renderTexture;var generated=false;if(target){if(target instanceof RenderTexture){renderTexture=target;}else{var multisample=renderer.context.webGLVersion>=2?renderer.multisample:MSAA_QUALITY.NONE;renderTexture=this.renderer.generateTexture(target,{multisample:multisample});if(multisample!==MSAA_QUALITY.NONE){var resolvedTexture=RenderTexture.create({width:renderTexture.width,height:renderTexture.height});renderer.framebuffer.bind(renderTexture.framebuffer);renderer.framebuffer.blit(resolvedTexture.framebuffer);renderer.framebuffer.bind(null);renderTexture.destroy(true);renderTexture=resolvedTexture;}generated=true;}}if(renderTexture){var _frame;resolution=renderTexture.baseTexture.resolution;frame=(_frame=frame)!==null&&_frame!==void 0?_frame:renderTexture.frame;flipY=false;renderer.renderTexture.bind(renderTexture);}else{resolution=renderer.resolution;if(!frame){frame=TEMP_RECT;frame.width=renderer.width;frame.height=renderer.height;}flipY=true;renderer.renderTexture.bind(null);}var width=Math.round(frame.width*resolution);var height=Math.round(frame.height*resolution);var pixels=new Uint8Array(BYTES_PER_PIXEL*width*height);var gl=renderer.gl;gl.readPixels(Math.round(frame.x*resolution),Math.round(frame.y*resolution),width,height,gl.RGBA,gl.UNSIGNED_BYTE,pixels);if(generated){renderTexture.destroy(true);}return{pixels:pixels,width:width,height:height,flipY:flipY};}},{key:"destroy",value:function destroy(){this.renderer=null;}}],[{key:"arrayPostDivide",value:function arrayPostDivide(pixels,out){for(var i=0;i<pixels.length;i+=4){var alpha=out[i+3]=pixels[i+3];if(alpha!==0){out[i]=Math.round(Math.min(pixels[i]*255/alpha,255));out[i+1]=Math.round(Math.min(pixels[i+1]*255/alpha,255));out[i+2]=Math.round(Math.min(pixels[i+2]*255/alpha,255));}else{out[i]=pixels[i];out[i+1]=pixels[i+1];out[i+2]=pixels[i+2];}}}}]);}();var Extract=_Extract;Extract.extension={name:"extract",type:ExtensionType.RendererSystem};extensions$1.add(Extract);var buildCircle={build:function build(graphicsData){var points=graphicsData.points;var x;var y;var dx;var dy;var rx;var ry;if(graphicsData.type===SHAPES.CIRC){var circle=graphicsData.shape;x=circle.x;y=circle.y;rx=ry=circle.radius;dx=dy=0;}else if(graphicsData.type===SHAPES.ELIP){var ellipse=graphicsData.shape;x=ellipse.x;y=ellipse.y;rx=ellipse.width;ry=ellipse.height;dx=dy=0;}else{var roundedRect=graphicsData.shape;var halfWidth=roundedRect.width/2;var halfHeight=roundedRect.height/2;x=roundedRect.x+halfWidth;y=roundedRect.y+halfHeight;rx=ry=Math.max(0,Math.min(roundedRect.radius,Math.min(halfWidth,halfHeight)));dx=halfWidth-rx;dy=halfHeight-ry;}if(!(rx>=0&&ry>=0&&dx>=0&&dy>=0)){points.length=0;return;}var n=Math.ceil(2.3*Math.sqrt(rx+ry));var m=n*8+(dx?4:0)+(dy?4:0);points.length=m;if(m===0){return;}if(n===0){points.length=8;points[0]=points[6]=x+dx;points[1]=points[3]=y+dy;points[2]=points[4]=x-dx;points[5]=points[7]=y-dy;return;}var j1=0;var j2=n*4+(dx?2:0)+2;var j3=j2;var j4=m;{var x0=dx+rx;var y0=dy;var x1=x+x0;var x2=x-x0;var y1=y+y0;points[j1++]=x1;points[j1++]=y1;points[--j2]=y1;points[--j2]=x2;if(dy){var y2=y-y0;points[j3++]=x2;points[j3++]=y2;points[--j4]=y2;points[--j4]=x1;}}for(var i=1;i<n;i++){var a=Math.PI/2*(i/n);var _x38=dx+Math.cos(a)*rx;var _y=dy+Math.sin(a)*ry;var _x39=x+_x38;var _x40=x-_x38;var _y2=y+_y;var _y3=y-_y;points[j1++]=_x39;points[j1++]=_y2;points[--j2]=_y2;points[--j2]=_x40;points[j3++]=_x40;points[j3++]=_y3;points[--j4]=_y3;points[--j4]=_x39;}{var _x41=dx;var _y4=dy+ry;var _x42=x+_x41;var _x43=x-_x41;var _y5=y+_y4;var _y6=y-_y4;points[j1++]=_x42;points[j1++]=_y5;points[--j4]=_y6;points[--j4]=_x42;if(dx){points[j1++]=_x43;points[j1++]=_y5;points[--j4]=_y6;points[--j4]=_x43;}}},triangulate:function triangulate(graphicsData,graphicsGeometry){var points=graphicsData.points;var verts=graphicsGeometry.points;var indices=graphicsGeometry.indices;if(points.length===0){return;}var vertPos=verts.length/2;var center=vertPos;var x;var y;if(graphicsData.type!==SHAPES.RREC){var circle=graphicsData.shape;x=circle.x;y=circle.y;}else{var roundedRect=graphicsData.shape;x=roundedRect.x+roundedRect.width/2;y=roundedRect.y+roundedRect.height/2;}var matrix=graphicsData.matrix;verts.push(graphicsData.matrix?matrix.a*x+matrix.c*y+matrix.tx:x,graphicsData.matrix?matrix.b*x+matrix.d*y+matrix.ty:y);vertPos++;verts.push(points[0],points[1]);for(var i=2;i<points.length;i+=2){verts.push(points[i],points[i+1]);indices.push(vertPos++,center,vertPos);}indices.push(center+1,center,vertPos);}};function fixOrientation(points){var hole=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var m=points.length;if(m<6){return;}var area=0;for(var i=0,x1=points[m-2],y1=points[m-1];i<m;i+=2){var x2=points[i];var y2=points[i+1];area+=(x2-x1)*(y2+y1);x1=x2;y1=y2;}if(!hole&&area>0||hole&&area<=0){var n=m/2;for(var _i25=n+n%2;_i25<m;_i25+=2){var i1=m-_i25-2;var i2=m-_i25-1;var i3=_i25;var i4=_i25+1;var _ref18=[points[i3],points[i1]];points[i1]=_ref18[0];points[i3]=_ref18[1];var _ref19=[points[i4],points[i2]];points[i2]=_ref19[0];points[i4]=_ref19[1];}}}var buildPoly={build:function build(graphicsData){graphicsData.points=graphicsData.shape.points.slice();},triangulate:function triangulate(graphicsData,graphicsGeometry){var points=graphicsData.points;var holes=graphicsData.holes;var verts=graphicsGeometry.points;var indices=graphicsGeometry.indices;if(points.length>=6){fixOrientation(points,false);var holeArray=[];for(var i=0;i<holes.length;i++){var hole=holes[i];fixOrientation(hole.points,true);holeArray.push(points.length/2);points=points.concat(hole.points);}var triangles=earcut$1(points,holeArray,2);if(!triangles){return;}var vertPos=verts.length/2;for(var _i26=0;_i26<triangles.length;_i26+=3){indices.push(triangles[_i26]+vertPos);indices.push(triangles[_i26+1]+vertPos);indices.push(triangles[_i26+2]+vertPos);}for(var _i27=0;_i27<points.length;_i27++){verts.push(points[_i27]);}}}};var buildRectangle={build:function build(graphicsData){var rectData=graphicsData.shape;var x=rectData.x;var y=rectData.y;var width=rectData.width;var height=rectData.height;var points=graphicsData.points;points.length=0;if(!(width>=0&&height>=0)){return;}points.push(x,y,x+width,y,x+width,y+height,x,y+height);},triangulate:function triangulate(graphicsData,graphicsGeometry){var points=graphicsData.points;var verts=graphicsGeometry.points;if(points.length===0){return;}var vertPos=verts.length/2;verts.push(points[0],points[1],points[2],points[3],points[6],points[7],points[4],points[5]);graphicsGeometry.indices.push(vertPos,vertPos+1,vertPos+2,vertPos+1,vertPos+2,vertPos+3);}};var buildRoundedRectangle={build:function build(graphicsData){buildCircle.build(graphicsData);},triangulate:function triangulate(graphicsData,graphicsGeometry){buildCircle.triangulate(graphicsData,graphicsGeometry);}};var LINE_JOIN=/* @__PURE__ */function(LINE_JOIN2){LINE_JOIN2["MITER"]="miter";LINE_JOIN2["BEVEL"]="bevel";LINE_JOIN2["ROUND"]="round";return LINE_JOIN2;}(LINE_JOIN||{});var LINE_CAP=/* @__PURE__ */function(LINE_CAP2){LINE_CAP2["BUTT"]="butt";LINE_CAP2["ROUND"]="round";LINE_CAP2["SQUARE"]="square";return LINE_CAP2;}(LINE_CAP||{});var curves={adaptive:true,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function _segmentsCount(length){var defaultSegments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:20;if(!this.adaptive||!length||isNaN(length)){return defaultSegments;}var result=Math.ceil(length/this.maxLength);if(result<this.minSegments){result=this.minSegments;}else if(result>this.maxSegments){result=this.maxSegments;}return result;}};var GRAPHICS_CURVES=curves;var ArcUtils=/*#__PURE__*/function(){function ArcUtils(){_classCallCheck(this,ArcUtils);}return _createClass(ArcUtils,null,[{key:"curveTo",value:function curveTo(x1,y1,x2,y2,radius,points){var fromX=points[points.length-2];var fromY=points[points.length-1];var a1=fromY-y1;var b1=fromX-x1;var a2=y2-y1;var b2=x2-x1;var mm=Math.abs(a1*b2-b1*a2);if(mm<1e-8||radius===0){if(points[points.length-2]!==x1||points[points.length-1]!==y1){points.push(x1,y1);}return null;}var dd=a1*a1+b1*b1;var cc=a2*a2+b2*b2;var tt=a1*a2+b1*b2;var k1=radius*Math.sqrt(dd)/mm;var k2=radius*Math.sqrt(cc)/mm;var j1=k1*tt/dd;var j2=k2*tt/cc;var cx=k1*b2+k2*b1;var cy=k1*a2+k2*a1;var px=b1*(k2+j1);var py=a1*(k2+j1);var qx=b2*(k1+j2);var qy=a2*(k1+j2);var startAngle=Math.atan2(py-cy,px-cx);var endAngle=Math.atan2(qy-cy,qx-cx);return{cx:cx+x1,cy:cy+y1,radius:radius,startAngle:startAngle,endAngle:endAngle,anticlockwise:b1*a2>b2*a1};}},{key:"arc",value:function arc(_startX,_startY,cx,cy,radius,startAngle,endAngle,_anticlockwise,points){var sweep=endAngle-startAngle;var n=curves._segmentsCount(Math.abs(sweep)*radius,Math.ceil(Math.abs(sweep)/PI_2)*40);var theta=sweep/(n*2);var theta2=theta*2;var cTheta=Math.cos(theta);var sTheta=Math.sin(theta);var segMinus=n-1;var remainder=segMinus%1/segMinus;for(var i=0;i<=segMinus;++i){var real=i+remainder*i;var angle=theta+startAngle+theta2*real;var c=Math.cos(angle);var s=-Math.sin(angle);points.push((cTheta*c+sTheta*s)*radius+cx,(cTheta*-s+sTheta*c)*radius+cy);}}}]);}();var BatchPart=/*#__PURE__*/function(){function BatchPart(){_classCallCheck(this,BatchPart);this.reset();}return _createClass(BatchPart,[{key:"begin",value:function begin(style,startIndex,attribStart){this.reset();this.style=style;this.start=startIndex;this.attribStart=attribStart;}},{key:"end",value:function end(endIndex,endAttrib){this.attribSize=endAttrib-this.attribStart;this.size=endIndex-this.start;}},{key:"reset",value:function reset(){this.style=null;this.size=0;this.start=0;this.attribStart=0;this.attribSize=0;}}]);}();var BezierUtils=/*#__PURE__*/function(){function BezierUtils(){_classCallCheck(this,BezierUtils);}return _createClass(BezierUtils,null,[{key:"curveLength",value:function curveLength(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY){var n=10;var result=0;var t=0;var t2=0;var t3=0;var nt=0;var nt2=0;var nt3=0;var x=0;var y=0;var dx=0;var dy=0;var prevX=fromX;var prevY=fromY;for(var i=1;i<=n;++i){t=i/n;t2=t*t;t3=t2*t;nt=1-t;nt2=nt*nt;nt3=nt2*nt;x=nt3*fromX+3*nt2*t*cpX+3*nt*t2*cpX2+t3*toX;y=nt3*fromY+3*nt2*t*cpY+3*nt*t2*cpY2+t3*toY;dx=prevX-x;dy=prevY-y;prevX=x;prevY=y;result+=Math.sqrt(dx*dx+dy*dy);}return result;}},{key:"curveTo",value:function curveTo(cpX,cpY,cpX2,cpY2,toX,toY,points){var fromX=points[points.length-2];var fromY=points[points.length-1];points.length-=2;var n=curves._segmentsCount(BezierUtils.curveLength(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY));var dt=0;var dt2=0;var dt3=0;var t2=0;var t3=0;points.push(fromX,fromY);for(var i=1,j=0;i<=n;++i){j=i/n;dt=1-j;dt2=dt*dt;dt3=dt2*dt;t2=j*j;t3=t2*j;points.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY);}}}]);}();function square(x,y,nx,ny,innerWeight,outerWeight,clockwise,verts){var ix=x-nx*innerWeight;var iy=y-ny*innerWeight;var ox=x+nx*outerWeight;var oy=y+ny*outerWeight;var exx;var eyy;if(clockwise){exx=ny;eyy=-nx;}else{exx=-ny;eyy=nx;}var eix=ix+exx;var eiy=iy+eyy;var eox=ox+exx;var eoy=oy+eyy;verts.push(eix,eiy,eox,eoy);return 2;}function round(cx,cy,sx,sy,ex,ey,verts,clockwise){var cx2p0x=sx-cx;var cy2p0y=sy-cy;var angle0=Math.atan2(cx2p0x,cy2p0y);var angle1=Math.atan2(ex-cx,ey-cy);if(clockwise&&angle0<angle1){angle0+=Math.PI*2;}else if(!clockwise&&angle0>angle1){angle1+=Math.PI*2;}var startAngle=angle0;var angleDiff=angle1-angle0;var absAngleDiff=Math.abs(angleDiff);var radius=Math.sqrt(cx2p0x*cx2p0x+cy2p0y*cy2p0y);var segCount=(15*absAngleDiff*Math.sqrt(radius)/Math.PI>>0)+1;var angleInc=angleDiff/segCount;startAngle+=angleInc;if(clockwise){verts.push(cx,cy,sx,sy);for(var i=1,angle=startAngle;i<segCount;i++,angle+=angleInc){verts.push(cx,cy,cx+Math.sin(angle)*radius,cy+Math.cos(angle)*radius);}verts.push(cx,cy,ex,ey);}else{verts.push(sx,sy,cx,cy);for(var _i28=1,_angle=startAngle;_i28<segCount;_i28++,_angle+=angleInc){verts.push(cx+Math.sin(_angle)*radius,cy+Math.cos(_angle)*radius,cx,cy);}verts.push(ex,ey,cx,cy);}return segCount*2;}function buildNonNativeLine(graphicsData,graphicsGeometry){var shape=graphicsData.shape;var points=graphicsData.points||shape.points.slice();var eps=graphicsGeometry.closePointEps;if(points.length===0){return;}var style=graphicsData.lineStyle;var firstPoint=new Point(points[0],points[1]);var lastPoint=new Point(points[points.length-2],points[points.length-1]);var closedShape=shape.type!==SHAPES.POLY||shape.closeStroke;var closedPath=Math.abs(firstPoint.x-lastPoint.x)<eps&&Math.abs(firstPoint.y-lastPoint.y)<eps;if(closedShape){points=points.slice();if(closedPath){points.pop();points.pop();lastPoint.set(points[points.length-2],points[points.length-1]);}var midPointX=(firstPoint.x+lastPoint.x)*0.5;var midPointY=(lastPoint.y+firstPoint.y)*0.5;points.unshift(midPointX,midPointY);points.push(midPointX,midPointY);}var verts=graphicsGeometry.points;var length=points.length/2;var indexCount=points.length;var indexStart=verts.length/2;var width=style.width/2;var widthSquared=width*width;var miterLimitSquared=style.miterLimit*style.miterLimit;var x0=points[0];var y0=points[1];var x1=points[2];var y1=points[3];var x2=0;var y2=0;var perpx=-(y0-y1);var perpy=x0-x1;var perp1x=0;var perp1y=0;var dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;var ratio=style.alignment;var innerWeight=(1-ratio)*2;var outerWeight=ratio*2;if(!closedShape){if(style.cap===LINE_CAP.ROUND){indexCount+=round(x0-perpx*(innerWeight-outerWeight)*0.5,y0-perpy*(innerWeight-outerWeight)*0.5,x0-perpx*innerWeight,y0-perpy*innerWeight,x0+perpx*outerWeight,y0+perpy*outerWeight,verts,true)+2;}else if(style.cap===LINE_CAP.SQUARE){indexCount+=square(x0,y0,perpx,perpy,innerWeight,outerWeight,true,verts);}}verts.push(x0-perpx*innerWeight,y0-perpy*innerWeight,x0+perpx*outerWeight,y0+perpy*outerWeight);for(var i=1;i<length-1;++i){x0=points[(i-1)*2];y0=points[(i-1)*2+1];x1=points[i*2];y1=points[i*2+1];x2=points[(i+1)*2];y2=points[(i+1)*2+1];perpx=-(y0-y1);perpy=x0-x1;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;perp1x=-(y1-y2);perp1y=x1-x2;dist=Math.sqrt(perp1x*perp1x+perp1y*perp1y);perp1x/=dist;perp1y/=dist;perp1x*=width;perp1y*=width;var dx0=x1-x0;var dy0=y0-y1;var dx1=x1-x2;var dy1=y2-y1;var dot=dx0*dx1+dy0*dy1;var cross=dy0*dx1-dy1*dx0;var clockwise=cross<0;if(Math.abs(cross)<1e-3*Math.abs(dot)){verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight,x1+perpx*outerWeight,y1+perpy*outerWeight);if(dot>=0){if(style.join===LINE_JOIN.ROUND){indexCount+=round(x1,y1,x1-perpx*innerWeight,y1-perpy*innerWeight,x1-perp1x*innerWeight,y1-perp1y*innerWeight,verts,false)+4;}else{indexCount+=2;}verts.push(x1-perp1x*outerWeight,y1-perp1y*outerWeight,x1+perp1x*innerWeight,y1+perp1y*innerWeight);}continue;}var c1=(-perpx+x0)*(-perpy+y1)-(-perpx+x1)*(-perpy+y0);var c2=(-perp1x+x2)*(-perp1y+y1)-(-perp1x+x1)*(-perp1y+y2);var px=(dx0*c2-dx1*c1)/cross;var py=(dy1*c1-dy0*c2)/cross;var pdist=(px-x1)*(px-x1)+(py-y1)*(py-y1);var imx=x1+(px-x1)*innerWeight;var imy=y1+(py-y1)*innerWeight;var omx=x1-(px-x1)*outerWeight;var omy=y1-(py-y1)*outerWeight;var smallerInsideSegmentSq=Math.min(dx0*dx0+dy0*dy0,dx1*dx1+dy1*dy1);var insideWeight=clockwise?innerWeight:outerWeight;var smallerInsideDiagonalSq=smallerInsideSegmentSq+insideWeight*insideWeight*widthSquared;var insideMiterOk=pdist<=smallerInsideDiagonalSq;var join=style.join;if(join===LINE_JOIN.MITER&&pdist/widthSquared>miterLimitSquared){join=LINE_JOIN.BEVEL;}if(insideMiterOk){switch(join){case LINE_JOIN.MITER:{verts.push(imx,imy,omx,omy);break;}case LINE_JOIN.BEVEL:{if(clockwise){verts.push(imx,imy,x1+perpx*outerWeight,y1+perpy*outerWeight,imx,imy,x1+perp1x*outerWeight,y1+perp1y*outerWeight);}else{verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight,omx,omy,x1-perp1x*innerWeight,y1-perp1y*innerWeight,omx,omy);}indexCount+=2;break;}case LINE_JOIN.ROUND:{if(clockwise){verts.push(imx,imy,x1+perpx*outerWeight,y1+perpy*outerWeight);indexCount+=round(x1,y1,x1+perpx*outerWeight,y1+perpy*outerWeight,x1+perp1x*outerWeight,y1+perp1y*outerWeight,verts,true)+4;verts.push(imx,imy,x1+perp1x*outerWeight,y1+perp1y*outerWeight);}else{verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight,omx,omy);indexCount+=round(x1,y1,x1-perpx*innerWeight,y1-perpy*innerWeight,x1-perp1x*innerWeight,y1-perp1y*innerWeight,verts,false)+4;verts.push(x1-perp1x*innerWeight,y1-perp1y*innerWeight,omx,omy);}break;}}}else{verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight,x1+perpx*outerWeight,y1+perpy*outerWeight);switch(join){case LINE_JOIN.MITER:{if(clockwise){verts.push(omx,omy,omx,omy);}else{verts.push(imx,imy,imx,imy);}indexCount+=2;break;}case LINE_JOIN.ROUND:{if(clockwise){indexCount+=round(x1,y1,x1+perpx*outerWeight,y1+perpy*outerWeight,x1+perp1x*outerWeight,y1+perp1y*outerWeight,verts,true)+2;}else{indexCount+=round(x1,y1,x1-perpx*innerWeight,y1-perpy*innerWeight,x1-perp1x*innerWeight,y1-perp1y*innerWeight,verts,false)+2;}break;}}verts.push(x1-perp1x*innerWeight,y1-perp1y*innerWeight,x1+perp1x*outerWeight,y1+perp1y*outerWeight);indexCount+=2;}}x0=points[(length-2)*2];y0=points[(length-2)*2+1];x1=points[(length-1)*2];y1=points[(length-1)*2+1];perpx=-(y0-y1);perpy=x0-x1;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight,x1+perpx*outerWeight,y1+perpy*outerWeight);if(!closedShape){if(style.cap===LINE_CAP.ROUND){indexCount+=round(x1-perpx*(innerWeight-outerWeight)*0.5,y1-perpy*(innerWeight-outerWeight)*0.5,x1-perpx*innerWeight,y1-perpy*innerWeight,x1+perpx*outerWeight,y1+perpy*outerWeight,verts,false)+2;}else if(style.cap===LINE_CAP.SQUARE){indexCount+=square(x1,y1,perpx,perpy,innerWeight,outerWeight,false,verts);}}var indices=graphicsGeometry.indices;var eps2=curves.epsilon*curves.epsilon;for(var _i29=indexStart;_i29<indexCount+indexStart-2;++_i29){x0=verts[_i29*2];y0=verts[_i29*2+1];x1=verts[(_i29+1)*2];y1=verts[(_i29+1)*2+1];x2=verts[(_i29+2)*2];y2=verts[(_i29+2)*2+1];if(Math.abs(x0*(y1-y2)+x1*(y2-y0)+x2*(y0-y1))<eps2){continue;}indices.push(_i29,_i29+1,_i29+2);}}function buildNativeLine(graphicsData,graphicsGeometry){var i=0;var shape=graphicsData.shape;var points=graphicsData.points||shape.points;var closedShape=shape.type!==SHAPES.POLY||shape.closeStroke;if(points.length===0)return;var verts=graphicsGeometry.points;var indices=graphicsGeometry.indices;var length=points.length/2;var startIndex=verts.length/2;var currentIndex=startIndex;verts.push(points[0],points[1]);for(i=1;i<length;i++){verts.push(points[i*2],points[i*2+1]);indices.push(currentIndex,currentIndex+1);currentIndex++;}if(closedShape){indices.push(currentIndex,startIndex);}}function buildLine(graphicsData,graphicsGeometry){if(graphicsData.lineStyle.native){buildNativeLine(graphicsData,graphicsGeometry);}else{buildNonNativeLine(graphicsData,graphicsGeometry);}}var QuadraticUtils=/*#__PURE__*/function(){function QuadraticUtils(){_classCallCheck(this,QuadraticUtils);}return _createClass(QuadraticUtils,null,[{key:"curveLength",value:function curveLength(fromX,fromY,cpX,cpY,toX,toY){var ax=fromX-2*cpX+toX;var ay=fromY-2*cpY+toY;var bx=2*cpX-2*fromX;var by=2*cpY-2*fromY;var a=4*(ax*ax+ay*ay);var b=4*(ax*bx+ay*by);var c=bx*bx+by*by;var s=2*Math.sqrt(a+b+c);var a2=Math.sqrt(a);var a32=2*a*a2;var c2=2*Math.sqrt(c);var ba=b/a2;return(a32*s+a2*b*(s-c2)+(4*c*a-b*b)*Math.log((2*a2+ba+s)/(ba+c2)))/(4*a32);}},{key:"curveTo",value:function curveTo(cpX,cpY,toX,toY,points){var fromX=points[points.length-2];var fromY=points[points.length-1];var n=curves._segmentsCount(QuadraticUtils.curveLength(fromX,fromY,cpX,cpY,toX,toY));var xa=0;var ya=0;for(var i=1;i<=n;++i){var j=i/n;xa=fromX+(cpX-fromX)*j;ya=fromY+(cpY-fromY)*j;points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j);}}}]);}();var FILL_COMMANDS=_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},SHAPES.POLY,buildPoly),SHAPES.CIRC,buildCircle),SHAPES.ELIP,buildCircle),SHAPES.RECT,buildRectangle),SHAPES.RREC,buildRoundedRectangle);var BATCH_POOL=[];var DRAW_CALL_POOL=[];var GraphicsData=/*#__PURE__*/function(){function GraphicsData(shape){var fillStyle=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var lineStyle=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var matrix=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;_classCallCheck(this,GraphicsData);this.points=[];this.holes=[];this.shape=shape;this.lineStyle=lineStyle;this.fillStyle=fillStyle;this.matrix=matrix;this.type=shape.type;}return _createClass(GraphicsData,[{key:"clone",value:function clone(){return new GraphicsData(this.shape,this.fillStyle,this.lineStyle,this.matrix);}},{key:"destroy",value:function destroy(){this.shape=null;this.holes.length=0;this.holes=null;this.points.length=0;this.points=null;this.lineStyle=null;this.fillStyle=null;}}]);}();var tmpPoint=new Point();var _GraphicsGeometry=/*#__PURE__*/function(_BatchGeometry){function _GraphicsGeometry(){var _this78;_classCallCheck(this,_GraphicsGeometry);_this78=_callSuper(this,_GraphicsGeometry);_this78.closePointEps=1e-4;_this78.boundsPadding=0;_this78.uvsFloat32=null;_this78.indicesUint16=null;_this78.batchable=false;_this78.points=[];_this78.colors=[];_this78.uvs=[];_this78.indices=[];_this78.textureIds=[];_this78.graphicsData=[];_this78.drawCalls=[];_this78.batchDirty=-1;_this78.batches=[];_this78.dirty=0;_this78.cacheDirty=-1;_this78.clearDirty=0;_this78.shapeIndex=0;_this78._bounds=new Bounds();_this78.boundsDirty=-1;return _this78;}_inherits(_GraphicsGeometry,_BatchGeometry);return _createClass(_GraphicsGeometry,[{key:"bounds",get:function get(){this.updateBatches();if(this.boundsDirty!==this.dirty){this.boundsDirty=this.dirty;this.calculateBounds();}return this._bounds;}},{key:"invalidate",value:function invalidate(){this.boundsDirty=-1;this.dirty++;this.batchDirty++;this.shapeIndex=0;this.points.length=0;this.colors.length=0;this.uvs.length=0;this.indices.length=0;this.textureIds.length=0;for(var i=0;i<this.drawCalls.length;i++){this.drawCalls[i].texArray.clear();DRAW_CALL_POOL.push(this.drawCalls[i]);}this.drawCalls.length=0;for(var _i30=0;_i30<this.batches.length;_i30++){var batchPart=this.batches[_i30];batchPart.reset();BATCH_POOL.push(batchPart);}this.batches.length=0;}},{key:"clear",value:function clear(){if(this.graphicsData.length>0){this.invalidate();this.clearDirty++;this.graphicsData.length=0;}return this;}},{key:"drawShape",value:function drawShape(shape){var fillStyle=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var lineStyle=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var matrix=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var data=new GraphicsData(shape,fillStyle,lineStyle,matrix);this.graphicsData.push(data);this.dirty++;return this;}},{key:"drawHole",value:function drawHole(shape){var matrix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!this.graphicsData.length){return null;}var data=new GraphicsData(shape,null,null,matrix);var lastShape=this.graphicsData[this.graphicsData.length-1];data.lineStyle=lastShape.lineStyle;lastShape.holes.push(data);this.dirty++;return this;}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(_GraphicsGeometry.prototype),"destroy",this).call(this);for(var i=0;i<this.graphicsData.length;++i){this.graphicsData[i].destroy();}this.points.length=0;this.points=null;this.colors.length=0;this.colors=null;this.uvs.length=0;this.uvs=null;this.indices.length=0;this.indices=null;this.indexBuffer.destroy();this.indexBuffer=null;this.graphicsData.length=0;this.graphicsData=null;this.drawCalls.length=0;this.drawCalls=null;this.batches.length=0;this.batches=null;this._bounds=null;}},{key:"containsPoint",value:function containsPoint(point){var graphicsData=this.graphicsData;for(var i=0;i<graphicsData.length;++i){var data=graphicsData[i];if(!data.fillStyle.visible){continue;}if(data.shape){if(data.matrix){data.matrix.applyInverse(point,tmpPoint);}else{tmpPoint.copyFrom(point);}if(data.shape.contains(tmpPoint.x,tmpPoint.y)){var hitHole=false;if(data.holes){for(var i2=0;i2<data.holes.length;i2++){var hole=data.holes[i2];if(hole.shape.contains(tmpPoint.x,tmpPoint.y)){hitHole=true;break;}}}if(!hitHole){return true;}}}}return false;}},{key:"updateBatches",value:function updateBatches(){if(!this.graphicsData.length){this.batchable=true;return;}if(!this.validateBatching()){return;}this.cacheDirty=this.dirty;var uvs=this.uvs;var graphicsData=this.graphicsData;var batchPart=null;var currentStyle=null;if(this.batches.length>0){batchPart=this.batches[this.batches.length-1];currentStyle=batchPart.style;}for(var i=this.shapeIndex;i<graphicsData.length;i++){this.shapeIndex++;var data=graphicsData[i];var fillStyle=data.fillStyle;var lineStyle=data.lineStyle;var command=FILL_COMMANDS[data.type];command.build(data);if(data.matrix){this.transformPoints(data.points,data.matrix);}if(fillStyle.visible||lineStyle.visible){this.processHoles(data.holes);}for(var j=0;j<2;j++){var style=j===0?fillStyle:lineStyle;if(!style.visible)continue;var nextTexture=style.texture.baseTexture;var index2=this.indices.length;var attribIndex=this.points.length/2;nextTexture.wrapMode=WRAP_MODES.REPEAT;if(j===0){this.processFill(data);}else{this.processLine(data);}var size=this.points.length/2-attribIndex;if(size===0)continue;if(batchPart&&!this._compareStyles(currentStyle,style)){batchPart.end(index2,attribIndex);batchPart=null;}if(!batchPart){batchPart=BATCH_POOL.pop()||new BatchPart();batchPart.begin(style,index2,attribIndex);this.batches.push(batchPart);currentStyle=style;}this.addUvs(this.points,uvs,style.texture,attribIndex,size,style.matrix);}}var index=this.indices.length;var attrib=this.points.length/2;if(batchPart){batchPart.end(index,attrib);}if(this.batches.length===0){this.batchable=true;return;}var need32=attrib>65535;if(this.indicesUint16&&this.indices.length===this.indicesUint16.length&&need32===this.indicesUint16.BYTES_PER_ELEMENT>2){this.indicesUint16.set(this.indices);}else{this.indicesUint16=need32?new Uint32Array(this.indices):new Uint16Array(this.indices);}this.batchable=this.isBatchable();if(this.batchable){this.packBatches();}else{this.buildDrawCalls();}}},{key:"_compareStyles",value:function _compareStyles(styleA,styleB){if(!styleA||!styleB){return false;}if(styleA.texture.baseTexture!==styleB.texture.baseTexture){return false;}if(styleA.color+styleA.alpha!==styleB.color+styleB.alpha){return false;}if(!!styleA.native!==!!styleB.native){return false;}return true;}},{key:"validateBatching",value:function validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length){return false;}for(var i=0,l=this.graphicsData.length;i<l;i++){var data=this.graphicsData[i];var fill=data.fillStyle;var line=data.lineStyle;if(fill&&!fill.texture.baseTexture.valid)return false;if(line&&!line.texture.baseTexture.valid)return false;}return true;}},{key:"packBatches",value:function packBatches(){this.batchDirty++;this.uvsFloat32=new Float32Array(this.uvs);var batches=this.batches;for(var i=0,l=batches.length;i<l;i++){var batch=batches[i];for(var j=0;j<batch.size;j++){var _index9=batch.start+j;this.indicesUint16[_index9]=this.indicesUint16[_index9]-batch.attribStart;}}}},{key:"isBatchable",value:function isBatchable(){if(this.points.length>65535*2){return false;}var batches=this.batches;for(var i=0;i<batches.length;i++){if(batches[i].style.native){return false;}}return this.points.length<_GraphicsGeometry.BATCHABLE_SIZE*2;}},{key:"buildDrawCalls",value:function buildDrawCalls(){var TICK=++BaseTexture._globalBatch;for(var i=0;i<this.drawCalls.length;i++){this.drawCalls[i].texArray.clear();DRAW_CALL_POOL.push(this.drawCalls[i]);}this.drawCalls.length=0;var colors=this.colors;var textureIds=this.textureIds;var currentGroup=DRAW_CALL_POOL.pop();if(!currentGroup){currentGroup=new BatchDrawCall();currentGroup.texArray=new BatchTextureArray();}currentGroup.texArray.count=0;currentGroup.start=0;currentGroup.size=0;currentGroup.type=DRAW_MODES.TRIANGLES;var textureCount=0;var currentTexture=null;var textureId=0;var native=false;var drawMode=DRAW_MODES.TRIANGLES;var index=0;this.drawCalls.push(currentGroup);for(var _i31=0;_i31<this.batches.length;_i31++){var data=this.batches[_i31];var maxTextures=8;var style=data.style;var nextTexture=style.texture.baseTexture;if(native!==!!style.native){native=!!style.native;drawMode=native?DRAW_MODES.LINES:DRAW_MODES.TRIANGLES;currentTexture=null;textureCount=maxTextures;TICK++;}if(currentTexture!==nextTexture){currentTexture=nextTexture;if(nextTexture._batchEnabled!==TICK){if(textureCount===maxTextures){TICK++;textureCount=0;if(currentGroup.size>0){currentGroup=DRAW_CALL_POOL.pop();if(!currentGroup){currentGroup=new BatchDrawCall();currentGroup.texArray=new BatchTextureArray();}this.drawCalls.push(currentGroup);}currentGroup.start=index;currentGroup.size=0;currentGroup.texArray.count=0;currentGroup.type=drawMode;}nextTexture.touched=1;nextTexture._batchEnabled=TICK;nextTexture._batchLocation=textureCount;nextTexture.wrapMode=WRAP_MODES.REPEAT;currentGroup.texArray.elements[currentGroup.texArray.count++]=nextTexture;textureCount++;}}currentGroup.size+=data.size;index+=data.size;textureId=nextTexture._batchLocation;this.addColors(colors,style.color,style.alpha,data.attribSize,data.attribStart);this.addTextureIds(textureIds,textureId,data.attribSize,data.attribStart);}BaseTexture._globalBatch=TICK;this.packAttributes();}},{key:"packAttributes",value:function packAttributes(){var verts=this.points;var uvs=this.uvs;var colors=this.colors;var textureIds=this.textureIds;var glPoints=new ArrayBuffer(verts.length*3*4);var f32=new Float32Array(glPoints);var u32=new Uint32Array(glPoints);var p=0;for(var i=0;i<verts.length/2;i++){f32[p++]=verts[i*2];f32[p++]=verts[i*2+1];f32[p++]=uvs[i*2];f32[p++]=uvs[i*2+1];u32[p++]=colors[i];f32[p++]=textureIds[i];}this._buffer.update(glPoints);this._indexBuffer.update(this.indicesUint16);}},{key:"processFill",value:function processFill(data){if(data.holes.length){buildPoly.triangulate(data,this);}else{var command=FILL_COMMANDS[data.type];command.triangulate(data,this);}}},{key:"processLine",value:function processLine(data){buildLine(data,this);for(var i=0;i<data.holes.length;i++){buildLine(data.holes[i],this);}}},{key:"processHoles",value:function processHoles(holes){for(var i=0;i<holes.length;i++){var hole=holes[i];var command=FILL_COMMANDS[hole.type];command.build(hole);if(hole.matrix){this.transformPoints(hole.points,hole.matrix);}}}},{key:"calculateBounds",value:function calculateBounds(){var bounds=this._bounds;bounds.clear();bounds.addVertexData(this.points,0,this.points.length);bounds.pad(this.boundsPadding,this.boundsPadding);}},{key:"transformPoints",value:function transformPoints(points,matrix){for(var i=0;i<points.length/2;i++){var x=points[i*2];var y=points[i*2+1];points[i*2]=matrix.a*x+matrix.c*y+matrix.tx;points[i*2+1]=matrix.b*x+matrix.d*y+matrix.ty;}}},{key:"addColors",value:function addColors(colors,color,alpha,size){var offset=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var rgb=(color>>16)+(color&65280)+((color&255)<<16);var rgba=premultiplyTint(rgb,alpha);colors.length=Math.max(colors.length,offset+size);for(var i=0;i<size;i++){colors[offset+i]=rgba;}}},{key:"addTextureIds",value:function addTextureIds(textureIds,id,size){var offset=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;textureIds.length=Math.max(textureIds.length,offset+size);for(var i=0;i<size;i++){textureIds[offset+i]=id;}}},{key:"addUvs",value:function addUvs(verts,uvs,texture,start,size){var matrix=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var index=0;var uvsStart=uvs.length;var frame=texture.frame;while(index<size){var x=verts[(start+index)*2];var y=verts[(start+index)*2+1];if(matrix){var nx=matrix.a*x+matrix.c*y+matrix.tx;y=matrix.b*x+matrix.d*y+matrix.ty;x=nx;}index++;uvs.push(x/frame.width,y/frame.height);}var baseTexture=texture.baseTexture;if(frame.width<baseTexture.width||frame.height<baseTexture.height){this.adjustUvs(uvs,texture,uvsStart,size);}}},{key:"adjustUvs",value:function adjustUvs(uvs,texture,start,size){var baseTexture=texture.baseTexture;var eps=1e-6;var finish=start+size*2;var frame=texture.frame;var scaleX=frame.width/baseTexture.width;var scaleY=frame.height/baseTexture.height;var offsetX=frame.x/frame.width;var offsetY=frame.y/frame.height;var minX=Math.floor(uvs[start]+eps);var minY=Math.floor(uvs[start+1]+eps);for(var i=start+2;i<finish;i+=2){minX=Math.min(minX,Math.floor(uvs[i]+eps));minY=Math.min(minY,Math.floor(uvs[i+1]+eps));}offsetX-=minX;offsetY-=minY;for(var _i32=start;_i32<finish;_i32+=2){uvs[_i32]=(uvs[_i32]+offsetX)*scaleX;uvs[_i32+1]=(uvs[_i32+1]+offsetY)*scaleY;}}}]);}(BatchGeometry);var GraphicsGeometry=_GraphicsGeometry;GraphicsGeometry.BATCHABLE_SIZE=100;var FillStyle=/*#__PURE__*/function(){function FillStyle(){_classCallCheck(this,FillStyle);this.color=16777215;this.alpha=1;this.texture=Texture.WHITE;this.matrix=null;this.visible=false;this.reset();}return _createClass(FillStyle,[{key:"clone",value:function clone(){var obj=new FillStyle();obj.color=this.color;obj.alpha=this.alpha;obj.texture=this.texture;obj.matrix=this.matrix;obj.visible=this.visible;return obj;}},{key:"reset",value:function reset(){this.color=16777215;this.alpha=1;this.texture=Texture.WHITE;this.matrix=null;this.visible=false;}},{key:"destroy",value:function destroy(){this.texture=null;this.matrix=null;}}]);}();var LineStyle=/*#__PURE__*/function(_FillStyle){function LineStyle(){var _this79;_classCallCheck(this,LineStyle);_this79=_callSuper(this,LineStyle,arguments);_this79.width=0;_this79.alignment=0.5;_this79.native=false;_this79.cap=LINE_CAP.BUTT;_this79.join=LINE_JOIN.MITER;_this79.miterLimit=10;return _this79;}_inherits(LineStyle,_FillStyle);return _createClass(LineStyle,[{key:"clone",value:function clone(){var obj=new LineStyle();obj.color=this.color;obj.alpha=this.alpha;obj.texture=this.texture;obj.matrix=this.matrix;obj.visible=this.visible;obj.width=this.width;obj.alignment=this.alignment;obj.native=this.native;obj.cap=this.cap;obj.join=this.join;obj.miterLimit=this.miterLimit;return obj;}},{key:"reset",value:function reset(){_get(_getPrototypeOf(LineStyle.prototype),"reset",this).call(this);this.color=0;this.alignment=0.5;this.width=0;this.native=false;}}]);}(FillStyle);var temp=new Float32Array(3);var DEFAULT_SHADERS={};var _Graphics=/*#__PURE__*/function(_Container3){function _Graphics(){var _this80;var geometry=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,_Graphics);_this80=_callSuper(this,_Graphics);_this80.shader=null;_this80.pluginName="batch";_this80.currentPath=null;_this80.batches=[];_this80.batchTint=-1;_this80.batchDirty=-1;_this80.vertexData=null;_this80._fillStyle=new FillStyle();_this80._lineStyle=new LineStyle();_this80._matrix=null;_this80._holeMode=false;_this80.state=State.for2d();_this80._geometry=geometry||new GraphicsGeometry();_this80._geometry.refCount++;_this80._transformID=-1;_this80.tint=16777215;_this80.blendMode=BLEND_MODES.NORMAL;return _this80;}_inherits(_Graphics,_Container3);return _createClass(_Graphics,[{key:"geometry",get:function get(){return this._geometry;}},{key:"clone",value:function clone(){this.finishPoly();return new _Graphics(this._geometry);}},{key:"blendMode",get:function get(){return this.state.blendMode;},set:function set(value){this.state.blendMode=value;}},{key:"tint",get:function get(){return this._tint;},set:function set(value){this._tint=value;}},{key:"fill",get:function get(){return this._fillStyle;}},{key:"line",get:function get(){return this._lineStyle;}},{key:"lineStyle",value:function lineStyle(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var alpha=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var alignment=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0.5;var native=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;if(typeof options==="number"){options={width:options,color:color,alpha:alpha,alignment:alignment,native:native};}return this.lineTextureStyle(options);}},{key:"lineTextureStyle",value:function lineTextureStyle(options){var _options3;options=Object.assign({width:0,texture:Texture.WHITE,color:(_options3=options)!==null&&_options3!==void 0&&_options3.texture?16777215:0,alpha:1,matrix:null,alignment:0.5,native:false,cap:LINE_CAP.BUTT,join:LINE_JOIN.MITER,miterLimit:10},options);if(this.currentPath){this.startPoly();}var visible=options.width>0&&options.alpha>0;if(!visible){this._lineStyle.reset();}else{if(options.matrix){options.matrix=options.matrix.clone();options.matrix.invert();}Object.assign(this._lineStyle,{visible:visible},options);}return this;}},{key:"startPoly",value:function startPoly(){if(this.currentPath){var points=this.currentPath.points;var len=this.currentPath.points.length;if(len>2){this.drawShape(this.currentPath);this.currentPath=new Polygon();this.currentPath.closeStroke=false;this.currentPath.points.push(points[len-2],points[len-1]);}}else{this.currentPath=new Polygon();this.currentPath.closeStroke=false;}}},{key:"finishPoly",value:function finishPoly(){if(this.currentPath){if(this.currentPath.points.length>2){this.drawShape(this.currentPath);this.currentPath=null;}else{this.currentPath.points.length=0;}}}},{key:"moveTo",value:function moveTo(x,y){this.startPoly();this.currentPath.points[0]=x;this.currentPath.points[1]=y;return this;}},{key:"lineTo",value:function lineTo(x,y){if(!this.currentPath){this.moveTo(0,0);}var points=this.currentPath.points;var fromX=points[points.length-2];var fromY=points[points.length-1];if(fromX!==x||fromY!==y){points.push(x,y);}return this;}},{key:"_initCurve",value:function _initCurve(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(this.currentPath){if(this.currentPath.points.length===0){this.currentPath.points=[x,y];}}else{this.moveTo(x,y);}}},{key:"quadraticCurveTo",value:function quadraticCurveTo(cpX,cpY,toX,toY){this._initCurve();var points=this.currentPath.points;if(points.length===0){this.moveTo(0,0);}QuadraticUtils.curveTo(cpX,cpY,toX,toY,points);return this;}},{key:"bezierCurveTo",value:function bezierCurveTo(cpX,cpY,cpX2,cpY2,toX,toY){this._initCurve();BezierUtils.curveTo(cpX,cpY,cpX2,cpY2,toX,toY,this.currentPath.points);return this;}},{key:"arcTo",value:function arcTo(x1,y1,x2,y2,radius){this._initCurve(x1,y1);var points=this.currentPath.points;var result=ArcUtils.curveTo(x1,y1,x2,y2,radius,points);if(result){var cx=result.cx,cy=result.cy,radius2=result.radius,startAngle=result.startAngle,endAngle=result.endAngle,anticlockwise=result.anticlockwise;this.arc(cx,cy,radius2,startAngle,endAngle,anticlockwise);}return this;}},{key:"arc",value:function arc(cx,cy,radius,startAngle,endAngle){var anticlockwise=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;if(startAngle===endAngle){return this;}if(!anticlockwise&&endAngle<=startAngle){endAngle+=PI_2;}else if(anticlockwise&&startAngle<=endAngle){startAngle+=PI_2;}var sweep=endAngle-startAngle;if(sweep===0){return this;}var startX=cx+Math.cos(startAngle)*radius;var startY=cy+Math.sin(startAngle)*radius;var eps=this._geometry.closePointEps;var points=this.currentPath?this.currentPath.points:null;if(points){var xDiff=Math.abs(points[points.length-2]-startX);var yDiff=Math.abs(points[points.length-1]-startY);if(xDiff<eps&&yDiff<eps);else{points.push(startX,startY);}}else{this.moveTo(startX,startY);points=this.currentPath.points;}ArcUtils.arc(startX,startY,cx,cy,radius,startAngle,endAngle,anticlockwise,points);return this;}},{key:"beginFill",value:function beginFill(){var color=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var alpha=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return this.beginTextureFill({texture:Texture.WHITE,color:color,alpha:alpha});}},{key:"beginTextureFill",value:function beginTextureFill(options){options=Object.assign({texture:Texture.WHITE,color:16777215,alpha:1,matrix:null},options);if(this.currentPath){this.startPoly();}var visible=options.alpha>0;if(!visible){this._fillStyle.reset();}else{if(options.matrix){options.matrix=options.matrix.clone();options.matrix.invert();}Object.assign(this._fillStyle,{visible:visible},options);}return this;}},{key:"endFill",value:function endFill(){this.finishPoly();this._fillStyle.reset();return this;}},{key:"drawRect",value:function drawRect(x,y,width,height){return this.drawShape(new Rectangle(x,y,width,height));}},{key:"drawRoundedRect",value:function drawRoundedRect(x,y,width,height,radius){return this.drawShape(new RoundedRectangle(x,y,width,height,radius));}},{key:"drawCircle",value:function drawCircle(x,y,radius){return this.drawShape(new Circle(x,y,radius));}},{key:"drawEllipse",value:function drawEllipse(x,y,width,height){return this.drawShape(new Ellipse(x,y,width,height));}},{key:"drawPolygon",value:function drawPolygon(){var points;var closeStroke=true;for(var _len6=arguments.length,path=new Array(_len6),_key6=0;_key6<_len6;_key6++){path[_key6]=arguments[_key6];}var poly=path[0];if(poly.points){closeStroke=poly.closeStroke;points=poly.points;}else if(Array.isArray(path[0])){points=path[0];}else{points=path;}var shape=new Polygon(points);shape.closeStroke=closeStroke;this.drawShape(shape);return this;}},{key:"drawShape",value:function drawShape(shape){if(!this._holeMode){this._geometry.drawShape(shape,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix);}else{this._geometry.drawHole(shape,this._matrix);}return this;}},{key:"clear",value:function clear(){this._geometry.clear();this._lineStyle.reset();this._fillStyle.reset();this._boundsID++;this._matrix=null;this._holeMode=false;this.currentPath=null;return this;}},{key:"isFastRect",value:function isFastRect(){var data=this._geometry.graphicsData;return data.length===1&&data[0].shape.type===SHAPES.RECT&&!data[0].matrix&&!data[0].holes.length&&!(data[0].lineStyle.visible&&data[0].lineStyle.width);}},{key:"_render",value:function _render(renderer){this.finishPoly();var geometry=this._geometry;geometry.updateBatches();if(geometry.batchable){if(this.batchDirty!==geometry.batchDirty){this._populateBatches();}this._renderBatched(renderer);}else{renderer.batch.flush();this._renderDirect(renderer);}}},{key:"_populateBatches",value:function _populateBatches(){var geometry=this._geometry;var blendMode=this.blendMode;var len=geometry.batches.length;this.batchTint=-1;this._transformID=-1;this.batchDirty=geometry.batchDirty;this.batches.length=len;this.vertexData=new Float32Array(geometry.points);for(var i=0;i<len;i++){var gI=geometry.batches[i];var color=gI.style.color;var vertexData=new Float32Array(this.vertexData.buffer,gI.attribStart*4*2,gI.attribSize*2);var uvs=new Float32Array(geometry.uvsFloat32.buffer,gI.attribStart*4*2,gI.attribSize*2);var _indices=new Uint16Array(geometry.indicesUint16.buffer,gI.start*2,gI.size);var batch={vertexData:vertexData,blendMode:blendMode,indices:_indices,uvs:uvs,_batchRGB:hex2rgb(color),_tintRGB:color,_texture:gI.style.texture,alpha:gI.style.alpha,worldAlpha:1};this.batches[i]=batch;}}},{key:"_renderBatched",value:function _renderBatched(renderer){if(!this.batches.length){return;}renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]);this.calculateVertices();this.calculateTints();for(var i=0,l=this.batches.length;i<l;i++){var batch=this.batches[i];batch.worldAlpha=this.worldAlpha*batch.alpha;renderer.plugins[this.pluginName].render(batch);}}},{key:"_renderDirect",value:function _renderDirect(renderer){var shader=this._resolveDirectShader(renderer);var geometry=this._geometry;var tint=this.tint;var worldAlpha=this.worldAlpha;var uniforms=shader.uniforms;var drawCalls=geometry.drawCalls;uniforms.translationMatrix=this.transform.worldTransform;uniforms.tint[0]=(tint>>16&255)/255*worldAlpha;uniforms.tint[1]=(tint>>8&255)/255*worldAlpha;uniforms.tint[2]=(tint&255)/255*worldAlpha;uniforms.tint[3]=worldAlpha;renderer.shader.bind(shader);renderer.geometry.bind(geometry,shader);renderer.state.set(this.state);for(var i=0,l=drawCalls.length;i<l;i++){this._renderDrawCallDirect(renderer,geometry.drawCalls[i]);}}},{key:"_renderDrawCallDirect",value:function _renderDrawCallDirect(renderer,drawCall){var texArray=drawCall.texArray,type=drawCall.type,size=drawCall.size,start=drawCall.start;var groupTextureCount=texArray.count;for(var j=0;j<groupTextureCount;j++){renderer.texture.bind(texArray.elements[j],j);}renderer.geometry.draw(type,size,start);}},{key:"_resolveDirectShader",value:function _resolveDirectShader(renderer){var shader=this.shader;var pluginName=this.pluginName;if(!shader){if(!DEFAULT_SHADERS[pluginName]){var maxTextures=renderer.plugins[pluginName].maxTextures;var sampleValues=new Int32Array(maxTextures);for(var i=0;i<maxTextures;i++){sampleValues[i]=i;}var _uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix(),default:UniformGroup.from({uSamplers:sampleValues},true)};var program=renderer.plugins[pluginName]._shader.program;DEFAULT_SHADERS[pluginName]=new Shader(program,_uniforms);}shader=DEFAULT_SHADERS[pluginName];}return shader;}},{key:"_calculateBounds",value:function _calculateBounds(){this.finishPoly();var geometry=this._geometry;if(!geometry.graphicsData.length){return;}var _geometry$bounds=geometry.bounds,minX=_geometry$bounds.minX,minY=_geometry$bounds.minY,maxX=_geometry$bounds.maxX,maxY=_geometry$bounds.maxY;this._bounds.addFrame(this.transform,minX,minY,maxX,maxY);}},{key:"containsPoint",value:function containsPoint(point){this.worldTransform.applyInverse(point,_Graphics._TEMP_POINT);return this._geometry.containsPoint(_Graphics._TEMP_POINT);}},{key:"calculateTints",value:function calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;var tintRGB=hex2rgb(this.tint,temp);for(var i=0;i<this.batches.length;i++){var batch=this.batches[i];var batchTint=batch._batchRGB;var r=tintRGB[0]*batchTint[0]*255;var g=tintRGB[1]*batchTint[1]*255;var b=tintRGB[2]*batchTint[2]*255;var color=(r<<16)+(g<<8)+(b|0);batch._tintRGB=(color>>16)+(color&65280)+((color&255)<<16);}}}},{key:"calculateVertices",value:function calculateVertices(){var wtID=this.transform._worldID;if(this._transformID===wtID){return;}this._transformID=wtID;var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var data=this._geometry.points;var vertexData=this.vertexData;var count=0;for(var i=0;i<data.length;i+=2){var x=data[i];var y=data[i+1];vertexData[count++]=a*x+c*y+tx;vertexData[count++]=d*y+b*x+ty;}}},{key:"closePath",value:function closePath(){var currentPath=this.currentPath;if(currentPath){currentPath.closeStroke=true;this.finishPoly();}return this;}},{key:"setMatrix",value:function setMatrix(matrix){this._matrix=matrix;return this;}},{key:"beginHole",value:function beginHole(){this.finishPoly();this._holeMode=true;return this;}},{key:"endHole",value:function endHole(){this.finishPoly();this._holeMode=false;return this;}},{key:"destroy",value:function destroy(options){this._geometry.refCount--;if(this._geometry.refCount===0){this._geometry.dispose();}this._matrix=null;this.currentPath=null;this._lineStyle.destroy();this._lineStyle=null;this._fillStyle.destroy();this._fillStyle=null;this._geometry=null;this.shader=null;this.vertexData=null;this.batches.length=0;this.batches=null;_get(_getPrototypeOf(_Graphics.prototype),"destroy",this).call(this,options);}}]);}(Container);var Graphics=_Graphics;Graphics.curves=curves;Graphics._TEMP_POINT=new Point();var graphicsUtils={buildPoly:buildPoly,buildCircle:buildCircle,buildRectangle:buildRectangle,buildRoundedRectangle:buildRoundedRectangle,buildLine:buildLine,ArcUtils:ArcUtils,BezierUtils:BezierUtils,QuadraticUtils:QuadraticUtils,BatchPart:BatchPart,FILL_COMMANDS:FILL_COMMANDS,BATCH_POOL:BATCH_POOL,DRAW_CALL_POOL:DRAW_CALL_POOL};var MeshBatchUvs=/*#__PURE__*/function(){function MeshBatchUvs(uvBuffer,uvMatrix){_classCallCheck(this,MeshBatchUvs);this.uvBuffer=uvBuffer;this.uvMatrix=uvMatrix;this.data=null;this._bufferUpdateId=-1;this._textureUpdateId=-1;this._updateID=0;}return _createClass(MeshBatchUvs,[{key:"update",value:function update(forceUpdate){if(!forceUpdate&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID){return;}this._bufferUpdateId=this.uvBuffer._updateID;this._textureUpdateId=this.uvMatrix._updateID;var data=this.uvBuffer.data;if(!this.data||this.data.length!==data.length){this.data=new Float32Array(data.length);}this.uvMatrix.multiplyUvs(data,this.data);this._updateID++;}}]);}();var tempPoint$1=new Point();var tempPolygon=new Polygon();var _Mesh=/*#__PURE__*/function(_Container4){function _Mesh(geometry,shader,state){var _this81;var drawMode=arguments.length>3&&arguments[3]!==undefined?arguments[3]:DRAW_MODES.TRIANGLES;_classCallCheck(this,_Mesh);_this81=_callSuper(this,_Mesh);_this81.geometry=geometry;_this81.shader=shader;_this81.state=state||State.for2d();_this81.drawMode=drawMode;_this81.start=0;_this81.size=0;_this81.uvs=null;_this81.indices=null;_this81.vertexData=new Float32Array(1);_this81.vertexDirty=-1;_this81._transformID=-1;_this81._roundPixels=settings.ROUND_PIXELS;_this81.batchUvs=null;return _this81;}_inherits(_Mesh,_Container4);return _createClass(_Mesh,[{key:"geometry",get:function get(){return this._geometry;},set:function set(value){if(this._geometry===value){return;}if(this._geometry){this._geometry.refCount--;if(this._geometry.refCount===0){this._geometry.dispose();}}this._geometry=value;if(this._geometry){this._geometry.refCount++;}this.vertexDirty=-1;}},{key:"uvBuffer",get:function get(){return this.geometry.buffers[1];}},{key:"verticesBuffer",get:function get(){return this.geometry.buffers[0];}},{key:"material",get:function get(){return this.shader;},set:function set(value){this.shader=value;}},{key:"blendMode",get:function get(){return this.state.blendMode;},set:function set(value){this.state.blendMode=value;}},{key:"roundPixels",get:function get(){return this._roundPixels;},set:function set(value){if(this._roundPixels!==value){this._transformID=-1;}this._roundPixels=value;}},{key:"tint",get:function get(){return"tint"in this.shader?this.shader.tint:null;},set:function set(value){this.shader.tint=value;}},{key:"texture",get:function get(){return"texture"in this.shader?this.shader.texture:null;},set:function set(value){this.shader.texture=value;}},{key:"_render",value:function _render(renderer){var vertices=this.geometry.buffers[0].data;var shader=this.shader;if(shader.batchable&&this.drawMode===DRAW_MODES.TRIANGLES&&vertices.length<_Mesh.BATCHABLE_SIZE*2){this._renderToBatch(renderer);}else{this._renderDefault(renderer);}}},{key:"_renderDefault",value:function _renderDefault(renderer){var shader=this.shader;shader.alpha=this.worldAlpha;if(shader.update){shader.update();}renderer.batch.flush();shader.uniforms.translationMatrix=this.transform.worldTransform.toArray(true);renderer.shader.bind(shader);renderer.state.set(this.state);renderer.geometry.bind(this.geometry,shader);renderer.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount);}},{key:"_renderToBatch",value:function _renderToBatch(renderer){var geometry=this.geometry;var shader=this.shader;if(shader.uvMatrix){shader.uvMatrix.update();this.calculateUvs();}this.calculateVertices();this.indices=geometry.indexBuffer.data;this._tintRGB=shader._tintRGB;this._texture=shader.texture;var pluginName=this.material.pluginName;renderer.batch.setObjectRenderer(renderer.plugins[pluginName]);renderer.plugins[pluginName].render(this);}},{key:"calculateVertices",value:function calculateVertices(){var geometry=this.geometry;var verticesBuffer=geometry.buffers[0];var vertices=verticesBuffer.data;var vertexDirtyId=verticesBuffer._updateID;if(vertexDirtyId===this.vertexDirty&&this._transformID===this.transform._worldID){return;}this._transformID=this.transform._worldID;if(this.vertexData.length!==vertices.length){this.vertexData=new Float32Array(vertices.length);}var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var vertexData=this.vertexData;for(var i=0;i<vertexData.length/2;i++){var x=vertices[i*2];var y=vertices[i*2+1];vertexData[i*2]=a*x+c*y+tx;vertexData[i*2+1]=b*x+d*y+ty;}if(this._roundPixels){var resolution=settings.RESOLUTION;for(var _i33=0;_i33<vertexData.length;++_i33){vertexData[_i33]=Math.round(vertexData[_i33]*resolution)/resolution;}}this.vertexDirty=vertexDirtyId;}},{key:"calculateUvs",value:function calculateUvs(){var geomUvs=this.geometry.buffers[1];var shader=this.shader;if(!shader.uvMatrix.isSimple){if(!this.batchUvs){this.batchUvs=new MeshBatchUvs(geomUvs,shader.uvMatrix);}this.batchUvs.update();this.uvs=this.batchUvs.data;}else{this.uvs=geomUvs.data;}}},{key:"_calculateBounds",value:function _calculateBounds(){this.calculateVertices();this._bounds.addVertexData(this.vertexData,0,this.vertexData.length);}},{key:"containsPoint",value:function containsPoint(point){if(!this.getBounds().contains(point.x,point.y)){return false;}this.worldTransform.applyInverse(point,tempPoint$1);var vertices=this.geometry.getBuffer("aVertexPosition").data;var points=tempPolygon.points;var indices=this.geometry.getIndex().data;var len=indices.length;var step=this.drawMode===4?3:1;for(var i=0;i+2<len;i+=step){var ind0=indices[i]*2;var ind1=indices[i+1]*2;var ind2=indices[i+2]*2;points[0]=vertices[ind0];points[1]=vertices[ind0+1];points[2]=vertices[ind1];points[3]=vertices[ind1+1];points[4]=vertices[ind2];points[5]=vertices[ind2+1];if(tempPolygon.contains(tempPoint$1.x,tempPoint$1.y)){return true;}}return false;}},{key:"destroy",value:function destroy(options){_get(_getPrototypeOf(_Mesh.prototype),"destroy",this).call(this,options);if(this._cachedTexture){this._cachedTexture.destroy();this._cachedTexture=null;}this.geometry=null;this.shader=null;this.state=null;this.uvs=null;this.indices=null;this.vertexData=null;}}]);}(Container);var Mesh=_Mesh;Mesh.BATCHABLE_SIZE=100;var MeshGeometry=/*#__PURE__*/function(_Geometry4){function MeshGeometry(vertices,uvs,index){var _this82;_classCallCheck(this,MeshGeometry);_this82=_callSuper(this,MeshGeometry);var verticesBuffer=new Buffer(vertices);var uvsBuffer=new Buffer(uvs,true);var indexBuffer=new Buffer(index,true,true);_this82.addAttribute("aVertexPosition",verticesBuffer,2,false,TYPES.FLOAT).addAttribute("aTextureCoord",uvsBuffer,2,false,TYPES.FLOAT).addIndex(indexBuffer);_this82._updateId=-1;return _this82;}_inherits(MeshGeometry,_Geometry4);return _createClass(MeshGeometry,[{key:"vertexDirtyId",get:function get(){return this.buffers[0]._updateID;}}]);}(Geometry);var fragment$1="varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n";var vertex$1="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n";var MeshMaterial=/*#__PURE__*/function(_Shader2){function MeshMaterial(uSampler,options){var _this83;_classCallCheck(this,MeshMaterial);var uniforms={uSampler:uSampler,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};options=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},options);if(options.uniforms){Object.assign(uniforms,options.uniforms);}_this83=_callSuper(this,MeshMaterial,[options.program||Program.from(vertex$1,fragment$1),uniforms]);_this83._colorDirty=false;_this83.uvMatrix=new TextureMatrix(uSampler);_this83.batchable=options.program===void 0;_this83.pluginName=options.pluginName;_this83.tint=options.tint;_this83.alpha=options.alpha;return _this83;}_inherits(MeshMaterial,_Shader2);return _createClass(MeshMaterial,[{key:"texture",get:function get(){return this.uniforms.uSampler;},set:function set(value){if(this.uniforms.uSampler!==value){if(!this.uniforms.uSampler.baseTexture.alphaMode!==!value.baseTexture.alphaMode){this._colorDirty=true;}this.uniforms.uSampler=value;this.uvMatrix.texture=value;}}},{key:"alpha",get:function get(){return this._alpha;},set:function set(value){if(value===this._alpha)return;this._alpha=value;this._colorDirty=true;}},{key:"tint",get:function get(){return this._tint;},set:function set(value){if(value===this._tint)return;this._tint=value;this._tintRGB=(value>>16)+(value&65280)+((value&255)<<16);this._colorDirty=true;}},{key:"update",value:function update(){if(this._colorDirty){this._colorDirty=false;var baseTexture=this.texture.baseTexture;premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,baseTexture.alphaMode);}if(this.uvMatrix.update()){this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord;}}}]);}(Shader);var PlaneGeometry=/*#__PURE__*/function(_MeshGeometry){function PlaneGeometry(){var _this84;var width=arguments.length>0&&arguments[0]!==undefined?arguments[0]:100;var height=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100;var segWidth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:10;var segHeight=arguments.length>3&&arguments[3]!==undefined?arguments[3]:10;_classCallCheck(this,PlaneGeometry);_this84=_callSuper(this,PlaneGeometry);_this84.segWidth=segWidth;_this84.segHeight=segHeight;_this84.width=width;_this84.height=height;_this84.build();return _this84;}_inherits(PlaneGeometry,_MeshGeometry);return _createClass(PlaneGeometry,[{key:"build",value:function build(){var total=this.segWidth*this.segHeight;var verts=[];var uvs=[];var indices=[];var segmentsX=this.segWidth-1;var segmentsY=this.segHeight-1;var sizeX=this.width/segmentsX;var sizeY=this.height/segmentsY;for(var i=0;i<total;i++){var x=i%this.segWidth;var y=i/this.segWidth|0;verts.push(x*sizeX,y*sizeY);uvs.push(x/segmentsX,y/segmentsY);}var totalSub=segmentsX*segmentsY;for(var _i34=0;_i34<totalSub;_i34++){var xpos=_i34%segmentsX;var ypos=_i34/segmentsX|0;var value=ypos*this.segWidth+xpos;var value2=ypos*this.segWidth+xpos+1;var value3=(ypos+1)*this.segWidth+xpos;var value4=(ypos+1)*this.segWidth+xpos+1;indices.push(value,value2,value3,value2,value4,value3);}this.buffers[0].data=new Float32Array(verts);this.buffers[1].data=new Float32Array(uvs);this.indexBuffer.data=new Uint16Array(indices);this.buffers[0].update();this.buffers[1].update();this.indexBuffer.update();}}]);}(MeshGeometry);var RopeGeometry=/*#__PURE__*/function(_MeshGeometry2){function RopeGeometry(){var _this85;var width=arguments.length>0&&arguments[0]!==undefined?arguments[0]:200;var points=arguments.length>1?arguments[1]:undefined;var textureScale=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,RopeGeometry);_this85=_callSuper(this,RopeGeometry,[new Float32Array(points.length*4),new Float32Array(points.length*4),new Uint16Array((points.length-1)*6)]);_this85.points=points;_this85._width=width;_this85.textureScale=textureScale;_this85.build();return _this85;}_inherits(RopeGeometry,_MeshGeometry2);return _createClass(RopeGeometry,[{key:"width",get:function get(){return this._width;}},{key:"build",value:function build(){var points=this.points;if(!points)return;var vertexBuffer=this.getBuffer("aVertexPosition");var uvBuffer=this.getBuffer("aTextureCoord");var indexBuffer=this.getIndex();if(points.length<1){return;}if(vertexBuffer.data.length/4!==points.length){vertexBuffer.data=new Float32Array(points.length*4);uvBuffer.data=new Float32Array(points.length*4);indexBuffer.data=new Uint16Array((points.length-1)*6);}var uvs=uvBuffer.data;var indices=indexBuffer.data;uvs[0]=0;uvs[1]=0;uvs[2]=0;uvs[3]=1;var amount=0;var prev=points[0];var textureWidth=this._width*this.textureScale;var total=points.length;for(var i=0;i<total;i++){var _index10=i*4;if(this.textureScale>0){var dx=prev.x-points[i].x;var dy=prev.y-points[i].y;var distance=Math.sqrt(dx*dx+dy*dy);prev=points[i];amount+=distance/textureWidth;}else{amount=i/(total-1);}uvs[_index10]=amount;uvs[_index10+1]=0;uvs[_index10+2]=amount;uvs[_index10+3]=1;}var indexCount=0;for(var _i35=0;_i35<total-1;_i35++){var _index11=_i35*2;indices[indexCount++]=_index11;indices[indexCount++]=_index11+1;indices[indexCount++]=_index11+2;indices[indexCount++]=_index11+2;indices[indexCount++]=_index11+1;indices[indexCount++]=_index11+3;}uvBuffer.update();indexBuffer.update();this.updateVertices();}},{key:"updateVertices",value:function updateVertices(){var points=this.points;if(points.length<1){return;}var lastPoint=points[0];var nextPoint;var perpX=0;var perpY=0;var vertices=this.buffers[0].data;var total=points.length;var halfWidth=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(var i=0;i<total;i++){var point=points[i];var _index12=i*4;if(i<points.length-1){nextPoint=points[i+1];}else{nextPoint=point;}perpY=-(nextPoint.x-lastPoint.x);perpX=nextPoint.y-lastPoint.y;var perpLength=Math.sqrt(perpX*perpX+perpY*perpY);if(perpLength<1e-6){perpX=0;perpY=0;}else{perpX/=perpLength;perpY/=perpLength;perpX*=halfWidth;perpY*=halfWidth;}vertices[_index12]=point.x+perpX;vertices[_index12+1]=point.y+perpY;vertices[_index12+2]=point.x-perpX;vertices[_index12+3]=point.y-perpY;lastPoint=point;}this.buffers[0].update();}},{key:"update",value:function update(){if(this.textureScale>0){this.build();}else{this.updateVertices();}}}]);}(MeshGeometry);var SimplePlane=/*#__PURE__*/function(_Mesh2){function SimplePlane(texture,verticesX,verticesY){var _this86;_classCallCheck(this,SimplePlane);var planeGeometry=new PlaneGeometry(texture.width,texture.height,verticesX,verticesY);var meshMaterial=new MeshMaterial(Texture.WHITE);_this86=_callSuper(this,SimplePlane,[planeGeometry,meshMaterial]);_this86.texture=texture;_this86.autoResize=true;return _this86;}_inherits(SimplePlane,_Mesh2);return _createClass(SimplePlane,[{key:"textureUpdated",value:function textureUpdated(){this._textureID=this.shader.texture._updateID;var geometry=this.geometry;var _this$shader$texture=this.shader.texture,width=_this$shader$texture.width,height=_this$shader$texture.height;if(this.autoResize&&(geometry.width!==width||geometry.height!==height)){geometry.width=this.shader.texture.width;geometry.height=this.shader.texture.height;geometry.build();}}},{key:"texture",get:function get(){return this.shader.texture;},set:function set(value){if(this.shader.texture===value){return;}this.shader.texture=value;this._textureID=-1;if(value.baseTexture.valid){this.textureUpdated();}else{value.once("update",this.textureUpdated,this);}}},{key:"_render",value:function _render(renderer){if(this._textureID!==this.shader.texture._updateID){this.textureUpdated();}_get(_getPrototypeOf(SimplePlane.prototype),"_render",this).call(this,renderer);}},{key:"destroy",value:function destroy(options){this.shader.texture.off("update",this.textureUpdated,this);_get(_getPrototypeOf(SimplePlane.prototype),"destroy",this).call(this,options);}}]);}(Mesh);var DEFAULT_BORDER_SIZE=10;var NineSlicePlane=/*#__PURE__*/function(_SimplePlane){function NineSlicePlane(texture){var _this87;var leftWidth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_BORDER_SIZE;var topHeight=arguments.length>2&&arguments[2]!==undefined?arguments[2]:DEFAULT_BORDER_SIZE;var rightWidth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:DEFAULT_BORDER_SIZE;var bottomHeight=arguments.length>4&&arguments[4]!==undefined?arguments[4]:DEFAULT_BORDER_SIZE;_classCallCheck(this,NineSlicePlane);_this87=_callSuper(this,NineSlicePlane,[Texture.WHITE,4,4]);_this87._origWidth=texture.orig.width;_this87._origHeight=texture.orig.height;_this87._width=_this87._origWidth;_this87._height=_this87._origHeight;_this87._leftWidth=leftWidth;_this87._rightWidth=rightWidth;_this87._topHeight=topHeight;_this87._bottomHeight=bottomHeight;_this87.texture=texture;return _this87;}_inherits(NineSlicePlane,_SimplePlane);return _createClass(NineSlicePlane,[{key:"textureUpdated",value:function textureUpdated(){this._textureID=this.shader.texture._updateID;this._refresh();}},{key:"vertices",get:function get(){return this.geometry.getBuffer("aVertexPosition").data;},set:function set(value){this.geometry.getBuffer("aVertexPosition").data=value;}},{key:"updateHorizontalVertices",value:function updateHorizontalVertices(){var vertices=this.vertices;var scale=this._getMinScale();vertices[9]=vertices[11]=vertices[13]=vertices[15]=this._topHeight*scale;vertices[17]=vertices[19]=vertices[21]=vertices[23]=this._height-this._bottomHeight*scale;vertices[25]=vertices[27]=vertices[29]=vertices[31]=this._height;}},{key:"updateVerticalVertices",value:function updateVerticalVertices(){var vertices=this.vertices;var scale=this._getMinScale();vertices[2]=vertices[10]=vertices[18]=vertices[26]=this._leftWidth*scale;vertices[4]=vertices[12]=vertices[20]=vertices[28]=this._width-this._rightWidth*scale;vertices[6]=vertices[14]=vertices[22]=vertices[30]=this._width;}},{key:"_getMinScale",value:function _getMinScale(){var w=this._leftWidth+this._rightWidth;var scaleW=this._width>w?1:this._width/w;var h=this._topHeight+this._bottomHeight;var scaleH=this._height>h?1:this._height/h;var scale=Math.min(scaleW,scaleH);return scale;}},{key:"width",get:function get(){return this._width;},set:function set(value){this._width=value;this._refresh();}},{key:"height",get:function get(){return this._height;},set:function set(value){this._height=value;this._refresh();}},{key:"leftWidth",get:function get(){return this._leftWidth;},set:function set(value){this._leftWidth=value;this._refresh();}},{key:"rightWidth",get:function get(){return this._rightWidth;},set:function set(value){this._rightWidth=value;this._refresh();}},{key:"topHeight",get:function get(){return this._topHeight;},set:function set(value){this._topHeight=value;this._refresh();}},{key:"bottomHeight",get:function get(){return this._bottomHeight;},set:function set(value){this._bottomHeight=value;this._refresh();}},{key:"_refresh",value:function _refresh(){var texture=this.texture;var uvs=this.geometry.buffers[1].data;this._origWidth=texture.orig.width;this._origHeight=texture.orig.height;var _uvw=1/this._origWidth;var _uvh=1/this._origHeight;uvs[0]=uvs[8]=uvs[16]=uvs[24]=0;uvs[1]=uvs[3]=uvs[5]=uvs[7]=0;uvs[6]=uvs[14]=uvs[22]=uvs[30]=1;uvs[25]=uvs[27]=uvs[29]=uvs[31]=1;uvs[2]=uvs[10]=uvs[18]=uvs[26]=_uvw*this._leftWidth;uvs[4]=uvs[12]=uvs[20]=uvs[28]=1-_uvw*this._rightWidth;uvs[9]=uvs[11]=uvs[13]=uvs[15]=_uvh*this._topHeight;uvs[17]=uvs[19]=uvs[21]=uvs[23]=1-_uvh*this._bottomHeight;this.updateHorizontalVertices();this.updateVerticalVertices();this.geometry.buffers[0].update();this.geometry.buffers[1].update();}}]);}(SimplePlane);var SimpleMesh=/*#__PURE__*/function(_Mesh3){function SimpleMesh(){var _this88;var texture=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Texture.EMPTY;var vertices=arguments.length>1?arguments[1]:undefined;var uvs=arguments.length>2?arguments[2]:undefined;var indices=arguments.length>3?arguments[3]:undefined;var drawMode=arguments.length>4?arguments[4]:undefined;_classCallCheck(this,SimpleMesh);var geometry=new MeshGeometry(vertices,uvs,indices);geometry.getBuffer("aVertexPosition").static=false;var meshMaterial=new MeshMaterial(texture);_this88=_callSuper(this,SimpleMesh,[geometry,meshMaterial,null,drawMode]);_this88.autoUpdate=true;return _this88;}_inherits(SimpleMesh,_Mesh3);return _createClass(SimpleMesh,[{key:"vertices",get:function get(){return this.geometry.getBuffer("aVertexPosition").data;},set:function set(value){this.geometry.getBuffer("aVertexPosition").data=value;}},{key:"_render",value:function _render(renderer){if(this.autoUpdate){this.geometry.getBuffer("aVertexPosition").update();}_get(_getPrototypeOf(SimpleMesh.prototype),"_render",this).call(this,renderer);}}]);}(Mesh);var SimpleRope=/*#__PURE__*/function(_Mesh4){function SimpleRope(texture,points){var _this89;var textureScale=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,SimpleRope);var ropeGeometry=new RopeGeometry(texture.height,points,textureScale);var meshMaterial=new MeshMaterial(texture);if(textureScale>0){texture.baseTexture.wrapMode=WRAP_MODES.REPEAT;}_this89=_callSuper(this,SimpleRope,[ropeGeometry,meshMaterial]);_this89.autoUpdate=true;return _this89;}_inherits(SimpleRope,_Mesh4);return _createClass(SimpleRope,[{key:"_render",value:function _render(renderer){var geometry=this.geometry;if(this.autoUpdate||geometry._width!==this.shader.texture.height){geometry._width=this.shader.texture.height;geometry.update();}_get(_getPrototypeOf(SimpleRope.prototype),"_render",this).call(this,renderer);}}]);}(Mesh);var ParticleContainer=/*#__PURE__*/function(_Container5){function ParticleContainer(){var _this90;var maxSize=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1500;var properties=arguments.length>1?arguments[1]:undefined;var batchSize=arguments.length>2&&arguments[2]!==undefined?arguments[2]:16384;var autoResize=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,ParticleContainer);_this90=_callSuper(this,ParticleContainer);var maxBatchSize=16384;if(batchSize>maxBatchSize){batchSize=maxBatchSize;}_this90._properties=[false,true,false,false,false];_this90._maxSize=maxSize;_this90._batchSize=batchSize;_this90._buffers=null;_this90._bufferUpdateIDs=[];_this90._updateID=0;_this90.interactiveChildren=false;_this90.blendMode=BLEND_MODES.NORMAL;_this90.autoResize=autoResize;_this90.roundPixels=true;_this90.baseTexture=null;_this90.setProperties(properties);_this90._tint=0;_this90.tintRgb=new Float32Array(4);_this90.tint=16777215;return _this90;}_inherits(ParticleContainer,_Container5);return _createClass(ParticleContainer,[{key:"setProperties",value:function setProperties(properties){if(properties){this._properties[0]="vertices"in properties||"scale"in properties?!!properties.vertices||!!properties.scale:this._properties[0];this._properties[1]="position"in properties?!!properties.position:this._properties[1];this._properties[2]="rotation"in properties?!!properties.rotation:this._properties[2];this._properties[3]="uvs"in properties?!!properties.uvs:this._properties[3];this._properties[4]="tint"in properties||"alpha"in properties?!!properties.tint||!!properties.alpha:this._properties[4];}}},{key:"updateTransform",value:function updateTransform(){this.displayObjectUpdateTransform();}},{key:"tint",get:function get(){return this._tint;},set:function set(value){this._tint=value;hex2rgb(value,this.tintRgb);}},{key:"render",value:function render(renderer){var _this91=this;if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable){return;}if(!this.baseTexture){this.baseTexture=this.children[0]._texture.baseTexture;if(!this.baseTexture.valid){this.baseTexture.once("update",function(){return _this91.onChildrenChange(0);});}}renderer.batch.setObjectRenderer(renderer.plugins.particle);renderer.plugins.particle.render(this);}},{key:"onChildrenChange",value:function onChildrenChange(smallestChildIndex){var bufferIndex=Math.floor(smallestChildIndex/this._batchSize);while(this._bufferUpdateIDs.length<bufferIndex){this._bufferUpdateIDs.push(0);}this._bufferUpdateIDs[bufferIndex]=++this._updateID;}},{key:"dispose",value:function dispose(){if(this._buffers){for(var i=0;i<this._buffers.length;++i){this._buffers[i].destroy();}this._buffers=null;}}},{key:"destroy",value:function destroy(options){_get(_getPrototypeOf(ParticleContainer.prototype),"destroy",this).call(this,options);this.dispose();this._properties=null;this._buffers=null;this._bufferUpdateIDs=null;}}]);}(Container);var ParticleBuffer=/*#__PURE__*/function(){function ParticleBuffer(properties,dynamicPropertyFlags,size){_classCallCheck(this,ParticleBuffer);this.geometry=new Geometry();this.indexBuffer=null;this.size=size;this.dynamicProperties=[];this.staticProperties=[];for(var i=0;i<properties.length;++i){var property=properties[i];property={attributeName:property.attributeName,size:property.size,uploadFunction:property.uploadFunction,type:property.type||TYPES.FLOAT,offset:property.offset};if(dynamicPropertyFlags[i]){this.dynamicProperties.push(property);}else{this.staticProperties.push(property);}}this.staticStride=0;this.staticBuffer=null;this.staticData=null;this.staticDataUint32=null;this.dynamicStride=0;this.dynamicBuffer=null;this.dynamicData=null;this.dynamicDataUint32=null;this._updateID=0;this.initBuffers();}return _createClass(ParticleBuffer,[{key:"initBuffers",value:function initBuffers(){var geometry=this.geometry;var dynamicOffset=0;this.indexBuffer=new Buffer(createIndicesForQuads(this.size),true,true);geometry.addIndex(this.indexBuffer);this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){var property=this.dynamicProperties[i];property.offset=dynamicOffset;dynamicOffset+=property.size;this.dynamicStride+=property.size;}var dynBuffer=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(dynBuffer);this.dynamicDataUint32=new Uint32Array(dynBuffer);this.dynamicBuffer=new Buffer(this.dynamicData,false,false);var staticOffset=0;this.staticStride=0;for(var _i36=0;_i36<this.staticProperties.length;++_i36){var _property=this.staticProperties[_i36];_property.offset=staticOffset;staticOffset+=_property.size;this.staticStride+=_property.size;}var statBuffer=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(statBuffer);this.staticDataUint32=new Uint32Array(statBuffer);this.staticBuffer=new Buffer(this.staticData,true,false);for(var _i37=0;_i37<this.dynamicProperties.length;++_i37){var _property2=this.dynamicProperties[_i37];geometry.addAttribute(_property2.attributeName,this.dynamicBuffer,0,_property2.type===TYPES.UNSIGNED_BYTE,_property2.type,this.dynamicStride*4,_property2.offset*4);}for(var _i38=0;_i38<this.staticProperties.length;++_i38){var _property3=this.staticProperties[_i38];geometry.addAttribute(_property3.attributeName,this.staticBuffer,0,_property3.type===TYPES.UNSIGNED_BYTE,_property3.type,this.staticStride*4,_property3.offset*4);}}},{key:"uploadDynamic",value:function uploadDynamic(children,startIndex,amount){for(var i=0;i<this.dynamicProperties.length;i++){var property=this.dynamicProperties[i];property.uploadFunction(children,startIndex,amount,property.type===TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,property.offset);}this.dynamicBuffer._updateID++;}},{key:"uploadStatic",value:function uploadStatic(children,startIndex,amount){for(var i=0;i<this.staticProperties.length;i++){var property=this.staticProperties[i];property.uploadFunction(children,startIndex,amount,property.type===TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,property.offset);}this.staticBuffer._updateID++;}},{key:"destroy",value:function destroy(){this.indexBuffer=null;this.dynamicProperties=null;this.dynamicBuffer=null;this.dynamicData=null;this.dynamicDataUint32=null;this.staticProperties=null;this.staticBuffer=null;this.staticData=null;this.staticDataUint32=null;this.geometry.destroy();}}]);}();var fragment="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}";var vertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n";var ParticleRenderer=/*#__PURE__*/function(_ObjectRenderer2){function ParticleRenderer(renderer){var _this92;_classCallCheck(this,ParticleRenderer);_this92=_callSuper(this,ParticleRenderer,[renderer]);_this92.shader=null;_this92.properties=null;_this92.tempMatrix=new Matrix();_this92.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:_this92.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:_this92.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:_this92.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:_this92.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:TYPES.UNSIGNED_BYTE,uploadFunction:_this92.uploadTint,offset:0}];_this92.shader=Shader.from(vertex,fragment,{});_this92.state=State.for2d();return _this92;}_inherits(ParticleRenderer,_ObjectRenderer2);return _createClass(ParticleRenderer,[{key:"render",value:function render(container){var children=container.children;var maxSize=container._maxSize;var batchSize=container._batchSize;var renderer=this.renderer;var totalChildren=children.length;if(totalChildren===0){return;}else if(totalChildren>maxSize&&!container.autoResize){totalChildren=maxSize;}var buffers=container._buffers;if(!buffers){buffers=container._buffers=this.generateBuffers(container);}var baseTexture=children[0]._texture.baseTexture;var premultiplied=baseTexture.alphaMode>0;this.state.blendMode=correctBlendMode(container.blendMode,premultiplied);renderer.state.set(this.state);var gl=renderer.gl;var m=container.worldTransform.copyTo(this.tempMatrix);m.prepend(renderer.globalUniforms.uniforms.projectionMatrix);this.shader.uniforms.translationMatrix=m.toArray(true);this.shader.uniforms.uColor=premultiplyRgba(container.tintRgb,container.worldAlpha,this.shader.uniforms.uColor,premultiplied);this.shader.uniforms.uSampler=baseTexture;this.renderer.shader.bind(this.shader);var updateStatic=false;for(var i=0,j=0;i<totalChildren;i+=batchSize,j+=1){var amount=totalChildren-i;if(amount>batchSize){amount=batchSize;}if(j>=buffers.length){buffers.push(this._generateOneMoreBuffer(container));}var buffer=buffers[j];buffer.uploadDynamic(children,i,amount);var bid=container._bufferUpdateIDs[j]||0;updateStatic=updateStatic||buffer._updateID<bid;if(updateStatic){buffer._updateID=container._updateID;buffer.uploadStatic(children,i,amount);}renderer.geometry.bind(buffer.geometry);gl.drawElements(gl.TRIANGLES,amount*6,gl.UNSIGNED_SHORT,0);}}},{key:"generateBuffers",value:function generateBuffers(container){var buffers=[];var size=container._maxSize;var batchSize=container._batchSize;var dynamicPropertyFlags=container._properties;for(var i=0;i<size;i+=batchSize){buffers.push(new ParticleBuffer(this.properties,dynamicPropertyFlags,batchSize));}return buffers;}},{key:"_generateOneMoreBuffer",value:function _generateOneMoreBuffer(container){var batchSize=container._batchSize;var dynamicPropertyFlags=container._properties;return new ParticleBuffer(this.properties,dynamicPropertyFlags,batchSize);}},{key:"uploadVertices",value:function uploadVertices(children,startIndex,amount,array,stride,offset){var w0=0;var w1=0;var h0=0;var h1=0;for(var i=0;i<amount;++i){var sprite=children[startIndex+i];var texture=sprite._texture;var sx=sprite.scale.x;var sy=sprite.scale.y;var trim=texture.trim;var orig=texture.orig;if(trim){w1=trim.x-sprite.anchor.x*orig.width;w0=w1+trim.width;h1=trim.y-sprite.anchor.y*orig.height;h0=h1+trim.height;}else{w0=orig.width*(1-sprite.anchor.x);w1=orig.width*-sprite.anchor.x;h0=orig.height*(1-sprite.anchor.y);h1=orig.height*-sprite.anchor.y;}array[offset]=w1*sx;array[offset+1]=h1*sy;array[offset+stride]=w0*sx;array[offset+stride+1]=h1*sy;array[offset+stride*2]=w0*sx;array[offset+stride*2+1]=h0*sy;array[offset+stride*3]=w1*sx;array[offset+stride*3+1]=h0*sy;offset+=stride*4;}}},{key:"uploadPosition",value:function uploadPosition(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spritePosition=children[startIndex+i].position;array[offset]=spritePosition.x;array[offset+1]=spritePosition.y;array[offset+stride]=spritePosition.x;array[offset+stride+1]=spritePosition.y;array[offset+stride*2]=spritePosition.x;array[offset+stride*2+1]=spritePosition.y;array[offset+stride*3]=spritePosition.x;array[offset+stride*3+1]=spritePosition.y;offset+=stride*4;}}},{key:"uploadRotation",value:function uploadRotation(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteRotation=children[startIndex+i].rotation;array[offset]=spriteRotation;array[offset+stride]=spriteRotation;array[offset+stride*2]=spriteRotation;array[offset+stride*3]=spriteRotation;offset+=stride*4;}}},{key:"uploadUvs",value:function uploadUvs(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var textureUvs=children[startIndex+i]._texture._uvs;if(textureUvs){array[offset]=textureUvs.x0;array[offset+1]=textureUvs.y0;array[offset+stride]=textureUvs.x1;array[offset+stride+1]=textureUvs.y1;array[offset+stride*2]=textureUvs.x2;array[offset+stride*2+1]=textureUvs.y2;array[offset+stride*3]=textureUvs.x3;array[offset+stride*3+1]=textureUvs.y3;offset+=stride*4;}else{array[offset]=0;array[offset+1]=0;array[offset+stride]=0;array[offset+stride+1]=0;array[offset+stride*2]=0;array[offset+stride*2+1]=0;array[offset+stride*3]=0;array[offset+stride*3+1]=0;offset+=stride*4;}}}},{key:"uploadTint",value:function uploadTint(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var sprite=children[startIndex+i];var premultiplied=sprite._texture.baseTexture.alphaMode>0;var alpha=sprite.alpha;var argb=alpha<1&&premultiplied?premultiplyTint(sprite._tintRGB,alpha):sprite._tintRGB+(alpha*255<<24);array[offset]=argb;array[offset+stride]=argb;array[offset+stride*2]=argb;array[offset+stride*3]=argb;offset+=stride*4;}}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(ParticleRenderer.prototype),"destroy",this).call(this);if(this.shader){this.shader.destroy();this.shader=null;}this.tempMatrix=null;}}]);}(ObjectRenderer);ParticleRenderer.extension={name:"particle",type:ExtensionType.RendererPlugin};extensions$1.add(ParticleRenderer);var TEXT_GRADIENT=/* @__PURE__ */function(TEXT_GRADIENT2){TEXT_GRADIENT2[TEXT_GRADIENT2["LINEAR_VERTICAL"]=0]="LINEAR_VERTICAL";TEXT_GRADIENT2[TEXT_GRADIENT2["LINEAR_HORIZONTAL"]=1]="LINEAR_HORIZONTAL";return TEXT_GRADIENT2;}(TEXT_GRADIENT||{});var contextSettings={willReadFrequently:true};var _TextMetrics=/*#__PURE__*/function(){function _TextMetrics(text,style,width,height,lines,lineWidths,lineHeight,maxLineWidth,fontProperties){_classCallCheck(this,_TextMetrics);this.text=text;this.style=style;this.width=width;this.height=height;this.lines=lines;this.lineWidths=lineWidths;this.lineHeight=lineHeight;this.maxLineWidth=maxLineWidth;this.fontProperties=fontProperties;}return _createClass(_TextMetrics,null,[{key:"experimentalLetterSpacingSupported",get:function get(){var result=_TextMetrics._experimentalLetterSpacingSupported;if(result!==void 0){var proto=settings.ADAPTER.getCanvasRenderingContext2D().prototype;result=_TextMetrics._experimentalLetterSpacingSupported="letterSpacing"in proto||"textLetterSpacing"in proto;}return result;}},{key:"measureText",value:function measureText(text,style,wordWrap){var canvas=arguments.length>3&&arguments[3]!==undefined?arguments[3]:_TextMetrics._canvas;wordWrap=wordWrap===void 0||wordWrap===null?style.wordWrap:wordWrap;var font=style.toFontString();var fontProperties=_TextMetrics.measureFont(font);if(fontProperties.fontSize===0){fontProperties.fontSize=style.fontSize;fontProperties.ascent=style.fontSize;}var context=canvas.getContext("2d",contextSettings);context.font=font;var outputText=wordWrap?_TextMetrics.wordWrap(text,style,canvas):text;var lines=outputText.split(/(?:\r\n|\r|\n)/);var lineWidths=new Array(lines.length);var maxLineWidth=0;for(var i=0;i<lines.length;i++){var lineWidth=_TextMetrics._measureText(lines[i],style.letterSpacing,context);lineWidths[i]=lineWidth;maxLineWidth=Math.max(maxLineWidth,lineWidth);}var width=maxLineWidth+style.strokeThickness;if(style.dropShadow){width+=style.dropShadowDistance;}var lineHeight=style.lineHeight||fontProperties.fontSize+style.strokeThickness;var height=Math.max(lineHeight,fontProperties.fontSize+style.strokeThickness*2)+(lines.length-1)*(lineHeight+style.leading);if(style.dropShadow){height+=style.dropShadowDistance;}return new _TextMetrics(text,style,width,height,lines,lineWidths,lineHeight+style.leading,maxLineWidth,fontProperties);}},{key:"_measureText",value:function _measureText(text,letterSpacing,context){var useExperimentalLetterSpacing=false;if(_TextMetrics.experimentalLetterSpacingSupported){if(_TextMetrics.experimentalLetterSpacing){context.letterSpacing="".concat(letterSpacing,"px");context.textLetterSpacing="".concat(letterSpacing,"px");useExperimentalLetterSpacing=true;}else{context.letterSpacing="0px";context.textLetterSpacing="0px";}}var width=context.measureText(text).width;if(width>0){if(useExperimentalLetterSpacing){width-=letterSpacing;}else{width+=(_TextMetrics.graphemeSegmenter(text).length-1)*letterSpacing;}}return width;}},{key:"wordWrap",value:function wordWrap(text,style){var canvas=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_TextMetrics._canvas;var context=canvas.getContext("2d",contextSettings);var width=0;var line="";var lines="";var cache=/* @__PURE__ */Object.create(null);var letterSpacing=style.letterSpacing,whiteSpace=style.whiteSpace;var collapseSpaces=_TextMetrics.collapseSpaces(whiteSpace);var collapseNewlines=_TextMetrics.collapseNewlines(whiteSpace);var canPrependSpaces=!collapseSpaces;var wordWrapWidth=style.wordWrapWidth+letterSpacing;var tokens=_TextMetrics.tokenize(text);for(var i=0;i<tokens.length;i++){var token=tokens[i];if(_TextMetrics.isNewline(token)){if(!collapseNewlines){lines+=_TextMetrics.addLine(line);canPrependSpaces=!collapseSpaces;line="";width=0;continue;}token=" ";}if(collapseSpaces){var currIsBreakingSpace=_TextMetrics.isBreakingSpace(token);var lastIsBreakingSpace=_TextMetrics.isBreakingSpace(line[line.length-1]);if(currIsBreakingSpace&&lastIsBreakingSpace){continue;}}var tokenWidth=_TextMetrics.getFromCache(token,letterSpacing,cache,context);if(tokenWidth>wordWrapWidth){if(line!==""){lines+=_TextMetrics.addLine(line);line="";width=0;}if(_TextMetrics.canBreakWords(token,style.breakWords)){var characters=_TextMetrics.wordWrapSplit(token);for(var j=0;j<characters.length;j++){var char=characters[j];var lastChar=char;var k=1;while(characters[j+k]){var nextChar=characters[j+k];if(!_TextMetrics.canBreakChars(lastChar,nextChar,token,j,style.breakWords)){char+=nextChar;}else{break;}lastChar=nextChar;k++;}j+=k-1;var characterWidth=_TextMetrics.getFromCache(char,letterSpacing,cache,context);if(characterWidth+width>wordWrapWidth){lines+=_TextMetrics.addLine(line);canPrependSpaces=false;line="";width=0;}line+=char;width+=characterWidth;}}else{if(line.length>0){lines+=_TextMetrics.addLine(line);line="";width=0;}var isLastToken=i===tokens.length-1;lines+=_TextMetrics.addLine(token,!isLastToken);canPrependSpaces=false;line="";width=0;}}else{if(tokenWidth+width>wordWrapWidth){canPrependSpaces=false;lines+=_TextMetrics.addLine(line);line="";width=0;}if(line.length>0||!_TextMetrics.isBreakingSpace(token)||canPrependSpaces){line+=token;width+=tokenWidth;}}}lines+=_TextMetrics.addLine(line,false);return lines;}},{key:"addLine",value:function addLine(line){var newLine=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;line=_TextMetrics.trimRight(line);line=newLine?"".concat(line,"\n"):line;return line;}},{key:"getFromCache",value:function getFromCache(key,letterSpacing,cache,context){var width=cache[key];if(typeof width!=="number"){width=_TextMetrics._measureText(key,letterSpacing,context)+letterSpacing;cache[key]=width;}return width;}},{key:"collapseSpaces",value:function collapseSpaces(whiteSpace){return whiteSpace==="normal"||whiteSpace==="pre-line";}},{key:"collapseNewlines",value:function collapseNewlines(whiteSpace){return whiteSpace==="normal";}},{key:"trimRight",value:function trimRight(text){if(typeof text!=="string"){return"";}for(var i=text.length-1;i>=0;i--){var char=text[i];if(!_TextMetrics.isBreakingSpace(char)){break;}text=text.slice(0,-1);}return text;}},{key:"isNewline",value:function isNewline(char){if(typeof char!=="string"){return false;}return _TextMetrics._newlines.includes(char.charCodeAt(0));}},{key:"isBreakingSpace",value:function isBreakingSpace(char,_nextChar){if(typeof char!=="string"){return false;}return _TextMetrics._breakingSpaces.includes(char.charCodeAt(0));}},{key:"tokenize",value:function tokenize(text){var tokens=[];var token="";if(typeof text!=="string"){return tokens;}for(var i=0;i<text.length;i++){var char=text[i];var nextChar=text[i+1];if(_TextMetrics.isBreakingSpace(char,nextChar)||_TextMetrics.isNewline(char)){if(token!==""){tokens.push(token);token="";}tokens.push(char);continue;}token+=char;}if(token!==""){tokens.push(token);}return tokens;}},{key:"canBreakWords",value:function canBreakWords(_token,breakWords){return breakWords;}},{key:"canBreakChars",value:function canBreakChars(_char,_nextChar,_token,_index,_breakWords){return true;}},{key:"wordWrapSplit",value:function wordWrapSplit(token){return _TextMetrics.graphemeSegmenter(token);}},{key:"measureFont",value:function measureFont(font){if(_TextMetrics._fonts[font]){return _TextMetrics._fonts[font];}var properties={ascent:0,descent:0,fontSize:0};var canvas=_TextMetrics._canvas;var context=_TextMetrics._context;context.font=font;var metricsString=_TextMetrics.METRICS_STRING+_TextMetrics.BASELINE_SYMBOL;var width=Math.ceil(context.measureText(metricsString).width);var baseline=Math.ceil(context.measureText(_TextMetrics.BASELINE_SYMBOL).width);var height=Math.ceil(_TextMetrics.HEIGHT_MULTIPLIER*baseline);baseline=baseline*_TextMetrics.BASELINE_MULTIPLIER|0;if(width===0||height===0){_TextMetrics._fonts[font]=properties;return properties;}canvas.width=width;canvas.height=height;context.fillStyle="#f00";context.fillRect(0,0,width,height);context.font=font;context.textBaseline="alphabetic";context.fillStyle="#000";context.fillText(metricsString,0,baseline);var imagedata=context.getImageData(0,0,width,height).data;var pixels=imagedata.length;var line=width*4;var i=0;var idx=0;var stop=false;for(i=0;i<baseline;++i){for(var j=0;j<line;j+=4){if(imagedata[idx+j]!==255){stop=true;break;}}if(!stop){idx+=line;}else{break;}}properties.ascent=baseline-i;idx=pixels-line;stop=false;for(i=height;i>baseline;--i){for(var _j6=0;_j6<line;_j6+=4){if(imagedata[idx+_j6]!==255){stop=true;break;}}if(!stop){idx-=line;}else{break;}}properties.descent=i-baseline;properties.fontSize=properties.ascent+properties.descent;_TextMetrics._fonts[font]=properties;return properties;}},{key:"clearMetrics",value:function clearMetrics(){var font=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";if(font){delete _TextMetrics._fonts[font];}else{_TextMetrics._fonts={};}}},{key:"_canvas",get:function get(){if(!_TextMetrics.__canvas){var canvas;try{var c=new OffscreenCanvas(0,0);var _context45=c.getContext("2d",contextSettings);if(_context45!==null&&_context45!==void 0&&_context45.measureText){_TextMetrics.__canvas=c;return c;}canvas=settings.ADAPTER.createCanvas();}catch(ex){canvas=settings.ADAPTER.createCanvas();}canvas.width=canvas.height=10;_TextMetrics.__canvas=canvas;}return _TextMetrics.__canvas;}},{key:"_context",get:function get(){if(!_TextMetrics.__context){_TextMetrics.__context=_TextMetrics._canvas.getContext("2d",contextSettings);}return _TextMetrics.__context;}}]);}();var TextMetrics=_TextMetrics;TextMetrics.METRICS_STRING="|\xC9q\xC5";TextMetrics.BASELINE_SYMBOL="M";TextMetrics.BASELINE_MULTIPLIER=1.4;TextMetrics.HEIGHT_MULTIPLIER=2;TextMetrics.graphemeSegmenter=function(_Intl){if(typeof((_Intl=Intl)===null||_Intl===void 0?void 0:_Intl.Segmenter)==="function"){var segmenter=new Intl.Segmenter();return function(s){return _toConsumableArray(segmenter.segment(s)).map(function(x){return x.segment;});};}return function(s){return _toConsumableArray(s);};}();TextMetrics.experimentalLetterSpacing=false;TextMetrics._fonts={};TextMetrics._newlines=[10,13];TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];var _TextStyle=/*#__PURE__*/function(){function _TextStyle(style){_classCallCheck(this,_TextStyle);this.styleID=0;this.reset();deepCopyProperties(this,style,style);}return _createClass(_TextStyle,[{key:"clone",value:function clone(){var clonedProperties={};deepCopyProperties(clonedProperties,this,_TextStyle.defaultStyle);return new _TextStyle(clonedProperties);}},{key:"reset",value:function reset(){deepCopyProperties(this,_TextStyle.defaultStyle,_TextStyle.defaultStyle);}},{key:"align",get:function get(){return this._align;},set:function set(align){if(this._align!==align){this._align=align;this.styleID++;}}},{key:"breakWords",get:function get(){return this._breakWords;},set:function set(breakWords){if(this._breakWords!==breakWords){this._breakWords=breakWords;this.styleID++;}}},{key:"dropShadow",get:function get(){return this._dropShadow;},set:function set(dropShadow){if(this._dropShadow!==dropShadow){this._dropShadow=dropShadow;this.styleID++;}}},{key:"dropShadowAlpha",get:function get(){return this._dropShadowAlpha;},set:function set(dropShadowAlpha){if(this._dropShadowAlpha!==dropShadowAlpha){this._dropShadowAlpha=dropShadowAlpha;this.styleID++;}}},{key:"dropShadowAngle",get:function get(){return this._dropShadowAngle;},set:function set(dropShadowAngle){if(this._dropShadowAngle!==dropShadowAngle){this._dropShadowAngle=dropShadowAngle;this.styleID++;}}},{key:"dropShadowBlur",get:function get(){return this._dropShadowBlur;},set:function set(dropShadowBlur){if(this._dropShadowBlur!==dropShadowBlur){this._dropShadowBlur=dropShadowBlur;this.styleID++;}}},{key:"dropShadowColor",get:function get(){return this._dropShadowColor;},set:function set(dropShadowColor){var outputColor=getColor(dropShadowColor);if(this._dropShadowColor!==outputColor){this._dropShadowColor=outputColor;this.styleID++;}}},{key:"dropShadowDistance",get:function get(){return this._dropShadowDistance;},set:function set(dropShadowDistance){if(this._dropShadowDistance!==dropShadowDistance){this._dropShadowDistance=dropShadowDistance;this.styleID++;}}},{key:"fill",get:function get(){return this._fill;},set:function set(fill){var outputColor=getColor(fill);if(this._fill!==outputColor){this._fill=outputColor;this.styleID++;}}},{key:"fillGradientType",get:function get(){return this._fillGradientType;},set:function set(fillGradientType){if(this._fillGradientType!==fillGradientType){this._fillGradientType=fillGradientType;this.styleID++;}}},{key:"fillGradientStops",get:function get(){return this._fillGradientStops;},set:function set(fillGradientStops){if(!areArraysEqual(this._fillGradientStops,fillGradientStops)){this._fillGradientStops=fillGradientStops;this.styleID++;}}},{key:"fontFamily",get:function get(){return this._fontFamily;},set:function set(fontFamily){if(this.fontFamily!==fontFamily){this._fontFamily=fontFamily;this.styleID++;}}},{key:"fontSize",get:function get(){return this._fontSize;},set:function set(fontSize){if(this._fontSize!==fontSize){this._fontSize=fontSize;this.styleID++;}}},{key:"fontStyle",get:function get(){return this._fontStyle;},set:function set(fontStyle){if(this._fontStyle!==fontStyle){this._fontStyle=fontStyle;this.styleID++;}}},{key:"fontVariant",get:function get(){return this._fontVariant;},set:function set(fontVariant){if(this._fontVariant!==fontVariant){this._fontVariant=fontVariant;this.styleID++;}}},{key:"fontWeight",get:function get(){return this._fontWeight;},set:function set(fontWeight){if(this._fontWeight!==fontWeight){this._fontWeight=fontWeight;this.styleID++;}}},{key:"letterSpacing",get:function get(){return this._letterSpacing;},set:function set(letterSpacing){if(this._letterSpacing!==letterSpacing){this._letterSpacing=letterSpacing;this.styleID++;}}},{key:"lineHeight",get:function get(){return this._lineHeight;},set:function set(lineHeight){if(this._lineHeight!==lineHeight){this._lineHeight=lineHeight;this.styleID++;}}},{key:"leading",get:function get(){return this._leading;},set:function set(leading){if(this._leading!==leading){this._leading=leading;this.styleID++;}}},{key:"lineJoin",get:function get(){return this._lineJoin;},set:function set(lineJoin){if(this._lineJoin!==lineJoin){this._lineJoin=lineJoin;this.styleID++;}}},{key:"miterLimit",get:function get(){return this._miterLimit;},set:function set(miterLimit){if(this._miterLimit!==miterLimit){this._miterLimit=miterLimit;this.styleID++;}}},{key:"padding",get:function get(){return this._padding;},set:function set(padding){if(this._padding!==padding){this._padding=padding;this.styleID++;}}},{key:"stroke",get:function get(){return this._stroke;},set:function set(stroke){var outputColor=getColor(stroke);if(this._stroke!==outputColor){this._stroke=outputColor;this.styleID++;}}},{key:"strokeThickness",get:function get(){return this._strokeThickness;},set:function set(strokeThickness){if(this._strokeThickness!==strokeThickness){this._strokeThickness=strokeThickness;this.styleID++;}}},{key:"textBaseline",get:function get(){return this._textBaseline;},set:function set(textBaseline){if(this._textBaseline!==textBaseline){this._textBaseline=textBaseline;this.styleID++;}}},{key:"trim",get:function get(){return this._trim;},set:function set(trim){if(this._trim!==trim){this._trim=trim;this.styleID++;}}},{key:"whiteSpace",get:function get(){return this._whiteSpace;},set:function set(whiteSpace){if(this._whiteSpace!==whiteSpace){this._whiteSpace=whiteSpace;this.styleID++;}}},{key:"wordWrap",get:function get(){return this._wordWrap;},set:function set(wordWrap){if(this._wordWrap!==wordWrap){this._wordWrap=wordWrap;this.styleID++;}}},{key:"wordWrapWidth",get:function get(){return this._wordWrapWidth;},set:function set(wordWrapWidth){if(this._wordWrapWidth!==wordWrapWidth){this._wordWrapWidth=wordWrapWidth;this.styleID++;}}},{key:"toFontString",value:function toFontString(){var fontSizeString=typeof this.fontSize==="number"?"".concat(this.fontSize,"px"):this.fontSize;var fontFamilies=this.fontFamily;if(!Array.isArray(this.fontFamily)){fontFamilies=this.fontFamily.split(",");}for(var i=fontFamilies.length-1;i>=0;i--){var fontFamily=fontFamilies[i].trim();if(!/([\"\'])[^\'\"]+\1/.test(fontFamily)&&!genericFontFamilies.includes(fontFamily)){fontFamily="\"".concat(fontFamily,"\"");}fontFamilies[i]=fontFamily;}return"".concat(this.fontStyle," ").concat(this.fontVariant," ").concat(this.fontWeight," ").concat(fontSizeString," ").concat(fontFamilies.join(","));}}]);}();var TextStyle=_TextStyle;TextStyle.defaultStyle={align:"left",breakWords:false,dropShadow:false,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:false,whiteSpace:"pre",wordWrap:false,wordWrapWidth:100};function getSingleColor(color){if(typeof color==="number"){return hex2string(color);}else if(typeof color==="string"){if(color.startsWith("0x")){color=color.replace("0x","#");}}return color;}function getColor(color){if(!Array.isArray(color)){return getSingleColor(color);}else{for(var i=0;i<color.length;++i){color[i]=getSingleColor(color[i]);}return color;}}function areArraysEqual(array1,array2){if(!Array.isArray(array1)||!Array.isArray(array2)){return false;}if(array1.length!==array2.length){return false;}for(var i=0;i<array1.length;++i){if(array1[i]!==array2[i]){return false;}}return true;}function deepCopyProperties(target,source,propertyObj){for(var prop in propertyObj){if(Array.isArray(source[prop])){target[prop]=source[prop].slice();}else{target[prop]=source[prop];}}}var defaultDestroyOptions={texture:true,children:false,baseTexture:true};var _Text=/*#__PURE__*/function(_Sprite){function _Text(text,style,canvas){var _Text$defaultResoluti;var _this93;_classCallCheck(this,_Text);var ownCanvas=false;if(!canvas){canvas=settings.ADAPTER.createCanvas();ownCanvas=true;}canvas.width=3;canvas.height=3;var texture=Texture.from(canvas);texture.orig=new Rectangle();texture.trim=new Rectangle();_this93=_callSuper(this,_Text,[texture]);_this93._ownCanvas=ownCanvas;_this93.canvas=canvas;_this93.context=canvas.getContext("2d",{willReadFrequently:true});_this93._resolution=(_Text$defaultResoluti=_Text.defaultResolution)!==null&&_Text$defaultResoluti!==void 0?_Text$defaultResoluti:settings.RESOLUTION;_this93._autoResolution=_Text.defaultAutoResolution;_this93._text=null;_this93._style=null;_this93._styleListener=null;_this93._font="";_this93.text=text;_this93.style=style;_this93.localStyleID=-1;return _this93;}_inherits(_Text,_Sprite);return _createClass(_Text,[{key:"updateText",value:function updateText(respectDirty){var style=this._style;if(this.localStyleID!==style.styleID){this.dirty=true;this.localStyleID=style.styleID;}if(!this.dirty&&respectDirty){return;}this._font=this._style.toFontString();var context=this.context;var measured=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas);var width=measured.width;var height=measured.height;var lines=measured.lines;var lineHeight=measured.lineHeight;var lineWidths=measured.lineWidths;var maxLineWidth=measured.maxLineWidth;var fontProperties=measured.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,width)+style.padding*2)*this._resolution);this.canvas.height=Math.ceil(Math.ceil(Math.max(1,height)+style.padding*2)*this._resolution);context.scale(this._resolution,this._resolution);context.clearRect(0,0,this.canvas.width,this.canvas.height);context.font=this._font;context.lineWidth=style.strokeThickness;context.textBaseline=style.textBaseline;context.lineJoin=style.lineJoin;context.miterLimit=style.miterLimit;var linePositionX;var linePositionY;var passesCount=style.dropShadow?2:1;for(var i=0;i<passesCount;++i){var isShadowPass=style.dropShadow&&i===0;var dsOffsetText=isShadowPass?Math.ceil(Math.max(1,height)+style.padding*2):0;var dsOffsetShadow=dsOffsetText*this._resolution;if(isShadowPass){context.fillStyle="black";context.strokeStyle="black";var dropShadowColor=style.dropShadowColor;var rgb=hex2rgb(typeof dropShadowColor==="number"?dropShadowColor:string2hex(dropShadowColor));var dropShadowBlur=style.dropShadowBlur*this._resolution;var dropShadowDistance=style.dropShadowDistance*this._resolution;context.shadowColor="rgba(".concat(rgb[0]*255,",").concat(rgb[1]*255,",").concat(rgb[2]*255,",").concat(style.dropShadowAlpha,")");context.shadowBlur=dropShadowBlur;context.shadowOffsetX=Math.cos(style.dropShadowAngle)*dropShadowDistance;context.shadowOffsetY=Math.sin(style.dropShadowAngle)*dropShadowDistance+dsOffsetShadow;}else{context.fillStyle=this._generateFillStyle(style,lines,measured);context.strokeStyle=style.stroke;context.shadowColor="black";context.shadowBlur=0;context.shadowOffsetX=0;context.shadowOffsetY=0;}var linePositionYShift=(lineHeight-fontProperties.fontSize)/2;if(lineHeight-fontProperties.fontSize<0){linePositionYShift=0;}for(var i2=0;i2<lines.length;i2++){linePositionX=style.strokeThickness/2;linePositionY=style.strokeThickness/2+i2*lineHeight+fontProperties.ascent+linePositionYShift;if(style.align==="right"){linePositionX+=maxLineWidth-lineWidths[i2];}else if(style.align==="center"){linePositionX+=(maxLineWidth-lineWidths[i2])/2;}if(style.stroke&&style.strokeThickness){this.drawLetterSpacing(lines[i2],linePositionX+style.padding,linePositionY+style.padding-dsOffsetText,true);}if(style.fill){this.drawLetterSpacing(lines[i2],linePositionX+style.padding,linePositionY+style.padding-dsOffsetText);}}}this.updateTexture();}},{key:"drawLetterSpacing",value:function drawLetterSpacing(text,x,y){var isStroke=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var style=this._style;var letterSpacing=style.letterSpacing;var useExperimentalLetterSpacing=false;if(TextMetrics.experimentalLetterSpacingSupported){if(TextMetrics.experimentalLetterSpacing){this.context.letterSpacing="".concat(letterSpacing,"px");this.context.textLetterSpacing="".concat(letterSpacing,"px");useExperimentalLetterSpacing=true;}else{this.context.letterSpacing="0px";this.context.textLetterSpacing="0px";}}if(letterSpacing===0||useExperimentalLetterSpacing){if(isStroke){this.context.strokeText(text,x,y);}else{this.context.fillText(text,x,y);}return;}var currentPosition=x;var stringArray=TextMetrics.graphemeSegmenter(text);var previousWidth=this.context.measureText(text).width;var currentWidth=0;for(var i=0;i<stringArray.length;++i){var currentChar=stringArray[i];if(isStroke){this.context.strokeText(currentChar,currentPosition,y);}else{this.context.fillText(currentChar,currentPosition,y);}var textStr="";for(var j=i+1;j<stringArray.length;++j){textStr+=stringArray[j];}currentWidth=this.context.measureText(textStr).width;currentPosition+=previousWidth-currentWidth+letterSpacing;previousWidth=currentWidth;}}},{key:"updateTexture",value:function updateTexture(){var canvas=this.canvas;if(this._style.trim){var trimmed=trimCanvas(canvas);if(trimmed.data){canvas.width=trimmed.width;canvas.height=trimmed.height;this.context.putImageData(trimmed.data,0,0);}}var texture=this._texture;var style=this._style;var padding=style.trim?0:style.padding;var baseTexture=texture.baseTexture;texture.trim.width=texture._frame.width=canvas.width/this._resolution;texture.trim.height=texture._frame.height=canvas.height/this._resolution;texture.trim.x=-padding;texture.trim.y=-padding;texture.orig.width=texture._frame.width-padding*2;texture.orig.height=texture._frame.height-padding*2;this._onTextureUpdate();baseTexture.setRealSize(canvas.width,canvas.height,this._resolution);texture.updateUvs();this.dirty=false;}},{key:"_render",value:function _render(renderer){if(this._autoResolution&&this._resolution!==renderer.resolution){this._resolution=renderer.resolution;this.dirty=true;}this.updateText(true);_get(_getPrototypeOf(_Text.prototype),"_render",this).call(this,renderer);}},{key:"updateTransform",value:function updateTransform(){this.updateText(true);_get(_getPrototypeOf(_Text.prototype),"updateTransform",this).call(this);}},{key:"getBounds",value:function getBounds(skipUpdate,rect){this.updateText(true);if(this._textureID===-1){skipUpdate=false;}return _get(_getPrototypeOf(_Text.prototype),"getBounds",this).call(this,skipUpdate,rect);}},{key:"getLocalBounds",value:function getLocalBounds(rect){this.updateText(true);return _get(_getPrototypeOf(_Text.prototype),"getLocalBounds",this).call(this,rect);}},{key:"_calculateBounds",value:function _calculateBounds(){this.calculateVertices();this._bounds.addQuad(this.vertexData);}},{key:"_generateFillStyle",value:function _generateFillStyle(style,lines,metrics){var fillStyle=style.fill;if(!Array.isArray(fillStyle)){return fillStyle;}else if(fillStyle.length===1){return fillStyle[0];}var gradient;var dropShadowCorrection=style.dropShadow?style.dropShadowDistance:0;var padding=style.padding||0;var width=this.canvas.width/this._resolution-dropShadowCorrection-padding*2;var height=this.canvas.height/this._resolution-dropShadowCorrection-padding*2;var fill=fillStyle.slice();var fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length){var lengthPlus1=fill.length+1;for(var i=1;i<lengthPlus1;++i){fillGradientStops.push(i/lengthPlus1);}}fill.unshift(fillStyle[0]);fillGradientStops.unshift(0);fill.push(fillStyle[fillStyle.length-1]);fillGradientStops.push(1);if(style.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){gradient=this.context.createLinearGradient(width/2,padding,width/2,height+padding);var textHeight=metrics.fontProperties.fontSize+style.strokeThickness;for(var _i39=0;_i39<lines.length;_i39++){var lastLineBottom=metrics.lineHeight*(_i39-1)+textHeight;var thisLineTop=metrics.lineHeight*_i39;var thisLineGradientStart=thisLineTop;if(_i39>0&&lastLineBottom>thisLineTop){thisLineGradientStart=(thisLineTop+lastLineBottom)/2;}var thisLineBottom=thisLineTop+textHeight;var nextLineTop=metrics.lineHeight*(_i39+1);var thisLineGradientEnd=thisLineBottom;if(_i39+1<lines.length&&nextLineTop<thisLineBottom){thisLineGradientEnd=(thisLineBottom+nextLineTop)/2;}var gradStopLineHeight=(thisLineGradientEnd-thisLineGradientStart)/height;for(var j=0;j<fill.length;j++){var lineStop=0;if(typeof fillGradientStops[j]==="number"){lineStop=fillGradientStops[j];}else{lineStop=j/fill.length;}var globalStop=Math.min(1,Math.max(0,thisLineGradientStart/height+lineStop*gradStopLineHeight));globalStop=Number(globalStop.toFixed(5));gradient.addColorStop(globalStop,fill[j]);}}}else{gradient=this.context.createLinearGradient(padding,height/2,width+padding,height/2);var totalIterations=fill.length+1;var currentIteration=1;for(var _i40=0;_i40<fill.length;_i40++){var stop=void 0;if(typeof fillGradientStops[_i40]==="number"){stop=fillGradientStops[_i40];}else{stop=currentIteration/totalIterations;}gradient.addColorStop(stop,fill[_i40]);currentIteration++;}}return gradient;}},{key:"destroy",value:function destroy(options){if(typeof options==="boolean"){options={children:options};}options=Object.assign({},defaultDestroyOptions,options);_get(_getPrototypeOf(_Text.prototype),"destroy",this).call(this,options);if(this._ownCanvas){this.canvas.height=this.canvas.width=0;}this.context=null;this.canvas=null;this._style=null;}},{key:"width",get:function get(){this.updateText(true);return Math.abs(this.scale.x)*this._texture.orig.width;},set:function set(value){this.updateText(true);var s=sign(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width;this._width=value;}},{key:"height",get:function get(){this.updateText(true);return Math.abs(this.scale.y)*this._texture.orig.height;},set:function set(value){this.updateText(true);var s=sign(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height;this._height=value;}},{key:"style",get:function get(){return this._style;},set:function set(style){style=style||{};if(style instanceof TextStyle){this._style=style;}else{this._style=new TextStyle(style);}this.localStyleID=-1;this.dirty=true;}},{key:"text",get:function get(){return this._text;},set:function set(text){text=String(text===null||text===void 0?"":text);if(this._text===text){return;}this._text=text;this.dirty=true;}},{key:"resolution",get:function get(){return this._resolution;},set:function set(value){this._autoResolution=false;if(this._resolution===value){return;}this._resolution=value;this.dirty=true;}}],[{key:"experimentalLetterSpacing",get:function get(){return TextMetrics.experimentalLetterSpacing;},set:function set(value){deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing");TextMetrics.experimentalLetterSpacing=value;}}]);}(Sprite);var Text=_Text;Text.defaultAutoResolution=true;var CountLimiter=/*#__PURE__*/function(){function CountLimiter(maxItemsPerFrame){_classCallCheck(this,CountLimiter);this.maxItemsPerFrame=maxItemsPerFrame;this.itemsLeft=0;}return _createClass(CountLimiter,[{key:"beginFrame",value:function beginFrame(){this.itemsLeft=this.maxItemsPerFrame;}},{key:"allowedToUpload",value:function allowedToUpload(){return this.itemsLeft-->0;}}]);}();function findMultipleBaseTextures(item,queue){var _item$_textures;var result=false;if(item!==null&&item!==void 0&&(_item$_textures=item._textures)!==null&&_item$_textures!==void 0&&_item$_textures.length){for(var i=0;i<item._textures.length;i++){if(item._textures[i]instanceof Texture){var baseTexture=item._textures[i].baseTexture;if(!queue.includes(baseTexture)){queue.push(baseTexture);result=true;}}}}return result;}function findBaseTexture(item,queue){if(item.baseTexture instanceof BaseTexture){var texture=item.baseTexture;if(!queue.includes(texture)){queue.push(texture);}return true;}return false;}function findTexture(item,queue){if(item._texture&&item._texture instanceof Texture){var texture=item._texture.baseTexture;if(!queue.includes(texture)){queue.push(texture);}return true;}return false;}function drawText(_helper,item){if(item instanceof Text){item.updateText(true);return true;}return false;}function calculateTextStyle(_helper,item){if(item instanceof TextStyle){var font=item.toFontString();TextMetrics.measureFont(font);return true;}return false;}function findText(item,queue){if(item instanceof Text){if(!queue.includes(item.style)){queue.push(item.style);}if(!queue.includes(item)){queue.push(item);}var texture=item._texture.baseTexture;if(!queue.includes(texture)){queue.push(texture);}return true;}return false;}function findTextStyle(item,queue){if(item instanceof TextStyle){if(!queue.includes(item)){queue.push(item);}return true;}return false;}var _BasePrepare=/*#__PURE__*/function(){function _BasePrepare(renderer){var _this94=this;_classCallCheck(this,_BasePrepare);this.limiter=new CountLimiter(_BasePrepare.uploadsPerFrame);this.renderer=renderer;this.uploadHookHelper=null;this.queue=[];this.addHooks=[];this.uploadHooks=[];this.completes=[];this.ticking=false;this.delayedTick=function(){if(!_this94.queue){return;}_this94.prepareItems();};this.registerFindHook(findText);this.registerFindHook(findTextStyle);this.registerFindHook(findMultipleBaseTextures);this.registerFindHook(findBaseTexture);this.registerFindHook(findTexture);this.registerUploadHook(drawText);this.registerUploadHook(calculateTextStyle);}return _createClass(_BasePrepare,[{key:"upload",value:function upload(item){var _this95=this;return new Promise(function(resolve){if(item){_this95.add(item);}if(_this95.queue.length){_this95.completes.push(resolve);if(!_this95.ticking){_this95.ticking=true;Ticker.system.addOnce(_this95.tick,_this95,UPDATE_PRIORITY.UTILITY);}}else{resolve();}});}},{key:"tick",value:function tick(){setTimeout(this.delayedTick,0);}},{key:"prepareItems",value:function prepareItems(){this.limiter.beginFrame();while(this.queue.length&&this.limiter.allowedToUpload()){var item=this.queue[0];var uploaded=false;if(item&&!item._destroyed){for(var i=0,len=this.uploadHooks.length;i<len;i++){if(this.uploadHooks[i](this.uploadHookHelper,item)){this.queue.shift();uploaded=true;break;}}}if(!uploaded){this.queue.shift();}}if(!this.queue.length){this.ticking=false;var completes=this.completes.slice(0);this.completes.length=0;for(var _i41=0,_len7=completes.length;_i41<_len7;_i41++){completes[_i41]();}}else{Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY);}}},{key:"registerFindHook",value:function registerFindHook(addHook){if(addHook){this.addHooks.push(addHook);}return this;}},{key:"registerUploadHook",value:function registerUploadHook(uploadHook){if(uploadHook){this.uploadHooks.push(uploadHook);}return this;}},{key:"add",value:function add(item){for(var i=0,len=this.addHooks.length;i<len;i++){if(this.addHooks[i](item,this.queue)){break;}}if(item instanceof Container){for(var _i42=item.children.length-1;_i42>=0;_i42--){this.add(item.children[_i42]);}}return this;}},{key:"destroy",value:function destroy(){if(this.ticking){Ticker.system.remove(this.tick,this);}this.ticking=false;this.addHooks=null;this.uploadHooks=null;this.renderer=null;this.completes=null;this.queue=null;this.limiter=null;this.uploadHookHelper=null;}}]);}();var BasePrepare=_BasePrepare;BasePrepare.uploadsPerFrame=4;Object.defineProperties(settings,{UPLOADS_PER_FRAME:{get:function get(){return BasePrepare.uploadsPerFrame;},set:function set(value){deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame");BasePrepare.uploadsPerFrame=value;}}});function uploadBaseTextures(renderer,item){if(item instanceof BaseTexture){if(!item._glTextures[renderer.CONTEXT_UID]){renderer.texture.bind(item);}return true;}return false;}function uploadGraphics(renderer,item){if(!(item instanceof Graphics)){return false;}var geometry=item.geometry;item.finishPoly();geometry.updateBatches();var batches=geometry.batches;for(var i=0;i<batches.length;i++){var texture=batches[i].style.texture;if(texture){uploadBaseTextures(renderer,texture.baseTexture);}}if(!geometry.batchable){renderer.geometry.bind(geometry,item._resolveDirectShader(renderer));}return true;}function findGraphics(item,queue){if(item instanceof Graphics){queue.push(item);return true;}return false;}var Prepare=/*#__PURE__*/function(_BasePrepare2){function Prepare(renderer){var _this96;_classCallCheck(this,Prepare);_this96=_callSuper(this,Prepare,[renderer]);_this96.uploadHookHelper=_this96.renderer;_this96.registerFindHook(findGraphics);_this96.registerUploadHook(uploadBaseTextures);_this96.registerUploadHook(uploadGraphics);return _this96;}_inherits(Prepare,_BasePrepare2);return _createClass(Prepare);}(BasePrepare);Prepare.extension={name:"prepare",type:ExtensionType.RendererSystem};extensions$1.add(Prepare);var TimeLimiter=/*#__PURE__*/function(){function TimeLimiter(maxMilliseconds){_classCallCheck(this,TimeLimiter);this.maxMilliseconds=maxMilliseconds;this.frameStart=0;}return _createClass(TimeLimiter,[{key:"beginFrame",value:function beginFrame(){this.frameStart=Date.now();}},{key:"allowedToUpload",value:function allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds;}}]);}();var AnimatedSprite=/*#__PURE__*/function(_Sprite2){function AnimatedSprite(textures){var _this97;var autoUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,AnimatedSprite);_this97=_callSuper(this,AnimatedSprite,[textures[0]instanceof Texture?textures[0]:textures[0].texture]);_this97._textures=null;_this97._durations=null;_this97._autoUpdate=autoUpdate;_this97._isConnectedToTicker=false;_this97.animationSpeed=1;_this97.loop=true;_this97.updateAnchor=false;_this97.onComplete=null;_this97.onFrameChange=null;_this97.onLoop=null;_this97._currentTime=0;_this97._playing=false;_this97._previousFrame=null;_this97.textures=textures;return _this97;}_inherits(AnimatedSprite,_Sprite2);return _createClass(AnimatedSprite,[{key:"stop",value:function stop(){if(!this._playing){return;}this._playing=false;if(this._autoUpdate&&this._isConnectedToTicker){Ticker.shared.remove(this.update,this);this._isConnectedToTicker=false;}}},{key:"play",value:function play(){if(this._playing){return;}this._playing=true;if(this._autoUpdate&&!this._isConnectedToTicker){Ticker.shared.add(this.update,this,UPDATE_PRIORITY.HIGH);this._isConnectedToTicker=true;}}},{key:"gotoAndStop",value:function gotoAndStop(frameNumber){this.stop();this.currentFrame=frameNumber;}},{key:"gotoAndPlay",value:function gotoAndPlay(frameNumber){this.currentFrame=frameNumber;this.play();}},{key:"update",value:function update(deltaTime){if(!this._playing){return;}var elapsed=this.animationSpeed*deltaTime;var previousFrame=this.currentFrame;if(this._durations!==null){var lag=this._currentTime%1*this._durations[this.currentFrame];lag+=elapsed/60*1e3;while(lag<0){this._currentTime--;lag+=this._durations[this.currentFrame];}var _sign=Math.sign(this.animationSpeed*deltaTime);this._currentTime=Math.floor(this._currentTime);while(lag>=this._durations[this.currentFrame]){lag-=this._durations[this.currentFrame]*_sign;this._currentTime+=_sign;}this._currentTime+=lag/this._durations[this.currentFrame];}else{this._currentTime+=elapsed;}if(this._currentTime<0&&!this.loop){this.gotoAndStop(0);if(this.onComplete){this.onComplete();}}else if(this._currentTime>=this._textures.length&&!this.loop){this.gotoAndStop(this._textures.length-1);if(this.onComplete){this.onComplete();}}else if(previousFrame!==this.currentFrame){if(this.loop&&this.onLoop){if(this.animationSpeed>0&&this.currentFrame<previousFrame||this.animationSpeed<0&&this.currentFrame>previousFrame){this.onLoop();}}this.updateTexture();}}},{key:"updateTexture",value:function updateTexture(){var currentFrame=this.currentFrame;if(this._previousFrame===currentFrame){return;}this._previousFrame=currentFrame;this._texture=this._textures[currentFrame];this._textureID=-1;this._textureTrimmedID=-1;this._cachedTint=16777215;this.uvs=this._texture._uvs.uvsFloat32;if(this.updateAnchor){this._anchor.copyFrom(this._texture.defaultAnchor);}if(this.onFrameChange){this.onFrameChange(this.currentFrame);}}},{key:"destroy",value:function destroy(options){this.stop();_get(_getPrototypeOf(AnimatedSprite.prototype),"destroy",this).call(this,options);this.onComplete=null;this.onFrameChange=null;this.onLoop=null;}},{key:"totalFrames",get:function get(){return this._textures.length;}},{key:"textures",get:function get(){return this._textures;},set:function set(value){if(value[0]instanceof Texture){this._textures=value;this._durations=null;}else{this._textures=[];this._durations=[];for(var i=0;i<value.length;i++){this._textures.push(value[i].texture);this._durations.push(value[i].time);}}this._previousFrame=null;this.gotoAndStop(0);this.updateTexture();}},{key:"currentFrame",get:function get(){var currentFrame=Math.floor(this._currentTime)%this._textures.length;if(currentFrame<0){currentFrame+=this._textures.length;}return currentFrame;},set:function set(value){if(value<0||value>this.totalFrames-1){throw new Error("[AnimatedSprite]: Invalid frame index value ".concat(value,", expected to be between 0 and totalFrames ").concat(this.totalFrames,"."));}var previousFrame=this.currentFrame;this._currentTime=value;if(previousFrame!==this.currentFrame){this.updateTexture();}}},{key:"playing",get:function get(){return this._playing;}},{key:"autoUpdate",get:function get(){return this._autoUpdate;},set:function set(value){if(value!==this._autoUpdate){this._autoUpdate=value;if(!this._autoUpdate&&this._isConnectedToTicker){Ticker.shared.remove(this.update,this);this._isConnectedToTicker=false;}else if(this._autoUpdate&&!this._isConnectedToTicker&&this._playing){Ticker.shared.add(this.update,this);this._isConnectedToTicker=true;}}}}],[{key:"fromFrames",value:function fromFrames(frames){var textures=[];for(var i=0;i<frames.length;++i){textures.push(Texture.from(frames[i]));}return new AnimatedSprite(textures);}},{key:"fromImages",value:function fromImages(images){var textures=[];for(var i=0;i<images.length;++i){textures.push(Texture.from(images[i]));}return new AnimatedSprite(textures);}}]);}(Sprite);var tempPoint=new Point();var TilingSprite=/*#__PURE__*/function(_Sprite3){function TilingSprite(texture){var _this98;var width=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100;var height=arguments.length>2&&arguments[2]!==undefined?arguments[2]:100;_classCallCheck(this,TilingSprite);_this98=_callSuper(this,TilingSprite,[texture]);_this98.tileTransform=new Transform();_this98._width=width;_this98._height=height;_this98.uvMatrix=_this98.texture.uvMatrix||new TextureMatrix(texture);_this98.pluginName="tilingSprite";_this98.uvRespectAnchor=false;return _this98;}_inherits(TilingSprite,_Sprite3);return _createClass(TilingSprite,[{key:"clampMargin",get:function get(){return this.uvMatrix.clampMargin;},set:function set(value){this.uvMatrix.clampMargin=value;this.uvMatrix.update(true);}},{key:"tileScale",get:function get(){return this.tileTransform.scale;},set:function set(value){this.tileTransform.scale.copyFrom(value);}},{key:"tilePosition",get:function get(){return this.tileTransform.position;},set:function set(value){this.tileTransform.position.copyFrom(value);}},{key:"_onTextureUpdate",value:function _onTextureUpdate(){if(this.uvMatrix){this.uvMatrix.texture=this._texture;}this._cachedTint=16777215;}},{key:"_render",value:function _render(renderer){var texture=this._texture;if(!texture||!texture.valid){return;}this.tileTransform.updateLocalTransform();this.uvMatrix.update();renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]);renderer.plugins[this.pluginName].render(this);}},{key:"_calculateBounds",value:function _calculateBounds(){var minX=this._width*-this._anchor._x;var minY=this._height*-this._anchor._y;var maxX=this._width*(1-this._anchor._x);var maxY=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,minX,minY,maxX,maxY);}},{key:"getLocalBounds",value:function getLocalBounds(rect){if(this.children.length===0){this._bounds.minX=this._width*-this._anchor._x;this._bounds.minY=this._height*-this._anchor._y;this._bounds.maxX=this._width*(1-this._anchor._x);this._bounds.maxY=this._height*(1-this._anchor._y);if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new Rectangle();}rect=this._localBoundsRect;}return this._bounds.getRectangle(rect);}return _get(_getPrototypeOf(TilingSprite.prototype),"getLocalBounds",this).call(this,rect);}},{key:"containsPoint",value:function containsPoint(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._width;var height=this._height;var x1=-width*this.anchor._x;if(tempPoint.x>=x1&&tempPoint.x<x1+width){var y1=-height*this.anchor._y;if(tempPoint.y>=y1&&tempPoint.y<y1+height){return true;}}return false;}},{key:"destroy",value:function destroy(options){_get(_getPrototypeOf(TilingSprite.prototype),"destroy",this).call(this,options);this.tileTransform=null;this.uvMatrix=null;}},{key:"width",get:function get(){return this._width;},set:function set(value){this._width=value;}},{key:"height",get:function get(){return this._height;},set:function set(value){this._height=value;}}],[{key:"from",value:function from(source,options){var texture=source instanceof Texture?source:Texture.from(source,options);return new TilingSprite(texture,options.width,options.height);}}]);}(Sprite);var gl2FragmentSrc="#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n";var gl2VertexSrc="#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";var gl1FragmentSrc="#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n";var gl1VertexSrc="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";var fragmentSimpleSrc="#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n";var tempMat=new Matrix();var TilingSpriteRenderer=/*#__PURE__*/function(_ObjectRenderer3){function TilingSpriteRenderer(renderer){var _this99;_classCallCheck(this,TilingSpriteRenderer);_this99=_callSuper(this,TilingSpriteRenderer,[renderer]);renderer.runners.contextChange.add(_this99);_this99.quad=new QuadUv();_this99.state=State.for2d();return _this99;}_inherits(TilingSpriteRenderer,_ObjectRenderer3);return _createClass(TilingSpriteRenderer,[{key:"contextChange",value:function contextChange(){var renderer=this.renderer;var uniforms={globals:renderer.globalUniforms};this.simpleShader=Shader.from(gl1VertexSrc,fragmentSimpleSrc,uniforms);this.shader=renderer.context.webGLVersion>1?Shader.from(gl2VertexSrc,gl2FragmentSrc,uniforms):Shader.from(gl1VertexSrc,gl1FragmentSrc,uniforms);}},{key:"render",value:function render(ts){var renderer=this.renderer;var quad=this.quad;var vertices=quad.vertices;vertices[0]=vertices[6]=ts._width*-ts.anchor.x;vertices[1]=vertices[3]=ts._height*-ts.anchor.y;vertices[2]=vertices[4]=ts._width*(1-ts.anchor.x);vertices[5]=vertices[7]=ts._height*(1-ts.anchor.y);var anchorX=ts.uvRespectAnchor?ts.anchor.x:0;var anchorY=ts.uvRespectAnchor?ts.anchor.y:0;vertices=quad.uvs;vertices[0]=vertices[6]=-anchorX;vertices[1]=vertices[3]=-anchorY;vertices[2]=vertices[4]=1-anchorX;vertices[5]=vertices[7]=1-anchorY;quad.invalidate();var tex=ts._texture;var baseTex=tex.baseTexture;var premultiplied=baseTex.alphaMode>0;var lt=ts.tileTransform.localTransform;var uv=ts.uvMatrix;var isSimple=baseTex.isPowerOfTwo&&tex.frame.width===baseTex.width&&tex.frame.height===baseTex.height;if(isSimple){if(!baseTex._glTextures[renderer.CONTEXT_UID]){if(baseTex.wrapMode===WRAP_MODES.CLAMP){baseTex.wrapMode=WRAP_MODES.REPEAT;}}else{isSimple=baseTex.wrapMode!==WRAP_MODES.CLAMP;}}var shader=isSimple?this.simpleShader:this.shader;var w=tex.width;var h=tex.height;var W=ts._width;var H=ts._height;tempMat.set(lt.a*w/W,lt.b*w/H,lt.c*h/W,lt.d*h/H,lt.tx/W,lt.ty/H);tempMat.invert();if(isSimple){tempMat.prepend(uv.mapCoord);}else{shader.uniforms.uMapCoord=uv.mapCoord.toArray(true);shader.uniforms.uClampFrame=uv.uClampFrame;shader.uniforms.uClampOffset=uv.uClampOffset;}shader.uniforms.uTransform=tempMat.toArray(true);shader.uniforms.uColor=premultiplyTintToRgba(ts.tint,ts.worldAlpha,shader.uniforms.uColor,premultiplied);shader.uniforms.translationMatrix=ts.transform.worldTransform.toArray(true);shader.uniforms.uSampler=tex;renderer.shader.bind(shader);renderer.geometry.bind(quad);this.state.blendMode=correctBlendMode(ts.blendMode,premultiplied);renderer.state.set(this.state);renderer.geometry.draw(this.renderer.gl.TRIANGLES,6,0);}}]);}(ObjectRenderer);TilingSpriteRenderer.extension={name:"tilingSprite",type:ExtensionType.RendererPlugin};extensions$1.add(TilingSpriteRenderer);var _Spritesheet=/*#__PURE__*/function(){function _Spritesheet(texture,data){var resolutionFilename=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;_classCallCheck(this,_Spritesheet);this.linkedSheets=[];this._texture=texture instanceof Texture?texture:null;this.baseTexture=texture instanceof BaseTexture?texture:this._texture.baseTexture;this.textures={};this.animations={};this.data=data;var resource=this.baseTexture.resource;this.resolution=this._updateResolution(resolutionFilename||(resource?resource.url:null));this._frames=this.data.frames;this._frameKeys=Object.keys(this._frames);this._batchIndex=0;this._callback=null;}return _createClass(_Spritesheet,[{key:"_updateResolution",value:function _updateResolution(){var resolutionFilename=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var scale=this.data.meta.scale;var resolution=getResolutionOfUrl(resolutionFilename,null);if(resolution===null){resolution=parseFloat(scale!==null&&scale!==void 0?scale:"1");}if(resolution!==1){this.baseTexture.setResolution(resolution);}return resolution;}},{key:"parse",value:function parse(){var _this100=this;return new Promise(function(resolve){_this100._callback=resolve;_this100._batchIndex=0;if(_this100._frameKeys.length<=_Spritesheet.BATCH_SIZE){_this100._processFrames(0);_this100._processAnimations();_this100._parseComplete();}else{_this100._nextBatch();}});}},{key:"_processFrames",value:function _processFrames(initialFrameIndex){var frameIndex=initialFrameIndex;var maxFrames=_Spritesheet.BATCH_SIZE;while(frameIndex-initialFrameIndex<maxFrames&&frameIndex<this._frameKeys.length){var i=this._frameKeys[frameIndex];var data=this._frames[i];var rect=data.frame;if(rect){var frame=null;var trim=null;var sourceSize=data.trimmed!==false&&data.sourceSize?data.sourceSize:data.frame;var orig=new Rectangle(0,0,Math.floor(sourceSize.w)/this.resolution,Math.floor(sourceSize.h)/this.resolution);if(data.rotated){frame=new Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.h)/this.resolution,Math.floor(rect.w)/this.resolution);}else{frame=new Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution);}if(data.trimmed!==false&&data.spriteSourceSize){trim=new Rectangle(Math.floor(data.spriteSourceSize.x)/this.resolution,Math.floor(data.spriteSourceSize.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution);}this.textures[i]=new Texture(this.baseTexture,frame,orig,trim,data.rotated?2:0,data.anchor);Texture.addToCache(this.textures[i],i);}frameIndex++;}}},{key:"_processAnimations",value:function _processAnimations(){var animations=this.data.animations||{};for(var animName in animations){this.animations[animName]=[];for(var i=0;i<animations[animName].length;i++){var frameName=animations[animName][i];this.animations[animName].push(this.textures[frameName]);}}}},{key:"_parseComplete",value:function _parseComplete(){var callback=this._callback;this._callback=null;this._batchIndex=0;callback.call(this,this.textures);}},{key:"_nextBatch",value:function _nextBatch(){var _this101=this;this._processFrames(this._batchIndex*_Spritesheet.BATCH_SIZE);this._batchIndex++;setTimeout(function(){if(_this101._batchIndex*_Spritesheet.BATCH_SIZE<_this101._frameKeys.length){_this101._nextBatch();}else{_this101._processAnimations();_this101._parseComplete();}},0);}},{key:"destroy",value:function destroy(){var destroyBase=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;for(var i in this.textures){this.textures[i].destroy();}this._frames=null;this._frameKeys=null;this.data=null;this.textures=null;if(destroyBase){var _this$_texture;(_this$_texture=this._texture)===null||_this$_texture===void 0||_this$_texture.destroy();this.baseTexture.destroy();}this._texture=null;this.baseTexture=null;this.linkedSheets=[];}}]);}();var Spritesheet=_Spritesheet;Spritesheet.BATCH_SIZE=1e3;var validImages=["jpg","png","jpeg","avif","webp"];function _getCacheableAssets(keys,asset,ignoreMultiPack){var out={};keys.forEach(function(key){out[key]=asset;});Object.keys(asset.textures).forEach(function(key){out[key]=asset.textures[key];});if(!ignoreMultiPack){var basePath=path.dirname(keys[0]);asset.linkedSheets.forEach(function(item,i){var out2=_getCacheableAssets(["".concat(basePath,"/").concat(asset.data.meta.related_multi_packs[i])],item,true);Object.assign(out,out2);});}return out;}var spritesheetAsset={extension:ExtensionType.Asset,cache:{test:function test(asset){return asset instanceof Spritesheet;},getCacheableAssets:function getCacheableAssets(keys,asset){return _getCacheableAssets(keys,asset,false);}},resolver:{test:function test(value){var tempURL=value.split("?")[0];var split=tempURL.split(".");var extension=split.pop();var format=split.pop();return extension==="json"&&validImages.includes(format);},parse:function parse(value){var _settings$RETINA_PREF8,_settings$RETINA_PREF9;var split=value.split(".");return{resolution:parseFloat((_settings$RETINA_PREF8=(_settings$RETINA_PREF9=settings.RETINA_PREFIX.exec(value))===null||_settings$RETINA_PREF9===void 0?void 0:_settings$RETINA_PREF9[1])!==null&&_settings$RETINA_PREF8!==void 0?_settings$RETINA_PREF8:"1"),format:split[split.length-2],src:value};}},loader:{extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Normal},testParse:function testParse(asset,options){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee42(){return _regeneratorRuntime().wrap(function _callee42$(_context46){while(1)switch(_context46.prev=_context46.next){case 0:return _context46.abrupt("return",path.extname(options.src).toLowerCase()===".json"&&!!asset.frames);case 1:case"end":return _context46.stop();}},_callee42);}))();},parse:function parse(asset,options,loader){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee43(){var _asset$meta;var basePath,imagePath,assets,texture,spritesheet,multiPacks,promises,_iterator6,_step6,_options$data4,item,itemUrl,res;return _regeneratorRuntime().wrap(function _callee43$(_context47){while(1)switch(_context47.prev=_context47.next){case 0:basePath=path.dirname(options.src);if(basePath&&basePath.lastIndexOf("/")!==basePath.length-1){basePath+="/";}imagePath=basePath+asset.meta.image;imagePath=copySearchParams(imagePath,options.src);_context47.next=6;return loader.load([imagePath]);case 6:assets=_context47.sent;texture=assets[imagePath];spritesheet=new Spritesheet(texture.baseTexture,asset,options.src);_context47.next=11;return spritesheet.parse();case 11:multiPacks=asset===null||asset===void 0||(_asset$meta=asset.meta)===null||_asset$meta===void 0?void 0:_asset$meta.related_multi_packs;if(!Array.isArray(multiPacks)){_context47.next=41;break;}promises=[];_iterator6=_createForOfIteratorHelper(multiPacks);_context47.prev=15;_iterator6.s();case 17:if((_step6=_iterator6.n()).done){_context47.next=28;break;}item=_step6.value;if(!(typeof item!=="string")){_context47.next=21;break;}return _context47.abrupt("continue",26);case 21:itemUrl=basePath+item;if(!((_options$data4=options.data)!==null&&_options$data4!==void 0&&_options$data4.ignoreMultiPack)){_context47.next=24;break;}return _context47.abrupt("continue",26);case 24:itemUrl=copySearchParams(itemUrl,options.src);promises.push(loader.load({src:itemUrl,data:{ignoreMultiPack:true}}));case 26:_context47.next=17;break;case 28:_context47.next=33;break;case 30:_context47.prev=30;_context47.t0=_context47["catch"](15);_iterator6.e(_context47.t0);case 33:_context47.prev=33;_iterator6.f();return _context47.finish(33);case 36:_context47.next=38;return Promise.all(promises);case 38:res=_context47.sent;spritesheet.linkedSheets=res;res.forEach(function(item){item.linkedSheets=[spritesheet].concat(spritesheet.linkedSheets.filter(function(sp){return sp!==item;}));});case 41:return _context47.abrupt("return",spritesheet);case 42:case"end":return _context47.stop();}},_callee43,null,[[15,30,33,36]]);}))();},unload:function unload(spritesheet){spritesheet.destroy(true);}}};extensions$1.add(spritesheetAsset);var BitmapFontData=/*#__PURE__*/_createClass(function BitmapFontData(){_classCallCheck(this,BitmapFontData);this.info=[];this.common=[];this.page=[];this.char=[];this.kerning=[];this.distanceField=[];});var TextFormat=/*#__PURE__*/function(){function TextFormat(){_classCallCheck(this,TextFormat);}return _createClass(TextFormat,null,[{key:"test",value:function test(data){return typeof data==="string"&&data.startsWith("info face=");}},{key:"parse",value:function parse(txt){var items=txt.match(/^[a-z]+\s+.+$/gm);var rawData={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(var i in items){var name=items[i].match(/^[a-z]+/gm)[0];var attributeList=items[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm);var itemData={};for(var i2 in attributeList){var split=attributeList[i2].split("=");var key=split[0];var strValue=split[1].replace(/"/gm,"");var floatValue=parseFloat(strValue);var value=isNaN(floatValue)?strValue:floatValue;itemData[key]=value;}rawData[name].push(itemData);}var font=new BitmapFontData();rawData.info.forEach(function(info){return font.info.push({face:info.face,size:parseInt(info.size,10)});});rawData.common.forEach(function(common){return font.common.push({lineHeight:parseInt(common.lineHeight,10)});});rawData.page.forEach(function(page){return font.page.push({id:parseInt(page.id,10),file:page.file});});rawData.char.forEach(function(char){return font.char.push({id:parseInt(char.id,10),page:parseInt(char.page,10),x:parseInt(char.x,10),y:parseInt(char.y,10),width:parseInt(char.width,10),height:parseInt(char.height,10),xoffset:parseInt(char.xoffset,10),yoffset:parseInt(char.yoffset,10),xadvance:parseInt(char.xadvance,10)});});rawData.kerning.forEach(function(kerning){return font.kerning.push({first:parseInt(kerning.first,10),second:parseInt(kerning.second,10),amount:parseInt(kerning.amount,10)});});rawData.distanceField.forEach(function(df){return font.distanceField.push({distanceRange:parseInt(df.distanceRange,10),fieldType:df.fieldType});});return font;}}]);}();var XMLFormat=/*#__PURE__*/function(){function XMLFormat(){_classCallCheck(this,XMLFormat);}return _createClass(XMLFormat,null,[{key:"test",value:function test(data){var xml=data;return"getElementsByTagName"in xml&&xml.getElementsByTagName("page").length&&xml.getElementsByTagName("info")[0].getAttribute("face")!==null;}},{key:"parse",value:function parse(xml){var data=new BitmapFontData();var info=xml.getElementsByTagName("info");var common=xml.getElementsByTagName("common");var page=xml.getElementsByTagName("page");var char=xml.getElementsByTagName("char");var kerning=xml.getElementsByTagName("kerning");var distanceField=xml.getElementsByTagName("distanceField");for(var i=0;i<info.length;i++){data.info.push({face:info[i].getAttribute("face"),size:parseInt(info[i].getAttribute("size"),10)});}for(var _i43=0;_i43<common.length;_i43++){data.common.push({lineHeight:parseInt(common[_i43].getAttribute("lineHeight"),10)});}for(var _i44=0;_i44<page.length;_i44++){data.page.push({id:parseInt(page[_i44].getAttribute("id"),10)||0,file:page[_i44].getAttribute("file")});}for(var _i45=0;_i45<char.length;_i45++){var letter=char[_i45];data.char.push({id:parseInt(letter.getAttribute("id"),10),page:parseInt(letter.getAttribute("page"),10)||0,x:parseInt(letter.getAttribute("x"),10),y:parseInt(letter.getAttribute("y"),10),width:parseInt(letter.getAttribute("width"),10),height:parseInt(letter.getAttribute("height"),10),xoffset:parseInt(letter.getAttribute("xoffset"),10),yoffset:parseInt(letter.getAttribute("yoffset"),10),xadvance:parseInt(letter.getAttribute("xadvance"),10)});}for(var _i46=0;_i46<kerning.length;_i46++){data.kerning.push({first:parseInt(kerning[_i46].getAttribute("first"),10),second:parseInt(kerning[_i46].getAttribute("second"),10),amount:parseInt(kerning[_i46].getAttribute("amount"),10)});}for(var _i47=0;_i47<distanceField.length;_i47++){data.distanceField.push({fieldType:distanceField[_i47].getAttribute("fieldType"),distanceRange:parseInt(distanceField[_i47].getAttribute("distanceRange"),10)});}return data;}}]);}();var XMLStringFormat=/*#__PURE__*/function(){function XMLStringFormat(){_classCallCheck(this,XMLStringFormat);}return _createClass(XMLStringFormat,null,[{key:"test",value:function test(data){if(typeof data==="string"&&data.includes("<font>")){return XMLFormat.test(settings.ADAPTER.parseXML(data));}return false;}},{key:"parse",value:function parse(xmlTxt){return XMLFormat.parse(settings.ADAPTER.parseXML(xmlTxt));}}]);}();var formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(data){for(var i=0;i<formats.length;i++){if(formats[i].test(data)){return formats[i];}}return null;}function generateFillStyle(canvas,context,style,resolution,lines,metrics){var fillStyle=style.fill;if(!Array.isArray(fillStyle)){return fillStyle;}else if(fillStyle.length===1){return fillStyle[0];}var gradient;var dropShadowCorrection=style.dropShadow?style.dropShadowDistance:0;var padding=style.padding||0;var width=canvas.width/resolution-dropShadowCorrection-padding*2;var height=canvas.height/resolution-dropShadowCorrection-padding*2;var fill=fillStyle.slice();var fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length){var lengthPlus1=fill.length+1;for(var i=1;i<lengthPlus1;++i){fillGradientStops.push(i/lengthPlus1);}}fill.unshift(fillStyle[0]);fillGradientStops.unshift(0);fill.push(fillStyle[fillStyle.length-1]);fillGradientStops.push(1);if(style.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){gradient=context.createLinearGradient(width/2,padding,width/2,height+padding);var lastIterationStop=0;var textHeight=metrics.fontProperties.fontSize+style.strokeThickness;var gradStopLineHeight=textHeight/height;for(var _i48=0;_i48<lines.length;_i48++){var thisLineTop=metrics.lineHeight*_i48;for(var j=0;j<fill.length;j++){var lineStop=0;if(typeof fillGradientStops[j]==="number"){lineStop=fillGradientStops[j];}else{lineStop=j/fill.length;}var globalStop=thisLineTop/height+lineStop*gradStopLineHeight;var clampedStop=Math.max(lastIterationStop,globalStop);clampedStop=Math.min(clampedStop,1);gradient.addColorStop(clampedStop,fill[j]);lastIterationStop=clampedStop;}}}else{gradient=context.createLinearGradient(padding,height/2,width+padding,height/2);var totalIterations=fill.length+1;var currentIteration=1;for(var _i49=0;_i49<fill.length;_i49++){var stop=void 0;if(typeof fillGradientStops[_i49]==="number"){stop=fillGradientStops[_i49];}else{stop=currentIteration/totalIterations;}gradient.addColorStop(stop,fill[_i49]);currentIteration++;}}return gradient;}function drawGlyph(canvas,context,metrics,x,y,resolution,style){var char=metrics.text;var fontProperties=metrics.fontProperties;context.translate(x,y);context.scale(resolution,resolution);var tx=style.strokeThickness/2;var ty=-(style.strokeThickness/2);context.font=style.toFontString();context.lineWidth=style.strokeThickness;context.textBaseline=style.textBaseline;context.lineJoin=style.lineJoin;context.miterLimit=style.miterLimit;context.fillStyle=generateFillStyle(canvas,context,style,resolution,[char],metrics);context.strokeStyle=style.stroke;if(style.dropShadow){var dropShadowColor=style.dropShadowColor;var rgb=hex2rgb(typeof dropShadowColor==="number"?dropShadowColor:string2hex(dropShadowColor));var dropShadowBlur=style.dropShadowBlur*resolution;var dropShadowDistance=style.dropShadowDistance*resolution;context.shadowColor="rgba(".concat(rgb[0]*255,",").concat(rgb[1]*255,",").concat(rgb[2]*255,",").concat(style.dropShadowAlpha,")");context.shadowBlur=dropShadowBlur;context.shadowOffsetX=Math.cos(style.dropShadowAngle)*dropShadowDistance;context.shadowOffsetY=Math.sin(style.dropShadowAngle)*dropShadowDistance;}else{context.shadowColor="black";context.shadowBlur=0;context.shadowOffsetX=0;context.shadowOffsetY=0;}if(style.stroke&&style.strokeThickness){context.strokeText(char,tx,ty+metrics.lineHeight-fontProperties.descent);}if(style.fill){context.fillText(char,tx,ty+metrics.lineHeight-fontProperties.descent);}context.setTransform(1,0,0,1,0,0);context.fillStyle="rgba(0, 0, 0, 0)";}function extractCharCode(str){return str.codePointAt?str.codePointAt(0):str.charCodeAt(0);}function splitTextToCharacters(text){return Array.from?Array.from(text):text.split("");}function resolveCharacters(chars){if(typeof chars==="string"){chars=[chars];}var result=[];for(var i=0,j=chars.length;i<j;i++){var item=chars[i];if(Array.isArray(item)){if(item.length!==2){throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got ".concat(item.length,"."));}var startCode=item[0].charCodeAt(0);var endCode=item[1].charCodeAt(0);if(endCode<startCode){throw new Error("[BitmapFont]: Invalid character range.");}for(var i2=startCode,j2=endCode;i2<=j2;i2++){result.push(String.fromCharCode(i2));}}else{result.push.apply(result,_toConsumableArray(splitTextToCharacters(item)));}}if(result.length===0){throw new Error("[BitmapFont]: Empty set when resolving characters.");}return result;}var _BitmapFont=/*#__PURE__*/function(){function _BitmapFont(data,textures,ownsTextures){var _distanceField$fieldT,_distanceField$fieldT2;_classCallCheck(this,_BitmapFont);var _data$info=_slicedToArray(data.info,1),info=_data$info[0];var _data$common=_slicedToArray(data.common,1),common=_data$common[0];var _data$page=_slicedToArray(data.page,1),page=_data$page[0];var _data$distanceField=_slicedToArray(data.distanceField,1),distanceField=_data$distanceField[0];var res=getResolutionOfUrl(page.file);var pageTextures={};this._ownsTextures=ownsTextures;this.font=info.face;this.size=info.size;this.lineHeight=common.lineHeight/res;this.chars={};this.pageTextures=pageTextures;for(var i=0;i<data.page.length;i++){var _data$page$i=data.page[i],id=_data$page$i.id,file=_data$page$i.file;pageTextures[id]=textures instanceof Array?textures[i]:textures[file];if(distanceField!==null&&distanceField!==void 0&&distanceField.fieldType&&distanceField.fieldType!=="none"){pageTextures[id].baseTexture.alphaMode=ALPHA_MODES.NO_PREMULTIPLIED_ALPHA;pageTextures[id].baseTexture.mipmap=MIPMAP_MODES.OFF;}}for(var _i50=0;_i50<data.char.length;_i50++){var _data$char$_i=data.char[_i50],_id=_data$char$_i.id,page2=_data$char$_i.page;var _data$char$_i2=data.char[_i50],x=_data$char$_i2.x,y=_data$char$_i2.y,width=_data$char$_i2.width,height=_data$char$_i2.height,xoffset=_data$char$_i2.xoffset,yoffset=_data$char$_i2.yoffset,xadvance=_data$char$_i2.xadvance;x/=res;y/=res;width/=res;height/=res;xoffset/=res;yoffset/=res;xadvance/=res;var rect=new Rectangle(x+pageTextures[page2].frame.x/res,y+pageTextures[page2].frame.y/res,width,height);this.chars[_id]={xOffset:xoffset,yOffset:yoffset,xAdvance:xadvance,kerning:{},texture:new Texture(pageTextures[page2].baseTexture,rect),page:page2};}for(var _i51=0;_i51<data.kerning.length;_i51++){var _data$kerning$_i=data.kerning[_i51],first=_data$kerning$_i.first,second=_data$kerning$_i.second,amount=_data$kerning$_i.amount;first/=res;second/=res;amount/=res;if(this.chars[second]){this.chars[second].kerning[first]=amount;}}this.distanceFieldRange=distanceField===null||distanceField===void 0?void 0:distanceField.distanceRange;this.distanceFieldType=(_distanceField$fieldT=distanceField===null||distanceField===void 0||(_distanceField$fieldT2=distanceField.fieldType)===null||_distanceField$fieldT2===void 0?void 0:_distanceField$fieldT2.toLowerCase())!==null&&_distanceField$fieldT!==void 0?_distanceField$fieldT:"none";}return _createClass(_BitmapFont,[{key:"destroy",value:function destroy(){for(var id in this.chars){this.chars[id].texture.destroy();this.chars[id].texture=null;}for(var _id2 in this.pageTextures){if(this._ownsTextures){this.pageTextures[_id2].destroy(true);}this.pageTextures[_id2]=null;}this.chars=null;this.pageTextures=null;}}],[{key:"install",value:function install(data,textures,ownsTextures){var fontData;if(data instanceof BitmapFontData){fontData=data;}else{var _format=autoDetectFormat(data);if(!_format){throw new Error("Unrecognized data format for font.");}fontData=_format.parse(data);}if(textures instanceof Texture){textures=[textures];}var font=new _BitmapFont(fontData,textures,ownsTextures);_BitmapFont.available[font.font]=font;return font;}},{key:"uninstall",value:function uninstall(name){var font=_BitmapFont.available[name];if(!font){throw new Error("No font found named '".concat(name,"'"));}font.destroy();delete _BitmapFont.available[name];}},{key:"from",value:function from(name,textStyle,options){if(!name){throw new Error("[BitmapFont] Property `name` is required.");}var _Object$assign=Object.assign({},_BitmapFont.defaultOptions,options),chars=_Object$assign.chars,padding=_Object$assign.padding,resolution=_Object$assign.resolution,textureWidth=_Object$assign.textureWidth,textureHeight=_Object$assign.textureHeight,baseOptions=_objectWithoutProperties(_Object$assign,_excluded2);var charsList=resolveCharacters(chars);var style=textStyle instanceof TextStyle?textStyle:new TextStyle(textStyle);var lineWidth=textureWidth;var fontData=new BitmapFontData();fontData.info[0]={face:style.fontFamily,size:style.fontSize};fontData.common[0]={lineHeight:style.fontSize};var positionX=0;var positionY=0;var canvas;var context;var baseTexture;var maxCharHeight=0;var textures=[];for(var i=0;i<charsList.length;i++){if(!canvas){canvas=settings.ADAPTER.createCanvas();canvas.width=textureWidth;canvas.height=textureHeight;context=canvas.getContext("2d");baseTexture=new BaseTexture(canvas,_objectSpread({resolution:resolution},baseOptions));textures.push(new Texture(baseTexture));fontData.page.push({id:textures.length-1,file:""});}var character=charsList[i];var metrics=TextMetrics.measureText(character,style,false,canvas);var width=metrics.width;var height=Math.ceil(metrics.height);var textureGlyphWidth=Math.ceil((style.fontStyle==="italic"?2:1)*width);if(positionY>=textureHeight-height*resolution){if(positionY===0){throw new Error("[BitmapFont] textureHeight ".concat(textureHeight,"px is too small (fontFamily: '").concat(style.fontFamily,"', fontSize: ").concat(style.fontSize,"px, char: '").concat(character,"')"));}--i;canvas=null;context=null;baseTexture=null;positionY=0;positionX=0;maxCharHeight=0;continue;}maxCharHeight=Math.max(height+metrics.fontProperties.descent,maxCharHeight);if(textureGlyphWidth*resolution+positionX>=lineWidth){if(positionX===0){throw new Error("[BitmapFont] textureWidth ".concat(textureWidth,"px is too small (fontFamily: '").concat(style.fontFamily,"', fontSize: ").concat(style.fontSize,"px, char: '").concat(character,"')"));}--i;positionY+=maxCharHeight*resolution;positionY=Math.ceil(positionY);positionX=0;maxCharHeight=0;continue;}drawGlyph(canvas,context,metrics,positionX,positionY,resolution,style);var id=extractCharCode(metrics.text);fontData.char.push({id:id,page:textures.length-1,x:positionX/resolution,y:positionY/resolution,width:textureGlyphWidth,height:height,xoffset:0,yoffset:0,xadvance:width-(style.dropShadow?style.dropShadowDistance:0)-(style.stroke?style.strokeThickness:0)});positionX+=(textureGlyphWidth+2*padding)*resolution;positionX=Math.ceil(positionX);}for(var _i52=0,len=charsList.length;_i52<len;_i52++){var first=charsList[_i52];for(var j=0;j<len;j++){var second=charsList[j];var c1=context.measureText(first).width;var c2=context.measureText(second).width;var _total=context.measureText(first+second).width;var amount=_total-(c1+c2);if(amount){fontData.kerning.push({first:extractCharCode(first),second:extractCharCode(second),amount:amount});}}}var font=new _BitmapFont(fontData,textures,true);if(_BitmapFont.available[name]!==void 0){_BitmapFont.uninstall(name);}_BitmapFont.available[name]=font;return font;}}]);}();var BitmapFont=_BitmapFont;BitmapFont.ALPHA=[["a","z"],["A","Z"]," "];BitmapFont.NUMERIC=[["0","9"]];BitmapFont.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];BitmapFont.ASCII=[[" ","~"]];BitmapFont.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:_BitmapFont.ALPHANUMERIC};BitmapFont.available={};var msdfFrag="// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r\n\r\n}\r\n";var msdfVert="// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n";var pageMeshDataDefaultPageMeshData=[];var pageMeshDataMSDFPageMeshData=[];var charRenderDataPool=[];var _BitmapText=/*#__PURE__*/function(_Container6){function _BitmapText(text){var _this102;var style=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,_BitmapText);_this102=_callSuper(this,_BitmapText);_this102._tint=16777215;var _Object$assign2=Object.assign({},_BitmapText.styleDefaults,style),align=_Object$assign2.align,tint=_Object$assign2.tint,maxWidth=_Object$assign2.maxWidth,letterSpacing=_Object$assign2.letterSpacing,fontName=_Object$assign2.fontName,fontSize=_Object$assign2.fontSize;if(!BitmapFont.available[fontName]){throw new Error("Missing BitmapFont \"".concat(fontName,"\""));}_this102._activePagesMeshData=[];_this102._textWidth=0;_this102._textHeight=0;_this102._align=align;_this102._tint=tint;_this102._font=void 0;_this102._fontName=fontName;_this102._fontSize=fontSize;_this102.text=text;_this102._maxWidth=maxWidth;_this102._maxLineHeight=0;_this102._letterSpacing=letterSpacing;_this102._anchor=new ObservablePoint(function(){_this102.dirty=true;},_this102,0,0);_this102._roundPixels=settings.ROUND_PIXELS;_this102.dirty=true;_this102._resolution=settings.RESOLUTION;_this102._autoResolution=true;_this102._textureCache={};return _this102;}_inherits(_BitmapText,_Container6);return _createClass(_BitmapText,[{key:"updateText",value:function updateText(){var data=BitmapFont.available[this._fontName];var fontSize=this.fontSize;var scale=fontSize/data.size;var pos=new Point();var chars=[];var lineWidths=[];var lineSpaces=[];var text=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ";var charsInput=splitTextToCharacters(text);var maxWidth=this._maxWidth*data.size/fontSize;var pageMeshDataPool=data.distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;var prevCharCode=null;var lastLineWidth=0;var maxLineWidth=0;var line=0;var lastBreakPos=-1;var lastBreakWidth=0;var spacesRemoved=0;var maxLineHeight=0;var spaceCount=0;for(var i=0;i<charsInput.length;i++){var char=charsInput[i];var charCode=extractCharCode(char);if(/(?:\s)/.test(char)){lastBreakPos=i;lastBreakWidth=lastLineWidth;spaceCount++;}if(char==="\r"||char==="\n"){lineWidths.push(lastLineWidth);lineSpaces.push(-1);maxLineWidth=Math.max(maxLineWidth,lastLineWidth);++line;++spacesRemoved;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null;spaceCount=0;continue;}var charData=data.chars[charCode];if(!charData){continue;}if(prevCharCode&&charData.kerning[prevCharCode]){pos.x+=charData.kerning[prevCharCode];}var charRenderData=charRenderDataPool.pop()||{texture:Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Point()};charRenderData.texture=charData.texture;charRenderData.line=line;charRenderData.charCode=charCode;charRenderData.position.x=Math.round(pos.x+charData.xOffset+this._letterSpacing/2);charRenderData.position.y=Math.round(pos.y+charData.yOffset);charRenderData.prevSpaces=spaceCount;chars.push(charRenderData);lastLineWidth=charRenderData.position.x+Math.max(charData.xAdvance-charData.xOffset,charData.texture.orig.width);pos.x+=charData.xAdvance+this._letterSpacing;maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height);prevCharCode=charCode;if(lastBreakPos!==-1&&maxWidth>0&&pos.x>maxWidth){++spacesRemoved;removeItems(chars,1+lastBreakPos-spacesRemoved,1+i-lastBreakPos);i=lastBreakPos;lastBreakPos=-1;lineWidths.push(lastBreakWidth);lineSpaces.push(chars.length>0?chars[chars.length-1].prevSpaces:0);maxLineWidth=Math.max(maxLineWidth,lastBreakWidth);line++;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null;spaceCount=0;}}var lastChar=charsInput[charsInput.length-1];if(lastChar!=="\r"&&lastChar!=="\n"){if(/(?:\s)/.test(lastChar)){lastLineWidth=lastBreakWidth;}lineWidths.push(lastLineWidth);maxLineWidth=Math.max(maxLineWidth,lastLineWidth);lineSpaces.push(-1);}var lineAlignOffsets=[];for(var _i53=0;_i53<=line;_i53++){var alignOffset=0;if(this._align==="right"){alignOffset=maxLineWidth-lineWidths[_i53];}else if(this._align==="center"){alignOffset=(maxLineWidth-lineWidths[_i53])/2;}else if(this._align==="justify"){alignOffset=lineSpaces[_i53]<0?0:(maxLineWidth-lineWidths[_i53])/lineSpaces[_i53];}lineAlignOffsets.push(alignOffset);}var lenChars=chars.length;var pagesMeshData={};var newPagesMeshData=[];var activePagesMeshData=this._activePagesMeshData;pageMeshDataPool.push.apply(pageMeshDataPool,_toConsumableArray(activePagesMeshData));for(var _i54=0;_i54<lenChars;_i54++){var texture=chars[_i54].texture;var baseTextureUid=texture.baseTexture.uid;if(!pagesMeshData[baseTextureUid]){var pageMeshData=pageMeshDataPool.pop();if(!pageMeshData){var _geometry=new MeshGeometry();var material=void 0;var meshBlendMode=void 0;if(data.distanceFieldType==="none"){material=new MeshMaterial(Texture.EMPTY);meshBlendMode=BLEND_MODES.NORMAL;}else{material=new MeshMaterial(Texture.EMPTY,{program:Program.from(msdfVert,msdfFrag),uniforms:{uFWidth:0}});meshBlendMode=BLEND_MODES.NORMAL_NPM;}var mesh=new Mesh(_geometry,material);mesh.blendMode=meshBlendMode;pageMeshData={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:mesh,vertices:null,uvs:null,indices:null};}pageMeshData.index=0;pageMeshData.indexCount=0;pageMeshData.vertexCount=0;pageMeshData.uvsCount=0;pageMeshData.total=0;var _textureCache=this._textureCache;_textureCache[baseTextureUid]=_textureCache[baseTextureUid]||new Texture(texture.baseTexture);pageMeshData.mesh.texture=_textureCache[baseTextureUid];pageMeshData.mesh.tint=this._tint;newPagesMeshData.push(pageMeshData);pagesMeshData[baseTextureUid]=pageMeshData;}pagesMeshData[baseTextureUid].total++;}for(var _i55=0;_i55<activePagesMeshData.length;_i55++){if(!newPagesMeshData.includes(activePagesMeshData[_i55])){this.removeChild(activePagesMeshData[_i55].mesh);}}for(var _i56=0;_i56<newPagesMeshData.length;_i56++){if(newPagesMeshData[_i56].mesh.parent!==this){this.addChild(newPagesMeshData[_i56].mesh);}}this._activePagesMeshData=newPagesMeshData;for(var _i57 in pagesMeshData){var _pageMeshData$indices;var _pageMeshData=pagesMeshData[_i57];var _total2=_pageMeshData.total;if(!(((_pageMeshData$indices=_pageMeshData.indices)===null||_pageMeshData$indices===void 0?void 0:_pageMeshData$indices.length)>6*_total2)||_pageMeshData.vertices.length<Mesh.BATCHABLE_SIZE*2){_pageMeshData.vertices=new Float32Array(4*2*_total2);_pageMeshData.uvs=new Float32Array(4*2*_total2);_pageMeshData.indices=new Uint16Array(6*_total2);}else{var total2=_pageMeshData.total;var vertices=_pageMeshData.vertices;for(var i2=total2*4*2;i2<vertices.length;i2++){vertices[i2]=0;}}_pageMeshData.mesh.size=6*_total2;}for(var _i58=0;_i58<lenChars;_i58++){var _char2=chars[_i58];var offset=_char2.position.x+lineAlignOffsets[_char2.line]*(this._align==="justify"?_char2.prevSpaces:1);if(this._roundPixels){offset=Math.round(offset);}var xPos=offset*scale;var yPos=_char2.position.y*scale;var _texture4=_char2.texture;var pageMesh=pagesMeshData[_texture4.baseTexture.uid];var textureFrame=_texture4.frame;var textureUvs=_texture4._uvs;var _index13=pageMesh.index++;pageMesh.indices[_index13*6+0]=0+_index13*4;pageMesh.indices[_index13*6+1]=1+_index13*4;pageMesh.indices[_index13*6+2]=2+_index13*4;pageMesh.indices[_index13*6+3]=0+_index13*4;pageMesh.indices[_index13*6+4]=2+_index13*4;pageMesh.indices[_index13*6+5]=3+_index13*4;pageMesh.vertices[_index13*8+0]=xPos;pageMesh.vertices[_index13*8+1]=yPos;pageMesh.vertices[_index13*8+2]=xPos+textureFrame.width*scale;pageMesh.vertices[_index13*8+3]=yPos;pageMesh.vertices[_index13*8+4]=xPos+textureFrame.width*scale;pageMesh.vertices[_index13*8+5]=yPos+textureFrame.height*scale;pageMesh.vertices[_index13*8+6]=xPos;pageMesh.vertices[_index13*8+7]=yPos+textureFrame.height*scale;pageMesh.uvs[_index13*8+0]=textureUvs.x0;pageMesh.uvs[_index13*8+1]=textureUvs.y0;pageMesh.uvs[_index13*8+2]=textureUvs.x1;pageMesh.uvs[_index13*8+3]=textureUvs.y1;pageMesh.uvs[_index13*8+4]=textureUvs.x2;pageMesh.uvs[_index13*8+5]=textureUvs.y2;pageMesh.uvs[_index13*8+6]=textureUvs.x3;pageMesh.uvs[_index13*8+7]=textureUvs.y3;}this._textWidth=maxLineWidth*scale;this._textHeight=(pos.y+data.lineHeight)*scale;for(var _i59 in pagesMeshData){var _pageMeshData2=pagesMeshData[_i59];if(this.anchor.x!==0||this.anchor.y!==0){var vertexCount=0;var anchorOffsetX=this._textWidth*this.anchor.x;var anchorOffsetY=this._textHeight*this.anchor.y;for(var _i60=0;_i60<_pageMeshData2.total;_i60++){_pageMeshData2.vertices[vertexCount++]-=anchorOffsetX;_pageMeshData2.vertices[vertexCount++]-=anchorOffsetY;_pageMeshData2.vertices[vertexCount++]-=anchorOffsetX;_pageMeshData2.vertices[vertexCount++]-=anchorOffsetY;_pageMeshData2.vertices[vertexCount++]-=anchorOffsetX;_pageMeshData2.vertices[vertexCount++]-=anchorOffsetY;_pageMeshData2.vertices[vertexCount++]-=anchorOffsetX;_pageMeshData2.vertices[vertexCount++]-=anchorOffsetY;}}this._maxLineHeight=maxLineHeight*scale;var vertexBuffer=_pageMeshData2.mesh.geometry.getBuffer("aVertexPosition");var textureBuffer=_pageMeshData2.mesh.geometry.getBuffer("aTextureCoord");var indexBuffer=_pageMeshData2.mesh.geometry.getIndex();vertexBuffer.data=_pageMeshData2.vertices;textureBuffer.data=_pageMeshData2.uvs;indexBuffer.data=_pageMeshData2.indices;vertexBuffer.update();textureBuffer.update();indexBuffer.update();}for(var _i61=0;_i61<chars.length;_i61++){charRenderDataPool.push(chars[_i61]);}this._font=data;this.dirty=false;}},{key:"updateTransform",value:function updateTransform(){this.validate();this.containerUpdateTransform();}},{key:"_render",value:function _render(renderer){if(this._autoResolution&&this._resolution!==renderer.resolution){this._resolution=renderer.resolution;this.dirty=true;}var _BitmapFont$available=BitmapFont.available[this._fontName],distanceFieldRange=_BitmapFont$available.distanceFieldRange,distanceFieldType=_BitmapFont$available.distanceFieldType,size=_BitmapFont$available.size;if(distanceFieldType!=="none"){var _this$worldTransform=this.worldTransform,a=_this$worldTransform.a,b=_this$worldTransform.b,c=_this$worldTransform.c,d=_this$worldTransform.d;var dx=Math.sqrt(a*a+b*b);var dy=Math.sqrt(c*c+d*d);var worldScale=(Math.abs(dx)+Math.abs(dy))/2;var fontScale=this.fontSize/size;var resolution=renderer._view.resolution;var _iterator7=_createForOfIteratorHelper(this._activePagesMeshData),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var mesh=_step7.value;mesh.mesh.shader.uniforms.uFWidth=worldScale*distanceFieldRange*fontScale*resolution;}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}}_get(_getPrototypeOf(_BitmapText.prototype),"_render",this).call(this,renderer);}},{key:"getLocalBounds",value:function getLocalBounds(){this.validate();return _get(_getPrototypeOf(_BitmapText.prototype),"getLocalBounds",this).call(this);}},{key:"validate",value:function validate(){var font=BitmapFont.available[this._fontName];if(!font){throw new Error("Missing BitmapFont \"".concat(this._fontName,"\""));}if(this._font!==font){this.dirty=true;}if(this.dirty){this.updateText();}}},{key:"tint",get:function get(){return this._tint;},set:function set(value){if(this._tint===value)return;this._tint=value;for(var i=0;i<this._activePagesMeshData.length;i++){this._activePagesMeshData[i].mesh.tint=value;}}},{key:"align",get:function get(){return this._align;},set:function set(value){if(this._align!==value){this._align=value;this.dirty=true;}}},{key:"fontName",get:function get(){return this._fontName;},set:function set(value){if(!BitmapFont.available[value]){throw new Error("Missing BitmapFont \"".concat(value,"\""));}if(this._fontName!==value){this._fontName=value;this.dirty=true;}}},{key:"fontSize",get:function get(){var _this$_fontSize;return(_this$_fontSize=this._fontSize)!==null&&_this$_fontSize!==void 0?_this$_fontSize:BitmapFont.available[this._fontName].size;},set:function set(value){if(this._fontSize!==value){this._fontSize=value;this.dirty=true;}}},{key:"anchor",get:function get(){return this._anchor;},set:function set(value){if(typeof value==="number"){this._anchor.set(value);}else{this._anchor.copyFrom(value);}}},{key:"text",get:function get(){return this._text;},set:function set(text){text=String(text===null||text===void 0?"":text);if(this._text===text){return;}this._text=text;this.dirty=true;}},{key:"maxWidth",get:function get(){return this._maxWidth;},set:function set(value){if(this._maxWidth===value){return;}this._maxWidth=value;this.dirty=true;}},{key:"maxLineHeight",get:function get(){this.validate();return this._maxLineHeight;}},{key:"textWidth",get:function get(){this.validate();return this._textWidth;}},{key:"letterSpacing",get:function get(){return this._letterSpacing;},set:function set(value){if(this._letterSpacing!==value){this._letterSpacing=value;this.dirty=true;}}},{key:"roundPixels",get:function get(){return this._roundPixels;},set:function set(value){if(value!==this._roundPixels){this._roundPixels=value;this.dirty=true;}}},{key:"textHeight",get:function get(){this.validate();return this._textHeight;}},{key:"resolution",get:function get(){return this._resolution;},set:function set(value){this._autoResolution=false;if(this._resolution===value){return;}this._resolution=value;this.dirty=true;}},{key:"destroy",value:function destroy(options){var _textureCache=this._textureCache;var data=BitmapFont.available[this._fontName];var pageMeshDataPool=data.distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;pageMeshDataPool.push.apply(pageMeshDataPool,_toConsumableArray(this._activePagesMeshData));var _iterator8=_createForOfIteratorHelper(this._activePagesMeshData),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var pageMeshData=_step8.value;this.removeChild(pageMeshData.mesh);}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}this._activePagesMeshData=[];pageMeshDataPool.filter(function(page){return _textureCache[page.mesh.texture.baseTexture.uid];}).forEach(function(page){page.mesh.texture=Texture.EMPTY;});for(var id in _textureCache){var texture=_textureCache[id];texture.destroy();delete _textureCache[id];}this._font=null;this._textureCache=null;_get(_getPrototypeOf(_BitmapText.prototype),"destroy",this).call(this,options);}}]);}(Container);var BitmapText=_BitmapText;BitmapText.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};var validExtensions=[".xml",".fnt"];var loadBitmapFont={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Normal},test:function test(url){return validExtensions.includes(path.extname(url).toLowerCase());},testParse:function testParse(data){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee44(){return _regeneratorRuntime().wrap(function _callee44$(_context48){while(1)switch(_context48.prev=_context48.next){case 0:return _context48.abrupt("return",TextFormat.test(data)||XMLStringFormat.test(data));case 1:case"end":return _context48.stop();}},_callee44);}))();},parse:function parse(asset,data,loader){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee45(){var fontData,src,pages,textureUrls,i,pageFile,imagePath,loadedTextures,textures;return _regeneratorRuntime().wrap(function _callee45$(_context49){while(1)switch(_context49.prev=_context49.next){case 0:fontData=TextFormat.test(asset)?TextFormat.parse(asset):XMLStringFormat.parse(asset);src=data.src;pages=fontData.page;textureUrls=[];for(i=0;i<pages.length;++i){pageFile=pages[i].file;imagePath=path.join(path.dirname(src),pageFile);imagePath=copySearchParams(imagePath,src);textureUrls.push(imagePath);}_context49.next=7;return loader.load(textureUrls);case 7:loadedTextures=_context49.sent;textures=textureUrls.map(function(url){return loadedTextures[url];});return _context49.abrupt("return",BitmapFont.install(fontData,textures,true));case 10:case"end":return _context49.stop();}},_callee45);}))();},load:function load(url,_options){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee46(){var response;return _regeneratorRuntime().wrap(function _callee46$(_context50){while(1)switch(_context50.prev=_context50.next){case 0:_context50.next=2;return settings.ADAPTER.fetch(url);case 2:response=_context50.sent;return _context50.abrupt("return",response.text());case 4:case"end":return _context50.stop();}},_callee46);}))();},unload:function unload(bitmapFont){bitmapFont.destroy();}};extensions$1.add(loadBitmapFont);var PIXI=/*#__PURE__*/Object.freeze({__proto__:null,ALPHA_MODES:ALPHA_MODES,AbstractMultiResource:AbstractMultiResource,AccessibilityManager:AccessibilityManager,AlphaFilter:AlphaFilter,AnimatedSprite:AnimatedSprite,Application:Application,ArrayResource:ArrayResource,Assets:Assets,AssetsClass:AssetsClass,Attribute:Attribute,BLEND_MODES:BLEND_MODES,BUFFER_BITS:BUFFER_BITS,BUFFER_TYPE:BUFFER_TYPE,BackgroundSystem:BackgroundSystem,BaseImageResource:BaseImageResource,BasePrepare:BasePrepare,BaseRenderTexture:BaseRenderTexture,BaseTexture:BaseTexture,BatchDrawCall:BatchDrawCall,BatchGeometry:BatchGeometry,BatchRenderer:BatchRenderer,BatchShaderGenerator:BatchShaderGenerator,BatchSystem:BatchSystem,BatchTextureArray:BatchTextureArray,BitmapFont:BitmapFont,BitmapFontData:BitmapFontData,BitmapText:BitmapText,BlobResource:BlobResource,BlurFilter:BlurFilter,BlurFilterPass:BlurFilterPass,Bounds:Bounds,BrowserAdapter:BrowserAdapter,Buffer:Buffer,BufferResource:BufferResource,BufferSystem:BufferSystem,CLEAR_MODES:CLEAR_MODES,COLOR_MASK_BITS:COLOR_MASK_BITS,Cache:Cache,CanvasResource:CanvasResource,Circle:Circle,ColorMatrixFilter:ColorMatrixFilter,CompressedTextureResource:CompressedTextureResource,Container:Container,ContextSystem:ContextSystem,CountLimiter:CountLimiter,CubeResource:CubeResource,DEG_TO_RAD:DEG_TO_RAD,DRAW_MODES:DRAW_MODES,DisplacementFilter:DisplacementFilter,DisplayObject:DisplayObject,ENV:ENV,Ellipse:Ellipse,EventBoundary:EventBoundary,EventSystem:EventSystem,ExtensionType:ExtensionType,Extract:Extract,FORMATS:FORMATS,FORMATS_TO_COMPONENTS:FORMATS_TO_COMPONENTS,FXAAFilter:FXAAFilter,FederatedDisplayObject:FederatedDisplayObject,FederatedEvent:FederatedEvent,FederatedMouseEvent:FederatedMouseEvent,FederatedPointerEvent:FederatedPointerEvent,FederatedWheelEvent:FederatedWheelEvent,FillStyle:FillStyle,Filter:Filter,FilterState:FilterState,FilterSystem:FilterSystem,Framebuffer:Framebuffer,FramebufferSystem:FramebufferSystem,GC_MODES:GC_MODES,GLFramebuffer:GLFramebuffer,GLProgram:GLProgram,GLTexture:GLTexture,GRAPHICS_CURVES:GRAPHICS_CURVES,GenerateTextureSystem:GenerateTextureSystem,Geometry:Geometry,GeometrySystem:GeometrySystem,Graphics:Graphics,GraphicsData:GraphicsData,GraphicsGeometry:GraphicsGeometry,IGLUniformData:IGLUniformData,INSTALLED:INSTALLED,INTERNAL_FORMATS:INTERNAL_FORMATS,INTERNAL_FORMAT_TO_BYTES_PER_PIXEL:INTERNAL_FORMAT_TO_BYTES_PER_PIXEL,ImageBitmapResource:ImageBitmapResource,ImageResource:ImageResource,LINE_CAP:LINE_CAP,LINE_JOIN:LINE_JOIN,LineStyle:LineStyle,LoaderParserPriority:LoaderParserPriority,MASK_TYPES:MASK_TYPES,MIPMAP_MODES:MIPMAP_MODES,MSAA_QUALITY:MSAA_QUALITY,MaskData:MaskData,MaskSystem:MaskSystem,Matrix:Matrix,Mesh:Mesh,MeshBatchUvs:MeshBatchUvs,MeshGeometry:MeshGeometry,MeshMaterial:MeshMaterial,MultisampleSystem:MultisampleSystem,NineSlicePlane:NineSlicePlane,NoiseFilter:NoiseFilter,ObjectRenderer:ObjectRenderer,ObjectRendererSystem:ObjectRendererSystem,ObservablePoint:ObservablePoint,PI_2:PI_2,PRECISION:PRECISION,ParticleContainer:ParticleContainer,ParticleRenderer:ParticleRenderer,PlaneGeometry:PlaneGeometry,PluginSystem:PluginSystem,Point:Point,Polygon:Polygon,Prepare:Prepare,Program:Program,ProjectionSystem:ProjectionSystem,Quad:Quad,QuadUv:QuadUv,RAD_TO_DEG:RAD_TO_DEG,RENDERER_TYPE:RENDERER_TYPE,Rectangle:Rectangle,RenderTexture:RenderTexture,RenderTexturePool:RenderTexturePool,RenderTextureSystem:RenderTextureSystem,Renderer:Renderer,ResizePlugin:ResizePlugin,Resource:Resource,RopeGeometry:RopeGeometry,RoundedRectangle:RoundedRectangle,Runner:Runner,SAMPLER_TYPES:SAMPLER_TYPES,SCALE_MODES:SCALE_MODES,SHAPES:SHAPES,SVGResource:SVGResource,ScissorSystem:ScissorSystem,Shader:Shader,ShaderSystem:ShaderSystem,SimpleMesh:SimpleMesh,SimplePlane:SimplePlane,SimpleRope:SimpleRope,Sprite:Sprite,SpriteMaskFilter:SpriteMaskFilter,Spritesheet:Spritesheet,StartupSystem:StartupSystem,State:State,StateSystem:StateSystem,StencilSystem:StencilSystem,SystemManager:SystemManager,TARGETS:TARGETS,TEXT_GRADIENT:TEXT_GRADIENT,TYPES:TYPES,TYPES_TO_BYTES_PER_COMPONENT:TYPES_TO_BYTES_PER_COMPONENT,TYPES_TO_BYTES_PER_PIXEL:TYPES_TO_BYTES_PER_PIXEL,TemporaryDisplayObject:TemporaryDisplayObject,Text:Text,TextFormat:TextFormat,TextMetrics:TextMetrics,TextStyle:TextStyle,Texture:Texture,TextureGCSystem:TextureGCSystem,TextureMatrix:TextureMatrix,TextureSystem:TextureSystem,TextureUvs:TextureUvs,Ticker:Ticker,TickerPlugin:TickerPlugin,TilingSprite:TilingSprite,TilingSpriteRenderer:TilingSpriteRenderer,TimeLimiter:TimeLimiter,Transform:Transform,TransformFeedback:TransformFeedback,TransformFeedbackSystem:TransformFeedbackSystem,UPDATE_PRIORITY:UPDATE_PRIORITY,UniformGroup:UniformGroup,VERSION:VERSION,VideoResource:VideoResource,ViewSystem:ViewSystem,ViewableBuffer:ViewableBuffer,WRAP_MODES:WRAP_MODES,XMLFormat:XMLFormat,XMLStringFormat:XMLStringFormat,accessibleTarget:accessibleTarget,autoDetectFormat:autoDetectFormat,autoDetectRenderer:autoDetectRenderer,autoDetectResource:autoDetectResource,cacheTextureArray:cacheTextureArray,checkDataUrl:checkDataUrl,checkExtension:checkExtension,checkMaxIfStatementsInShader:checkMaxIfStatementsInShader,convertToList:convertToList,copySearchParams:copySearchParams,createStringVariations:createStringVariations,createTexture:createTexture,createUBOElements:createUBOElements,curves:curves,defaultFilterVertex:defaultFilterVertex,defaultVertex:defaultVertex,detectAvif:detectAvif,detectCompressedTextures:detectCompressedTextures,detectDefaults:detectDefaults,detectWebp:detectWebp,extensions:extensions$1,filters:filters,generateProgram:_generateProgram,generateUniformBufferSync:generateUniformBufferSync,getFontFamilyName:getFontFamilyName,getTestContext:getTestContext,getUBOData:getUBOData,graphicsUtils:graphicsUtils,groupD8:groupD8,isMobile:isMobile,isSingleItem:isSingleItem,loadBitmapFont:loadBitmapFont,loadDDS:loadDDS,loadImageBitmap:loadImageBitmap,loadJson:loadJson,loadKTX:loadKTX,loadSVG:loadSVG,loadTextures:loadTextures,loadTxt:loadTxt,loadWebFont:loadWebFont,parseDDS:parseDDS,parseKTX:parseKTX,resolveCompressedTextureUrl:resolveCompressedTextureUrl,resolveTextureUrl:resolveTextureUrl,settings:settings,spritesheetAsset:spritesheetAsset,uniformParsers:uniformParsers,unsafeEvalSupported:unsafeEvalSupported,utils:index});var app=new Application({resizeTo:window});document.body.appendChild(app.view);var geometry=new Geometry().addAttribute('aVertexPosition',// the attribute name
[-100,-100,// x, y
100,-100,// x, y
100,100,-100,100],// x, y
2)// the size of the attribute
.addAttribute('aUvs',// the attribute name
[0,0,// u, v
1,0,// u, v
1,1,0,1],// u, v
2)// the size of the attribute
.addIndex([0,1,2,0,2,3]);var vertexSrc="\n\n    precision mediump float;\n\n    attribute vec2 aVertexPosition;\n    attribute vec2 aUvs;\n\n    uniform mat3 translationMatrix;\n    uniform mat3 projectionMatrix;\n\n    varying vec2 vUvs;\n\n    void main() {\n\n        vUvs = aUvs;\n        gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    }";var fragmentSrc="\n\n    precision mediump float;\n\n    varying vec2 vUvs;\n\n    uniform sampler2D uSampler2;\n    uniform float time;\n\n    void main() {\n\n        gl_FragColor = texture2D(uSampler2, vUvs + sin( (time + (vUvs.x) * 14.) ) * 0.1 );\n    }";var uniforms={uSampler2:Texture.from('https://pixijs.com/assets/bg_scene_rotate.jpg'),time:0};var shader=Shader.from(vertexSrc,fragmentSrc,uniforms);var quad=new Mesh(geometry,shader);quad.position.set(400,300);quad.scale.set(2);app.stage.addChild(quad);// start the animation..
// requestAnimationFrame(animate);
app.ticker.add(function(delta){quad.rotation+=0.01;quad.shader.uniforms.time+=0.1;});return PIXI;});
